<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>H∆∞·ªõng d·∫´n SQL t·ª´ A-Z</title>
    <style>
      :root {
        --indigo: #667eea;
        --purple: #764ba2;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        background: linear-gradient(135deg, var(--indigo), var(--purple));
        min-height: 100vh;
        color: #1f2937;
        line-height: 1.6;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      .header {
        background: rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 16px 24px;
        margin-bottom: 24px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        color: #fff;
      }
      .course-line {
        display: flex;
        gap: 18px;
        align-items: center;
        flex-wrap: wrap;
      }
      .course-code {
        color: #ffd700;
        font-weight: 800;
        font-size: 22px;
      }
      .author {
        opacity: 0.9;
        font-size: 14px;
      }
      .fb-link a {
        color: #ffd700;
        font-weight: 700;
        text-decoration: none;
      }
      .fb-link a:hover {
        text-decoration: underline;
      }
      .main-container {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }
      .sidebar {
        width: 320px;
        background: #fff;
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        max-height: 80vh;
        overflow-y: auto;
        position: sticky;
        top: 20px;
      }
      .sidebar h3 {
        color: var(--indigo);
        font-size: 18px;
        margin-bottom: 10px;
        text-align: center;
      }
      .tabs {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 12px;
      }
      .tab-btn {
        background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
        border: 1px solid #e6e9ff;
        color: var(--purple);
        font-size: 14px;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        font-weight: 700;
      }
      .tab-btn.active,
      .tab-btn:hover {
        background: linear-gradient(135deg, var(--indigo), var(--purple));
        color: #fff;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .toc-item {
        padding: 8px 10px;
        cursor: pointer;
        color: #374151;
        border-radius: 8px;
        transition: 0.15s;
        font-size: 14px;
        margin: 2px 0;
      }
      .toc-item:hover,
      .toc-item.active {
        background: rgba(102, 126, 234, 0.15);
        color: var(--indigo);
        padding-left: 14px;
        font-weight: 700;
      }
      .content-area {
        flex: 1;
        background: #fff;
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        max-height: 80vh;
        overflow-y: auto;
      }
      .search-box {
        width: 100%;
        padding: 12px 14px;
        margin-bottom: 16px;
        border: 2px solid var(--indigo);
        border-radius: 10px;
        font-size: 16px;
      }
      .section {
        display: none;
        animation: fadeIn 0.35s ease-in;
      }
      .section.active {
        display: block;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      .section h2 {
        color: var(--indigo);
        font-size: 26px;
        margin: 0 0 16px 0;
        padding-bottom: 10px;
        border-bottom: 3px solid var(--indigo);
      }
      .section h3 {
        color: var(--purple);
        font-size: 18px;
        margin: 20px 0 10px;
        padding: 10px;
        background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
        border-left: 5px solid var(--indigo);
        border-radius: 8px;
      }
      .code-block {
        background: #f8f9fa;
        color: #2d3748;
        padding: 20px;
        border-radius: 12px;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 14px;
        line-height: 1.8;
        overflow-x: auto;
        position: relative;
        margin: 15px 0;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        white-space: pre-line;
      }
      .code-block::before {
        content: "SQL";
        position: absolute;
        top: 8px;
        right: 12px;
        background: linear-gradient(135deg, var(--indigo), var(--purple));
        color: #fff;
        border-radius: 6px;
        font-size: 12px;
        padding: 4px 8px;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* Enhanced SQL Syntax Highlighting */
      .code-block .keyword {
        color: #0066cc;
        font-weight: bold;
      }
      .code-block .string {
        color: #22863a;
        font-weight: 500;
      }
      .code-block .number {
        color: #e36209;
        font-weight: 500;
      }
      .code-block .comment {
        color: #6a737d;
        font-style: italic;
        opacity: 0.8;
        font-size: 13px;
      }
      .code-block .function {
        color: #6f42c1;
        font-weight: 600;
      }
      .code-block .datatype {
        color: #d73a49;
        font-weight: 600;
      }
      .code-block .operator {
        color: #005cc5;
        font-weight: 500;
      }
      .code-block .table {
        color: #032f62;
        font-weight: 500;
      }
      .code-block .column {
        color: #24292e;
      }

      /* Legacy classes for compatibility */
      .sql-keyword {
        color: #0066cc;
        font-weight: bold;
      }
      .sql-string {
        color: #22863a;
      }
      .sql-comment {
        color: #6a737d;
        font-style: italic;
      }
      .sql-number {
        color: #e36209;
      }
      .sql-function {
      .sql-function {
        color: #800080;
        font-weight: bold;
      }
      .sql-operator {
        color: #ff0000;
        font-weight: bold;
      }
      .example,
      .info-box,
      .success-box,
      .highlight-box,
      .note {
        border-radius: 10px;
        padding: 14px;
        margin: 12px 0;
      }
      .example {
        background: #f7fafc;
        border-left: 4px solid #4299e1;
      }
      .info-box {
        background: linear-gradient(135deg, #ebf8ff, #bee3f8);
        border-left: 4px solid #3182ce;
      }
      .success-box {
        background: linear-gradient(135deg, #f0fff4, #c6f6d5);
        border-left: 4px solid #38a169;
      }
      .highlight-box {
        background: linear-gradient(135deg, #fff5f5, #fed7d7);
        border-left: 4px solid #e53e3e;
      }
      .note {
        background: #fffbeb;
        border-left: 4px solid #f6ad55;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        border: 1px solid #e2e8f0;
      }

      thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      th {
        padding: 16px 20px;
        text-align: left;
        color: #fff;
        font-weight: 600;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: none;
        position: relative;
      }

      th:not(:last-child)::after {
        content: '';
        position: absolute;
        right: 0;
        top: 25%;
        height: 50%;
        width: 1px;
        background: rgba(255, 255, 255, 0.2);
      }

      td {
        padding: 14px 20px;
        text-align: left;
        border-bottom: 1px solid #f1f5f9;
        color: #334155;
        font-size: 14px;
        line-height: 1.5;
        vertical-align: top;
      }

      tbody tr {
        transition: all 0.2s ease;
      }

      tbody tr:hover {
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      tbody tr:nth-child(even) {
        background: #f8fafc;
      }

      tbody tr:nth-child(even):hover {
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      /* Table content styling */
      table td b {
        color: #1e293b;
        font-weight: 600;
      }

      table td code {
        background: #f1f5f9;
        color: #e11d48;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 13px;
        font-family: "Consolas", "Monaco", monospace;
      }

      /* Special table types */
      .datatype-table {
        margin: 25px 0;
      }

      .datatype-table th {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        font-size: 13px;
      }

      .comparison-table {
        margin: 25px 0;
      }

      .comparison-table th {
        background: linear-gradient(135deg, #059669 0%, #0d9488 100%);
        font-size: 13px;
      }

      .features-table {
        margin: 25px 0;
      }

      .features-table th {
        background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
        font-size: 13px;
      }

      /* Status indicators in tables */
      .status-yes {
        color: #059669;
        font-weight: 600;
      }

      .status-no {
        color: #dc2626;
        font-weight: 600;
      }

      .status-partial {
        color: #d97706;
        font-weight: 600;
      }

      /* Table badges */
      .table-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge-high {
        background: #dcfce7;
        color: #166534;
      }

      .badge-medium {
        background: #fef3c7;
        color: #92400e;
      }

      .badge-low {
        background: #fee2e2;
        color: #991b1b;
      }

      .badge-feature {
        background: #e0e7ff;
        color: #3730a3;
      }
      .back-to-top {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: var(--indigo);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        cursor: pointer;
        font-size: 18px;
        display: none;
      }
      .back-to-top:hover {
        background: var(--purple);
      }
      @media (max-width: 1024px) {
        .main-container {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          position: relative;
          max-height: none;
        }
        .content-area {
          max-height: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="fb-link">
          üìò Facebook:
          <a
            href="https://www.facebook.com/vu.hoang.79219"
            target="_blank"
            rel="noopener"
            >Ho√†ng Ho√†ng</a
          >
        </div>
        <div class="course-line">
          <div class="course-code">DBI202</div>
          <div class="author">T√°c gi·∫£: HO√ÄNG HO√ÄNG</div>
        </div>
      </div>

      <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
          <h3>üîç M·ª•c L·ª•c</h3>
          <div class="tabs">
            <button class="tab-btn active" data-tab="basic">
              PH·∫¶N I: C∆† B·∫¢N
            </button>
            <button class="tab-btn" data-tab="constraints">
              PH·∫¶N II: CONSTRAINTS & INDEX
            </button>
            <button class="tab-btn" data-tab="basic-sql">
              PH·∫¶N III: SQL C∆† B·∫¢N
            </button>
            <button class="tab-btn" data-tab="advanced">
              PH·∫¶N IV: N√ÇNG CAO
            </button>
            <button class="tab-btn" data-tab="expert">
              PH·∫¶N V: C·∫§U TR√öC N√ÇNG CAO
            </button>
            <button class="tab-btn" data-tab="videos">üé¨ VIDEO TRICKS</button>
          </div>

          <div class="tab-content active" id="basic">
            <div class="toc-item" data-target="datatype">1. Datatype</div>
            <div class="toc-item" data-target="char-varchar">
              2. CHAR vs VARCHAR
            </div>
            <div class="toc-item" data-target="conversion">
              3. Chuy·ªÉn ƒë·ªïi ki·ªÉu
            </div>
            <div class="toc-item" data-target="truncate-drop-delete">
              4. TRUNCATE vs DROP vs DELETE
            </div>
            <div class="toc-item" data-target="identity-sequence">
              5. Identity vs Sequence
            </div>
          </div>

          <div class="tab-content" id="constraints">
            <div class="toc-item" data-target="constraint">6. Constraint</div>
            <div class="toc-item" data-target="constraint-ways">
              7. C√°ch t·∫°o constraint
            </div>
            <div class="toc-item" data-target="unique-pk">8. Unique vs PK</div>
            <div class="toc-item" data-target="index">9. Index</div>
          </div>

          <div class="tab-content" id="basic-sql">
            <div class="toc-item" data-target="sql-order">
              10. Th·ª© t·ª± th·ª±c thi SQL
            </div>
            <div class="toc-item" data-target="where-having">
              11. WHERE vs HAVING
            </div>
            <div class="toc-item" data-target="union-merge">
              12. UNION, MERGE, PIVOT, INTERSECT
            </div>
            <div class="toc-item" data-target="relationship">
              13. Relationship & Chu·∫©n h√≥a
            </div>
            <div class="toc-item" data-target="group-by">14. GROUP BY</div>
            <div class="toc-item" data-target="functions">15. C√°c function</div>
          </div>

          <div class="tab-content" id="advanced">
            <div class="toc-item" data-target="join">16. JOIN</div>
            <div class="toc-item" data-target="view">17. VIEW</div>
            <div class="toc-item" data-target="subquery">18. SUBQUERY</div>
            <div class="toc-item" data-target="ranking">
              19. Ranking / Window
            </div>
            <div class="toc-item" data-target="cte">20. CTE</div>
          </div>

          <div class="tab-content" id="expert">
            <div class="toc-item" data-target="conditions">
              21. L·ªánh ƒëi·ªÅu khi·ªÉn
            </div>
            <div class="toc-item" data-target="udf">22. UDF</div>
            <div class="toc-item" data-target="sp">23. Stored Procedure</div>
            <div class="toc-item" data-target="exception">24. Exception</div>
            <div class="toc-item" data-target="transaction">
              25. Transaction
            </div>
            <div class="toc-item" data-target="trigger">26. Trigger</div>
            <div class="toc-item" data-target="acid">27. ACID</div>
          </div>

          <div class="tab-content" id="videos">
            <div class="toc-item" data-target="video-tricks">
              üé¨ M·∫πo & Video
            </div>
          </div>
        </aside>

        <!-- Content -->
        <main class="content-area">
          <input
            type="text"
            class="search-box"
            placeholder="üîç T√¨m ki·∫øm..."
            id="searchBox"
          />

          <!-- 1 -->
          <section class="section active" id="datatype">
            <h2>üìä DATATYPE C·ª¶A SQL - H∆Ø·ªöNG D·∫™N CHI TI·∫æT</h2>

            <h3>ÔøΩ 1. KI·ªÇU S·ªê (NUMERIC TYPES)</h3>

            <h3>S·ªë nguy√™n (Integer Types)</h3>
            <table class="datatype-table">
              <thead>
                <tr>
                  <th>Ki·ªÉu d·ªØ li·ªáu</th>
                  <th>Ph·∫°m vi gi√° tr·ªã</th>
                  <th>K√≠ch th∆∞·ªõc</th>
                  <th>Khi n√†o s·ª≠ d·ª•ng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>TINYINT</b></td>
                  <td>0 ƒë·∫øn 255</td>
                  <td><span class="table-badge badge-high">1 byte</span></td>
                  <td>Tu·ªïi, th√°ng, tr·∫°ng th√°i</td>
                </tr>
                <tr>
                  <td><b>SMALLINT</b></td>
                  <td>-32,768 ƒë·∫øn 32,767</td>
                  <td><span class="table-badge badge-high">2 bytes</span></td>
                  <td>S·ªë l∆∞·ª£ng nh·ªè, nƒÉm</td>
                </tr>
                <tr>
                  <td><b>INT</b></td>
                  <td>-2,147,483,648 ƒë·∫øn 2,147,483,647</td>
                  <td><span class="table-badge badge-medium">4 bytes</span></td>
                  <td>ID, s·ªë l∆∞·ª£ng th√¥ng th∆∞·ªùng</td>
                </tr>
                <tr>
                  <td><b>BIGINT</b></td>
                  <td>
                    -9,223,372,036,854,775,808 ƒë·∫øn 9,223,372,036,854,775,807
                  </td>
                  <td><span class="table-badge badge-low">8 bytes</span></td>
                  <td>ID l·ªõn, timestamp</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">SanPham</span> (
                  <span class="column">ID</span> <span class="datatype">INT</span>,
                  <span class="column">SoLuongTon</span> <span class="datatype">SMALLINT</span>,
                  <span class="column">TrangThai</span> <span class="datatype">TINYINT</span>,
                  <span class="column">ViewCount</span> <span class="datatype">BIGINT</span>
                );

                <span class="keyword">INSERT INTO</span> <span class="table">SanPham</span>
                <span class="keyword">VALUES</span> (<span class="number">1001</span>, <span class="number">150</span>, <span class="number">1</span>, <span class="number">2500000</span>);
              </div>
            </div>

            <h3>üí∞ S·ªë th·∫≠p ph√¢n (Decimal Types)</h3>
            <table class="datatype-table">
              <thead>
                <tr>
                  <th>Ki·ªÉu d·ªØ li·ªáu</th>
                  <th>M√¥ t·∫£</th>
                  <th>ƒê·ªô ch√≠nh x√°c</th>
                  <th>S·ª≠ d·ª•ng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>DECIMAL(p,s)</b></td>
                  <td>S·ªë th·∫≠p ph√¢n ch√≠nh x√°c</td>
                  <td><span class="status-yes">Cao</span></td>
                  <td>Ti·ªÅn t·ªá, t·ª∑ l·ªá ch√≠nh x√°c</td>
                </tr>
                <tr>
                  <td><b>NUMERIC(p,s)</b></td>
                  <td>Gi·ªëng DECIMAL</td>
                  <td><span class="status-yes">Cao</span></td>
                  <td>T√≠nh to√°n t√†i ch√≠nh</td>
                </tr>
                <tr>
                  <td><b>FLOAT</b></td>
                  <td>S·ªë th·ª±c d·∫•u ph·∫©y ƒë·ªông</td>
                  <td><span class="status-no">Th·∫•p</span></td>
                  <td>T√≠nh to√°n khoa h·ªçc</td>
                </tr>
                <tr>
                  <td><b>REAL</b></td>
                  <td>S·ªë th·ª±c ƒë·ªô ch√≠nh x√°c ƒë∆°n</td>
                  <td><span class="status-partial">Trung b√¨nh</span></td>
                  <td>T·ªça ƒë·ªô, measurement</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• chi ti·∫øt:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">DonHang</span> (
                  <span class="column">ID</span> <span class="datatype">INT</span>,
                  <span class="column">Gia</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),
                  <span class="column">ThueVAT</span> <span class="datatype">DECIMAL</span>(<span class="number">5</span>,<span class="number">4</span>),
                  <span class="column">KhoiLuong</span> <span class="datatype">FLOAT</span>,
                  <span class="column">TyLeGiamGia</span> <span class="datatype">REAL</span>
                );

                <span class="keyword">INSERT INTO</span> <span class="table">DonHang</span>
                <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1299000.50</span>, <span class="number">0.1000</span>, <span class="number">2.756891</span>, <span class="number">0.15</span>), 
                       (<span class="number">2</span>, <span class="number">850000.00</span>, <span class="number">0.0800</span>, <span class="number">1.234567</span>, <span class="number">0.20</span>);

                <span class="keyword">SELECT</span>
                <span class="column">ID</span>, <span class="column">Gia</span>,
                <span class="column">Gia</span> <span class="operator">*</span>
                <span class="column">ThueVAT</span>
                <span class="keyword">AS</span>
                <span class="column">TienThue</span>,
                <span class="column">Gia</span>
                <span class="operator">*</span> (<span class="number">1</span>
                <span class="operator">+</span>
                <span class="column">ThueVAT</span>)
                <span class="keyword">AS</span>
                <span class="column">GiaSauThue</span>
                <span class="keyword">FROM</span>
                <span class="table">DonHang</span>;
              </div>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω v·ªÅ FLOAT vs DECIMAL:</h4>
              <div class="code-block">
                <span class="comment">-- FLOAT c√≥ th·ªÉ m·∫•t ƒë·ªô ch√≠nh x√°c</span>
                <span class="keyword">SELECT</span> <span class="number">0.1</span> <span class="operator">+</span> <span class="number">0.2</span> <span class="keyword">AS</span> <span class="column">FloatResult</span>,       <span class="comment">-- K·∫øt qu·∫£: 0.30000000000000004</span>
                       <span class="function">CAST</span>(<span class="number">0.1</span> <span class="keyword">AS</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>)) <span class="operator">+</span> <span class="function">CAST</span>(<span class="number">0.2</span> <span class="keyword">AS</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>)) <span class="keyword">AS</span> <span class="column">DecimalResult</span> <span class="comment">-- K·∫øt qu·∫£: 0.30</span>
                <span class="comment">-- V√¨ v·∫≠y v·ªõi ti·ªÅn t·ªá lu√¥n d√πng DECIMAL!</span>
              </div>
            </div>

            <h3>üìù 2. KI·ªÇU CHU·ªñI (STRING TYPES)</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>Ki·ªÉu</th>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>K√≠ch th∆∞·ªõc</th>
                  <th>S·ª≠ d·ª•ng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>CHAR(n)</b></td>
                  <td>ƒê·ªô d√†i c·ªë ƒë·ªãnh</td>
                  <td><span class="table-badge badge-low">n bytes</span></td>
                  <td>M√£ code c·ªë ƒë·ªãnh</td>
                </tr>
                <tr>
                  <td><b>VARCHAR(n)</b></td>
                  <td>ƒê·ªô d√†i thay ƒë·ªïi</td>
                  <td>
                    <span class="table-badge badge-high"
                      >Th·ª±c t·∫ø + 2 bytes</span
                    >
                  </td>
                  <td>T√™n, m√¥ t·∫£</td>
                </tr>
                <tr>
                  <td><b>TEXT</b></td>
                  <td>VƒÉn b·∫£n d√†i</td>
                  <td>R·∫•t l·ªõn</td>
                  <td>N·ªôi dung, m√¥ t·∫£ chi ti·∫øt</td>
                </tr>
                <tr>
                  <td><b>NCHAR(n)</b></td>
                  <td>Unicode c·ªë ƒë·ªãnh</td>
                  <td>n * 2 bytes</td>
                  <td>ƒêa ng√¥n ng·ªØ</td>
                </tr>
                <tr>
                  <td><b>NVARCHAR(n)</b></td>
                  <td>Unicode thay ƒë·ªïi</td>
                  <td>Th·ª±c t·∫ø * 2 + 2 bytes</td>
                  <td>T√™n ti·∫øng Vi·ªát</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• so s√°nh CHAR vs VARCHAR:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">Demo</span> (
                  <span class="column">MaKH</span> <span class="datatype">CHAR</span>(<span class="number">10</span>), 
                  <span class="column">TenKH</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>), 
                  <span class="column">GhiChu</span> <span class="datatype">TEXT</span>
                );

                <span class="keyword">INSERT INTO</span> <span class="table">Demo</span>
                <span class="keyword">VALUES</span> (<span class="string">'KH001'</span>, <span class="string">'Nguy·ªÖn VƒÉn An'</span>, <span class="string">'Kh√°ch h√†ng VIP t·ª´ nƒÉm 2020'</span>),
                       (<span class="string">'KH002'</span>, <span class="string">'Tr·∫ßn Th·ªã B√¨nh'</span>, <span class="string">'Kh√°ch h√†ng th∆∞·ªùng xuy√™n mua h√†ng'</span>);

                <span class="keyword">SELECT</span> <span class="column">MaKH</span>,
                <span class="function">LEN</span>(<span class="column"
                  >MaKH</span
                >) <span class="keyword">AS</span>
                <span class="column">DoDaiMaKH</span>,
                <span class="column">TenKH</span>,
                <span class="function">LEN</span>(<span class="column"
                  >TenKH</span
                >) <span class="keyword">AS</span>
                <span class="column">DoDaiTenKH</span>
                <span class="keyword">FROM</span>
                <span class="table">Demo</span>;
              </div>
            </div>

            <div class="info-box">
              <h4>üåè Unicode cho ti·∫øng Vi·ªát:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">KhachHang</span> (
                  <span class="column">ID</span> <span class="datatype">INT</span>,
                  <span class="column">TenKH</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>), 
                  <span class="column">DiaChi</span> <span class="datatype">NVARCHAR</span>(<span class="number">200</span>), 
                  <span class="column">GhiChu</span> <span class="datatype">NTEXT</span>
                );
                );

                <span class="keyword">INSERT INTO</span>
                <span class="table">KhachHang</span>
                <span class="keyword">VALUES</span> (<span class="number"
                  >1</span
                >, <span class="string">N'Nguy·ªÖn VƒÉn √Ånh'</span>,
                <span class="string">N'123 ƒê∆∞·ªùng L√™ L·ª£i, Qu·∫≠n 1, TP.HCM'</span>,
                <span class="string">N'Kh√°ch h√†ng c√≥ uy t√≠n cao'</span>);
              </div>
            </div>

            <h3>üìÖ 3. KI·ªÇU NG√ÄY TH√ÅNG (DATE/TIME TYPES)</h3>
            <table class="datatype-table">
              <thead>
                <tr>
                  <th>Ki·ªÉu</th>
                  <th>Ph·∫°m vi</th>
                  <th>ƒê·ªãnh d·∫°ng</th>
                  <th>ƒê·ªô ch√≠nh x√°c</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>DATE</b></td>
                  <td>0001-01-01 ƒë·∫øn 9999-12-31</td>
                  <td><code>YYYY-MM-DD</code></td>
                  <td><span class="table-badge badge-feature">Ng√†y</span></td>
                </tr>
                <tr>
                  <td><b>TIME</b></td>
                  <td>00:00:00.0000000 ƒë·∫øn 23:59:59.9999999</td>
                  <td><code>HH:MM:SS</code></td>
                  <td>
                    <span class="table-badge badge-feature">Th·ªùi gian</span>
                  </td>
                </tr>
                <tr>
                  <td><b>DATETIME</b></td>
                  <td>1753-01-01 ƒë·∫øn 9999-12-31</td>
                  <td>YYYY-MM-DD HH:MM:SS</td>
                  <td>3.33ms</td>
                </tr>
                <tr>
                  <td><b>DATETIME2</b></td>
                  <td>0001-01-01 ƒë·∫øn 9999-12-31</td>
                  <td>YYYY-MM-DD HH:MM:SS.nnnnnnn</td>
                  <td>100ns</td>
                </tr>
                <tr>
                  <td><b>TIMESTAMP</b></td>
                  <td>1970-01-01 ƒë·∫øn 2038-01-19</td>
                  <td>Unix timestamp</td>
                  <td>1 gi√¢y</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">LichSuGiaoDich</span> (
                    <span class="column">ID</span> <span class="datatype">INT</span>,
                    <span class="column">NgayGiaoDich</span> <span class="datatype">DATE</span>,
                    <span class="column">GioGiaoDich</span> <span class="datatype">TIME</span>,
                    <span class="column">ThoiDiemDayDu</span> <span class="datatype">DATETIME2</span>
                );

                <span class="keyword">INSERT INTO</span> <span class="table">LichSuGiaoDich</span> 
                <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'2023-12-01'</span>, <span class="string">'14:30:00'</span>, <span class="string">'2023-12-01 14:30:25'</span>);
              </div>
            </div>

            <div class="success-box">
              <h4>üïí V√≠ d·ª• t√≠nh to√°n th·ªùi gian:</h4>
              <div class="code-block">
                <span class="keyword">SELECT</span>
                <span class="function">GETDATE</span>()
                <span class="keyword">AS</span>
                <span class="column">HienTai</span>,
                <span class="function">DATEADD</span>(<span class="keyword"
                  >DAY</span
                >, <span class="number">7</span>,
                <span class="function">GETDATE</span>())
                <span class="keyword">AS</span>
                <span class="column">Sau7Ngay</span>,
                <span class="function">DATEADD</span>(<span class="keyword"
                  >MONTH</span
                >, <span class="number">-3</span>,
                <span class="function">GETDATE</span>())
                <span class="keyword">AS</span>
                <span class="column">Truoc3Thang</span>,
                <span class="function">DATEADD</span>(<span class="keyword"
                  >YEAR</span
                >, <span class="number">1</span>,
                <span class="function">GETDATE</span>())
                <span class="keyword">AS</span>
                <span class="column">SangNam</span>;

                <span class="keyword">SELECT</span>
                <span class="function">CONVERT</span>(<span class="datatype"
                  >VARCHAR</span
                >(<span class="number">10</span>),
                <span class="function">GETDATE</span>(),
                <span class="number">103</span>)
                <span class="keyword">AS</span>
                <span class="column">DD_MM_YYYY</span>,
                <span class="function">CONVERT</span>(<span class="datatype"
                  >VARCHAR</span
                >(<span class="number">10</span>),
                <span class="function">GETDATE</span>(),
                <span class="number">101</span>)
                <span class="keyword">AS</span>
                <span class="column">MM_DD_YYYY</span>; as MM_DD_YYYY, --
                12/01/2023 FORMAT(GETDATE(), 'dd/MM/yyyy') as DinhDangVN; --
                01/12/2023
              </div>
            </div>

            <h3>‚úÖ 4. KI·ªÇU BOOLEAN V√Ä BINARY</h3>
            <div class="example">
              <h4>üîß Ki·ªÉu Boolean (BIT):</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">CauHinh</span> (
                    <span class="column">ID</span> <span class="datatype">INT</span>,
                    <span class="column">TenCauHinh</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>),
                    <span class="column">GiaTriBoolean</span> <span class="datatype">BIT</span>, <span class="comment">-- 0 = False, 1 = True</span>
                    <span class="column">MoTa</span> <span class="datatype">VARCHAR</span>(<span class="number">100</span>)
                );
                
                <span class="keyword">INSERT INTO</span> <span class="table">CauHinh</span> 
                <span class="keyword">VALUES</span> 
                    (<span class="number">1</span>, <span class="string">'AllowRegistration'</span>, <span class="number">1</span>, <span class="string">'Cho ph√©p ƒëƒÉng k√Ω m·ªõi'</span>),
                    (<span class="number">2</span>, <span class="string">'MaintenanceMode'</span>, <span class="number">0</span>, <span class="string">'Ch·∫ø ƒë·ªô b·∫£o tr√¨'</span>),
                    (<span class="number">3</span>, <span class="string">'EnableNotification'</span>, <span class="number">1</span>, <span class="string">'B·∫≠t th√¥ng b√°o'</span>);
                       
                <span class="comment">-- S·ª≠ d·ª•ng</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">CauHinh</span> 
                <span class="keyword">WHERE</span> <span class="column">GiaTriBoolean</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- L·∫•y c√°c c·∫•u h√¨nh ƒëang b·∫≠t</span>
              </div>
            </div>

            <div class="example">
              <h4>üíæ Ki·ªÉu Binary:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">TapTin</span> (
                    <span class="column">ID</span> <span class="datatype">INT</span>,
                    <span class="column">TenFile</span> <span class="datatype">VARCHAR</span>(<span class="number">100</span>),
                    <span class="column">NoiDung</span> <span class="datatype">VARBINARY</span>(<span class="keyword">MAX</span>),
                    <span class="column">KichThuoc</span> <span class="datatype">INT</span>
                );
                
                <span class="keyword">INSERT INTO</span> <span class="table">TapTin</span> 
                <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'logo.png'</span>, <span class="string">0x89504E470D0A...</span>, <span class="number">2048</span>);
                
                <span class="comment">-- L·∫•y th√¥ng tin file</span>
                <span class="keyword">SELECT</span> <span class="column">TenFile</span>, <span class="column">KichThuoc</span>, <span class="column">LoaiFile</span>, 
                       <span class="function">LEN</span>(<span class="column">NoiDung</span>) <span class="keyword">AS</span> <span class="column">KichThuocThucTe</span> 
                <span class="keyword">FROM</span> <span class="table">TapTin</span>;
              </div>
            </div>

            <h3>üÜî 5. KI·ªÇU ƒê·∫∂C BI·ªÜT</h3>
            <div class="example">
              <h4>IDENTITY - T·ª± ƒë·ªông tƒÉng:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">KhachHang</span> (
                    <span class="column">ID</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>), <span class="comment">-- B·∫Øt ƒë·∫ßu t·ª´ 1, m·ªói l·∫ßn tƒÉng 1</span>
                    <span class="column">MaKH</span> <span class="keyword">AS</span> <span class="string">'KH'</span> <span class="operator">+</span> <span class="function">RIGHT</span>(<span class="string">'000'</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">ID</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>(<span class="number">3</span>)), <span class="number">3</span>), <span class="comment">-- Computed column</span>
                    <span class="column">TenKH</span> <span class="datatype">VARCHAR</span>(<span class="number">100</span>),
                    <span class="column">NgayTao</span> <span class="datatype">DATETIME</span> <span class="keyword">DEFAULT</span> <span class="function">GETDATE</span>()
                );
                
                <span class="keyword">INSERT INTO</span> <span class="table">KhachHang</span> (<span class="column">TenKH</span>)
                <span class="keyword">VALUES</span> (<span class="string">'Nguy·ªÖn VƒÉn A'</span>), (<span class="string">'Tr·∫ßn Th·ªã B'</span>);
              </div>
            </div>

            <div class="note">
              <h4>üìã Nguy√™n t·∫Øc ch·ªçn datatype:</h4>
              <p><b>1. S·ªë nguy√™n:</b></p>
              <ul>
                <li>ID nh·ªè (< 32,000): SMALLINT</li>
                <li>ID th√¥ng th∆∞·ªùng: INT</li>
                <li>ID r·∫•t l·ªõn, timestamp: BIGINT</li>
              </ul>
              <p><b>2. Ti·ªÅn t·ªá:</b></p>
              <ul>
                <li>Lu√¥n d√πng DECIMAL(15,2) ho·∫∑c DECIMAL(18,4)</li>
                <li>Kh√¥ng bao gi·ªù d√πng FLOAT cho ti·ªÅn!</li>
              </ul>
              <p><b>3. Chu·ªói:</b></p>
              <ul>
                <li>M√£ code c·ªë ƒë·ªãnh: CHAR(n)</li>
                <li>T√™n, m√¥ t·∫£: NVARCHAR(n) (h·ªó tr·ª£ Unicode)</li>
                <li>N·ªôi dung d√†i: NTEXT</li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>‚ö° Performance Tips:</h4>
              <ul>
                <li>Datatype nh·ªè h∆°n = truy v·∫•n nhanh h∆°n</li>
                <li>Index hi·ªáu qu·∫£ h∆°n tr√™n datatype ph√π h·ª£p</li>
                <li>
                  Tr√°nh chuy·ªÉn ƒë·ªïi datatype kh√¥ng c·∫ßn thi·∫øt trong WHERE clause
                </li>
              </ul>
            </div>
          </section>

          <!-- 2 -->
          <section class="section" id="char-varchar">
            <h2>2. Ph√¢n bi·ªát CHAR vs VARCHAR</h2>

            <h3>üìù CHAR (Character)</h3>
            <p>
              CHAR l√† ki·ªÉu d·ªØ li·ªáu chu·ªói k√Ω t·ª± c√≥ <b>ƒë·ªô d√†i c·ªë ƒë·ªãnh</b>. Khi b·∫°n
              khai b√°o m·ªôt c·ªôt v·ªõi ki·ªÉu d·ªØ li·ªáu CHAR(n), h·ªá th·ªëng s·∫Ω lu√¥n c·∫•p
              ph√°t m·ªôt kh√¥ng gian l∆∞u tr·ªØ l√† n k√Ω t·ª±, b·∫•t k·ªÉ b·∫°n l∆∞u tr·ªØ bao
              nhi√™u k√Ω t·ª± th·ª±c t·∫ø.
            </p>

            <div class="success-box">
              <h4>‚úÖ ∆Øu ƒëi·ªÉm:</h4>
              <p>
                T·ªëc ƒë·ªô truy xu·∫•t nhanh h∆°n v√¨ ƒë·ªô d√†i ƒë√£ ƒë∆∞·ª£c x√°c ƒë·ªãnh tr∆∞·ªõc,
                gi√∫p h·ªá th·ªëng kh√¥ng ph·∫£i t·ªën th·ªùi gian ƒë·ªÉ t√≠nh to√°n ƒë·ªô d√†i.
              </p>
            </div>

            <div class="highlight-box">
              <h4>‚ùå Nh∆∞·ª£c ƒëi·ªÉm:</h4>
              <p>
                L√£ng ph√≠ kh√¥ng gian l∆∞u tr·ªØ. N·∫øu d·ªØ li·ªáu b·∫°n nh·∫≠p ng·∫Øn h∆°n ƒë·ªô
                d√†i ƒë√£ khai b√°o, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông th√™m c√°c kho·∫£ng tr·∫Øng
                (padding) v√†o cu·ªëi chu·ªói cho ƒë·ªß n k√Ω t·ª±.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n khai b√°o m·ªôt c·ªôt <code>ma_san_pham</code> c√≥ ki·ªÉu d·ªØ
                li·ªáu l√† <code>CHAR(10)</code>.
              </p>
              <ul>
                <li>
                  Khi b·∫°n l∆∞u gi√° tr·ªã <code>'SP001'</code>, h·ªá th·ªëng s·∫Ω l∆∞u
                  <code>'SP001 '</code> (chu·ªói 'SP001' c√πng 5 kho·∫£ng tr·∫Øng ·ªü
                  cu·ªëi), chi·∫øm 10 byte.
                </li>
                <li>
                  Khi b·∫°n l∆∞u gi√° tr·ªã <code>'SP12345678'</code>, h·ªá th·ªëng s·∫Ω l∆∞u
                  <code>'SP12345678'</code> (chu·ªói ƒë·∫ßy ƒë·ªß 10 k√Ω t·ª±), chi·∫øm 10
                  byte.
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>üéØ Khi n√†o n√™n d√πng CHAR?</h4>
              <p>
                N√™n d√πng CHAR cho c√°c tr∆∞·ªùng d·ªØ li·ªáu c√≥ ƒë·ªô d√†i c·ªë ƒë·ªãnh v√† ng·∫Øn,
                v√≠ d·ª• nh∆∞ m√£ b∆∞u ƒëi·ªán, m√£ qu·ªëc gia (nh∆∞ 'VN', 'US'), hay c√°c m√£
                s·∫£n ph·∫©m, m√£ danh m·ª•c c√≥ ƒë·ªô d√†i kh√¥ng thay ƒë·ªïi.
              </p>
            </div>

            <h3>üîÑ VARCHAR (Variable Character)</h3>
            <p>
              VARCHAR l√† ki·ªÉu d·ªØ li·ªáu chu·ªói k√Ω t·ª± c√≥ <b>ƒë·ªô d√†i thay ƒë·ªïi</b>. Khi
              b·∫°n khai b√°o m·ªôt c·ªôt v·ªõi ki·ªÉu d·ªØ li·ªáu VARCHAR(n), h·ªá th·ªëng ch·ªâ c·∫•p
              ph√°t kh√¥ng gian l∆∞u tr·ªØ b·∫±ng v·ªõi ƒë·ªô d√†i th·ª±c t·∫ø c·ªßa chu·ªói b·∫°n
              nh·∫≠p, c·ªông th√™m m·ªôt ho·∫∑c hai byte ƒë·ªÉ l∆∞u th√¥ng tin v·ªÅ ƒë·ªô d√†i c·ªßa
              chu·ªói.
            </p>

            <div class="success-box">
              <h4>‚úÖ ∆Øu ƒëi·ªÉm:</h4>
              <p>Ti·∫øt ki·ªám kh√¥ng gian l∆∞u tr·ªØ hi·ªáu qu·∫£.</p>
            </div>

            <div class="highlight-box">
              <h4>‚ùå Nh∆∞·ª£c ƒëi·ªÉm:</h4>
              <p>
                T·ªëc ƒë·ªô x·ª≠ l√Ω c√≥ th·ªÉ ch·∫≠m h∆°n CHAR m·ªôt ch√∫t v√¨ h·ªá th·ªëng ph·∫£i ƒë·ªçc
                th√™m th√¥ng tin v·ªÅ ƒë·ªô d√†i chu·ªói tr∆∞·ªõc khi truy xu·∫•t d·ªØ li·ªáu.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n khai b√°o m·ªôt c·ªôt <code>ten_san_pham</code> c√≥ ki·ªÉu d·ªØ
                li·ªáu l√† <code>VARCHAR(50)</code>.
              </p>
              <ul>
                <li>
                  Khi b·∫°n l∆∞u gi√° tr·ªã <code>'√Åo thun'</code>, h·ªá th·ªëng ch·ªâ l∆∞u
                  <code>'√Åo thun'</code> (kho·∫£ng 7 k√Ω t·ª±) c·ªông v·ªõi 1-2 byte ƒë·ªô
                  d√†i, t·ªïng c·ªông ch·ªâ chi·∫øm kho·∫£ng 8-9 byte.
                </li>
                <li>
                  Khi b·∫°n l∆∞u gi√° tr·ªã
                  <code>'ƒêi·ªán tho·∫°i iPhone 15 Pro Max'</code>, h·ªá th·ªëng s·∫Ω l∆∞u
                  ƒë√∫ng chu·ªói n√†y, kh√¥ng th√™m kho·∫£ng tr·∫Øng v√† ch·ªâ chi·∫øm dung
                  l∆∞·ª£ng c·∫ßn thi·∫øt.
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>üéØ Khi n√†o n√™n d√πng VARCHAR?</h4>
              <p>
                VARCHAR l√† l·ª±a ch·ªçn ph·ªï bi·∫øn nh·∫•t v√† ƒë∆∞·ª£c khuy√™n d√πng cho h·∫ßu
                h·∫øt c√°c tr∆∞·ªùng d·ªØ li·ªáu chu·ªói c√≥ ƒë·ªô d√†i kh√¥ng x√°c ƒë·ªãnh ho·∫∑c thay
                ƒë·ªïi nhi·ªÅu, v√≠ d·ª• nh∆∞ t√™n, ƒë·ªãa ch·ªâ, m√¥ t·∫£ s·∫£n ph·∫©m, email, v√† c√°c
                ƒëo·∫°n vƒÉn b·∫£n.
              </p>
            </div>

            <h3>üìä T√≥m t·∫Øt s·ª± kh√°c bi·ªát</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>CHAR(n)</th>
                  <th>VARCHAR(n)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>ƒê·ªô d√†i</b></td>
                  <td>
                    <span class="table-badge badge-warning">C·ªë ƒë·ªãnh</span>
                  </td>
                  <td>
                    <span class="table-badge badge-feature">Thay ƒë·ªïi</span>
                  </td>
                </tr>
                <tr>
                  <td><b>Dung l∆∞·ª£ng</b></td>
                  <td>Lu√¥n chi·∫øm n byte (ƒë√£ bao g·ªìm kho·∫£ng tr·∫Øng)</td>
                  <td>
                    Ch·ªâ chi·∫øm dung l∆∞·ª£ng th·ª±c t·∫ø c·ªßa chu·ªói + 1 ho·∫∑c 2 byte cho
                    ƒë·ªô d√†i
                  </td>
                </tr>
                <tr>
                  <td><b>T·ªëc ƒë·ªô</b></td>
                  <td><span class="status-yes">Nhanh h∆°n</span></td>
                  <td><span class="status-partial">Ch·∫≠m h∆°n m·ªôt ch√∫t</span></td>
                </tr>
                <tr>
                  <td><b>Ti·∫øt ki·ªám kh√¥ng gian</b></td>
                  <td>
                    <span class="status-no">Kh√¥ng hi·ªáu qu·∫£ (l√£ng ph√≠)</span>
                  </td>
                  <td><span class="status-yes">R·∫•t hi·ªáu qu·∫£</span></td>
                </tr>
                <tr>
                  <td><b>S·ª≠ d·ª•ng ph√π h·ª£p</b></td>
                  <td>D·ªØ li·ªáu c√≥ ƒë·ªô d√†i c·ªë ƒë·ªãnh, ng·∫Øn</td>
                  <td>D·ªØ li·ªáu c√≥ ƒë·ªô d√†i thay ƒë·ªïi</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• t·ªïng h·ª£p:</h4>
              <p>Gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt b·∫£ng <code>users</code> (ng∆∞·ªùi d√πng).</p>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">users</span> (
                  <span class="column">id</span> <span class="datatype">INT</span>,
                  <span class="column">first_name</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>), 
                  <span class="column">last_name</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>), 
                  <span class="column">country_code</span> <span class="datatype">CHAR</span>(<span class="number">2</span>), 
                  <span class="column">phone_number</span> <span class="datatype">VARCHAR</span>(<span class="number">15</span>)
                );
              </div>
              <p><b>Trong v√≠ d·ª• tr√™n:</b></p>
              <ul>
                <li>
                  <code>first_name</code> v√† <code>last_name</code> d√πng VARCHAR
                  v√¨ t√™n ng∆∞·ªùi c√≥ ƒë·ªô d√†i kh√°c nhau.
                </li>
                <li>
                  <code>country_code</code> d√πng CHAR v√¨ m√£ qu·ªëc gia lu√¥n c√≥ 2
                  k√Ω t·ª±.
                </li>
                <li>
                  <code>phone_number</code> d√πng VARCHAR v√¨ ƒë·ªô d√†i s·ªë ƒëi·ªán tho·∫°i
                  c√≥ th·ªÉ thay ƒë·ªïi t√πy theo qu·ªëc gia.
                </li>
              </ul>
            </div>
          </section>

          <!-- 3 -->
          <section class="section" id="conversion">
            <h2>3. Chuy·ªÉn ƒë·ªïi gi·ªØa c√°c ki·ªÉu d·ªØ li·ªáu</h2>

            <h3>üîÑ 1. CAST (chuy·ªÉn ƒë·ªïi ki·ªÉu d·ªØ li·ªáu chung)</h3>
            <p>
              H√†m <b>CAST</b> l√† m·ªôt h√†m ti√™u chu·∫©n trong SQL v√† ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi
              h·∫ßu h·∫øt c√°c h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu (nh∆∞ SQL Server, MySQL,
              PostgreSQL, Oracle).
            </p>

            <div class="info-box">
              <h4>üìù C√∫ ph√°p:</h4>
              <p><code>CAST(bi·ªÉu_th·ª©c AS ki·ªÉu_d·ªØ_li·ªáu)</code></p>
              <h4>üéØ Ch·ª©c nƒÉng:</h4>
              <p>
                Chuy·ªÉn ƒë·ªïi m·ªôt bi·ªÉu th·ª©c th√†nh m·ªôt ki·ªÉu d·ªØ li·ªáu ƒë√£ ch·ªâ ƒë·ªãnh.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>

              <h5><b>Chuy·ªÉn s·ªë th√†nh chu·ªói:</b></h5>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="function">CAST</span>(<span class="number">123</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>(<span class="number">10</span>)); 
                <span class="comment">-- K·∫øt qu·∫£: '123'</span>
              </div>
              <p>
                ƒê√¢y l√† c√°ch b·∫°n c√≥ th·ªÉ n·ªëi m·ªôt gi√° tr·ªã s·ªë v√†o m·ªôt chu·ªói vƒÉn b·∫£n.
                V√≠ d·ª•:
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="string">'S·∫£n ph·∫©m c√≥ m√£ l√†: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="number">123</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>(<span class="number">10</span>));
              </div>

              <h5><b>Chuy·ªÉn chu·ªói th√†nh s·ªë:</b></h5>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="function">CAST</span>(<span class="string">'123.45'</span> <span class="keyword">AS</span> <span class="datatype">DECIMAL</span>(<span class="number">5</span>, <span class="number">2</span>)); 
                <span class="comment">-- K·∫øt qu·∫£: 123.45</span>
              </div>

              <h5><b>Chuy·ªÉn chu·ªói th√†nh ng√†y th√°ng:</b></h5>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="function">CAST</span>(<span class="string">'2025-09-21'</span> <span class="keyword">AS</span> <span class="datatype">DATE</span>); 
                <span class="comment">-- K·∫øt qu·∫£: 2025-09-21</span>
              </div>
            </div>

            <h3>üé® 2. CONVERT (chuy·ªÉn ƒë·ªïi ki·ªÉu d·ªØ li·ªáu c√≥ ƒë·ªãnh d·∫°ng)</h3>
            <p>
              H√†m <b>CONVERT</b> l√† h√†m ri√™ng c·ªßa SQL Server v√† m·ªôt s·ªë h·ªá qu·∫£n
              tr·ªã c∆° s·ªü d·ªØ li·ªáu kh√°c, cung c·∫•p c√°c t√πy ch·ªçn ƒë·ªãnh d·∫°ng n√¢ng cao
              h∆°n CAST, ƒë·∫∑c bi·ªát h·ªØu √≠ch khi x·ª≠ l√Ω d·ªØ li·ªáu ng√†y th√°ng.
            </p>

            <div class="info-box">
              <h4>üìù C√∫ ph√°p:</h4>
              <p>
                <code>CONVERT(ki·ªÉu_d·ªØ_li·ªáu, bi·ªÉu_th·ª©c, [ki·ªÉu_ƒë·ªãnh_d·∫°ng])</code>
              </p>
              <h4>üéØ Ch·ª©c nƒÉng:</h4>
              <p>
                Chuy·ªÉn ƒë·ªïi m·ªôt bi·ªÉu th·ª©c th√†nh m·ªôt ki·ªÉu d·ªØ li·ªáu, v·ªõi kh·∫£ nƒÉng
                ch·ªâ ƒë·ªãnh m·ªôt m√£ ƒë·ªãnh d·∫°ng (style code) c·ª• th·ªÉ.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>

              <h5><b>ƒê·ªãnh d·∫°ng ng√†y th√°ng:</b></h5>
              <div class="code-block">
                <span class="keyword">SELECT</span>
                <span class="function">CONVERT</span>(<span class="datatype"
                  >VARCHAR</span
                >, <span class="function">GETDATE</span>(),
                <span class="number">103</span>);
              </div>
              <p>
                S·ªë <b>103</b> l√† m·ªôt m√£ ƒë·ªãnh d·∫°ng cho bi·∫øt ki·ªÉu dd/MM/yyyy. SQL
                Server c√≥ nhi·ªÅu m√£ ƒë·ªãnh d·∫°ng kh√°c nhau ƒë·ªÉ x·ª≠ l√Ω c√°c ki·ªÉu ng√†y
                th√°ng kh√°c.
              </p>

              <h5><b>V√≠ d·ª• kh√°c:</b></h5>
              <div class="code-block">
                <span class="comment">-- ƒê·ªãnh d·∫°ng ng√†y th√°ng ki·ªÉu yyyy-MM-dd</span>
                <span class="keyword">SELECT</span> <span class="function">CONVERT</span>(<span class="datatype">VARCHAR</span>, <span class="function">GETDATE</span>(), <span class="number">23</span>); 
                <span class="comment">-- K·∫øt qu·∫£: '2025-09-21'</span>
              </div>
            </div>

            <h3>üìä T√≥m t·∫Øt s·ª± kh√°c bi·ªát</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>CAST</th>
                  <th>CONVERT</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>T√≠nh t∆∞∆°ng th√≠ch</b></td>
                  <td>
                    <span class="status-yes">H·∫ßu h·∫øt c√°c h·ªá qu·∫£n tr·ªã CSDL</span>
                  </td>
                  <td>
                    <span class="status-partial">Ch·ªß y·∫øu l√† SQL Server</span>
                  </td>
                </tr>
                <tr>
                  <td><b>C√∫ ph√°p</b></td>
                  <td>
                    ƒê∆°n gi·∫£n: <code>CAST(bi·ªÉu_th·ª©c AS ki·ªÉu_d·ªØ_li·ªáu)</code>
                  </td>
                  <td>
                    Ph·ª©c t·∫°p h∆°n:
                    <code
                      >CONVERT(ki·ªÉu_d·ªØ_li·ªáu, bi·ªÉu_th·ª©c, [m√£_ƒë·ªãnh_d·∫°ng])</code
                    >
                  </td>
                </tr>
                <tr>
                  <td><b>Ch·ª©c nƒÉng</b></td>
                  <td>Chuy·ªÉn ƒë·ªïi ki·ªÉu d·ªØ li·ªáu c∆° b·∫£n</td>
                  <td>
                    Chuy·ªÉn ƒë·ªïi ki·ªÉu d·ªØ li·ªáu v·ªõi c√°c t√πy ch·ªçn ƒë·ªãnh d·∫°ng chi ti·∫øt,
                    ƒë·∫∑c bi·ªát cho ng√†y th√°ng
                  </td>
                </tr>
                <tr>
                  <td><b>ƒê·ªãnh d·∫°ng</b></td>
                  <td>Kh√¥ng c√≥ t√πy ch·ªçn ƒë·ªãnh d·∫°ng</td>
                  <td>C√≥ t√πy ch·ªçn ƒë·ªãnh d·∫°ng th√¥ng qua m√£ s·ªë (style code)</td>
                </tr>
              </tbody>
            </table>

            <div class="success-box">
              <h4>üí° Khuy·∫øn ngh·ªã s·ª≠ d·ª•ng:</h4>
              <ul>
                <li>
                  <b>D√πng CAST</b> cho c√°c chuy·ªÉn ƒë·ªïi ƒë∆°n gi·∫£n v√† ƒë·ªÉ ƒë·∫£m b·∫£o
                  t√≠nh t∆∞∆°ng th√≠ch v·ªõi nhi·ªÅu h·ªá CSDL kh√°c nhau
                </li>
                <li>
                  <b>D√πng CONVERT</b> khi c·∫ßn ƒë·ªãnh d·∫°ng chi ti·∫øt, ƒë·∫∑c bi·ªát v·ªõi
                  ng√†y th√°ng trong SQL Server
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <ul>
                <li>
                  Lu√¥n ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa d·ªØ li·ªáu tr∆∞·ªõc khi chuy·ªÉn ƒë·ªïi
                </li>
                <li>
                  M·ªôt s·ªë chuy·ªÉn ƒë·ªïi c√≥ th·ªÉ g√¢y m·∫•t d·ªØ li·ªáu (v√≠ d·ª•: t·ª´ DECIMAL
                  sang INT)
                </li>
                <li>
                  Chu·ªói kh√¥ng h·ª£p l·ªá s·∫Ω g√¢y l·ªói khi chuy·ªÉn ƒë·ªïi sang s·ªë ho·∫∑c ng√†y
                </li>
              </ul>
            </div>
          </section>

          <!-- 4 -->
          <section class="section" id="truncate-drop-delete">
            <h2>4. TRUNCATE vs DROP vs DELETE</h2>

            <h3>üóëÔ∏è TRUNCATE</h3>
            <p>
              <b>TRUNCATE</b> l√† m·ªôt l·ªánh ƒê·ªãnh nghƒ©a D·ªØ li·ªáu (DDL - Data
              Definition Language). N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√≥a t·∫•t c·∫£ c√°c h√†ng kh·ªèi
              m·ªôt b·∫£ng m·ªôt c√°ch nhanh ch√≥ng.
            </p>

            <div class="info-box">
              <h4>üéØ Ch·ª©c nƒÉng:</h4>
              <p>X√≥a to√†n b·ªô d·ªØ li·ªáu trong b·∫£ng.</p>

              <h4>‚ö° T√°c d·ª•ng:</h4>
              <p>
                Gi·ªëng nh∆∞ DELETE kh√¥ng c√≥ ƒëi·ªÅu ki·ªán WHERE, nh∆∞ng hi·ªáu qu·∫£ h∆°n
                nhi·ªÅu. L·ªánh n√†y ho·∫°t ƒë·ªông b·∫±ng c√°ch gi·∫£i ph√≥ng kh√¥ng gian l∆∞u
                tr·ªØ c·ªßa b·∫£ng, gi·ªëng nh∆∞ c√°ch b·∫°n d·ªçn s·∫°ch m·ªôt cƒÉn nh√† b·∫±ng c√°ch
                qu·∫≥ng t·∫•t c·∫£ ƒë·ªì ƒë·∫°c ƒëi m√† kh√¥ng ph·∫£i d·ªçn d·∫πp t·ª´ng m√≥n m·ªôt.
              </p>

              <h4>üîí Giao d·ªãch:</h4>
              <p>
                ƒê√¢y l√† m·ªôt l·ªánh DDL, v√¨ v·∫≠y n√≥ th∆∞·ªùng t·ª± ƒë·ªông x√°c nh·∫≠n (commit)
                v√† kh√¥ng th·ªÉ ho√†n t√°c (rollback).
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">TRUNCATE TABLE</span>
                <span class="table">orders</span>;
              </div>
            </div>

            <div class="success-box">
              <h4>üéØ Khi n√†o n√™n d√πng:</h4>
              <p>
                Khi b·∫°n mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu c·ªßa m·ªôt b·∫£ng l·ªõn m·ªôt c√°ch nhanh
                ch√≥ng v√† hi·ªáu qu·∫£, v√† b·∫°n kh√¥ng c·∫ßn ph·∫£i kh√¥i ph·ª•c l·∫°i d·ªØ li·ªáu
                ƒë√≥.
              </p>
            </div>

            <h3>üíÄ DROP</h3>
            <p>
              <b>DROP</b> l√† m·ªôt l·ªánh ƒê·ªãnh nghƒ©a D·ªØ li·ªáu (DDL). N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng
              ƒë·ªÉ x√≥a ho√†n to√†n m·ªôt ƒë·ªëi t∆∞·ª£ng c∆° s·ªü d·ªØ li·ªáu (nh∆∞ b·∫£ng, ch·ªâ m·ª•c,
              ho·∫∑c l∆∞·ª£c ƒë·ªì).
            </p>

            <div class="info-box">
              <h4>üéØ Ch·ª©c nƒÉng:</h4>
              <p>X√≥a c·∫£ c·∫•u tr√∫c (schema) l·∫´n d·ªØ li·ªáu.</p>

              <h4>‚ö° T√°c d·ª•ng:</h4>
              <p>
                Khi b·∫°n DROP m·ªôt b·∫£ng, to√†n b·ªô b·∫£ng ƒë√≥ v√† t·∫•t c·∫£ d·ªØ li·ªáu b√™n
                trong s·∫Ω b·ªã lo·∫°i b·ªè vƒ©nh vi·ªÖn kh·ªèi c∆° s·ªü d·ªØ li·ªáu.
              </p>

              <h4>üîí Giao d·ªãch:</h4>
              <p>
                T∆∞∆°ng t·ª± TRUNCATE, DROP c≈©ng l√† m·ªôt l·ªánh DDL v√† kh√¥ng th·ªÉ ho√†n
                t√°c (rollback).
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">DROP TABLE</span>
                <span class="table">stocks</span>;
              </div>
            </div>

            <div class="success-box">
              <h4>üéØ Khi n√†o n√™n d√πng:</h4>
              <p>
                Khi b·∫°n kh√¥ng c√≤n c·∫ßn m·ªôt b·∫£ng n√†o ƒë√≥ n·ªØa v√† mu·ªën x√≥a n√≥ vƒ©nh
                vi·ªÖn kh·ªèi c∆° s·ªü d·ªØ li·ªáu c·ªßa m√¨nh.
              </p>
            </div>

            <h3>‚úÇÔ∏è DELETE</h3>
            <p>
              <b>DELETE</b> l√† m·ªôt l·ªánh Thao t√°c D·ªØ li·ªáu (DML - Data
              Manipulation Language). N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√≥a m·ªôt ho·∫∑c nhi·ªÅu h√†ng
              kh·ªèi m·ªôt b·∫£ng.
            </p>

            <div class="info-box">
              <h4>üéØ Ch·ª©c nƒÉng:</h4>
              <p>X√≥a d·ªØ li·ªáu theo m·ªôt ƒëi·ªÅu ki·ªán c·ª• th·ªÉ.</p>

              <h4>‚ö° T√°c d·ª•ng:</h4>
              <p>
                L·ªánh n√†y x√≥a t·ª´ng h√†ng m·ªôt, m·∫•t nhi·ªÅu th·ªùi gian h∆°n so v·ªõi
                TRUNCATE, ƒë·∫∑c bi·ªát v·ªõi c√°c b·∫£ng l·ªõn. Tuy nhi√™n, n√≥ cho ph√©p b·∫°n
                ch·ªâ x√≥a nh·ªØng h√†ng m√† b·∫°n mu·ªën.
              </p>

              <h4>üîí Giao d·ªãch:</h4>
              <p>
                L√† m·ªôt l·ªánh DML, DELETE c√≥ th·ªÉ ho√†n t√°c (rollback). ƒêi·ªÅu n√†y r·∫•t
                h·ªØu √≠ch khi b·∫°n l·ª° tay x√≥a nh·∫ßm d·ªØ li·ªáu.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                DELETE FROM customers WHERE city = 'Tokyo'; -- X√≥a t·∫•t c·∫£ kh√°ch
                h√†ng ·ªü Tokyo DELETE FROM customers WHERE registration_date <
                '2020-01-01'; -- X√≥a kh√°ch h√†ng ƒëƒÉng k√Ω tr∆∞·ªõc nƒÉm 2020 DELETE
                FROM orders WHERE status = 'CANCELLED'; -- X√≥a c√°c ƒë∆°n h√†ng ƒë√£
                h·ªßy
              </div>
            </div>

            <div class="success-box">
              <h4>üéØ Khi n√†o n√™n d√πng:</h4>
              <p>
                Khi b·∫°n c·∫ßn x√≥a m·ªôt t·∫≠p h·ª£p con c·ªßa d·ªØ li·ªáu trong m·ªôt b·∫£ng ho·∫∑c
                khi b·∫°n mu·ªën c√≥ kh·∫£ nƒÉng ho√†n t√°c l·∫°i thao t√°c x√≥a.
              </p>
            </div>

            <h3>üìä B·∫£ng t√≥m t·∫Øt</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>TRUNCATE</th>
                  <th>DROP</th>
                  <th>DELETE</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>Lo·∫°i l·ªánh</b></td>
                  <td><span class="table-badge badge-medium">DDL</span></td>
                  <td><span class="table-badge badge-medium">DDL</span></td>
                  <td><span class="table-badge badge-feature">DML</span></td>
                </tr>
                <tr>
                  <td><b>Ph·∫°m vi</b></td>
                  <td>X√≥a to√†n b·ªô d·ªØ li·ªáu trong b·∫£ng</td>
                  <td>X√≥a to√†n b·ªô b·∫£ng v√† c·∫•u tr√∫c</td>
                  <td>
                    X√≥a c√°c h√†ng ƒë∆∞·ª£c ch·ªçn (ho·∫∑c t·∫•t c·∫£ h√†ng n·∫øu kh√¥ng c√≥ WHERE)
                  </td>
                </tr>
                <tr>
                  <td><b>T·ªëc ƒë·ªô</b></td>
                  <td><span class="status-yes">R·∫•t nhanh</span></td>
                  <td><span class="status-yes">Nhanh</span></td>
                  <td>
                    <span class="status-no"
                      >Ch·∫≠m h∆°n, ƒë·∫∑c bi·ªát v·ªõi b·∫£ng l·ªõn</span
                    >
                  </td>
                </tr>
                <tr>
                  <td><b>Ho√†n t√°c</b></td>
                  <td>
                    <span class="status-no">Kh√¥ng th·ªÉ (kh√¥ng c√≥ rollback)</span>
                  </td>
                  <td>
                    <span class="status-no">Kh√¥ng th·ªÉ (kh√¥ng c√≥ rollback)</span>
                  </td>
                  <td><span class="status-yes">C√≥ th·ªÉ (c√≥ rollback)</span></td>
                </tr>
                <tr>
                  <td><b>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng</b></td>
                  <td>X√≥a nhanh to√†n b·ªô d·ªØ li·ªáu ƒë·ªÉ chu·∫©n b·ªã cho d·ªØ li·ªáu m·ªõi</td>
                  <td>X√≥a vƒ©nh vi·ªÖn m·ªôt b·∫£ng kh√¥ng c√≤n c·∫ßn thi·∫øt</td>
                  <td>X√≥a d·ªØ li·ªáu c√≥ ƒëi·ªÅu ki·ªán ho·∫∑c c·∫ßn kh·∫£ nƒÉng kh√¥i ph·ª•c</td>
                </tr>
              </tbody>
            </table>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <ul>
                <li>
                  <b>TRUNCATE v√† DROP</b> kh√¥ng th·ªÉ ho√†n t√°c - h√£y th·∫≠n tr·ªçng
                  khi s·ª≠ d·ª•ng!
                </li>
                <li>
                  <b>DELETE</b> c√≥ th·ªÉ s·ª≠ d·ª•ng trong transaction v√† c√≥ th·ªÉ
                  rollback
                </li>
                <li><b>TRUNCATE</b> nhanh h∆°n DELETE r·∫•t nhi·ªÅu v·ªõi b·∫£ng l·ªõn</li>
                <li><b>DROP</b> x√≥a c·∫£ c·∫•u tr√∫c b·∫£ng, kh√¥ng ch·ªâ d·ªØ li·ªáu</li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø so s√°nh:</h4>
              <div class="code-block">
                <span class="comment">-- T·∫°o b·∫£ng test</span>
                <span class="keyword">CREATE TABLE</span> <span class="table">test_data</span> (
                    <span class="column">id</span> <span class="datatype">INT</span>,
                    <span class="column">name</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>),
                    <span class="column">created_date</span> <span class="datatype">DATE</span>
                );
                
                <span class="comment">-- Th√™m d·ªØ li·ªáu</span>
                <span class="keyword">INSERT INTO</span> <span class="table">test_data</span> 
                <span class="keyword">VALUES</span> 
                    (<span class="number">1</span>, <span class="string">'Item 1'</span>, <span class="string">'2023-01-01'</span>),
                    (<span class="number">2</span>, <span class="string">'Item 2'</span>, <span class="string">'2023-02-01'</span>),
                    (<span class="number">3</span>, <span class="string">'Item 3'</span>, <span class="string">'2023-03-01'</span>);
                
                <span class="comment">-- DELETE: X√≥a c√≥ ƒëi·ªÅu ki·ªán (c√≥ th·ªÉ rollback)</span>
                <span class="keyword">BEGIN TRANSACTION</span>;
                <span class="comment">-- DELETE: X√≥a c√≥ ƒëi·ªÅu ki·ªán</span>
                <span class="keyword">DELETE FROM</span> <span class="table">test_data</span> <span class="keyword">WHERE</span> <span class="column">id</span> <span class="operator">=</span> <span class="number">1</span>;
                
                <span class="comment">-- TRUNCATE: X√≥a to√†n b·ªô</span>
                <span class="keyword">TRUNCATE TABLE</span> <span class="table">test_data</span>;
                
                <span class="comment">-- DROP: X√≥a b·∫£ng</span>
                <span class="keyword">DROP TABLE</span> <span class="table">test_data</span>;
              </div>
            </div>
          </section>

          <!-- 5 -->
          <section class="section" id="identity-sequence">
            <h2>5. Identity vs Sequence</h2>

            <h3>üî¢ 1. IDENTITY (c·ªôt t·ª± tƒÉng)</h3>
            <p>
              <b>IDENTITY</b> l√† m·ªôt thu·ªôc t√≠nh ƒë∆∞·ª£c g√°n cho m·ªôt c·ªôt trong m·ªôt
              b·∫£ng. N√≥ t·ª± ƒë·ªông t·∫°o ra m·ªôt s·ªë duy nh·∫•t, tƒÉng d·∫ßn cho m·ªói b·∫£n ghi
              m·ªõi ƒë∆∞·ª£c th√™m v√†o.
            </p>

            <div class="info-box">
              <h4>üìã ƒê·∫∑c ƒëi·ªÉm:</h4>
              <ul>
                <li>
                  <b>Ph·∫°m vi:</b> ƒê·ªôc l·∫≠p v√† ch·ªâ √°p d·ª•ng cho m·ªôt b·∫£ng c·ª• th·ªÉ.
                  M·ªói b·∫£ng c√≥ m·ªôt c·ªôt IDENTITY ri√™ng bi·ªát.
                </li>
                <li>
                  <b>T·∫°o s·ªë:</b> S·ªë ƒë∆∞·ª£c t·∫°o ra t·ª± ƒë·ªông v√† tu·∫ßn t·ª± khi b·∫°n ch√®n
                  (insert) d·ªØ li·ªáu v√†o b·∫£ng. B·∫°n kh√¥ng c·∫ßn ph·∫£i ch·ªâ ƒë·ªãnh gi√° tr·ªã
                  cho c·ªôt n√†y.
                </li>
                <li><b>C√∫ ph√°p:</b> Th∆∞·ªùng ƒë∆∞·ª£c khai b√°o khi t·∫°o b·∫£ng.</li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">orders</span> (
                    <span class="column">order_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>, <span class="comment">-- IDENTITY(seed, increment)</span>
                    <span class="column">customer_id</span> <span class="datatype">INT</span>,
                    <span class="column">order_date</span> <span class="datatype">DATE</span>
                );
              </div>
              <p>Trong ƒë√≥, <code>IDENTITY(1,1)</code> c√≥ nghƒ©a l√†:</p>
              <ul>
                <li>
                  <b>1 ƒë·∫ßu ti√™n (seed):</b> Gi√° tr·ªã b·∫Øt ƒë·∫ßu c·ªßa s·ªë t·ª± tƒÉng.
                </li>
                <li>
                  <b>1 th·ª© hai (increment):</b> B∆∞·ªõc nh·∫£y gi·ªØa c√°c gi√° tr·ªã.
                </li>
              </ul>
            </div>

            <div class="success-box">
              <h4>üéØ Khi n√†o n√™n d√πng:</h4>
              <p>
                Khi b·∫°n c·∫ßn m·ªôt kh√≥a ch√≠nh (primary key) t·ª± ƒë·ªông tƒÉng cho m·ªôt
                b·∫£ng duy nh·∫•t, ch·∫≥ng h·∫°n nh∆∞ order_id ho·∫∑c product_id. ƒê√¢y l√†
                c√°ch ƒë∆°n gi·∫£n v√† ph·ªï bi·∫øn nh·∫•t ƒë·ªÉ t·∫°o ID duy nh·∫•t cho m·ªói b·∫£n
                ghi.
              </p>
            </div>

            <h3>üé≤ 2. SEQUENCE (ƒë·ªëi t∆∞·ª£ng t·∫°o s·ªë)</h3>
            <p>
              <b>SEQUENCE</b> l√† m·ªôt ƒë·ªëi t∆∞·ª£ng c∆° s·ªü d·ªØ li·ªáu ƒë·ªôc l·∫≠p, ƒë∆∞·ª£c s·ª≠
              d·ª•ng ƒë·ªÉ t·∫°o ra m·ªôt chu·ªói c√°c s·ªë duy nh·∫•t, tu·∫ßn t·ª±. N√≥ c√≥ th·ªÉ ƒë∆∞·ª£c
              s·ª≠ d·ª•ng b·ªüi m·ªôt ho·∫∑c nhi·ªÅu b·∫£ng.
            </p>

            <div class="info-box">
              <h4>üìã ƒê·∫∑c ƒëi·ªÉm:</h4>
              <ul>
                <li>
                  <b>Ph·∫°m vi:</b> ƒê·ªôc l·∫≠p v·ªõi b·∫£ng v√† c√≥ th·ªÉ ƒë∆∞·ª£c d√πng chung cho
                  nhi·ªÅu b·∫£ng. SEQUENCE t·ªìn t·∫°i nh∆∞ m·ªôt ƒë·ªëi t∆∞·ª£ng ri√™ng bi·ªát
                  trong c∆° s·ªü d·ªØ li·ªáu.
                </li>
                <li>
                  <b>T·∫°o s·ªë:</b> B·∫°n ph·∫£i g·ªçi m·ªôt h√†m ƒë·ªÉ l·∫•y gi√° tr·ªã ti·∫øp theo
                  t·ª´ SEQUENCE.
                </li>
                <li>
                  <b>Trong SQL Server:</b>
                  <code>NEXT VALUE FOR sequence_name</code>
                </li>
                <li>
                  <b>Trong Oracle/PostgreSQL:</b>
                  <code>sequence_name.NEXTVAL</code>
                </li>
                <li>
                  <b>T√≠nh to√†n v·∫πn:</b> Th·∫≠m ch√≠ khi m·ªôt giao d·ªãch b·ªã h·ªßy b·ªè
                  (rollback), s·ªë ƒë√£ l·∫•y t·ª´ SEQUENCE s·∫Ω kh√¥ng ƒë∆∞·ª£c c·∫•p l·∫°i. ƒêi·ªÅu
                  n√†y c√≥ th·ªÉ d·∫´n ƒë·∫øn c√°c s·ªë b·ªã thi·∫øu (gap) trong chu·ªói.
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                -- T·∫°o m·ªôt SEQUENCE c√≥ t√™n l√† seq_transaction_id, b·∫Øt ƒë·∫ßu t·ª´ 1
                v√† tƒÉng 1
                <span class="keyword">CREATE SEQUENCE</span> <span class="table">seq_transaction_id</span> 
                <span class="keyword">START WITH</span> <span class="number">1</span> <span class="keyword">INCREMENT BY</span> <span class="number">1</span>;
                
                <span class="comment">-- S·ª≠ d·ª•ng SEQUENCE khi th√™m d·ªØ li·ªáu v√†o b·∫£ng</span>
                <span class="keyword">INSERT INTO</span> <span class="table">transactions</span> (<span class="column">transaction_id</span>, <span class="column">transaction_date</span>)
                <span class="keyword">VALUES</span> (<span class="keyword">NEXT VALUE FOR</span> <span class="table">seq_transaction_id</span>, <span class="function">GETDATE</span>());
                
                <span class="comment">-- C√≥ th·ªÉ s·ª≠ d·ª•ng c√πng SEQUENCE cho nhi·ªÅu b·∫£ng kh√°c nhau</span>
                <span class="keyword">INSERT INTO</span> <span class="table">audit_log</span> (<span class="column">log_id</span>, <span class="column">action</span>, <span class="column">timestamp</span>) 
                <span class="keyword">VALUES</span> (<span class="keyword">NEXT VALUE FOR</span> <span class="table">seq_transaction_id</span>, <span class="string">'LOGIN'</span>, <span class="function">GETDATE</span>());
              </div>
            </div>

            <div class="success-box">
              <h4>üéØ Khi n√†o n√™n d√πng:</h4>
              <p>
                Khi b·∫°n c·∫ßn t·∫°o ID duy nh·∫•t v√† c√≥ th·ªÉ chia s·∫ª gi·ªØa nhi·ªÅu b·∫£ng,
                v√≠ d·ª• nh∆∞ ID cho c√°c giao d·ªãch li√™n quan ƒë·∫øn nhi·ªÅu b·∫£ng kh√°c
                nhau. SEQUENCE c≈©ng h·ªØu √≠ch khi b·∫°n c·∫ßn t·∫°o ID tr∆∞·ªõc khi ch√®n
                v√†o b·∫£ng.
              </p>
            </div>

            <h3>üìä B·∫£ng t√≥m t·∫Øt s·ª± kh√°c bi·ªát</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>IDENTITY</th>
                  <th>SEQUENCE</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>Ph·∫°m vi</b></td>
                  <td>C·ªôt c·ª• th·ªÉ trong m·ªôt b·∫£ng duy nh·∫•t</td>
                  <td>ƒê·ªëi t∆∞·ª£ng ƒë·ªôc l·∫≠p, c√≥ th·ªÉ d√πng chung cho nhi·ªÅu b·∫£ng</td>
                </tr>
                <tr>
                  <td><b>C√°ch s·ª≠ d·ª•ng</b></td>
                  <td>
                    <span class="table-badge badge-warning"
                      >T·ª± ƒë·ªông t·∫°o gi√° tr·ªã khi ch√®n d·ªØ li·ªáu</span
                    >
                  </td>
                  <td>
                    <span class="table-badge badge-feature"
                      >Ph·∫£i g·ªçi h√†m ƒë·ªÉ l·∫•y gi√° tr·ªã ti·∫øp theo</span
                    >
                  </td>
                </tr>
                <tr>
                  <td><b>T√≠nh linh ho·∫°t</b></td>
                  <td>
                    <span class="status-partial"
                      >K√©m linh ho·∫°t h∆°n, ch·ªâ d√πng cho m·ªôt c·ªôt duy nh·∫•t</span
                    >
                  </td>
                  <td>
                    <span class="status-yes"
                      >Linh ho·∫°t h∆°n, c√≥ th·ªÉ d√πng cho nhi·ªÅu b·∫£ng, l·∫•y gi√° tr·ªã
                      tr∆∞·ªõc khi ch√®n</span
                    >
                  </td>
                </tr>
                <tr>
                  <td><b>V·ªã tr√≠</b></td>
                  <td>Thu·ªôc t√≠nh c·ªßa c·ªôt trong <code>CREATE TABLE</code></td>
                  <td>ƒê·ªëi t∆∞·ª£ng ri√™ng bi·ªát trong c∆° s·ªü d·ªØ li·ªáu</td>
                </tr>
                <tr>
                  <td><b>T√≠nh t∆∞∆°ng th√≠ch</b></td>
                  <td>
                    H·∫ßu h·∫øt c√°c h·ªá qu·∫£n tr·ªã CSDL ƒë·ªÅu c√≥ c∆° ch·∫ø t∆∞∆°ng t·ª± (<code
                      >AUTO_INCREMENT</code
                    >
                    trong MySQL)
                  </td>
                  <td>Ph·ªï bi·∫øn trong Oracle, PostgreSQL, v√† SQL Server</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø so s√°nh:</h4>
              <div class="code-block">
                <span class="comment">-- IDENTITY: ƒê∆°n gi·∫£n cho m·ªôt b·∫£ng</span>
                <span class="keyword">CREATE TABLE</span> <span class="table">customers</span> (
                    <span class="column">customer_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">customer_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>),
                    <span class="column">email</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>)
                );
                
                <span class="comment">-- Ch√®n d·ªØ li·ªáu</span>
                <span class="keyword">INSERT INTO</span> <span class="table">customers</span> (<span class="column">customer_name</span>, <span class="column">email</span>)
                <span class="keyword">VALUES</span> (<span class="string">N'Nguy·ªÖn VƒÉn A'</span>, <span class="string">'a@email.com'</span>);
                
                <span class="comment">-- SEQUENCE: Linh ho·∫°t cho nhi·ªÅu b·∫£ng</span>
                <span class="keyword">CREATE SEQUENCE</span> <span class="table">seq_global_id</span> 
                <span class="keyword">START WITH</span> <span class="number">1000</span> <span class="keyword">INCREMENT BY</span> <span class="number">1</span>;
                
                <span class="keyword">CREATE TABLE</span> <span class="table">orders</span> (
                    <span class="column">order_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">customer_id</span> <span class="datatype">INT</span>,
                    <span class="column">order_date</span> <span class="datatype">DATE</span>
                );
                
                <span class="keyword">CREATE TABLE</span> <span class="table">invoices</span> (
                    <span class="column">invoice_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">order_id</span> <span class="datatype">INT</span>,
                    <span class="column">amount</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>)
                );
                
                <span class="comment">-- S·ª≠ d·ª•ng c√πng sequence cho c·∫£ hai b·∫£ng</span>
                <span class="keyword">INSERT INTO</span> <span class="table">orders</span> 
                <span class="keyword">VALUES</span> (<span class="keyword">NEXT VALUE FOR</span> <span class="table">seq_global_id</span>, <span class="number">1</span>, <span class="function">GETDATE</span>());
                
                <span class="keyword">INSERT INTO</span> <span class="table">invoices</span> 
                <span class="keyword">VALUES</span> (<span class="keyword">NEXT VALUE FOR</span> <span class="table">seq_global_id</span>, <span class="number">1001</span>, <span class="number">150000.00</span>);
              </div>
            </div>

            <div class="highlight-box">
              <h4>üí° L·ª±a ch·ªçn ph√π h·ª£p:</h4>
              <ul>
                <li>
                  <b>Ch·ªçn IDENTITY</b> khi b·∫°n c·∫ßn ID ƒë∆°n gi·∫£n cho m·ªôt b·∫£ng c·ª•
                  th·ªÉ
                </li>
                <li>
                  <b>Ch·ªçn SEQUENCE</b> khi b·∫°n c·∫ßn chia s·∫ª s·ªë t·ª± tƒÉng gi·ªØa nhi·ªÅu
                  b·∫£ng ho·∫∑c c·∫ßn linh ho·∫°t h∆°n trong vi·ªác t·∫°o ID
                </li>
                <li>
                  <b>IDENTITY</b> d·ªÖ s·ª≠ d·ª•ng v√† ph·ªï bi·∫øn h∆°n cho c√°c ·ª©ng d·ª•ng
                  ƒë∆°n gi·∫£n
                </li>
                <li>
                  <b>SEQUENCE</b> m·∫°nh m·∫Ω h∆°n cho c√°c thi·∫øt k·∫ø c∆° s·ªü d·ªØ li·ªáu
                  ph·ª©c t·∫°p
                </li>
              </ul>
            </div>
          </section>

          <!-- 6 -->
          <section class="section" id="constraint">
            <h2>6. Constraint trong SQL</h2>

            <h3>üîí Constraint l√† g√¨?</h3>
            <p>
              <b>Constraint (r√†ng bu·ªôc)</b> l√† c√°c quy t·∫Øc ƒë∆∞·ª£c √°p d·ª•ng cho c·ªôt
              ho·∫∑c b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ gi·ªõi h·∫°n lo·∫°i d·ªØ li·ªáu c√≥ th·ªÉ ƒë∆∞·ª£c
              ch√®n v√†o. M·ª•c ƒë√≠ch ch√≠nh c·ªßa ch√∫ng l√† ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn v√†
              ƒë·ªô ch√≠nh x√°c c·ªßa d·ªØ li·ªáu trong c∆° s·ªü d·ªØ li·ªáu.
            </p>

            <div class="info-box">
              <h4>üìù C√°c lo·∫°i Constraint ph·ªï bi·∫øn:</h4>
              <p>
                <b>NOT NULL</b>, <b>UNIQUE</b>, <b>PRIMARY KEY</b>,
                <b>FOREIGN KEY</b>, <b>CHECK</b>, <b>DEFAULT</b>
              </p>
            </div>

            <h3>‚ùå 1. NOT NULL</h3>
            <p>
              R√†ng bu·ªôc <b>NOT NULL</b> ƒë·∫£m b·∫£o r·∫±ng m·ªôt c·ªôt kh√¥ng th·ªÉ c√≥ gi√°
              tr·ªã NULL. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n ph·∫£i lu√¥n cung c·∫•p m·ªôt gi√° tr·ªã
              cho c·ªôt ƒë√≥ khi th√™m m·ªôt h√†ng m·ªõi.
            </p>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">products</span> (
                    <span class="column">product_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">product_name</span> <span class="datatype">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>, <span class="comment">-- T√™n s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ph√©p ƒë·ªÉ tr·ªëng</span>
                    <span class="column">description</span> <span class="datatype">TEXT</span>,
                    <span class="column">price</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT NULL</span> <span class="comment">-- Gi√° s·∫£n ph·∫©m b·∫Øt bu·ªôc ph·∫£i c√≥</span>
                );
              </div>
              <p>
                C·ªôt <code>product_name</code> kh√¥ng ƒë∆∞·ª£c ph√©p ƒë·ªÉ tr·ªëng - kh√°ch
                h√†ng c·∫ßn bi·∫øt t√™n s·∫£n ph·∫©m.
              </p>
            </div>

            <h3>üîë 2. UNIQUE</h3>
            <p>
              R√†ng bu·ªôc <b>UNIQUE</b> ƒë·∫£m b·∫£o r·∫±ng t·∫•t c·∫£ c√°c gi√° tr·ªã trong m·ªôt
              c·ªôt l√† duy nh·∫•t. N√≥ cho ph√©p gi√° tr·ªã NULL, nh∆∞ng m·ªói gi√° tr·ªã NULL
              c≈©ng ph·∫£i l√† duy nh·∫•t.
            </p>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">users</span> (
                    <span class="column">user_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">username</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>, <span class="comment">-- T√™n ƒëƒÉng nh·∫≠p ph·∫£i duy nh·∫•t</span>
                    <span class="column">email</span> <span class="datatype">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">UNIQUE</span>, <span class="comment">-- Email ph·∫£i duy nh·∫•t</span>
                    <span class="column">phone</span> <span class="datatype">VARCHAR</span>(<span class="number">15</span>) <span class="keyword">UNIQUE</span> <span class="comment">-- S·ªë ƒëi·ªán tho·∫°i ph·∫£i duy nh·∫•t</span>
                );
              </div>
              <p>
                M·ªói ng∆∞·ªùi d√πng ph·∫£i c√≥ m·ªôt ƒë·ªãa ch·ªâ email ri√™ng bi·ªát - kh√¥ng ƒë∆∞·ª£c
                tr√πng l·∫∑p.
              </p>
            </div>

            <h3>üóùÔ∏è 3. PRIMARY KEY (Kh√≥a Ch√≠nh)</h3>
            <p>
              R√†ng bu·ªôc <b>PRIMARY KEY</b> l√† m·ªôt t·ªï h·ª£p c·ªßa NOT NULL v√† UNIQUE.
              N√≥ d√πng ƒë·ªÉ x√°c ƒë·ªãnh duy nh·∫•t m·ªôt h√†ng trong m·ªôt b·∫£ng. M·ªôt b·∫£ng ch·ªâ
              c√≥ th·ªÉ c√≥ m·ªôt kh√≥a ch√≠nh, v√† gi√° tr·ªã c·ªßa n√≥ kh√¥ng bao gi·ªù ƒë∆∞·ª£c
              ph√©p thay ƒë·ªïi (th∆∞·ªùng l√† m·ªôt ID t·ª± tƒÉng).
            </p>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">customers</span> (
                    <span class="column">customer_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>, <span class="comment">-- ID kh√°ch h√†ng t·ª± tƒÉng</span>
                    <span class="column">customer_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,
                    <span class="column">registration_date</span> <span class="datatype">DATE</span> <span class="keyword">DEFAULT</span> <span class="function">GETDATE</span>()
                );
              </div>
              <p>
                C·ªôt <code>customer_id</code> l√† duy nh·∫•t v√† kh√¥ng ƒë∆∞·ª£c ph√©p ƒë·ªÉ
                tr·ªëng - ƒë√¢y l√† danh t√≠nh c·ªßa m·ªói kh√°ch h√†ng.
              </p>
            </div>

            <h3>üîó 4. FOREIGN KEY (Kh√≥a Ngo·∫°i)</h3>
            <p>
              R√†ng bu·ªôc <b>FOREIGN KEY</b> ƒë∆∞·ª£c d√πng ƒë·ªÉ li√™n k·∫øt hai b·∫£ng v·ªõi
              nhau. N√≥ ƒë·∫£m b·∫£o r·∫±ng c√°c gi√° tr·ªã trong m·ªôt c·ªôt c·ªßa b·∫£ng n√†y (kh√≥a
              ngo·∫°i) ph·∫£i t∆∞∆°ng ·ª©ng v·ªõi m·ªôt gi√° tr·ªã trong c·ªôt kh√≥a ch√≠nh c·ªßa
              b·∫£ng kh√°c. ƒêi·ªÅu n√†y gi√∫p duy tr√¨ m·ªëi quan h·ªá v√† t√≠nh to√†n v·∫πn tham
              chi·∫øu gi·ªØa c√°c b·∫£ng.
            </p>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">orders</span> (
                    <span class="column">order_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">customer_id</span> <span class="datatype">INT</span>,
                    <span class="column">order_date</span> <span class="datatype">DATE</span>,
                    <span class="column">total_amount</span> <span class="datatype">DECIMAL</span>(<span class="number">12</span>,<span class="number">2</span>),
                    <span class="keyword">FOREIGN KEY</span> (<span class="column">customer_id</span>) <span class="keyword">REFERENCES</span> <span class="table">customers</span>(<span class="column">customer_id</span>)
                );
              </div>
              <p>
                Trong v√≠ d·ª• n√†y, <code>customer_id</code> trong b·∫£ng
                <code>orders</code> l√† kh√≥a ngo·∫°i, n√≥ ph·∫£i tham chi·∫øu ƒë·∫øn m·ªôt
                <code>customer_id</code> c√≥ th·∫≠t trong b·∫£ng
                <code>customers</code>.
              </p>
            </div>

            <h3>‚úÖ 5. CHECK</h3>
            <p>
              R√†ng bu·ªôc <b>CHECK</b> cho ph√©p b·∫°n ƒë·∫∑t m·ªôt ƒëi·ªÅu ki·ªán c·ª• th·ªÉ m√†
              t·∫•t c·∫£ c√°c gi√° tr·ªã trong m·ªôt c·ªôt ph·∫£i tu√¢n theo.
            </p>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">employees</span> (
                    <span class="column">employee_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">employee_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,
                    <span class="column">age</span> <span class="datatype">INT</span> <span class="keyword">CHECK</span> (<span class="column">age</span> <span class="operator">=</span> <span class="number">18</span> <span class="keyword">AND</span> <span class="column">age</span> <span class="operator"><=</span> <span class="number">65</span>), <span class="comment">-- Tu·ªïi t·ª´ 18-65</span>
                    <span class="column">salary</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">CHECK</span> (<span class="column">salary</span> <span class="operator">></span> <span class="number">0</span>), <span class="comment">-- L∆∞∆°ng ph·∫£i d∆∞∆°ng</span>
                    <span class="column">department</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">CHECK</span> (<span class="column">department</span> <span class="keyword">IN</span> (<span class="string">'IT'</span>, <span class="string">'HR'</span>, <span class="string">'Finance'</span>, <span class="string">'Marketing'</span>))
                );
              </div>
              <p>
                C·ªôt <code>age</code> ch·ªâ ch·∫•p nh·∫≠n c√°c gi√° tr·ªã t·ª´ 18 ƒë·∫øn 65 tu·ªïi
                - ph√π h·ª£p v·ªõi ƒë·ªô tu·ªïi lao ƒë·ªông.
              </p>
            </div>

            <h3>üéØ 6. DEFAULT</h3>
            <p>
              R√†ng bu·ªôc <b>DEFAULT</b> cung c·∫•p m·ªôt gi√° tr·ªã m·∫∑c ƒë·ªãnh cho m·ªôt
              c·ªôt. N·∫øu kh√¥ng c√≥ gi√° tr·ªã n√†o ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh khi ch√®n m·ªôt h√†ng, gi√°
              tr·ªã m·∫∑c ƒë·ªãnh s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c s·ª≠ d·ª•ng.
            </p>

            <div class="example">
              <h4>V√≠ d·ª•:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">orders</span> (
                    <span class="column">order_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">customer_id</span> <span class="datatype">INT</span>,
                    <span class="column">order_date</span> <span class="datatype">DATE</span> <span class="keyword">DEFAULT</span> <span class="function">GETDATE</span>(), <span class="comment">-- Ng√†y ƒë·∫∑t h√†ng m·∫∑c ƒë·ªãnh l√† h√¥m nay</span>
                    <span class="column">status</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">'PENDING'</span>, <span class="comment">-- Tr·∫°ng th√°i m·∫∑c ƒë·ªãnh l√† 'PENDING'</span>
                    <span class="column">priority</span> <span class="datatype">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>, <span class="comment">-- ƒê·ªô ∆∞u ti√™n m·∫∑c ƒë·ªãnh l√† 1</span>
                    <span class="column">notes</span> <span class="datatype">NVARCHAR</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="string">N'Kh√¥ng c√≥ ghi ch√∫'</span>
                );
              </div>
              <p>
                N·∫øu kh√¥ng khai b√°o tr·∫°ng th√°i, n√≥ s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ƒë·∫∑t l√†
                <code>'PENDING'</code>.
              </p>
            </div>

            <h3>üîß V√≠ d·ª• t·ªïng h·ª£p</h3>
            <p>
              B·∫°n c√≥ th·ªÉ th√™m c√°c r√†ng bu·ªôc tr·ª±c ti·∫øp khi t·∫°o b·∫£ng ho·∫∑c sau ƒë√≥
              b·∫±ng l·ªánh ALTER TABLE. D∆∞·ªõi ƒë√¢y l√† v√≠ d·ª• s·ª≠ d·ª•ng ALTER TABLE ƒë·ªÉ
              th√™m m·ªôt r√†ng bu·ªôc FOREIGN KEY.
            </p>

            <div class="example">
              <div class="code-block">
                ALTER TABLE orders ADD CONSTRAINT FK_customer FOREIGN KEY
                (customer_id) REFERENCES customers(customer_id);
              </div>
              <p><b>Gi·∫£i th√≠ch t·ª´ng ph·∫ßn:</b></p>
              <ul>
                <li>
                  <code>ALTER TABLE orders</code>: L·ªánh n√†y cho bi·∫øt b·∫°n mu·ªën
                  thay ƒë·ªïi c·∫•u tr√∫c c·ªßa b·∫£ng orders.
                </li>
                <li>
                  <code>ADD CONSTRAINT FK_customer</code>: Th√™m m·ªôt r√†ng bu·ªôc
                  m·ªõi v√† ƒë·∫∑t t√™n l√† FK_customer. Vi·ªác ƒë·∫∑t t√™n gi√∫p b·∫°n d·ªÖ d√†ng
                  qu·∫£n l√Ω v√† x√≥a r√†ng bu·ªôc sau n√†y.
                </li>
                <li>
                  <code>FOREIGN KEY (customer_id)</code>: Ch·ªâ ƒë·ªãnh c·ªôt
                  customer_id trong b·∫£ng orders l√† kh√≥a ngo·∫°i.
                </li>
                <li>
                  <code>REFERENCES customers(customer_id)</code>: Ch·ªâ ƒë·ªãnh r·∫±ng
                  kh√≥a ngo·∫°i n√†y tham chi·∫øu ƒë·∫øn c·ªôt customer_id l√† kh√≥a ch√≠nh
                  trong b·∫£ng customers.
                </li>
              </ul>
            </div>

            <div class="success-box">
              <h4>üí° L·ª£i √≠ch c·ªßa Constraints:</h4>
              <ul>
                <li>
                  <b>ƒê·∫£m b·∫£o t√≠nh to√†n v·∫πn d·ªØ li·ªáu:</b> NgƒÉn ch·∫∑n d·ªØ li·ªáu kh√¥ng
                  h·ª£p l·ªá
                </li>
                <li>
                  <b>T·ª± ƒë·ªông ki·ªÉm tra:</b> Database t·ª± ƒë·ªông ki·ªÉm tra r√†ng bu·ªôc
                  khi th√™m/s·ª≠a d·ªØ li·ªáu
                </li>
                <li>
                  <b>Hi·ªáu su·∫•t t·ªët h∆°n:</b> M·ªôt s·ªë constraint gi√∫p t·ªëi ∆∞u h√≥a
                  truy v·∫•n
                </li>
                <li>
                  <b>T√≠nh nh·∫•t qu√°n:</b> ƒê·∫£m b·∫£o d·ªØ li·ªáu lu√¥n tu√¢n theo quy t·∫Øc
                  nghi·ªáp v·ª•
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <ul>
                <li>
                  Constraint ƒë∆∞·ª£c ki·ªÉm tra m·ªói khi c√≥ thao t√°c INSERT, UPDATE
                </li>
                <li>
                  Vi ph·∫°m constraint s·∫Ω g√¢y ra l·ªói v√† rollback transaction
                </li>
                <li>N√™n ƒë·∫∑t t√™n c√≥ √Ω nghƒ©a cho constraint ƒë·ªÉ d·ªÖ qu·∫£n l√Ω</li>
                <li>
                  FOREIGN KEY constraint c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t v·ªõi b·∫£ng
                  l·ªõn
                </li>
              </ul>
            </div>
          </section>

          <!-- 7 -->
          <section class="section" id="constraint-ways">
            <h2>7. C√≥ m·∫•y c√°ch t·∫°o constraint?</h2>

            <h3>üéØ 1. T·∫°o constraint khi kh·ªüi t·∫°o b·∫£ng (CREATE TABLE)</h3>
            <p>
              ƒê√¢y l√† ph∆∞∆°ng ph√°p ph·ªï bi·∫øn v√† ƒë∆∞·ª£c khuy·∫øn kh√≠ch s·ª≠ d·ª•ng. B·∫°n ƒë·ªãnh
              nghƒ©a c√°c r√†ng bu·ªôc ngay trong c√¢u l·ªánh CREATE TABLE. C√°ch n√†y
              gi√∫p c·∫•u tr√∫c b·∫£ng c·ªßa b·∫°n r√µ r√†ng ngay t·ª´ ƒë·∫ßu v√† ƒë·∫£m b·∫£o t√≠nh
              to√†n v·∫πn d·ªØ li·ªáu ngay khi b·∫£ng ƒë∆∞·ª£c t·∫°o.
            </p>

            <div class="info-box">
              <h4>üìù C√∫ ph√°p:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">table_name</span> (
                    <span class="column">column1</span> <span class="datatype">datatype</span> <span class="keyword">CONSTRAINT_1</span>,
                    <span class="column">column2</span> <span class="datatype">datatype</span> <span class="keyword">CONSTRAINT_2</span>,
                    ...
                    <span class="keyword">CONSTRAINT_N</span>
                );
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• chi ti·∫øt:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">products</span> (
                    <span class="column">product_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">product_name</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,
                    <span class="column">price</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (<span class="column">price</span> <span class="operator">></span> <span class="number">0</span>),
                    <span class="column">category_id</span> <span class="datatype">INT</span> <span class="keyword">REFERENCES</span> <span class="table">categories</span>(<span class="column">category_id</span>)
                );
              </div>
              <p>Trong v√≠ d·ª• n√†y:</p>
              <ul>
                <li>
                  <code>product_id</code> v√† <code>product_name</code> ƒë∆∞·ª£c ƒë·ªãnh
                  nghƒ©a r√†ng bu·ªôc tr·ª±c ti·∫øp
                </li>
                <li>
                  R√†ng bu·ªôc <code>UNIQUE</code> v√† <code>FOREIGN KEY</code> ƒë∆∞·ª£c
                  ƒë·ªãnh nghƒ©a ri√™ng bi·ªát ·ªü cu·ªëi
                </li>
                <li>
                  C√°ch n√†y th∆∞·ªùng ƒë∆∞·ª£c d√πng khi r√†ng bu·ªôc √°p d·ª•ng cho nhi·ªÅu c·ªôt
                  ho·∫∑c c·∫ßn ƒë·∫∑t t√™n c·ª• th·ªÉ
                </li>
              </ul>
            </div>

            <div class="success-box">
              <h4>‚úÖ ∆Øu ƒëi·ªÉm c·ªßa c√°ch n√†y:</h4>
              <ul>
                <li>
                  <b>C·∫•u tr√∫c r√µ r√†ng:</b> To√†n b·ªô r√†ng bu·ªôc ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a
                  c√πng l√∫c
                </li>
                <li>
                  <b>ƒê·∫£m b·∫£o t√≠nh to√†n v·∫πn:</b> R√†ng bu·ªôc c√≥ hi·ªáu l·ª±c ngay t·ª´
                  khi t·∫°o b·∫£ng
                </li>
                <li>
                  <b>D·ªÖ ƒë·ªçc v√† b·∫£o tr√¨:</b> Developers c√≥ th·ªÉ hi·ªÉu c·∫•u tr√∫c b·∫£ng
                  ngay l·∫≠p t·ª©c
                </li>
                <li>
                  <b>Hi·ªáu su·∫•t t·ªët:</b> Kh√¥ng c·∫ßn th√™m thao t√°c ALTER sau n√†y
                </li>
              </ul>
            </div>

            <h3>üîß 2. T·∫°o constraint sau khi b·∫£ng ƒë√£ t·ªìn t·∫°i (ALTER TABLE)</h3>
            <p>
              N·∫øu b·∫°n c·∫ßn th√™m m·ªôt r√†ng bu·ªôc v√†o m·ªôt b·∫£ng ƒë√£ c√≥ s·∫µn, b·∫°n s·ª≠ d·ª•ng
              c√¢u l·ªánh ALTER TABLE. Ph∆∞∆°ng ph√°p n√†y h·ªØu √≠ch khi b·∫°n mu·ªën thay
              ƒë·ªïi c·∫•u tr√∫c c·ªßa b·∫£ng m√† kh√¥ng c·∫ßn ph·∫£i x√≥a v√† t·∫°o l·∫°i b·∫£ng.
            </p>

            <div class="info-box">
              <h4>üìù C√∫ ph√°p:</h4>
              <div class="code-block">
                ALTER TABLE table_name ADD CONSTRAINT constraint_name
                constraint_type (column_name);
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n ƒë√£ c√≥ m·ªôt b·∫£ng <code>products</code> nh∆∞ng ch∆∞a c√≥
                r√†ng bu·ªôc UNIQUE cho t√™n s·∫£n ph·∫©m. B·∫°n c√≥ th·ªÉ th√™m n√≥ nh∆∞ sau:
              </p>
              <div class="code-block">
                -- Th√™m r√†ng bu·ªôc UNIQUE ALTER TABLE products ADD CONSTRAINT
                UQ_product_name UNIQUE (product_name); -- Th√™m r√†ng bu·ªôc CHECK
                cho gi√° ALTER TABLE products ADD CONSTRAINT CHK_price_positive
                CHECK (price > 0); -- Th√™m r√†ng bu·ªôc FOREIGN KEY ALTER TABLE
                products ADD CONSTRAINT FK_supplier FOREIGN KEY (supplier_id)
                REFERENCES suppliers(supplier_id); -- Th√™m r√†ng bu·ªôc DEFAULT
                (c√°ch kh√°c) ALTER TABLE products ADD CONSTRAINT DF_status
                DEFAULT 'ACTIVE' FOR status;
              </div>
              <p>
                L·ªánh n√†y s·∫Ω th√™m m·ªôt r√†ng bu·ªôc t√™n l√†
                <code>UQ_product_name</code> v√†o b·∫£ng products, ƒë·∫£m b·∫£o r·∫±ng t√™n
                s·∫£n ph·∫©m kh√¥ng b·ªã tr√πng l·∫∑p.
              </p>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng khi d√πng ALTER TABLE:</h4>
              <ul>
                <li>
                  <b>Ki·ªÉm tra d·ªØ li·ªáu hi·ªán t·∫°i:</b> ƒê·∫£m b·∫£o d·ªØ li·ªáu ƒë√£ c√≥ tu√¢n
                  th·ªß r√†ng bu·ªôc m·ªõi
                </li>
                <li>
                  <b>Backup tr∆∞·ªõc khi thay ƒë·ªïi:</b> Ph√≤ng tr∆∞·ªùng h·ª£p c√≥ l·ªói x·∫£y
                  ra
                </li>
                <li>
                  <b>Th·ªùi gian th·ª±c thi:</b> V·ªõi b·∫£ng l·ªõn c√≥ th·ªÉ m·∫•t th·ªùi gian
                  ƒë·ªÉ ki·ªÉm tra to√†n b·ªô d·ªØ li·ªáu
                </li>
                <li>
                  <b>Lock b·∫£ng:</b> Trong qu√° tr√¨nh th√™m constraint, b·∫£ng c√≥ th·ªÉ
                  b·ªã lock
                </li>
              </ul>
            </div>

            <h3>üìä T√≥m t·∫Øt so s√°nh</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>Ph∆∞∆°ng ph√°p</th>
                  <th>∆Øu ƒëi·ªÉm</th>
                  <th>Nh∆∞·ª£c ƒëi·ªÉm</th>
                  <th>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>CREATE TABLE</b></td>
                  <td>
                    <span class="status-yes"
                      >C·∫•u tr√∫c r√µ r√†ng, ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn ngay t·ª´ ƒë·∫ßu</span
                    >
                  </td>
                  <td>
                    <span class="status-no"
                      >Kh√¥ng th·ªÉ th√™m r√†ng bu·ªôc cho b·∫£ng ƒë√£ t·ªìn t·∫°i</span
                    >
                  </td>
                  <td>
                    <span class="table-badge badge-feature"
                      >Kh·ªüi t·∫°o b·∫£ng m·ªõi</span
                    >
                  </td>
                </tr>
                <tr>
                  <td><b>ALTER TABLE</b></td>
                  <td>
                    <span class="status-yes"
                      >Linh ho·∫°t, cho ph√©p thay ƒë·ªïi c·∫•u tr√∫c b·∫£ng hi·ªán c√≥</span
                    >
                  </td>
                  <td>
                    <span class="status-partial"
                      >C·∫ßn c·∫©n th·∫≠n, c√≥ th·ªÉ g√¢y l·ªói n·∫øu d·ªØ li·ªáu hi·ªán t·∫°i kh√¥ng
                      tu√¢n th·ªß r√†ng bu·ªôc</span
                    >
                  </td>
                  <td>
                    <span class="table-badge badge-warning"
                      >S·ª≠a ƒë·ªïi b·∫£ng ƒë√£ c√≥ s·∫µn</span
                    >
                  </td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>V√≠ d·ª• t·ªïng h·ª£p - K·ªãch b·∫£n th·ª±c t·∫ø:</h4>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">employees</span> (
                    <span class="column">employee_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">employee_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,
                    <span class="column">email</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>,
                    <span class="column">salary</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">CHECK</span> (<span class="column">salary</span> <span class="operator">></span> <span class="number">0</span>)
                );
              </div>
                
                <span class="comment">-- B∆∞·ªõc 3: Th√™m b·∫£ng ph√≤ng ban v√† li√™n k·∫øt</span>
                <span class="keyword">CREATE TABLE</span> <span class="table">departments</span> (
                    <span class="column">department_id</span> <span class="datatype">INT</span> <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">department_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>
                );
                
                <span class="comment">-- Th√™m c·ªôt department_id v√†o b·∫£ng employees</span>
                <span class="keyword">ALTER TABLE</span> <span class="table">employees</span> <span class="keyword">ADD</span> <span class="column">department_id</span> <span class="datatype">INT</span>;
                
                <span class="comment">-- T·∫°o foreign key constraint</span>
                <span class="keyword">ALTER TABLE</span> <span class="table">employees</span> 
                <span class="keyword">ADD CONSTRAINT</span> <span class="column">FK_employee_department</span> 
                <span class="keyword">FOREIGN KEY</span> (<span class="column">department_id</span>) <span class="keyword">REFERENCES</span> <span class="table">departments</span>(<span class="column">department_id</span>);
              </div>
            </div>

            <div class="success-box">
              <h4>üí° Khuy·∫øn ngh·ªã t·ªët nh·∫•t:</h4>
              <ul>
                <li>
                  <b>∆Øu ti√™n CREATE TABLE:</b> ƒê·ªãnh nghƒ©a ƒë·∫ßy ƒë·ªß constraint khi
                  thi·∫øt k·∫ø ban ƒë·∫ßu
                </li>
                <li>
                  <b>S·ª≠ d·ª•ng ALTER TABLE:</b> Cho vi·ªác b·∫£o tr√¨ v√† m·ªü r·ªông h·ªá
                  th·ªëng
                </li>
                <li>
                  <b>ƒê·∫∑t t√™n c√≥ √Ω nghƒ©a:</b> S·ª≠ d·ª•ng prefix nh∆∞ UQ_, FK_, CHK_
                  ƒë·ªÉ d·ªÖ qu·∫£n l√Ω
                </li>
                <li>
                  <b>Ki·ªÉm tra tr∆∞·ªõc khi th√™m:</b> ƒê·∫£m b·∫£o d·ªØ li·ªáu hi·ªán t·∫°i ph√π
                  h·ª£p v·ªõi constraint m·ªõi
                </li>
              </ul>
            </div>
          </section>

          <!-- 8 -->
          <section class="section" id="unique-pk">
            <h2>8. Unique vs Primary Key</h2>

            <h3>üîë 1. UNIQUE (Kh√≥a Duy Nh·∫•t)</h3>
            <p>
              <b>UNIQUE</b> l√† m·ªôt r√†ng bu·ªôc (constraint) ƒë·∫£m b·∫£o r·∫±ng t·∫•t c·∫£
              c√°c gi√° tr·ªã trong m·ªôt c·ªôt (ho·∫∑c m·ªôt nh√≥m c·ªôt) ƒë·ªÅu l√† duy nh·∫•t. N√≥
              ngƒÉn ch·∫∑n vi·ªác tr√πng l·∫∑p d·ªØ li·ªáu trong c√°c c·ªôt ƒë∆∞·ª£c √°p d·ª•ng.
            </p>

            <div class="info-box">
              <h4>üìã T√≠nh ch·∫•t c·ªßa UNIQUE:</h4>
              <ul>
                <li>
                  <b>Cho ph√©p NULL:</b> M·ªôt c·ªôt c√≥ r√†ng bu·ªôc UNIQUE c√≥ th·ªÉ ch·ª©a
                  m·ªôt ho·∫∑c nhi·ªÅu gi√° tr·ªã NULL
                </li>
                <li>
                  <b>S·ªë l∆∞·ª£ng:</b> M·ªôt b·∫£ng c√≥ th·ªÉ c√≥ nhi·ªÅu r√†ng bu·ªôc UNIQUE
                </li>
                <li>
                  <b>M·ª•c ƒë√≠ch:</b> ƒê·∫£m b·∫£o t√≠nh duy nh·∫•t c·ªßa d·ªØ li·ªáu nh∆∞ng kh√¥ng
                  nh·∫≠n d·∫°ng b·∫£n ghi
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• UNIQUE:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt b·∫£ng <code>customers</code> (kh√°ch h√†ng) v√†
                mu·ªën ƒë·∫£m b·∫£o r·∫±ng m·ªói kh√°ch h√†ng ch·ªâ c√≥ m·ªôt ƒë·ªãa ch·ªâ email duy
                nh·∫•t.
              </p>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">customers</span> (
                    <span class="column">customer_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">customer_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,
                    <span class="column">email</span> <span class="datatype">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">UNIQUE</span>, <span class="comment">-- √Åp d·ª•ng r√†ng bu·ªôc UNIQUE cho c·ªôt email</span>
                    <span class="column">phone_number</span> <span class="datatype">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>, <span class="comment">-- S·ªë ƒëi·ªán tho·∫°i c≈©ng ph·∫£i duy nh·∫•t</span>
                    <span class="column">address</span> <span class="datatype">NVARCHAR</span>(<span class="number">200</span>),
                    <span class="column">registration_date</span> <span class="datatype">DATE</span> <span class="keyword">DEFAULT</span> <span class="function">GETDATE</span>()
                );
                
                <span class="comment">-- Th√™m d·ªØ li·ªáu h·ª£p l·ªá</span>
                <span class="keyword">INSERT INTO</span> <span class="table">customers</span> (<span class="column">customer_name</span>, <span class="column">email</span>, <span class="column">phone_number</span>) 
                <span class="keyword">VALUES</span> 
                    (<span class="string">N'Nguy·ªÖn VƒÉn A'</span>, <span class="string">'a@email.com'</span>, <span class="string">'0123456789'</span>),
                    (<span class="string">N'Tr·∫ßn Th·ªã B'</span>, <span class="string">'b@email.com'</span>, <span class="string">'0987654321'</span>);
              </div>
              <p>
                N·∫øu b·∫°n c·ªë g·∫Øng th√™m hai kh√°ch h√†ng c√≥ c√πng ƒë·ªãa ch·ªâ email, h·ªá
                th·ªëng s·∫Ω b√°o l·ªói.
              </p>
            </div>

            <h3>üëë 2. PRIMARY KEY (Kh√≥a Ch√≠nh)</h3>
            <p>
              <b>PRIMARY KEY</b> l√† m·ªôt r√†ng bu·ªôc ƒë·∫∑c bi·ªát, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c
              ƒë·ªãnh duy nh·∫•t m·ªôt h√†ng trong m·ªôt b·∫£ng. ƒê√¢y l√† m·ªôt kh√°i ni·ªám c·ªët
              l√µi trong c∆° s·ªü d·ªØ li·ªáu quan h·ªá.
            </p>

            <div class="info-box">
              <h4>üìã T√≠nh ch·∫•t c·ªßa PRIMARY KEY:</h4>
              <ul>
                <li>
                  <b>Kh√¥ng cho ph√©p NULL:</b> M·ªôt c·ªôt PRIMARY KEY ph·∫£i ch·ª©a gi√°
                  tr·ªã, kh√¥ng th·ªÉ ƒë·ªÉ tr·ªëng (NULL)
                </li>
                <li><b>S·ªë l∆∞·ª£ng:</b> M·ªôt b·∫£ng ch·ªâ c√≥ m·ªôt PRIMARY KEY</li>
                <li>
                  <b>T√≠ch h·ª£p:</b> PRIMARY KEY v·ªÅ b·∫£n ch·∫•t l√† s·ª± k·∫øt h·ª£p c·ªßa
                  UNIQUE v√† NOT NULL
                </li>
                <li>
                  <b>M·ª•c ƒë√≠ch:</b> Nh·∫≠n d·∫°ng duy nh·∫•t t·ª´ng b·∫£n ghi trong b·∫£ng
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• PRIMARY KEY:</h4>
              <p>
                Trong b·∫£ng <code>stores</code> (c·ª≠a h√†ng),
                <code>store_id</code> th∆∞·ªùng ƒë∆∞·ª£c ch·ªçn l√†m kh√≥a ch√≠nh v√¨ m·ªói c·ª≠a
                h√†ng s·∫Ω c√≥ m·ªôt ID duy nh·∫•t v√† kh√¥ng th·ªÉ ƒë·ªÉ tr·ªëng.
              </p>
              <div class="code-block">
                <span class="keyword">CREATE TABLE</span> <span class="table">stores</span> (
                    <span class="column">store_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>, <span class="comment">-- store_id l√† kh√≥a ch√≠nh</span>
                    <span class="column">store_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,
                    <span class="column">manager_name</span> <span class="datatype">NVARCHAR</span>(<span class="number">100</span>),
                    <span class="column">location</span> <span class="datatype">NVARCHAR</span>(<span class="number">255</span>),
                    <span class="column">phone</span> <span class="datatype">VARCHAR</span>(<span class="number">20</span>),
                    <span class="column">opening_date</span> <span class="datatype">DATE</span> <span class="keyword">DEFAULT</span> <span class="function">GETDATE</span>()
                );
                
                <span class="comment">-- Th√™m d·ªØ li·ªáu</span>
                <span class="keyword">INSERT INTO</span> <span class="table">stores</span> (<span class="column">store_name</span>, <span class="column">manager_name</span>) 
                <span class="keyword">VALUES</span> 
                    (<span class="string">N'C·ª≠a h√†ng Qu·∫≠n 1'</span>, <span class="string">N'Nguy·ªÖn VƒÉn Manager'</span>),
                    (<span class="string">N'C·ª≠a h√†ng H√† N·ªôi'</span>, <span class="string">N'Tr·∫ßn Th·ªã Director'</span>);
              </div>
              <p>
                N·∫øu b·∫°n c·ªë g·∫Øng ch√®n hai c·ª≠a h√†ng v·ªõi c√πng
                <code>store_id</code> ho·∫∑c ƒë·ªÉ tr·ªëng <code>store_id</code>, h·ªá
                th·ªëng s·∫Ω b√°o l·ªói.
              </p>
            </div>

            <h3>üìä T√≥m t·∫Øt s·ª± kh√°c bi·ªát</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>UNIQUE</th>
                  <th>PRIMARY KEY</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>Gi√° tr·ªã NULL</b></td>
                  <td>Cho ph√©p gi√° tr·ªã NULL</td>
                  <td>Kh√¥ng cho ph√©p gi√° tr·ªã NULL</td>
                </tr>
                <tr>
                  <td><b>S·ªë l∆∞·ª£ng</b></td>
                  <td>C√≥ th·ªÉ c√≥ nhi·ªÅu trong m·ªôt b·∫£ng</td>
                  <td>Ch·ªâ c√≥ m·ªôt trong m·ªôt b·∫£ng</td>
                </tr>
                <tr>
                  <td><b>M·ª•c ƒë√≠ch</b></td>
                  <td>
                    ƒê·∫£m b·∫£o duy nh·∫•t d·ªØ li·ªáu trong m·ªôt c·ªôt ho·∫∑c m·ªôt nh√≥m c·ªôt
                  </td>
                  <td>
                    X√°c ƒë·ªãnh duy nh·∫•t m·ªôt h√†ng trong b·∫£ng (kh√≥a nh·∫≠n d·∫°ng)
                  </td>
                </tr>
                <tr>
                  <td><b>T√≠nh ch·∫•t</b></td>
                  <td>L√† m·ªôt r√†ng bu·ªôc duy nh·∫•t</td>
                  <td>L√† s·ª± k·∫øt h·ª£p c·ªßa UNIQUE v√† NOT NULL</td>
                </tr>
                <tr>
                  <td><b>Index t·ª± ƒë·ªông</b></td>
                  <td>T·∫°o index unique t·ª± ƒë·ªông</td>
                  <td>T·∫°o clustered index t·ª± ƒë·ªông (th∆∞·ªùng)</td>
                </tr>
                <tr>
                  <td><b>S·ª≠ d·ª•ng trong quan h·ªá</b></td>
                  <td>C√≥ th·ªÉ ƒë∆∞·ª£c tham chi·∫øu b·ªüi Foreign Key</td>
                  <td>Th∆∞·ªùng ƒë∆∞·ª£c tham chi·∫øu b·ªüi Foreign Key</td>
                </tr>
              </tbody>
            </table>

            <h3>üîß V√≠ d·ª• minh h·ªça c√°ch s·ª≠ d·ª•ng</h3>
            <div class="example">
              <h4>PRIMARY KEY c·ªßa b·∫£ng stores:</h4>
              <p>
                <code>store_id</code> l√† PRIMARY KEY. B·∫°n s·ª≠ d·ª•ng
                <code>store_id</code> ƒë·ªÉ tham chi·∫øu ƒë·∫øn m·ªôt c·ª≠a h√†ng c·ª• th·ªÉ.
              </p>
              <div class="code-block">
                ALTER TABLE stores ADD CONSTRAINT pk_store_id PRIMARY KEY
                (store_id);
              </div>
            </div>

            <div class="example">
              <h4>UNIQUE c·ªßa b·∫£ng customers:</h4>
              <p>
                <code>email</code> c√≥ th·ªÉ l√† UNIQUE. M·ªói kh√°ch h√†ng c√≥ m·ªôt email
                duy nh·∫•t, nh∆∞ng email ƒë√≥ kh√¥ng d√πng ƒë·ªÉ x√°c ƒë·ªãnh to√†n b·ªô h√†ng (v√¨
                c√≥ th·ªÉ c√≥ nhi·ªÅu kh√°ch h√†ng ch∆∞a c√≥ email).
              </p>
              <div class="code-block">
                ALTER TABLE customers ADD CONSTRAINT unique_email UNIQUE
                (email);
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• t·ªïng h·ª£p - B·∫£ng nh√¢n vi√™n:</h4>
              <div class="code-block">
                CREATE TABLE employees ( employee_id INT IDENTITY(1,1) PRIMARY
                KEY, -- Kh√≥a ch√≠nh ƒë·ªÉ nh·∫≠n d·∫°ng duy nh·∫•t employee_code
                VARCHAR(10) UNIQUE NOT NULL, -- M√£ nh√¢n vi√™n duy nh·∫•t email
                VARCHAR(100) UNIQUE, -- Email duy nh·∫•t, c√≥ th·ªÉ NULL
                social_security VARCHAR(12) UNIQUE, -- S·ªë CMT/CCCD duy nh·∫•t
                employee_name NVARCHAR(100) NOT NULL, department_id INT,
                hire_date DATE DEFAULT GETDATE() ); -- V√≠ d·ª• ch√®n d·ªØ li·ªáu INSERT
                INTO employees (employee_code, email, social_security,
                employee_name, department_id) VALUES ('EMP001',
                'john.doe@company.com', '123456789012', N'Nguy·ªÖn VƒÉn John', 1),
                ('EMP002', 'jane.smith@company.com', '123456789013', N'Tr·∫ßn Th·ªã
                Jane', 2), ('EMP003', NULL, '123456789014', N'Ph·∫°m VƒÉn Bob', 1);
                -- Email c√≥ th·ªÉ NULL -- T·∫°o quan h·ªá v·ªõi b·∫£ng kh√°c CREATE TABLE
                timesheets ( timesheet_id INT IDENTITY(1,1) PRIMARY KEY,
                employee_id INT, -- Tham chi·∫øu ƒë·∫øn PRIMARY KEY c·ªßa b·∫£ng
                employees work_date DATE, hours_worked DECIMAL(4,2), FOREIGN KEY
                (employee_id) REFERENCES employees(employee_id) );
              </div>
            </div>

            <div class="success-box">
              <h4>üí° H∆∞·ªõng d·∫´n l·ª±a ch·ªçn:</h4>
              <ul>
                <li>
                  <b>S·ª≠ d·ª•ng PRIMARY KEY</b> khi b·∫°n c·∫ßn m·ªôt c·ªôt ƒë·ªÉ nh·∫≠n d·∫°ng
                  duy nh·∫•t m·ªói h√†ng trong b·∫£ng
                </li>
                <li>
                  <b>S·ª≠ d·ª•ng UNIQUE</b> khi b·∫°n ch·ªâ mu·ªën ƒë·∫£m b·∫£o d·ªØ li·ªáu trong
                  m·ªôt c·ªôt kh√¥ng b·ªã tr√πng l·∫∑p, nh∆∞ng kh√¥ng c·∫ßn n√≥ l√†m kh√≥a nh·∫≠n
                  d·∫°ng ch√≠nh
                </li>
                <li>
                  <b>C√≥ th·ªÉ k·∫øt h·ª£p:</b> M·ªôt b·∫£ng c√≥ th·ªÉ c√≥ 1 PRIMARY KEY v√†
                  nhi·ªÅu UNIQUE constraints
                </li>
                <li>
                  <b>Thi·∫øt k·∫ø t·ªët:</b> M·ªói b·∫£ng n√™n c√≥ PRIMARY KEY ƒë·ªÉ ƒë·∫£m b·∫£o
                  t√≠nh to√†n v·∫πn d·ªØ li·ªáu
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <ul>
                <li>
                  <b>PRIMARY KEY</b> th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m Clustered Index,
                  ·∫£nh h∆∞·ªüng ƒë·∫øn c√°ch l∆∞u tr·ªØ v·∫≠t l√Ω
                </li>
                <li>
                  <b>UNIQUE</b> c√≥ th·ªÉ c√≥ gi√° tr·ªã NULL, nh∆∞ng ch·ªâ ƒë∆∞·ª£c ph√©p m·ªôt
                  gi√° tr·ªã NULL duy nh·∫•t trong m·ªôt s·ªë h·ªá CSDL
                </li>
                <li>
                  <b>Foreign Key</b> c√≥ th·ªÉ tham chi·∫øu ƒë·∫øn c·ªôt UNIQUE, kh√¥ng ch·ªâ
                  PRIMARY KEY
                </li>
                <li>
                  <b>Hi·ªáu su·∫•t:</b> C·∫£ hai ƒë·ªÅu t·∫°o index t·ª± ƒë·ªông, gi√∫p tƒÉng t·ªëc
                  ƒë·ªô truy v·∫•n
                </li>
              </ul>
            </div>
          </section>

          <!-- 9 -->
          <section class="section" id="index">
            <h2>9. Index</h2>

            <h3>üìö Index l√† g√¨?</h3>
            <p>
              <b>Index (ch·ªâ m·ª•c)</b> l√† m·ªôt c·∫•u tr√∫c d·ªØ li·ªáu ƒë·∫∑c bi·ªát ƒë∆∞·ª£c t·∫°o
              tr√™n m·ªôt c·ªôt (ho·∫∑c nhi·ªÅu c·ªôt) c·ªßa b·∫£ng ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô t√¨m ki·∫øm v√†
              truy xu·∫•t d·ªØ li·ªáu. B·∫°n c√≥ th·ªÉ h√¨nh dung n√≥ gi·ªëng nh∆∞
              <b>m·ª•c l·ª•c c·ªßa m·ªôt cu·ªën s√°ch</b>: thay v√¨ ph·∫£i ƒë·ªçc to√†n b·ªô cu·ªën
              s√°ch (qu√©t to√†n b·ªô b·∫£ng) ƒë·ªÉ t√¨m m·ªôt t·ª´ kh√≥a, b·∫°n ch·ªâ c·∫ßn tra c·ª©u
              m·ª•c l·ª•c (index) ƒë·ªÉ bi·∫øt t·ª´ kh√≥a ƒë√≥ ·ªü trang n√†o, t·ª´ ƒë√≥ ti·∫øt ki·ªám
              th·ªùi gian ƒë√°ng k·ªÉ.
            </p>

            <div class="info-box">
              <h4>‚öôÔ∏è C√°ch ho·∫°t ƒë·ªông c·ªßa Index:</h4>
              <p>
                Khi m·ªôt index ƒë∆∞·ª£c t·∫°o, h·ªá th·ªëng c∆° s·ªü d·ªØ li·ªáu s·∫Ω
                <b>s·∫Øp x·∫øp c√°c gi√° tr·ªã</b> c·ªßa c·ªôt ƒë√≥ v√† l∆∞u tr·ªØ ch√∫ng c√πng v·ªõi
                <b>con tr·ªè (pointer)</b> ƒë·∫øn v·ªã tr√≠ c·ªßa c√°c h√†ng d·ªØ li·ªáu t∆∞∆°ng
                ·ª©ng.
              </p>
            </div>

            <h3>üóÇÔ∏è C√°c lo·∫°i Index ph·ªï bi·∫øn</h3>
            <p>
              C√≥ nhi·ªÅu lo·∫°i index kh√°c nhau, m·ªói lo·∫°i c√≥ c√°ch ho·∫°t ƒë·ªông v√† m·ª•c
              ƒë√≠ch s·ª≠ d·ª•ng ri√™ng:
            </p>

            <h4>1. Clustered Index</h4>
            <div class="highlight-box">
              <ul>
                <li>
                  <b>S·∫Øp x·∫øp th·ª© t·ª± v·∫≠t l√Ω</b> c·ªßa c√°c h√†ng d·ªØ li·ªáu trong b·∫£ng
                </li>
                <li>M·ªôt b·∫£ng <b>ch·ªâ c√≥ th·ªÉ c√≥ m·ªôt</b> Clustered Index</li>
                <li>ƒê√¢y th∆∞·ªùng l√† <b>kh√≥a ch√≠nh (PRIMARY KEY)</b> c·ªßa b·∫£ng</li>
                <li>
                  <b>V√≠ d·ª•:</b> N·∫øu m·ªôt b·∫£ng ƒë∆∞·ª£c t·∫°o v·ªõi PRIMARY KEY, SQL
                  Server s·∫Ω t·ª± ƒë·ªông t·∫°o m·ªôt Clustered Index tr√™n c·ªôt ƒë√≥
                </li>
              </ul>
            </div>

            <h4>2. Non-clustered Index</h4>
            <div class="highlight-box">
              <ul>
                <li><b>Kh√¥ng s·∫Øp x·∫øp th·ª© t·ª± v·∫≠t l√Ω</b> c·ªßa d·ªØ li·ªáu</li>
                <li>
                  T·∫°o ra m·ªôt <b>c·∫•u tr√∫c ri√™ng bi·ªát</b> (nh∆∞ c√¢y B-tree) ƒë·ªÉ l∆∞u
                  tr·ªØ c√°c gi√° tr·ªã ƒë√£ s·∫Øp x·∫øp
                </li>
                <li>M·ªôt b·∫£ng c√≥ th·ªÉ c√≥ <b>nhi·ªÅu Non-clustered Index</b></li>
                <li>
                  <b>V√≠ d·ª•:</b> M·ªôt index tr√™n c·ªôt email c·ªßa b·∫£ng customers
                </li>
              </ul>
            </div>

            <h4>3. Single-column Index</h4>
            <div class="highlight-box">
              <ul>
                <li>Ch·ªâ ƒë∆∞·ª£c t·∫°o tr√™n <b>m·ªôt c·ªôt duy nh·∫•t</b></li>
                <li>
                  <b>V√≠ d·ª•:</b>
                  <code
                    >CREATE INDEX idx_customer_name ON
                    customers(last_name);</code
                  >
                </li>
              </ul>
            </div>

            <h4>4. Composite Index (Multi-column Index)</h4>
            <div class="highlight-box">
              <ul>
                <li>ƒê∆∞·ª£c t·∫°o tr√™n <b>hai ho·∫∑c nhi·ªÅu c·ªôt</b></li>
                <li>
                  TƒÉng t·ªëc ƒë·ªô t√¨m ki·∫øm khi c√°c c√¢u l·ªánh WHERE ho·∫∑c ORDER BY s·ª≠
                  d·ª•ng <b>k·∫øt h·ª£p c√°c c·ªôt n√†y</b>
                </li>
                <li>
                  <b>V√≠ d·ª•:</b>
                  <code
                    >CREATE INDEX idx_emp_name_dept ON employees(first_name,
                    department_id);</code
                  >
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω v·ªÅ Composite Index:</h4>
              <p>
                <b>Th·ª© t·ª± c√°c c·ªôt</b> trong Composite Index r·∫•t quan tr·ªçng. V√≠
                d·ª•, index tr√™n <code>(last_name, first_name)</code> c√≥ th·ªÉ gi√∫p
                t√¨m ki·∫øm theo <code>last_name</code> ho·∫∑c
                <code>(last_name, first_name)</code>, nh∆∞ng s·∫Ω
                <b>kh√¥ng hi·ªáu qu·∫£</b> khi ch·ªâ t√¨m ki·∫øm theo
                <code>first_name</code>.
              </p>
            </div>

            <h4>5. Unique Index</h4>
            <div class="highlight-box">
              <ul>
                <li>
                  Gi·ªëng nh∆∞ r√†ng bu·ªôc UNIQUE, n√≥ ƒë·∫£m b·∫£o r·∫±ng t·∫•t c·∫£ c√°c gi√° tr·ªã
                  trong c·ªôt ƒë∆∞·ª£c l·∫≠p ch·ªâ m·ª•c l√† <b>duy nh·∫•t</b>
                </li>
                <li>
                  Th∆∞·ªùng ƒë∆∞·ª£c t·∫°o <b>t·ª± ƒë·ªông</b> khi b·∫°n ƒë·ªãnh nghƒ©a m·ªôt c·ªôt l√†
                  PRIMARY KEY ho·∫∑c UNIQUE
                </li>
              </ul>
            </div>

            <h3>üîß C√∫ ph√°p v√† v√≠ d·ª•</h3>
            <div class="example">
              <h4>C√∫ ph√°p c∆° b·∫£n:</h4>
              <div class="code-block">
                <span class="keyword">CREATE INDEX</span> <span class="column">index_name</span> <span class="keyword">ON</span> <span class="table">table_name</span>(<span class="column">column1</span>, <span class="column">column2</span>, ...);
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• 1: T·∫°o index ƒë∆°n c·ªôt</h4>
              <p>
                T·∫°o m·ªôt index ƒë∆°n c·ªôt tr√™n c·ªôt <code>last_name</code> c·ªßa b·∫£ng
                <code>customers</code>:
              </p>
              <div class="code-block">
                <span class="keyword">CREATE INDEX</span> <span class="column">idx_customer_name</span> <span class="keyword">ON</span> <span class="table">customers</span>(<span class="column">last_name</span>);
                
                <span class="comment">-- Truy v·∫•n s·∫Ω nhanh h∆°n:</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">customers</span> 
                <span class="keyword">WHERE</span> <span class="column">last_name</span> <span class="operator">=</span> <span class="string">N'Nguy·ªÖn'</span>;
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• 2: T·∫°o index k·∫øt h·ª£p</h4>
              <p>
                T·∫°o m·ªôt index k·∫øt h·ª£p tr√™n hai c·ªôt <code>first_name</code> v√†
                <code>department_id</code> c·ªßa b·∫£ng <code>employees</code>:
              </p>
              <div class="code-block">
                <span class="keyword">CREATE INDEX</span> <span class="column">idx_name_department</span> <span class="keyword">ON</span> <span class="table">employees</span>(<span class="column">first_name</span>, <span class="column">department_id</span>);
                
                <span class="comment">-- Index n√†y s·∫Ω gi√∫p tƒÉng t·ªëc c√°c truy v·∫•n nh∆∞:</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">employees</span> 
                <span class="keyword">WHERE</span> <span class="column">first_name</span> <span class="operator">=</span> <span class="string">N'VƒÉn'</span> <span class="keyword">AND</span> <span class="column">department_id</span> <span class="operator">=</span> <span class="number">10</span>;
                
                <span class="comment">-- Ho·∫∑c ch·ªâ t√¨m theo first_name (c·ªôt ƒë·∫ßu ti√™n c·ªßa index):</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">employees</span> 
                <span class="keyword">WHERE</span> <span class="column">first_name</span> <span class="operator">=</span> <span class="string">N'VƒÉn'</span>;
                
                <span class="comment">-- Nh∆∞ng KH√îNG hi·ªáu qu·∫£ cho truy v·∫•n ch·ªâ theo department_id:
                -- SELECT * FROM employees WHERE department_id = 10; -- Kh√¥ng t·ªëi ∆∞u</span>
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• 3: T·∫°o Unique Index</h4>
              <div class="code-block">
                -- T·∫°o unique index tr√™n c·ªôt email CREATE UNIQUE INDEX
                idx_unique_email ON customers(email); -- Ho·∫∑c t·∫°o unique index
                k·∫øt h·ª£p CREATE UNIQUE INDEX idx_unique_product_code ON
                products(product_code, supplier_id);
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• 4: X√≥a Index</h4>
              <div class="code-block">
                -- X√≥a index khi kh√¥ng c√≤n c·∫ßn thi·∫øt DROP INDEX
                idx_customer_name ON customers; -- Ho·∫∑c trong SQL Server 2016+:
                DROP INDEX customers.idx_customer_name;
              </div>
            </div>

            <h3>üéØ Khi n√†o n√™n d√πng Index?</h3>
            <div class="success-box">
              <h4>‚úÖ N√äN t·∫°o Index khi:</h4>
              <ul>
                <li>
                  <b>Tr√™n c√°c c·ªôt ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n</b> trong c√°c c√¢u
                  l·ªánh WHERE, JOIN v√† ORDER BY
                </li>
                <li>
                  <b>Tr√™n c√°c c·ªôt c√≥ nhi·ªÅu gi√° tr·ªã kh√°c nhau</b> (t√≠nh ƒë·ªôc l·∫≠p
                  cao)
                </li>
                <li><b>Khi t·ªëc ƒë·ªô ƒë·ªçc d·ªØ li·ªáu quan tr·ªçng h∆°n t·ªëc ƒë·ªô ghi</b></li>
                <li>Tr√™n c√°c c·ªôt th∆∞·ªùng xuy√™n ƒë∆∞·ª£c s·∫Øp x·∫øp (ORDER BY)</li>
                <li>Tr√™n c√°c c·ªôt tham gia v√†o JOIN</li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå KH√îNG n√™n t·∫°o Index khi:</h4>
              <ul>
                <li>B·∫£ng c√≥ <b>√≠t d·ªØ li·ªáu</b> (d∆∞·ªõi 1000 h√†ng)</li>
                <li>
                  C·ªôt c√≥ <b>√≠t gi√° tr·ªã kh√°c nhau</b> (v√≠ d·ª•: c·ªôt gi·ªõi t√≠nh ch·ªâ
                  c√≥ Nam/N·ªØ)
                </li>
                <li>
                  B·∫£ng c√≥ <b>nhi·ªÅu thao t√°c INSERT, UPDATE, DELETE</b> h∆°n
                  SELECT
                </li>
                <li>C·ªôt <b>√≠t khi ƒë∆∞·ª£c s·ª≠ d·ª•ng</b> trong WHERE ho·∫∑c JOIN</li>
              </ul>
            </div>

            <h3>üìä V√≠ d·ª• th·ª±c t·∫ø: Hi·ªáu qu·∫£ c·ªßa Index</h3>
            <div class="example">
              <h4>So s√°nh hi·ªáu su·∫•t v·ªõi v√† kh√¥ng c√≥ Index:</h4>
              <div class="code-block">
                <span class="comment">-- T·∫°o b·∫£ng m·∫´u v·ªõi d·ªØ li·ªáu l·ªõn</span>
                <span class="keyword">CREATE TABLE</span> <span class="table">sales_records</span> (
                    <span class="column">sale_id</span> <span class="datatype">INT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">PRIMARY KEY</span>,
                    <span class="column">customer_id</span> <span class="datatype">INT</span>,
                    <span class="column">product_id</span> <span class="datatype">INT</span>,
                    <span class="column">sale_date</span> <span class="datatype">DATE</span>,
                    <span class="column">amount</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),
                    <span class="column">region</span> <span class="datatype">NVARCHAR</span>(<span class="number">50</span>)
                );
                
                <span class="comment">-- Ch√®n 100,000 b·∫£n ghi m·∫´u
                -- INSERT INTO sales_records ... (gi·∫£ s·ª≠ c√≥ 100k records)</span>
                
                <span class="comment">-- TR∆Ø·ªöC khi t·∫°o index - ch·∫≠m (Table Scan)</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">sales_records</span> 
                <span class="keyword">WHERE</span> <span class="column">customer_id</span> <span class="operator">=</span> <span class="number">12345</span> <span class="keyword">AND</span> <span class="column">sale_date</span> <span class="operator">>=</span> <span class="string">'2025-01-01'</span>;
                
                <span class="comment">-- T·∫°o index ph√π h·ª£p</span>
                <span class="keyword">CREATE INDEX</span> <span class="column">idx_customer_date</span> <span class="keyword">ON</span> <span class="table">sales_records</span>(<span class="column">customer_id</span>, <span class="column">sale_date</span>);
                
                <span class="comment">-- SAU khi t·∫°o index - nhanh h∆°n nhi·ªÅu (Index Seek)</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">sales_records</span> 
                <span class="keyword">WHERE</span> <span class="column">customer_id</span> <span class="operator">=</span> <span class="number">12345</span> <span class="keyword">AND</span> <span class="column">sale_date</span> <span class="operator">>=</span> <span class="string">'2025-01-01'</span>;
              </div>
            </div>

            <h3>üîç Ki·ªÉm tra v√† qu·∫£n l√Ω Index</h3>
            <div class="example">
              <h4>Xem c√°c index hi·ªán c√≥:</h4>
              <div class="code-block">
                -- Xem t·∫•t c·∫£ index c·ªßa m·ªôt b·∫£ng SELECT i.name AS IndexName,
                i.type_desc AS IndexType, c.name AS ColumnName FROM sys.indexes
                i INNER JOIN sys.index_columns ic ON i.object_id = ic.object_id
                AND i.index_id = ic.index_id INNER JOIN sys.columns c ON
                ic.object_id = c.object_id AND ic.column_id = c.column_id WHERE
                i.object_id = OBJECT_ID('customers') ORDER BY i.name,
                ic.key_ordinal;
              </div>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng v·ªÅ Index:</h4>
              <ul>
                <li>
                  <b>Index l√†m ch·∫≠m c√°c thao t√°c ghi:</b> INSERT, UPDATE v√†
                  DELETE v√¨ h·ªá th·ªëng ph·∫£i c·∫≠p nh·∫≠t c·∫£ b·∫£ng d·ªØ li·ªáu v√† c·∫•u tr√∫c
                  index
                </li>
                <li>
                  <b>Index chi·∫øm dung l∆∞·ª£ng:</b> M·ªói index t·∫°o th√™m s·ª≠ d·ª•ng th√™m
                  kh√¥ng gian l∆∞u tr·ªØ
                </li>
                <li>
                  <b>Qu√° nhi·ªÅu index c√≥ th·ªÉ ph·∫£n t√°c d·ª•ng:</b> N√™n ch·ªâ t·∫°o index
                  tr√™n c√°c c·ªôt th·ª±c s·ª± c·∫ßn thi·∫øt
                </li>
                <li>
                  <b>Index c·∫ßn ƒë∆∞·ª£c b·∫£o tr√¨:</b> ƒê·ªãnh k·ª≥ rebuild ho·∫∑c reorganize
                  ƒë·ªÉ duy tr√¨ hi·ªáu su·∫•t
                </li>
              </ul>
            </div>
          </section>

          <!-- 10 -->
          <section class="section" id="sql-order">
            <h2>10. Th·ª© t·ª± th·ª±c thi SQL</h2>

            <div class="info-box">
              <h4>üìã Th·ª© t·ª± th·ª±c thi SQL:</h4>
              <p>
                Hi·ªÉu r√µ th·ª© t·ª± th·ª±c thi SQL gi√∫p b·∫°n vi·∫øt c√¢u l·ªánh hi·ªáu qu·∫£ v√†
                tr√°nh l·ªói logic. SQL ƒë∆∞·ª£c th·ª±c thi theo th·ª© t·ª± sau,
                <b>kh√¥ng ph·∫£i theo th·ª© t·ª± vi·∫øt</b>:
              </p>
              <ol>
                <li><b>FROM / JOIN</b> - X√°c ƒë·ªãnh v√† n·ªëi c√°c b·∫£ng</li>
                <li><b>WHERE</b> - L·ªçc c√°c h√†ng</li>
                <li><b>GROUP BY</b> - Nh√≥m c√°c h√†ng</li>
                <li><b>HAVING</b> - L·ªçc c√°c nh√≥m</li>
                <li><b>SELECT</b> - Ch·ªçn c·ªôt v√† t√≠nh to√°n</li>
                <li><b>ORDER BY</b> - S·∫Øp x·∫øp k·∫øt qu·∫£</li>
              </ol>
            </div>

            <h3>üîç Chi ti·∫øt t·ª´ng b∆∞·ªõc th·ª±c thi</h3>

            <h4>1Ô∏è‚É£ FROM / JOIN</h4>
            <div class="highlight-box">
              <p>
                <b>FROM</b> l√† b∆∞·ªõc ƒë·∫ßu ti√™n. N√≥ x√°c ƒë·ªãnh c√°c b·∫£ng m√† b·∫°n s·∫Ω l√†m
                vi·ªác.
              </p>
              <p>
                <b>JOIN</b> k·∫øt h·ª£p c√°c h√†ng t·ª´ hai ho·∫∑c nhi·ªÅu b·∫£ng d·ª±a tr√™n m·ªôt
                c·ªôt li√™n quan gi·ªØa ch√∫ng.
              </p>
              <div class="code-block">
                FROM customers c JOIN orders o ON c.customer_id = o.customer_id
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> B∆∞·ªõc n√†y s·∫Ω t·∫°o ra m·ªôt t·∫≠p h·ª£p d·ªØ li·ªáu l·ªõn b·∫±ng
                c√°ch n·ªëi b·∫£ng <code>customers</code> v√† <code>orders</code> l·∫°i
                v·ªõi nhau.
              </p>
            </div>

            <h4>2Ô∏è‚É£ WHERE</h4>
            <div class="highlight-box">
              <p>
                L·ªçc c√°c h√†ng t·ª´ t·∫≠p h·ª£p d·ªØ li·ªáu ƒë∆∞·ª£c t·∫°o ·ªü b∆∞·ªõc FROM/JOIN. Ch·ªâ
                nh·ªØng h√†ng th·ªèa m√£n ƒëi·ªÅu ki·ªán WHERE m·ªõi ƒë∆∞·ª£c gi·ªØ l·∫°i.
              </p>
              <div class="code-block">WHERE o.order_date >= '2024-01-01'</div>
              <p>
                <b>K·∫øt qu·∫£:</b> B∆∞·ªõc n√†y s·∫Ω l·ªçc ra ch·ªâ nh·ªØng ƒë∆°n h√†ng ƒë∆∞·ª£c ƒë·∫∑t
                t·ª´ ng√†y 01/01/2024 tr·ªü ƒëi.
              </p>
            </div>

            <h4>3Ô∏è‚É£ GROUP BY</h4>
            <div class="highlight-box">
              <p>
                Nh√≥m c√°c h√†ng c√≥ c√πng gi√° tr·ªã trong m·ªôt ho·∫∑c nhi·ªÅu c·ªôt th√†nh c√°c
                nh√≥m t·ªïng h·ª£p.
              </p>
              <div class="code-block">
                <span class="keyword">GROUP BY</span> <span class="column">c.customer_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> B∆∞·ªõc n√†y s·∫Ω nh√≥m t·∫•t c·∫£ c√°c h√†ng c·ªßa c√πng m·ªôt
                kh√°ch h√†ng l·∫°i v·ªõi nhau, d·ª±a tr√™n ID, t√™n v√† h·ªç c·ªßa h·ªç.
              </p>
            </div>

            <h4>4Ô∏è‚É£ HAVING</h4>
            <div class="highlight-box">
              <p>
                L·ªçc c√°c nh√≥m ƒë∆∞·ª£c t·∫°o ra ·ªü b∆∞·ªõc GROUP BY d·ª±a tr√™n m·ªôt ƒëi·ªÅu ki·ªán
                t·ªïng h·ª£p (v√≠ d·ª•: COUNT, SUM, AVG).
              </p>
              <div class="code-block">
                <span class="keyword">HAVING</span> <span class="function">COUNT</span>(<span class="column">o.order_id</span>) <span class="operator">></span> <span class="number">2</span></div>
              <p>
                <b>K·∫øt qu·∫£:</b> B∆∞·ªõc n√†y s·∫Ω l·ªçc ra ch·ªâ nh·ªØng nh√≥m kh√°ch h√†ng ƒë√£
                ƒë·∫∑t nhi·ªÅu h∆°n 2 ƒë∆°n h√†ng.
              </p>
              <p>
                <b>L∆∞u √Ω:</b> B·∫°n kh√¥ng th·ªÉ s·ª≠ d·ª•ng WHERE cho ƒëi·ªÅu ki·ªán n√†y v√¨
                n√≥ ch·ªâ √°p d·ª•ng cho t·ª´ng h√†ng ri√™ng l·∫ª, kh√¥ng ph·∫£i cho c√°c nh√≥m.
              </p>
            </div>

            <h4>5Ô∏è‚É£ SELECT</h4>
            <div class="highlight-box">
              <p>
                B∆∞·ªõc n√†y ch·ªçn c√°c c·ªôt b·∫°n mu·ªën hi·ªÉn th·ªã trong k·∫øt qu·∫£ cu·ªëi c√πng.
                C√°c h√†m t·ªïng h·ª£p (COUNT, SUM, AVG) ƒë∆∞·ª£c t√≠nh to√°n ·ªü ƒë√¢y.
              </p>
              <div class="code-block">
                SELECT c.customer_id, c.first_name, c.last_name,
                COUNT(o.order_id) AS total_orders
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> B∆∞·ªõc n√†y s·∫Ω ch·ªçn c√°c c·ªôt customer_id,
                first_name, last_name v√† t√≠nh t·ªïng s·ªë ƒë∆°n h√†ng
                (COUNT(o.order_id)) cho m·ªói nh√≥m.
              </p>
            </div>

            <h4>6Ô∏è‚É£ ORDER BY</h4>
            <div class="highlight-box">
              <p>S·∫Øp x·∫øp th·ª© t·ª± c√°c h√†ng cu·ªëi c√πng c·ªßa k·∫øt qu·∫£.</p>
              <div class="code-block">ORDER BY total_orders DESC</div>
              <p>
                <b>K·∫øt qu·∫£:</b> B∆∞·ªõc n√†y s·∫Ω s·∫Øp x·∫øp k·∫øt qu·∫£ theo c·ªôt
                total_orders theo th·ª© t·ª± gi·∫£m d·∫ßn, hi·ªÉn th·ªã kh√°ch h√†ng c√≥ nhi·ªÅu
                ƒë∆°n h√†ng nh·∫•t l√™n ƒë·∫ßu.
              </p>
            </div>

            <h3>üìã V√≠ d·ª• ƒë·∫ßy ƒë·ªß</h3>
            <div class="example">
              <h4>C√¢u l·ªánh SQL ph·ª©c t·∫°p:</h4>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">c.customer_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>,
                       <span class="function">COUNT</span>(<span class="column">o.order_id</span>) <span class="keyword">AS</span> <span class="column">total_orders</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>
                <span class="keyword">WHERE</span> <span class="column">o.order_date</span> <span class="operator">>=</span> <span class="string">'2024-01-01'</span>
                <span class="keyword">GROUP BY</span> <span class="column">c.customer_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>
                <span class="keyword">HAVING</span> <span class="function">COUNT</span>(<span class="column">o.order_id</span>) <span class="operator">></span> <span class="number">2</span>
                <span class="keyword">ORDER BY</span> <span class="column">total_orders</span> <span class="keyword">DESC</span>;
              </div>
            </div>

            <h3>üîÑ Th·ª© t·ª± th·ª±c thi chi ti·∫øt c·ªßa v√≠ d·ª• tr√™n</h3>
            <div class="success-box">
              <ol>
                <li>
                  <b>FROM / JOIN:</b> N·ªëi b·∫£ng customers (ƒë∆∞·ª£c ƒë·∫∑t t√™n l√† c) v√†
                  orders (ƒë∆∞·ª£c ƒë·∫∑t t√™n l√† o) l·∫°i v·ªõi nhau.
                </li>
                <li>
                  <b>WHERE:</b> L·ªçc c√°c h√†ng t·ª´ k·∫øt qu·∫£ n·ªëi ch·ªâ nh·ªØng ƒë∆°n h√†ng
                  c√≥ ng√†y ƒë·∫∑t t·ª´ 2024-01-01 tr·ªü ƒëi.
                </li>
                <li>
                  <b>GROUP BY:</b> Nh√≥m c√°c h√†ng c√≤n l·∫°i theo t·ª´ng kh√°ch h√†ng.
                </li>
                <li>
                  <b>HAVING:</b> L·ªçc c√°c nh√≥m, ch·ªâ gi·ªØ l·∫°i nh·ªØng nh√≥m c√≥ s·ªë
                  l∆∞·ª£ng ƒë∆°n h√†ng l·ªõn h∆°n 2.
                </li>
                <li>
                  <b>SELECT:</b> Ch·ªçn c√°c c·ªôt customer_id, first_name, last_name
                  v√† t√≠nh t·ªïng s·ªë ƒë∆°n h√†ng cho m·ªói nh√≥m.
                </li>
                <li>
                  <b>ORDER BY:</b> S·∫Øp x·∫øp k·∫øt qu·∫£ cu·ªëi c√πng theo t·ªïng s·ªë ƒë∆°n
                  h√†ng gi·∫£m d·∫ßn.
                </li>
              </ol>
            </div>

            <h3>üí° V√≠ d·ª• minh h·ªça t·ª´ng b∆∞·ªõc</h3>
            <div class="example">
              <h4>D·ªØ li·ªáu m·∫´u:</h4>
              <div class="code-block">
                -- B·∫£ng customers customer_id | first_name | last_name 1 |
                Nguy·ªÖn | VƒÉn A 2 | Tr·∫ßn | Th·ªã B 3 | L√™ | VƒÉn C -- B·∫£ng orders
                order_id | customer_id | order_date 101 | 1 | 2024-02-01 102 | 1
                | 2024-03-01 103 | 1 | 2024-04-01 104 | 2 | 2024-01-15 105 | 2 |
                2024-02-15 106 | 3 | 2023-12-01 -- Tr∆∞·ªõc 2024-01-01
              </div>
            </div>

            <div class="example">
              <h4>K·∫øt qu·∫£ sau t·ª´ng b∆∞·ªõc:</h4>
              <div class="code-block">
                -- B∆∞·ªõc 1 (FROM/JOIN): N·ªëi 2 b·∫£ng customer_id | first_name |
                last_name | order_id | order_date 1 | Nguy·ªÖn | VƒÉn A | 101 |
                2024-02-01 1 | Nguy·ªÖn | VƒÉn A | 102 | 2024-03-01 1 | Nguy·ªÖn |
                VƒÉn A | 103 | 2024-04-01 2 | Tr·∫ßn | Th·ªã B | 104 | 2024-01-15 2 |
                Tr·∫ßn | Th·ªã B | 105 | 2024-02-15 3 | L√™ | VƒÉn C | 106 |
                2023-12-01 -- B∆∞·ªõc 2 (WHERE): L·ªçc order_date >= '2024-01-01'
                customer_id | first_name | last_name | order_id | order_date 1 |
                Nguy·ªÖn | VƒÉn A | 101 | 2024-02-01 1 | Nguy·ªÖn | VƒÉn A | 102 |
                2024-03-01 1 | Nguy·ªÖn | VƒÉn A | 103 | 2024-04-01 2 | Tr·∫ßn | Th·ªã
                B | 104 | 2024-01-15 2 | Tr·∫ßn | Th·ªã B | 105 | 2024-02-15 -- B∆∞·ªõc
                3 (GROUP BY): Nh√≥m theo customer Nh√≥m 1: customer_id=1,
                first_name=Nguy·ªÖn, last_name=VƒÉn A (3 ƒë∆°n h√†ng) Nh√≥m 2:
                customer_id=2, first_name=Tr·∫ßn, last_name=Th·ªã B (2 ƒë∆°n h√†ng) --
                B∆∞·ªõc 4 (HAVING): L·ªçc COUNT > 2 Ch·ªâ gi·ªØ Nh√≥m 1 (3 ƒë∆°n h√†ng > 2)
                -- B∆∞·ªõc 5 (SELECT): Ch·ªçn c·ªôt v√† t√≠nh COUNT customer_id |
                first_name | last_name | total_orders 1 | Nguy·ªÖn | VƒÉn A | 3 --
                B∆∞·ªõc 6 (ORDER BY): S·∫Øp x·∫øp (ch·ªâ c√≥ 1 h√†ng n√™n kh√¥ng thay ƒë·ªïi)
                customer_id | first_name | last_name | total_orders 1 | Nguy·ªÖn |
                VƒÉn A | 3
              </div>
            </div>

            <div class="info-box">
              <h4>üéØ T·∫°i sao th·ª© t·ª± n√†y quan tr·ªçng?</h4>
              <ul>
                <li>
                  <b>Hi·ªáu su·∫•t:</b> Hi·ªÉu th·ª© t·ª± gi√∫p t·ªëi ∆∞u h√≥a c√¢u l·ªánh (v√≠ d·ª•:
                  WHERE tr∆∞·ªõc GROUP BY gi√∫p gi·∫£m d·ªØ li·ªáu c·∫ßn nh√≥m)
                </li>
                <li>
                  <b>Tr√°nh l·ªói:</b> Bi·∫øt ƒë∆∞·ª£c t·∫°i sao kh√¥ng th·ªÉ d√πng alias trong
                  WHERE nh∆∞ng c√≥ th·ªÉ d√πng trong ORDER BY
                </li>
                <li>
                  <b>Logic ƒë√∫ng:</b> ƒê·∫£m b·∫£o k·∫øt qu·∫£ ch√≠nh x√°c khi vi·∫øt c√¢u l·ªánh
                  ph·ª©c t·∫°p
                </li>
                <li>
                  <b>Debug:</b> D·ªÖ d√†ng t√¨m l·ªói khi c√¢u l·ªánh kh√¥ng cho k·∫øt qu·∫£
                  mong mu·ªën
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <ul>
                <li>
                  <b>Alias:</b> Kh√¥ng th·ªÉ s·ª≠ d·ª•ng alias c·ªßa SELECT trong WHERE,
                  nh∆∞ng c√≥ th·ªÉ d√πng trong ORDER BY
                </li>
                <li>
                  <b>Aggregate functions:</b> Ch·ªâ c√≥ th·ªÉ d√πng trong SELECT v√†
                  HAVING, kh√¥ng d√πng ƒë∆∞·ª£c trong WHERE
                </li>
                <li>
                  <b>Performance:</b> WHERE th·ª±c thi tr∆∞·ªõc GROUP BY n√™n hi·ªáu qu·∫£
                  h∆°n HAVING cho ƒëi·ªÅu ki·ªán kh√¥ng ph·∫£i aggregate
                </li>
              </ul>
            </div>
          </section>

          <!-- 11 -->
          <section class="section" id="where-having">
            <h2>11. WHERE vs HAVING</h2>

            <div class="info-box">
              <h4>üîç Kh√°i ni·ªám c∆° b·∫£n:</h4>
              <p>
                <b>WHERE</b> v√† <b>HAVING</b> ƒë·ªÅu l√† c√°c m·ªánh ƒë·ªÅ l·ªçc trong SQL,
                nh∆∞ng ch√∫ng ho·∫°t ƒë·ªông ·ªü c√°c giai ƒëo·∫°n kh√°c nhau trong qu√° tr√¨nh
                th·ª±c thi c√¢u l·ªánh v√† c√≥ m·ª•c ƒë√≠ch s·ª≠ d·ª•ng ri√™ng bi·ªát.
              </p>
            </div>

            <h3>üéØ 1. WHERE</h3>
            <div class="highlight-box">
              <p>
                <b>WHERE</b> l√† m·ªánh ƒë·ªÅ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l·ªçc c√°c
                <b>h√†ng ri√™ng l·∫ª (individual rows)</b> tr∆∞·ªõc khi ch√∫ng ƒë∆∞·ª£c nh√≥m
                b·∫±ng GROUP BY.
              </p>
              <ul>
                <li><b>V·ªã tr√≠:</b> ƒê·∫∑t sau m·ªánh ƒë·ªÅ FROM ho·∫∑c JOIN</li>
                <li>
                  <b>Ch·ª©c nƒÉng:</b> L·ªçc d·ªØ li·ªáu d·ª±a tr√™n c√°c ƒëi·ªÅu ki·ªán v·ªÅ c·ªôt
                  th√¥ng th∆∞·ªùng
                </li>
                <li>
                  <b>H·∫°n ch·∫ø:</b> Kh√¥ng th·ªÉ s·ª≠ d·ª•ng c√°c h√†m t·ªïng h·ª£p nh∆∞
                  COUNT(), SUM(), AVG() tr·ª±c ti·∫øp trong m·ªánh ƒë·ªÅ WHERE
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• WHERE:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën t√¨m s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong kho c·ªßa c√°c c·ª≠a
                h√†ng, nh∆∞ng ch·ªâ quan t√¢m ƒë·∫øn nh·ªØng s·∫£n ph·∫©m c√≥ gi√° l·ªõn h∆°n 100.
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span>
                <span class="column">store_id</span>,
                <span class="function">COUNT</span>(<span class="column"
                  >product_id</span
                >) <span class="keyword">AS</span>
                <span class="column">total_products</span>
                <span class="keyword">FROM</span>
                <span class="table">stocks</span>
                <span class="keyword">WHERE</span>
                <span class="column">price</span>
                <span class="operator">></span> <span class="number">100</span>
                <span class="keyword">GROUP BY</span>
                <span class="column">store_id</span>;
              </div>
              <p>
                <b>Gi·∫£i th√≠ch:</b> Trong v√≠ d·ª• n√†y, WHERE s·∫Ω lo·∫°i b·ªè c√°c s·∫£n
                ph·∫©m c√≥ gi√° nh·ªè h∆°n ho·∫∑c b·∫±ng 100 kh·ªèi t·∫≠p d·ªØ li·ªáu ban ƒë·∫ßu, sau
                ƒë√≥ GROUP BY m·ªõi nh√≥m c√°c s·∫£n ph·∫©m c√≤n l·∫°i.
              </p>
            </div>

            <h3>üìä 2. HAVING</h3>
            <div class="highlight-box">
              <p>
                <b>HAVING</b> l√† m·ªánh ƒë·ªÅ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l·ªçc c√°c
                <b>nh√≥m (groups)</b> d·ªØ li·ªáu sau khi ch√∫ng ƒë√£ ƒë∆∞·ª£c t·∫°o ra b·ªüi
                GROUP BY.
              </p>
              <ul>
                <li><b>V·ªã tr√≠:</b> ƒê·∫∑t sau m·ªánh ƒë·ªÅ GROUP BY</li>
                <li>
                  <b>Ch·ª©c nƒÉng:</b> L·ªçc c√°c nh√≥m d·ª±a tr√™n c√°c ƒëi·ªÅu ki·ªán c·ªßa c√°c
                  h√†m t·ªïng h·ª£p (COUNT, SUM, AVG, v.v.)
                </li>
                <li>
                  <b>Y√™u c·∫ßu:</b> B·∫°n kh√¥ng th·ªÉ s·ª≠ d·ª•ng HAVING n·∫øu kh√¥ng c√≥
                  GROUP BY
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• HAVING:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën t√¨m c√°c c·ª≠a h√†ng c√≥ t·ªïng s·ªë s·∫£n ph·∫©m trong kho
                l·ªõn h∆°n 10.
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">store_id</span>, <span class="function">COUNT</span>(<span class="column">product_id</span>) <span class="keyword">AS</span> <span class="column">total_products</span> 
                <span class="keyword">FROM</span> <span class="table">stocks</span>
                <span class="keyword">GROUP BY</span> <span class="column">store_id</span> 
                <span class="keyword">HAVING</span> <span class="function">COUNT</span>(<span class="column">product_id</span>) <span class="operator">></span> <span class="number">10</span>; <span class="comment">-- L·ªçc c√°c nh√≥m c√≥ t·ªïng s·ªë s·∫£n ph·∫©m > 10</span>
              </div>
              <p>
                <b>Gi·∫£i th√≠ch:</b> ·ªû ƒë√¢y, GROUP BY s·∫Ω nh√≥m c√°c s·∫£n ph·∫©m theo
                store_id tr∆∞·ªõc, sau ƒë√≥ HAVING s·∫Ω ki·ªÉm tra t·ª´ng nh√≥m v√† ch·ªâ gi·ªØ
                l·∫°i nh·ªØng nh√≥m c√≥ t·ªïng s·ªë s·∫£n ph·∫©m l·ªõn h∆°n 10.
              </p>
            </div>

            <h3>üìã T√≥m t·∫Øt s·ª± kh√°c bi·ªát</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>WHERE</th>
                  <th>HAVING</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>V·ªã tr√≠</b></td>
                  <td>ƒê·∫∑t tr∆∞·ªõc GROUP BY</td>
                  <td>ƒê·∫∑t sau GROUP BY</td>
                </tr>
                <tr>
                  <td><b>ƒê·ªëi t∆∞·ª£ng l·ªçc</b></td>
                  <td>L·ªçc h√†ng ri√™ng l·∫ª</td>
                  <td>L·ªçc nh√≥m d·ªØ li·ªáu</td>
                </tr>
                <tr>
                  <td><b>S·ª≠ d·ª•ng h√†m t·ªïng h·ª£p</b></td>
                  <td>Kh√¥ng th·ªÉ s·ª≠ d·ª•ng tr·ª±c ti·∫øp</td>
                  <td>B·∫Øt bu·ªôc ph·∫£i s·ª≠ d·ª•ng</td>
                </tr>
                <tr>
                  <td><b>M·ª•c ƒë√≠ch</b></td>
                  <td>L·ªçc d·ªØ li·ªáu th√¥ tr∆∞·ªõc khi x·ª≠ l√Ω</td>
                  <td>L·ªçc k·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c t·ªïng h·ª£p</td>
                </tr>
                <tr>
                  <td><b>Th·ª© t·ª± th·ª±c thi</b></td>
                  <td>Th·ª±c thi th·ª© 2 (sau FROM/JOIN)</td>
                  <td>Th·ª±c thi th·ª© 4 (sau GROUP BY)</td>
                </tr>
                <tr>
                  <td><b>Hi·ªáu su·∫•t</b></td>
                  <td>Hi·ªáu qu·∫£ h∆°n v√¨ l·ªçc s·ªõm</td>
                  <td>Ch·∫≠m h∆°n v√¨ ph·∫£i t√≠nh to√°n tr∆∞·ªõc</td>
                </tr>
              </tbody>
            </table>

            <h3>üîß V√≠ d·ª• ƒë·∫ßy ƒë·ªß</h3>
            <div class="example">
              <h4>K·ªãch b·∫£n: T√¨m c·ª≠a h√†ng c√≥ nhi·ªÅu s·∫£n ph·∫©m gi√° r·∫ª</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën t√¨m c√°c c·ª≠a h√†ng c√≥ t·ªïng s·ªë s·∫£n ph·∫©m t·ªìn kho l·ªõn
                h∆°n 10 v√† ch·ªâ t√≠nh nh·ªØng s·∫£n ph·∫©m c√≥ gi√° d∆∞·ªõi 5000:
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">store_id</span>, <span class="function">COUNT</span>(<span class="column">product_id</span>) <span class="keyword">AS</span> <span class="column">total_products</span> 
                <span class="keyword">FROM</span> <span class="table">stocks</span>
                <span class="keyword">WHERE</span> <span class="column">price</span> <span class="operator"><</span> <span class="number">5000</span> <span class="comment">-- B∆∞·ªõc 1: L·ªçc c√°c h√†ng ri√™ng l·∫ª (s·∫£n ph·∫©m)</span>
                <span class="keyword">GROUP BY</span> <span class="column">store_id</span> 
                <span class="keyword">HAVING</span> <span class="function">COUNT</span>(<span class="column">product_id</span>) <span class="operator">></span> <span class="number">10</span>; <span class="comment">-- B∆∞·ªõc 2: L·ªçc c√°c nh√≥m (c·ª≠a h√†ng)</span>
              </div>
              <p><b>Qu√° tr√¨nh th·ª±c thi:</b></p>
              <ol>
                <li>
                  <b>WHERE:</b> Lo·∫°i b·ªè c√°c s·∫£n ph·∫©m c√≥ gi√° >= 5000 ngay t·ª´ ƒë·∫ßu
                </li>
                <li>
                  <b>GROUP BY:</b> Nh√≥m c√°c s·∫£n ph·∫©m c√≤n l·∫°i theo store_id
                </li>
                <li>
                  <b>HAVING:</b> Ch·ªâ gi·ªØ l·∫°i nh·ªØng c·ª≠a h√†ng c√≥ > 10 s·∫£n ph·∫©m
                </li>
              </ol>
            </div>

            <h3>üìà V√≠ d·ª• minh h·ªça chi ti·∫øt</h3>
            <div class="example">
              <h4>D·ªØ li·ªáu m·∫´u b·∫£ng stocks:</h4>
              <div class="code-block">
                <span class="column">store_id</span> | <span class="column">product_id</span> | <span class="column">price</span> 
                <span class="number">1</span> | <span class="number">101</span> | <span class="number">3000</span> 
                <span class="number">1</span> | <span class="number">102</span> | <span class="number">7000</span> <span class="comment">-- B·ªã lo·∫°i b·ªè b·ªüi WHERE</span> 
                <span class="number">1</span> | <span class="number">103</span> | <span class="number">4000</span> 
                <span class="number">1</span> | <span class="number">104</span> | <span class="number">2000</span> 
                <span class="number">2</span> | <span class="number">201</span> | <span class="number">4500</span> 
                <span class="number">2</span> | <span class="number">202</span> | <span class="number">6000</span> <span class="comment">-- B·ªã lo·∫°i b·ªè b·ªüi WHERE</span> 
                <span class="number">3</span> | <span class="number">301</span> | <span class="number">1000</span> 
                <span class="number">3</span> | <span class="number">302</span> | <span class="number">2000</span>
              </div>
            </div>

            <div class="example">
              <h4>K·∫øt qu·∫£ t·ª´ng b∆∞·ªõc:</h4>
              <div class="code-block">
                <span class="comment">-- Sau WHERE (price < 5000):</span>
                <span class="column">store_id</span> | <span class="column">product_id</span> | <span class="column">price</span> 
                <span class="number">1</span> | <span class="number">101</span> | <span class="number">3000</span> 
                <span class="number">1</span> | <span class="number">103</span> | <span class="number">4000</span> 
                <span class="number">1</span> | <span class="number">104</span> | <span class="number">2000</span> 
                <span class="number">2</span> | <span class="number">201</span> | <span class="number">4500</span> 
                <span class="number">3</span> | <span class="number">301</span> | <span class="number">1000</span> 
                <span class="number">3</span> | <span class="number">302</span> | <span class="number">2000</span>
                
                <span class="comment">-- Sau GROUP BY store_id:</span>
                <span class="column">store_id</span> | <span class="column">total_products</span> 
                <span class="number">1</span> | <span class="number">3</span> 
                <span class="number">2</span> | <span class="number">1</span> 
                <span class="number">3</span> | <span class="number">2</span>
                
                <span class="comment">-- Sau HAVING COUNT(product_id) > 10:</span>
                <span class="comment">(Kh√¥ng c√≥ k·∫øt qu·∫£ v√¨ kh√¥ng c·ª≠a h√†ng n√†o c√≥ > 10 s·∫£n ph·∫©m)</span>
                
                <span class="comment">-- N·∫øu thay ƒë·ªïi ƒëi·ªÅu ki·ªán HAVING th√†nh > 2:</span>
                <span class="column">store_id</span> | <span class="column">total_products</span> 
                <span class="number">1</span> | <span class="number">3</span>
              </div>
            </div>

            <h3>üö´ L·ªói th∆∞·ªùng g·∫∑p</h3>
            <div class="info-box">
              <h4>‚ùå L·ªói s·ª≠ d·ª•ng h√†m t·ªïng h·ª£p trong WHERE:</h4>
              <div class="code-block">
                <span class="comment">-- SAI: Kh√¥ng th·ªÉ d√πng COUNT() trong WHERE</span>
                <span class="keyword">SELECT</span> <span class="column">store_id</span>, <span class="function">COUNT</span>(<span class="column">product_id</span>) 
                <span class="keyword">FROM</span> <span class="table">stocks</span> 
                <span class="keyword">WHERE</span> <span class="function">COUNT</span>(<span class="column">product_id</span>) <span class="operator">></span> <span class="number">10</span> <span class="comment">-- L·ªñI!</span>
                <span class="keyword">GROUP BY</span> <span class="column">store_id</span>;
                
                <span class="comment">-- ƒê√öNG: Ph·∫£i d√πng HAVING</span>
                <span class="keyword">SELECT</span> <span class="column">store_id</span>, <span class="function">COUNT</span>(<span class="column">product_id</span>) 
                <span class="keyword">FROM</span> <span class="table">stocks</span> 
                <span class="keyword">GROUP BY</span> <span class="column">store_id</span> 
                <span class="keyword">HAVING</span> <span class="function">COUNT</span>(<span class="column">product_id</span>) <span class="operator">></span> <span class="number">10</span>; <span class="comment">-- ƒê√öNG!</span>
              </div>
            </div>

            <div class="info-box">
              <h4>‚ùå L·ªói s·ª≠ d·ª•ng HAVING kh√¥ng c√≥ GROUP BY:</h4>
              <div class="code-block">
                <span class="comment">-- SAI: HAVING c·∫ßn ph·∫£i c√≥ GROUP BY</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">stocks</span> 
                <span class="keyword">HAVING</span> <span class="column">price</span> <span class="operator">></span> <span class="number">1000</span>; <span class="comment">-- L·ªñI!</span>
                
                <span class="comment">-- ƒê√öNG: D√πng WHERE cho ƒëi·ªÅu ki·ªán h√†ng ƒë∆°n l·∫ª</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="table">stocks</span> 
                <span class="keyword">WHERE</span> <span class="column">price</span> <span class="operator">></span> <span class="number">1000</span>; <span class="comment">-- ƒê√öNG!</span>
              </div>
            </div>

            <h3>üí° L·ªùi khuy√™n s·ª≠ d·ª•ng</h3>
            <div class="success-box">
              <h4>‚úÖ Best Practices:</h4>
              <ul>
                <li>
                  <b>∆Øu ti√™n WHERE:</b> S·ª≠ d·ª•ng WHERE khi c√≥ th·ªÉ ƒë·ªÉ l·ªçc d·ªØ li·ªáu
                  s·ªõm, gi·∫£m t·∫£i x·ª≠ l√Ω
                </li>
                <li>
                  <b>HAVING cho aggregate:</b> Ch·ªâ d√πng HAVING khi c·∫ßn l·ªçc d·ª±a
                  tr√™n k·∫øt qu·∫£ t·ªïng h·ª£p
                </li>
                <li>
                  <b>K·∫øt h·ª£p th√¥ng minh:</b> C√≥ th·ªÉ d√πng c·∫£ WHERE v√† HAVING
                  trong c√πng m·ªôt c√¢u l·ªánh
                </li>
                <li>
                  <b>Hi·ªáu su·∫•t:</b> WHERE nhanh h∆°n HAVING v√¨ l·ªçc tr∆∞·ªõc khi nh√≥m
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• t·ªëi ∆∞u:</h4>
              <div class="code-block">
                <span class="comment">-- T√¨m c·ª≠a h√†ng c√≥ nhi·ªÅu s·∫£n ph·∫©m ƒëi·ªán t·ª≠ (category_id = 1) ƒë·∫Øt ti·ªÅn</span>
                <span class="keyword">SELECT</span> <span class="column">s.store_id</span>, <span class="column">s.store_name</span>, <span class="function">COUNT</span>(<span class="column">st.product_id</span>) <span class="keyword">AS</span> <span class="column">expensive_electronics</span> 
                <span class="keyword">FROM</span> <span class="table">stores</span> <span class="keyword">s</span> 
                <span class="keyword">JOIN</span> <span class="table">stocks</span> <span class="keyword">st</span> <span class="keyword">ON</span> <span class="column">s.store_id</span> <span class="operator">=</span> <span class="column">st.store_id</span> 
                <span class="keyword">JOIN</span> <span class="table">products</span> <span class="keyword">p</span> <span class="keyword">ON</span> <span class="column">st.product_id</span> <span class="operator">=</span> <span class="column">p.product_id</span> 
                <span class="keyword">WHERE</span> <span class="column">p.category_id</span> <span class="operator">=</span> <span class="number">1</span> <span class="comment">-- L·ªçc s·∫£n ph·∫©m ƒëi·ªán t·ª≠ tr∆∞·ªõc</span>
                  <span class="keyword">AND</span> <span class="column">st.price</span> <span class="operator">></span> <span class="number">10000</span> <span class="comment">-- L·ªçc s·∫£n ph·∫©m ƒë·∫Øt ti·ªÅn tr∆∞·ªõc</span>
                <span class="keyword">GROUP BY</span> <span class="column">s.store_id</span>, <span class="column">s.store_name</span> 
                <span class="keyword">HAVING</span> <span class="function">COUNT</span>(<span class="column">st.product_id</span>) <span class="operator">>=</span> <span class="number">5</span> <span class="comment">-- L·ªçc c·ª≠a h√†ng c√≥ >= 5 s·∫£n ph·∫©m</span>
                <span class="keyword">ORDER BY</span> <span class="column">expensive_electronics</span> <span class="keyword">DESC</span>;
              </div>
            </div>
          </section>

          <!-- 12 -->
          <section class="section" id="union-merge">
            <h2>12. UNION, MERGE, PIVOT, INTERSECT</h2>

            <div class="info-box">
              <h4>üîÑ C√°c ph√©p to√°n t·∫≠p h·ª£p v√† x·ª≠ l√Ω d·ªØ li·ªáu:</h4>
              <p>
                C√°c l·ªánh n√†y gi√∫p b·∫°n k·∫øt h·ª£p, h·ª£p nh·∫•t, xoay v√† t√¨m giao c·ªßa
                c√°c t·∫≠p d·ªØ li·ªáu m·ªôt c√°ch hi·ªáu qu·∫£. M·ªói l·ªánh c√≥ m·ª•c ƒë√≠ch s·ª≠ d·ª•ng
                ri√™ng bi·ªát trong x·ª≠ l√Ω d·ªØ li·ªáu.
              </p>
            </div>

            <h3>üîó 1. UNION (K·∫øt h·ª£p)</h3>
            <div class="highlight-box">
              <p>
                L·ªánh <b>UNION</b> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ k·∫øt h·ª£p k·∫øt qu·∫£ c·ªßa hai ho·∫∑c
                nhi·ªÅu c√¢u l·ªánh SELECT th√†nh m·ªôt t·∫≠p k·∫øt qu·∫£ duy nh·∫•t.
              </p>

              <h4>üìã ƒê·∫∑c ƒëi·ªÉm:</h4>
              <ul>
                <li>C√°c c√¢u l·ªánh SELECT ph·∫£i c√≥ <b>c√πng s·ªë c·ªôt</b></li>
                <li>
                  C√°c c·ªôt t∆∞∆°ng ·ª©ng ph·∫£i c√≥ <b>c√πng ki·ªÉu d·ªØ li·ªáu</b> ho·∫∑c ki·ªÉu
                  d·ªØ li·ªáu t∆∞∆°ng th√≠ch
                </li>
                <li><b>UNION</b> s·∫Ω t·ª± ƒë·ªông lo·∫°i b·ªè c√°c h√†ng tr√πng l·∫∑p</li>
                <li>
                  <b>UNION ALL</b> gi·ªØ l·∫°i t·∫•t c·∫£ c√°c h√†ng (k·ªÉ c·∫£ h√†ng tr√πng
                  l·∫∑p)
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• UNION:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën xem danh s√°ch t√™n s·∫£n ph·∫©m t·ª´ hai danh m·ª•c kh√°c
                nhau:
              </p>
              <div class="code-block">
                <span class="comment">-- UNION - Lo·∫°i b·ªè tr√πng l·∫∑p</span>
                <span class="keyword">SELECT</span> <span class="column">product_name</span> <span class="keyword">FROM</span> <span class="table">products</span>
                <span class="keyword">WHERE</span> <span class="column">category_id</span> <span class="operator">=</span> <span class="number">1</span> 
                <span class="keyword">UNION</span> 
                <span class="keyword">SELECT</span> <span class="column">product_name</span> <span class="keyword">FROM</span> <span class="table">products</span>
                <span class="keyword">WHERE</span> <span class="column">category_id</span> <span class="operator">=</span> <span class="number">2</span>;
                
                <span class="comment">-- UNION ALL - Gi·ªØ t·∫•t c·∫£ h√†ng</span>
                <span class="keyword">SELECT</span> <span class="column">product_name</span> <span class="keyword">FROM</span> <span class="table">products</span>
                <span class="keyword">WHERE</span> <span class="column">category_id</span> <span class="operator">=</span> <span class="number">1</span> 
                <span class="keyword">UNION ALL</span> 
                <span class="keyword">SELECT</span> <span class="column">product_name</span> <span class="keyword">FROM</span> <span class="table">products</span>
                <span class="keyword">WHERE</span> <span class="column">category_id</span> <span class="operator">=</span> <span class="number">2</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> Tr·∫£ v·ªÅ danh s√°ch t·∫•t c·∫£ c√°c s·∫£n ph·∫©m thu·ªôc c·∫£
                hai danh m·ª•c 1 v√† 2. N·∫øu c√≥ s·∫£n ph·∫©m n√†o xu·∫•t hi·ªán ·ªü c·∫£ hai danh
                m·ª•c th√¨ v·ªõi UNION n√≥ s·∫Ω ch·ªâ ƒë∆∞·ª£c li·ªát k√™ m·ªôt l·∫ßn, v·ªõi UNION ALL
                s·∫Ω xu·∫•t hi·ªán nhi·ªÅu l·∫ßn.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - Danh s√°ch kh√°ch h√†ng VIP:</h4>
              <div class="code-block">
                <span class="comment">-- K·∫øt h·ª£p kh√°ch h√†ng c√≥ nhi·ªÅu ƒë∆°n h√†ng v√† kh√°ch h√†ng chi ti√™u cao</span>
                <span class="keyword">SELECT</span> <span class="column">customer_id</span>, <span class="column">customer_name</span>, <span class="string">'Frequent Buyer'</span> <span class="keyword">AS</span> <span class="column">vip_type</span> 
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="keyword">c</span> 
                <span class="keyword">WHERE</span> (<span class="keyword">SELECT</span> <span class="function">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> <span class="table">orders</span>
                       <span class="keyword">WHERE</span> <span class="column">customer_id</span> <span class="operator">=</span> <span class="column">c.customer_id</span>) <span class="operator">></span> <span class="number">10</span> 
                <span class="keyword">UNION</span> 
                <span class="keyword">SELECT</span> <span class="column">customer_id</span>, <span class="column">customer_name</span>, <span class="string">'High Spender'</span> <span class="keyword">AS</span> <span class="column">vip_type</span> 
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="keyword">c</span> 
                <span class="keyword">WHERE</span> (<span class="keyword">SELECT</span> <span class="function">SUM</span>(<span class="column">total_amount</span>) <span class="keyword">FROM</span> <span class="table">orders</span> 
                       <span class="keyword">WHERE</span> <span class="column">customer_id</span> <span class="operator">=</span> <span class="column">c.customer_id</span>) <span class="operator">></span> <span class="number">100000</span>;
              </div>
            </div>

            <h3>üîÑ 2. MERGE (H·ª£p nh·∫•t)</h3>
            <div class="highlight-box">
              <p>
                L·ªánh <b>MERGE</b> (c√≤n ƒë∆∞·ª£c g·ªçi l√† Upsert - Update or Insert)
                ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ th·ª±c hi·ªán nhi·ªÅu thao t√°c (INSERT, UPDATE,
                DELETE) trong m·ªôt c√¢u l·ªánh duy nh·∫•t. N√≥ so s√°nh m·ªôt b·∫£ng ngu·ªìn
                v·ªõi m·ªôt b·∫£ng ƒë√≠ch v√† th·ª±c hi·ªán c√°c h√†nh ƒë·ªông d·ª±a tr√™n s·ª± kh·ªõp
                nhau c·ªßa c√°c h√†ng.
              </p>

              <h4>üìã ƒê·∫∑c ƒëi·ªÉm:</h4>
              <ul>
                <li>
                  R·∫•t h·ªØu √≠ch cho vi·ªác <b>ƒë·ªìng b·ªô h√≥a d·ªØ li·ªáu</b> gi·ªØa hai b·∫£ng
                </li>
                <li>
                  Gi√∫p gi·∫£m thi·ªÉu vi·ªác ph·∫£i vi·∫øt nhi·ªÅu c√¢u l·ªánh INSERT, UPDATE,
                  DELETE ri√™ng l·∫ª
                </li>
                <li>
                  Ch·ªâ c√≥ trong m·ªôt s·ªë h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu nh∆∞
                  <b>SQL Server, Oracle</b>
                </li>
                <li>
                  Th·ª±c hi·ªán nguy√™n t·ª≠ (atomic) - t·∫•t c·∫£ thay ƒë·ªïi ƒë∆∞·ª£c commit
                  ho·∫∑c rollback c√πng nhau
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• MERGE c∆° b·∫£n:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt b·∫£ng stocks hi·ªán t·∫°i v√† m·ªôt b·∫£ng t·∫°m
                new_stocks v·ªõi c√°c c·∫≠p nh·∫≠t:
              </p>
              <div class="code-block">
                <span class="keyword">MERGE INTO</span> <span class="table">stocks</span> <span class="keyword">AS</span> <span class="keyword">target</span> <span class="comment">-- B·∫£ng ƒë√≠ch</span>
                <span class="keyword">USING</span> <span class="table">new_stocks</span> <span class="keyword">AS</span> <span class="keyword">source</span> <span class="comment">-- B·∫£ng ngu·ªìn</span>
                <span class="keyword">ON</span> <span class="column">target.product_id</span> <span class="operator">=</span> <span class="column">source.product_id</span> <span class="comment">-- ƒêi·ªÅu ki·ªán kh·ªõp</span>
                <span class="keyword">WHEN MATCHED THEN</span> 
                  <span class="keyword">UPDATE SET</span> 
                    <span class="column">target.quantity</span> <span class="operator">=</span> <span class="column">source.quantity</span>,
                    <span class="column">target.last_updated</span> <span class="operator">=</span> <span class="function">GETDATE</span>()
                <span class="keyword">WHEN NOT MATCHED BY TARGET THEN</span> 
                  <span class="keyword">INSERT</span> (<span class="column">product_id</span>, <span class="column">quantity</span>, <span class="column">last_updated</span>)
                  <span class="keyword">VALUES</span> (<span class="column">source.product_id</span>, <span class="column">source.quantity</span>, <span class="function">GETDATE</span>())
                <span class="keyword">WHEN NOT MATCHED BY SOURCE THEN</span> 
                  <span class="keyword">DELETE</span>; <span class="comment">-- X√≥a s·∫£n ph·∫©m kh√¥ng c√≤n trong ngu·ªìn</span>
              </div>
              <p>
                <b>Gi·∫£i th√≠ch:</b> L·ªánh n√†y s·∫Ω ki·ªÉm tra t·ª´ng s·∫£n ph·∫©m trong
                new_stocks: n·∫øu t√¨m th·∫•y s·∫£n ph·∫©m ƒë√≥ trong stocks th√¨ c·∫≠p nh·∫≠t
                s·ªë l∆∞·ª£ng, n·∫øu kh√¥ng th√¨ th√™m m·ªõi, v√† x√≥a nh·ªØng s·∫£n ph·∫©m kh√¥ng
                c√≤n trong b·∫£ng ngu·ªìn.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - ƒê·ªìng b·ªô th√¥ng tin nh√¢n vi√™n:</h4>
              <div class="code-block">
                <span class="keyword">MERGE</span> <span class="table">employees</span> <span class="keyword">AS</span> <span class="keyword">target</span> 
                <span class="keyword">USING</span> <span class="table">employee_updates</span> <span class="keyword">AS</span> <span class="keyword">source</span> 
                <span class="keyword">ON</span> <span class="column">target.employee_id</span> <span class="operator">=</span> <span class="column">source.employee_id</span> 
                <span class="keyword">WHEN MATCHED AND</span> <span class="column">source.action</span> <span class="operator">=</span> <span class="string">'UPDATE'</span> <span class="keyword">THEN</span> 
                  <span class="keyword">UPDATE SET</span> 
                    <span class="column">target.salary</span> <span class="operator">=</span> <span class="column">source.salary</span>,
                    <span class="column">target.department_id</span> <span class="operator">=</span> <span class="column">source.department_id</span>,
                    <span class="column">target.updated_date</span> <span class="operator">=</span> <span class="function">GETDATE</span>()
                <span class="keyword">WHEN MATCHED AND</span> <span class="column">source.action</span> <span class="operator">=</span> <span class="string">'DELETE'</span> <span class="keyword">THEN</span> 
                  <span class="keyword">DELETE</span> 
                <span class="keyword">WHEN NOT MATCHED AND</span> <span class="column">source.action</span> <span class="operator">=</span> <span class="string">'INSERT'</span> <span class="keyword">THEN</span> 
                  <span class="keyword">INSERT</span> (<span class="column">employee_id</span>, <span class="column">employee_name</span>, <span class="column">salary</span>, <span class="column">department_id</span>, <span class="column">hire_date</span>)
                  <span class="keyword">VALUES</span> (<span class="column">source.employee_id</span>, <span class="column">source.employee_name</span>, <span class="column">source.salary</span>, 
                          <span class="column">source.department_id</span>, <span class="function">GETDATE</span>());
              </div>
            </div>

            <h3>üîÑ 3. PIVOT (Xoay b·∫£ng)</h3>
            <div class="highlight-box">
              <p>
                L·ªánh <b>PIVOT</b> xoay c√°c gi√° tr·ªã duy nh·∫•t t·ª´ m·ªôt c·ªôt th√†nh c√°c
                ti√™u ƒë·ªÅ c·ªôt (column headings) v√† th·ª±c hi·ªán c√°c ph√©p t√≠nh t·ªïng
                h·ª£p tr√™n ch√∫ng.
              </p>

              <h4>üìã ƒê·∫∑c ƒëi·ªÉm:</h4>
              <ul>
                <li>
                  <b>Chuy·ªÉn ƒë·ªïi h√†ng th√†nh c·ªôt</b> - bi·∫øn d·ªØ li·ªáu d·ªçc th√†nh d·ªØ
                  li·ªáu ngang
                </li>
                <li>R·∫•t h·ªØu √≠ch cho vi·ªác <b>t·∫°o b√°o c√°o t√≥m t·∫Øt</b></li>
                <li>
                  PIVOT l√† m·ªôt h√†m ri√™ng trong <b>SQL Server v√† Oracle</b>
                </li>
                <li>C·∫ßn x√°c ƒë·ªãnh tr∆∞·ªõc c√°c gi√° tr·ªã s·∫Ω th√†nh c·ªôt</li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• PIVOT c∆° b·∫£n:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën xem t·ªïng gi√° s·∫£n ph·∫©m theo t·ª´ng nƒÉm s·∫£n xu·∫•t,
                v·ªõi m·ªói nƒÉm l√† m·ªôt c·ªôt:
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">store_id</span>, [<span class="number">2022</span>], [<span class="number">2023</span>], [<span class="number">2024</span>] 
                <span class="keyword">FROM</span> (
                  <span class="keyword">SELECT</span> <span class="column">store_id</span>, <span class="column">model_year</span>, <span class="column">list_price</span> 
                  <span class="keyword">FROM</span> <span class="table">products</span>
                ) <span class="keyword">AS</span> <span class="keyword">src</span> <span class="comment">-- B·∫£ng ngu·ªìn t·∫°m</span>
                <span class="keyword">PIVOT</span> (
                  <span class="function">SUM</span>(<span class="column">list_price</span>) <span class="comment">-- H√†m t·ªïng h·ª£p</span>
                  <span class="keyword">FOR</span> <span class="column">model_year</span> <span class="keyword">IN</span> ([<span class="number">2022</span>], [<span class="number">2023</span>], [<span class="number">2024</span>]) <span class="comment">-- C·ªôt s·∫Ω ƒë∆∞·ª£c xoay th√†nh ti√™u ƒë·ªÅ</span>
                ) <span class="keyword">AS</span> <span class="keyword">pvt</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> T·∫°o ra c√°c c·ªôt m·ªõi c√≥ t√™n l√† [2022], [2023],
                [2024], v·ªõi gi√° tr·ªã l√† t·ªïng gi√° s·∫£n ph·∫©m c·ªßa nƒÉm ƒë√≥ cho t·ª´ng c·ª≠a
                h√†ng.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - B√°o c√°o doanh thu theo th√°ng:</h4>
              <div class="code-block">
                <span class="comment">-- D·ªØ li·ªáu g·ªëc d·∫°ng h√†ng</span>
                <span class="keyword">SELECT</span> <span class="column">employee_name</span>, [<span class="column">January</span>], [<span class="column">February</span>], [<span class="column">March</span>], [<span class="column">April</span>], [<span class="column">May</span>], [<span class="column">June</span>] 
                <span class="keyword">FROM</span> (
                  <span class="keyword">SELECT</span> <span class="column">e.employee_name</span>, <span class="function">DATENAME</span>(<span class="datatype">month</span>, <span class="column">o.order_date</span>) <span class="keyword">AS</span> <span class="column">month_name</span>, <span class="column">o.total_amount</span> 
                  <span class="keyword">FROM</span> <span class="table">employees</span> <span class="keyword">e</span> 
                  <span class="keyword">JOIN</span> <span class="table">orders</span> <span class="keyword">o</span> <span class="keyword">ON</span> <span class="column">e.employee_id</span> <span class="operator">=</span> <span class="column">o.sales_rep_id</span> 
                  <span class="keyword">WHERE</span> <span class="function">YEAR</span>(<span class="column">o.order_date</span>) <span class="operator">=</span> <span class="number">2024</span>
                ) <span class="keyword">AS</span> <span class="keyword">source_data</span> 
                <span class="keyword">PIVOT</span> (
                  <span class="function">SUM</span>(<span class="column">total_amount</span>) 
                  <span class="keyword">FOR</span> <span class="column">month_name</span> <span class="keyword">IN</span> ([<span class="column">January</span>], [<span class="column">February</span>], [<span class="column">March</span>], [<span class="column">April</span>], [<span class="column">May</span>], [<span class="column">June</span>])
                ) <span class="keyword">AS</span> <span class="keyword">monthly_sales</span>;
              </div>
            </div>

            <h3>üîç 4. INTERSECT (Giao nhau)</h3>
            <div class="highlight-box">
              <p>
                L·ªánh <b>INTERSECT</b> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ tr·∫£ v·ªÅ c√°c h√†ng c√πng t·ªìn
                t·∫°i trong c·∫£ hai c√¢u l·ªánh SELECT.
              </p>

              <h4>üìã ƒê·∫∑c ƒëi·ªÉm:</h4>
              <ul>
                <li>
                  C√°c c√¢u l·ªánh SELECT ph·∫£i c√≥
                  <b>c√πng s·ªë c·ªôt v√† ki·ªÉu d·ªØ li·ªáu</b> t∆∞∆°ng th√≠ch
                </li>
                <li>Ch·ªâ tr·∫£ v·ªÅ c√°c <b>h√†ng chung</b> c·ªßa hai t·∫≠p k·∫øt qu·∫£</li>
                <li><b>Lo·∫°i b·ªè c√°c gi√° tr·ªã tr√πng l·∫∑p</b></li>
                <li>T∆∞∆°ng ƒë∆∞∆°ng v·ªõi ph√©p giao (‚à©) trong l√Ω thuy·∫øt t·∫≠p h·ª£p</li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• INTERSECT c∆° b·∫£n:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën t√¨m c√°c s·∫£n ph·∫©m v·ª´a thu·ªôc th∆∞∆°ng hi·ªáu 1 v·ª´a
                thu·ªôc danh m·ª•c 3:
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">product_name</span> <span class="keyword">FROM</span> <span class="table">products</span> <span class="keyword">WHERE</span> <span class="column">brand_id</span> <span class="operator">=</span> <span class="number">1</span> 
                <span class="keyword">INTERSECT</span> 
                <span class="keyword">SELECT</span> <span class="column">product_name</span> <span class="keyword">FROM</span> <span class="table">products</span> <span class="keyword">WHERE</span> <span class="column">category_id</span> <span class="operator">=</span> <span class="number">3</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> Tr·∫£ v·ªÅ danh s√°ch c√°c s·∫£n ph·∫©m c√≥ t√™n xu·∫•t hi·ªán
                trong c·∫£ hai t·∫≠p k·∫øt qu·∫£, t·ª©c l√† nh·ªØng s·∫£n ph·∫©m th·ªèa m√£n c·∫£ hai
                ƒëi·ªÅu ki·ªán.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - T√¨m kh√°ch h√†ng chung:</h4>
              <div class="code-block">
                <span class="comment">-- T√¨m kh√°ch h√†ng v·ª´a mua online v·ª´a mua t·∫°i c·ª≠a h√†ng</span>
                <span class="keyword">SELECT</span> <span class="column">customer_id</span>, <span class="column">customer_name</span> 
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="keyword">c</span> 
                <span class="keyword">JOIN</span> <span class="table">orders</span> <span class="keyword">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span> 
                <span class="keyword">WHERE</span> <span class="column">o.order_type</span> <span class="operator">=</span> <span class="string">'Online'</span> 
                <span class="keyword">INTERSECT</span> 
                <span class="keyword">SELECT</span> <span class="column">customer_id</span>, <span class="column">customer_name</span> 
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="keyword">c</span> 
                <span class="keyword">JOIN</span> <span class="table">orders</span> <span class="keyword">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span> 
                <span class="keyword">WHERE</span> <span class="column">o.order_type</span> <span class="operator">=</span> <span class="string">'In-Store'</span>;
              </div>
            </div>

            <h3>üìä So s√°nh c√°c ph√©p to√°n</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>Ph√©p to√°n</th>
                  <th>M·ª•c ƒë√≠ch</th>
                  <th>K·∫øt qu·∫£</th>
                  <th>·ª®ng d·ª•ng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>UNION</b></td>
                  <td>K·∫øt h·ª£p t·∫≠p h·ª£p</td>
                  <td>T·∫•t c·∫£ h√†ng t·ª´ c·∫£ hai b·∫£ng (lo·∫°i tr√πng)</td>
                  <td>G·ªôp danh s√°ch, b√°o c√°o t·ªïng h·ª£p</td>
                </tr>
                <tr>
                  <td><b>UNION ALL</b></td>
                  <td>K·∫øt h·ª£p t·∫≠p h·ª£p</td>
                  <td>T·∫•t c·∫£ h√†ng t·ª´ c·∫£ hai b·∫£ng (gi·ªØ tr√πng)</td>
                  <td>G·ªôp d·ªØ li·ªáu l·ªãch s·ª≠</td>
                </tr>
                <tr>
                  <td><b>MERGE</b></td>
                  <td>ƒê·ªìng b·ªô d·ªØ li·ªáu</td>
                  <td>C·∫≠p nh·∫≠t b·∫£ng ƒë√≠ch</td>
                  <td>ETL, ƒë·ªìng b·ªô master data</td>
                </tr>
                <tr>
                  <td><b>PIVOT</b></td>
                  <td>Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu</td>
                  <td>H√†ng th√†nh c·ªôt</td>
                  <td>B√°o c√°o cross-tab, dashboard</td>
                </tr>
                <tr>
                  <td><b>INTERSECT</b></td>
                  <td>T√¨m giao nhau</td>
                  <td>H√†ng chung c·ªßa hai t·∫≠p</td>
                  <td>Ph√¢n t√≠ch overlap, validation</td>
                </tr>
              </tbody>
            </table>

            <h3>üí° V√≠ d·ª• t·ªïng h·ª£p</h3>
            <div class="example">
              <h4>K·ªãch b·∫£n: Ph√¢n t√≠ch kh√°ch h√†ng ƒëa k√™nh</h4>
              <div class="code-block">
                -- 1. UNION: T·∫•t c·∫£ kh√°ch h√†ng t·ª´ c√°c k√™nh SELECT customer_id,
                'Online' AS channel FROM online_customers UNION SELECT
                customer_id, 'Store' AS channel FROM store_customers; -- 2.
                INTERSECT: Kh√°ch h√†ng mua ·ªü c·∫£ hai k√™nh SELECT customer_id FROM
                online_customers INTERSECT SELECT customer_id FROM
                store_customers; -- 3. PIVOT: Doanh thu theo k√™nh v√† th√°ng
                SELECT customer_id, [Online], [Store], [Phone] FROM ( SELECT
                customer_id, channel, total_amount FROM all_orders ) AS src
                PIVOT ( SUM(total_amount) FOR channel IN ([Online], [Store],
                [Phone]) ) AS channel_pivot; -- 4. MERGE: C·∫≠p nh·∫≠t th√¥ng tin
                kh√°ch h√†ng MERGE customer_master AS target USING
                customer_updates AS source ON target.customer_id =
                source.customer_id WHEN MATCHED THEN UPDATE SET target.email =
                source.email, target.phone = source.phone WHEN NOT MATCHED THEN
                INSERT VALUES (source.customer_id, source.name, source.email,
                source.phone);
              </div>
            </div>

            <div class="success-box">
              <h4>üí° Best Practices:</h4>
              <ul>
                <li>
                  <b>UNION vs UNION ALL:</b> S·ª≠ d·ª•ng UNION ALL khi bi·∫øt ch·∫Øc
                  kh√¥ng c√≥ tr√πng l·∫∑p ƒë·ªÉ tƒÉng hi·ªáu su·∫•t
                </li>
                <li>
                  <b>MERGE:</b> Lu√¥n test v·ªõi d·ªØ li·ªáu nh·ªè tr∆∞·ªõc khi ch·∫°y
                  production
                </li>
                <li>
                  <b>PIVOT:</b> C√¢n nh·∫Øc s·ª≠ d·ª•ng dynamic PIVOT cho s·ªë l∆∞·ª£ng c·ªôt
                  kh√¥ng c·ªë ƒë·ªãnh
                </li>
                <li>
                  <b>INTERSECT:</b> C√≥ th·ªÉ thay th·∫ø b·∫±ng EXISTS ho·∫∑c INNER JOIN
                  trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p
                </li>
              </ul>
            </div>
          </section>

          <!-- 13 -->
          <section class="section" id="relationship">
            <h2>13. Relationship & Chu·∫©n h√≥a (1NF, 2NF, 3NF)</h2>

            <div class="info-box">
              <h4>üîó T·ªïng quan:</h4>
              <p>
                Ph·∫ßn n√†y bao g·ªìm hai kh√°i ni·ªám c·ªët l√µi trong thi·∫øt k·∫ø c∆° s·ªü d·ªØ
                li·ªáu: <b>Quan h·ªá (Relationships)</b> gi·ªØa c√°c b·∫£ng v√†
                <b>Chu·∫©n h√≥a (Normalization)</b> ƒë·ªÉ t·ªëi ∆∞u c·∫•u tr√∫c d·ªØ li·ªáu.
              </p>
            </div>

            <h3>üîó C√°c lo·∫°i Quan h·ªá (Relationship)</h3>
            <p>
              Trong m√¥ h√¨nh c∆° s·ªü d·ªØ li·ªáu quan h·ªá, c√°c b·∫£ng ƒë∆∞·ª£c li√™n k·∫øt v·ªõi
              nhau th√¥ng qua <b>kh√≥a ngo·∫°i (Foreign Key)</b>. C√≥ ba lo·∫°i quan h·ªá
              ch√≠nh:
            </p>

            <h4>1Ô∏è‚É£ Quan h·ªá 1-1 (M·ªôt-M·ªôt)</h4>
            <div class="highlight-box">
              <p>
                <b>ƒê·ªãnh nghƒ©a:</b> M·ªôt b·∫£n ghi trong b·∫£ng n√†y ch·ªâ li√™n k·∫øt v·ªõi
                duy nh·∫•t m·ªôt b·∫£n ghi trong b·∫£ng kia.
              </p>
              <p>
                <b>V√≠ d·ª•:</b> Trong m·ªôt c∆° s·ªü d·ªØ li·ªáu c·ªßa m·ªôt tr∆∞·ªùng h·ªçc, m·ªói
                h·ªçc sinh ch·ªâ c√≥ m·ªôt h·ªì s∆° h·ªçc b·∫° duy nh·∫•t. Quan h·ªá gi·ªØa b·∫£ng
                <code>Students</code> v√† b·∫£ng <code>StudentRecords</code> l√†
                1-1.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - Quan h·ªá 1-1:</h4>
              <div class="code-block">
                -- B·∫£ng Students CREATE TABLE students ( student_id INT PRIMARY
                KEY, student_name NVARCHAR(100), birth_date DATE ); -- B·∫£ng
                StudentRecords (quan h·ªá 1-1) CREATE TABLE student_records (
                record_id INT PRIMARY KEY, student_id INT UNIQUE, -- UNIQUE ƒë·∫£m
                b·∫£o quan h·ªá 1-1 gpa DECIMAL(3,2), total_credits INT, FOREIGN KEY
                (student_id) REFERENCES students(student_id) );
              </div>
            </div>

            <h4>2Ô∏è‚É£ Quan h·ªá 1-n (M·ªôt-Nhi·ªÅu)</h4>
            <div class="highlight-box">
              <p>
                <b>ƒê·ªãnh nghƒ©a:</b> M·ªôt b·∫£n ghi trong b·∫£ng n√†y c√≥ th·ªÉ li√™n k·∫øt
                v·ªõi nhi·ªÅu b·∫£n ghi trong b·∫£ng kia, nh∆∞ng m·ªôt b·∫£n ghi trong b·∫£ng
                kia ch·ªâ li√™n k·∫øt v·ªõi m·ªôt b·∫£n ghi trong b·∫£ng n√†y.
              </p>
              <p>
                <b>V√≠ d·ª•:</b> M·ªôt kh√°ch h√†ng c√≥ th·ªÉ ƒë·∫∑t nhi·ªÅu ƒë∆°n h√†ng, nh∆∞ng
                m·ªói ƒë∆°n h√†ng ch·ªâ thu·ªôc v·ªÅ m·ªôt kh√°ch h√†ng. Quan h·ªá gi·ªØa b·∫£ng
                <code>Customers</code> v√† b·∫£ng <code>Orders</code> l√† 1-n.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - Quan h·ªá 1-n:</h4>
              <div class="code-block">
                -- B·∫£ng Customers (1) CREATE TABLE customers ( customer_id INT
                PRIMARY KEY, customer_name NVARCHAR(100), email VARCHAR(255) );
                -- B·∫£ng Orders (nhi·ªÅu) CREATE TABLE orders ( order_id INT
                PRIMARY KEY, customer_id INT, -- Kh√≥a ngo·∫°i order_date DATE,
                total_amount DECIMAL(10,2), FOREIGN KEY (customer_id) REFERENCES
                customers(customer_id) );
              </div>
            </div>

            <h4>3Ô∏è‚É£ Quan h·ªá n-n (Nhi·ªÅu-Nhi·ªÅu)</h4>
            <div class="highlight-box">
              <p>
                <b>ƒê·ªãnh nghƒ©a:</b> M·ªôt b·∫£n ghi trong b·∫£ng n√†y c√≥ th·ªÉ li√™n k·∫øt
                v·ªõi nhi·ªÅu b·∫£n ghi trong b·∫£ng kia, v√† ng∆∞·ª£c l·∫°i.
              </p>
              <p>
                <b>V√≠ d·ª•:</b> M·ªôt sinh vi√™n c√≥ th·ªÉ ƒëƒÉng k√Ω nhi·ªÅu kh√≥a h·ªçc, v√†
                m·ªôt kh√≥a h·ªçc c√≥ th·ªÉ c√≥ nhi·ªÅu sinh vi√™n ƒëƒÉng k√Ω. Quan h·ªá gi·ªØa
                b·∫£ng <code>Students</code> v√† b·∫£ng <code>Courses</code> l√† n-n.
              </p>
              <p>
                <b>Gi·∫£i ph√°p:</b> ƒê·ªÉ x·ª≠ l√Ω lo·∫°i quan h·ªá n√†y, b·∫°n c·∫ßn m·ªôt
                <b>b·∫£ng trung gian (linking table)</b> nh∆∞
                <code>Enrollments</code> ƒë·ªÉ l∆∞u tr·ªØ c√°c li√™n k·∫øt.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø - Quan h·ªá n-n:</h4>
              <div class="code-block">
                -- B·∫£ng Students (nhi·ªÅu) CREATE TABLE students ( student_id INT
                PRIMARY KEY, student_name NVARCHAR(100) ); -- B·∫£ng Courses
                (nhi·ªÅu) CREATE TABLE courses ( course_id INT PRIMARY KEY,
                course_name NVARCHAR(100), credits INT ); -- B·∫£ng trung gian
                Enrollments CREATE TABLE enrollments ( enrollment_id INT PRIMARY
                KEY, student_id INT, course_id INT, enrollment_date DATE, grade
                CHAR(2), FOREIGN KEY (student_id) REFERENCES
                students(student_id), FOREIGN KEY (course_id) REFERENCES
                courses(course_id), UNIQUE(student_id, course_id) -- ƒê·∫£m b·∫£o m·ªôt
                sinh vi√™n kh√¥ng ƒëƒÉng k√Ω tr√πng kh√≥a h·ªçc );
              </div>
            </div>

            <h3>üìê Chu·∫©n h√≥a (Normalization)</h3>
            <div class="info-box">
              <p>
                <b>Chu·∫©n h√≥a</b> l√† qu√° tr√¨nh t·ªï ch·ª©c c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ
                <b>lo·∫°i b·ªè d∆∞ th·ª´a d·ªØ li·ªáu</b> v√†
                <b>c·∫£i thi·ªán t√≠nh to√†n v·∫πn</b> c·ªßa d·ªØ li·ªáu. D∆∞·ªõi ƒë√¢y l√† ba d·∫°ng
                chu·∫©n h√≥a ph·ªï bi·∫øn nh·∫•t:
              </p>
            </div>

            <h4>üìã 1NF (D·∫°ng chu·∫©n th·ª© nh·∫•t)</h4>
            <div class="highlight-box">
              <p>
                ƒê·ªÉ m·ªôt b·∫£ng ƒë∆∞·ª£c g·ªçi l√† ·ªü d·∫°ng <b>1NF</b>, n√≥ ph·∫£i th·ªèa m√£n hai
                ƒëi·ªÅu ki·ªán:
              </p>
              <ul>
                <li>
                  <b>M·ªói √¥</b> (giao ƒëi·ªÉm c·ªßa h√†ng v√† c·ªôt) ph·∫£i ch·ª©a m·ªôt
                  <b>gi√° tr·ªã duy nh·∫•t v√† nguy√™n t·ªë (atomic)</b>. T·ª©c l√† kh√¥ng c√≥
                  c√°c gi√° tr·ªã l·∫∑p l·∫°i trong m·ªôt √¥.
                </li>
                <li>
                  <b>M·ªói h√†ng ph·∫£i l√† duy nh·∫•t</b>. ƒêi·ªÅu n√†y th∆∞·ªùng ƒë∆∞·ª£c ƒë·∫£m b·∫£o
                  b·∫±ng vi·ªác c√≥ m·ªôt kh√≥a ch√≠nh (Primary Key).
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• vi ph·∫°m v√† chu·∫©n h√≥a 1NF:</h4>
              <p><b>‚ùå B·∫£ng kh√¥ng 1NF:</b></p>
              <table style="margin: 10px 0">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>T√™n</th>
                    <th>S·ªë ƒëi·ªán tho·∫°i</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>An</td>
                    <td>091234, 098765</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>B√¨nh</td>
                    <td>097777, 096666, 095555</td>
                  </tr>
                </tbody>
              </table>

              <p><b>‚úÖ B·∫£ng ƒë√£ chu·∫©n h√≥a 1NF:</b></p>
              <div class="code-block">
                -- Gi·∫£i ph√°p 1: T√°ch th√†nh nhi·ªÅu h√†ng CREATE TABLE contacts_1nf
                ( contact_id INT IDENTITY(1,1) PRIMARY KEY, person_id INT,
                person_name NVARCHAR(50), phone_number VARCHAR(20) ); INSERT
                INTO contacts_1nf VALUES (1, N'An', '091234'), (1, N'An',
                '098765'), (2, N'B√¨nh', '097777'), (2, N'B√¨nh', '096666'), (2,
                N'B√¨nh', '095555');
              </div>
            </div>

            <h4>üìã 2NF (D·∫°ng chu·∫©n th·ª© hai)</h4>
            <div class="highlight-box">
              <p>
                ƒê·ªÉ m·ªôt b·∫£ng ƒë∆∞·ª£c g·ªçi l√† ·ªü d·∫°ng <b>2NF</b>, n√≥ ph·∫£i th·ªèa m√£n c√°c
                ƒëi·ªÅu ki·ªán sau:
              </p>
              <ul>
                <li><b>ƒê√£ ·ªü 1NF</b></li>
                <li>
                  <b>Kh√¥ng c√≥ ph·ª• thu·ªôc h√†m b·ªô ph·∫≠n</b> (no partial functional
                  dependencies). ƒêi·ªÅu n√†y ch·ªâ √°p d·ª•ng cho c√°c b·∫£ng c√≥ kh√≥a ch√≠nh
                  k·∫øt h·ª£p (Composite Key). T·∫•t c·∫£ c√°c thu·ªôc t√≠nh kh√¥ng kh√≥a ph·∫£i
                  ph·ª• thu·ªôc ho√†n to√†n v√†o to√†n b·ªô kh√≥a ch√≠nh.
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• vi ph·∫°m v√† chu·∫©n h√≥a 2NF:</h4>
              <p><b>‚ùå B·∫£ng kh√¥ng 2NF:</b></p>
              <p>
                Gi·∫£ s·ª≠ b·∫°n c√≥ b·∫£ng <code>OrderDetails</code> v·ªõi kh√≥a ch√≠nh k·∫øt
                h·ª£p l√† <code>(OrderID, ProductID)</code>. Thu·ªôc t√≠nh
                <code>ProductName</code> ch·ªâ ph·ª• thu·ªôc v√†o
                <code>ProductID</code> ch·ª© kh√¥ng ph·ª• thu·ªôc v√†o
                <code>OrderID</code>.
              </p>
              <table style="margin: 10px 0">
                <thead>
                  <tr>
                    <th>OrderID</th>
                    <th>ProductID</th>
                    <th>ProductName</th>
                    <th>Quantity</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>101</td>
                    <td>P01</td>
                    <td>T-shirt</td>
                    <td>2</td>
                  </tr>
                  <tr>
                    <td>102</td>
                    <td>P01</td>
                    <td>T-shirt</td>
                    <td>1</td>
                  </tr>
                  <tr>
                    <td>101</td>
                    <td>P02</td>
                    <td>Jeans</td>
                    <td>1</td>
                  </tr>
                </tbody>
              </table>

              <p><b>‚úÖ B·∫£ng ƒë√£ chu·∫©n h√≥a 2NF:</b></p>
              <div class="code-block">
                -- T√°ch ProductID v√† ProductName ra b·∫£ng ri√™ng CREATE TABLE
                order_details_2nf ( order_id INT, product_id INT, quantity INT,
                PRIMARY KEY (order_id, product_id), FOREIGN KEY (product_id)
                REFERENCES products(product_id) ); CREATE TABLE products (
                product_id INT PRIMARY KEY, product_name NVARCHAR(100), price
                DECIMAL(10,2) );
              </div>
            </div>

            <h4>üìã 3NF (D·∫°ng chu·∫©n th·ª© ba)</h4>
            <div class="highlight-box">
              <p>
                ƒê·ªÉ m·ªôt b·∫£ng ƒë∆∞·ª£c g·ªçi l√† ·ªü d·∫°ng <b>3NF</b>, n√≥ ph·∫£i th·ªèa m√£n c√°c
                ƒëi·ªÅu ki·ªán sau:
              </p>
              <ul>
                <li><b>ƒê√£ ·ªü 2NF</b></li>
                <li>
                  <b>Kh√¥ng c√≥ ph·ª• thu·ªôc h√†m b·∫Øc c·∫ßu</b> (no transitive
                  functional dependencies). T·ª©c l√† kh√¥ng c√≥ thu·ªôc t√≠nh kh√¥ng
                  kh√≥a n√†o ph·ª• thu·ªôc v√†o m·ªôt thu·ªôc t√≠nh kh√¥ng kh√≥a kh√°c.
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• vi ph·∫°m v√† chu·∫©n h√≥a 3NF:</h4>
              <p><b>‚ùå B·∫£ng kh√¥ng 3NF:</b></p>
              <p>
                Gi·∫£ s·ª≠ b·∫°n c√≥ b·∫£ng <code>Employees</code>.
                <code>DepartmentName</code> ph·ª• thu·ªôc v√†o
                <code>DepartmentID</code>, v√† <code>DepartmentID</code> l·∫°i ph·ª•
                thu·ªôc v√†o <code>EmployeeID</code> (kh√≥a ch√≠nh). ƒêi·ªÅu n√†y vi ph·∫°m
                3NF v√¨ c√≥ s·ª± ph·ª• thu·ªôc b·∫Øc c·∫ßu:
                <code>EmployeeID ‚Üí DepartmentID ‚Üí DepartmentName</code>.
              </p>
              <table style="margin: 10px 0">
                <thead>
                  <tr>
                    <th>EmployeeID</th>
                    <th>EmployeeName</th>
                    <th>DepartmentID</th>
                    <th>DepartmentName</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>Nguy·ªÖn VƒÉn A</td>
                    <td>10</td>
                    <td>IT</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>Tr·∫ßn Th·ªã B</td>
                    <td>10</td>
                    <td>IT</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>L√™ VƒÉn C</td>
                    <td>20</td>
                    <td>Marketing</td>
                  </tr>
                </tbody>
              </table>

              <p><b>‚úÖ B·∫£ng ƒë√£ chu·∫©n h√≥a 3NF:</b></p>
              <div class="code-block">
                -- T√°ch DepartmentID v√† DepartmentName ra b·∫£ng ri√™ng CREATE
                TABLE employees_3nf ( employee_id INT PRIMARY KEY, employee_name
                NVARCHAR(100), department_id INT, salary DECIMAL(10,2), FOREIGN
                KEY (department_id) REFERENCES departments(department_id) );
                CREATE TABLE departments ( department_id INT PRIMARY KEY,
                department_name NVARCHAR(100), manager_id INT, budget
                DECIMAL(12,2) );
              </div>
            </div>

            <h3>üìä T√≥m t·∫Øt Chu·∫©n h√≥a</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>D·∫°ng chu·∫©n</th>
                  <th>ƒêi·ªÅu ki·ªán</th>
                  <th>V·∫•n ƒë·ªÅ gi·∫£i quy·∫øt</th>
                  <th>V√≠ d·ª•</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>1NF</b></td>
                  <td>Gi√° tr·ªã nguy√™n t·ªë, h√†ng duy nh·∫•t</td>
                  <td>Gi√° tr·ªã ƒëa tr·ªã trong m·ªôt √¥</td>
                  <td>T√°ch "091234, 098765" th√†nh 2 h√†ng</td>
                </tr>
                <tr>
                  <td><b>2NF</b></td>
                  <td>1NF + kh√¥ng ph·ª• thu·ªôc b·ªô ph·∫≠n</td>
                  <td>Thu·ªôc t√≠nh ph·ª• thu·ªôc m·ªôt ph·∫ßn kh√≥a</td>
                  <td>T√°ch ProductName kh·ªèi OrderDetails</td>
                </tr>
                <tr>
                  <td><b>3NF</b></td>
                  <td>2NF + kh√¥ng ph·ª• thu·ªôc b·∫Øc c·∫ßu</td>
                  <td>Thu·ªôc t√≠nh ph·ª• thu·ªôc thu·ªôc t√≠nh kh√°c</td>
                  <td>T√°ch DepartmentName kh·ªèi Employees</td>
                </tr>
              </tbody>
            </table>

            <h3>üí° V√≠ d·ª• t·ªïng h·ª£p: H·ªá th·ªëng qu·∫£n l√Ω b√°n h√†ng</h3>
            <div class="example">
              <h4>Thi·∫øt k·∫ø c∆° s·ªü d·ªØ li·ªáu chu·∫©n h√≥a ƒë·∫ßy ƒë·ªß:</h4>
              <div class="code-block">
                -- 1. B·∫£ng Customers (1 trong quan h·ªá 1-n v·ªõi Orders) CREATE
                TABLE customers ( customer_id INT PRIMARY KEY, customer_name
                NVARCHAR(100) NOT NULL, email VARCHAR(255) UNIQUE, phone
                VARCHAR(20), address NVARCHAR(255) ); -- 2. B·∫£ng Categories
                CREATE TABLE categories ( category_id INT PRIMARY KEY,
                category_name NVARCHAR(100) NOT NULL ); -- 3. B·∫£ng Products
                (tu√¢n th·ªß 3NF - t√°ch category th√†nh b·∫£ng ri√™ng) CREATE TABLE
                products ( product_id INT PRIMARY KEY, product_name
                NVARCHAR(100) NOT NULL, category_id INT, price DECIMAL(10,2),
                stock_quantity INT, FOREIGN KEY (category_id) REFERENCES
                categories(category_id) ); -- 4. B·∫£ng Orders (n trong quan h·ªá
                1-n v·ªõi Customers) CREATE TABLE orders ( order_id INT PRIMARY
                KEY, customer_id INT, order_date DATE DEFAULT GETDATE(),
                total_amount DECIMAL(10,2), FOREIGN KEY (customer_id) REFERENCES
                customers(customer_id) ); -- 5. B·∫£ng OrderDetails (b·∫£ng trung
                gian cho quan h·ªá n-n gi·ªØa Orders v√† Products) CREATE TABLE
                order_details ( order_detail_id INT PRIMARY KEY, order_id INT,
                product_id INT, quantity INT, unit_price DECIMAL(10,2), FOREIGN
                KEY (order_id) REFERENCES orders(order_id), FOREIGN KEY
                (product_id) REFERENCES products(product_id) );
              </div>
            </div>

            <h3>‚úÖ L·ª£i √≠ch c·ªßa Chu·∫©n h√≥a</h3>
            <div class="success-box">
              <ul>
                <li>
                  <b>Gi·∫£m d∆∞ th·ª´a d·ªØ li·ªáu:</b> Th√¥ng tin kh√¥ng b·ªã l·∫∑p l·∫°i kh√¥ng
                  c·∫ßn thi·∫øt
                </li>
                <li>
                  <b>TƒÉng t√≠nh nh·∫•t qu√°n:</b> C·∫≠p nh·∫≠t d·ªØ li·ªáu ·ªü m·ªôt n∆°i s·∫Ω √°p
                  d·ª•ng to√†n b·ªô h·ªá th·ªëng
                </li>
                <li>
                  <b>Ti·∫øt ki·ªám dung l∆∞·ª£ng:</b> Gi·∫£m k√≠ch th∆∞·ªõc c∆° s·ªü d·ªØ li·ªáu
                </li>
                <li>
                  <b>D·ªÖ b·∫£o tr√¨:</b> Thay ƒë·ªïi c·∫•u tr√∫c √≠t ·∫£nh h∆∞·ªüng ƒë·∫øn to√†n h·ªá
                  th·ªëng
                </li>
                <li>
                  <b>TƒÉng t√≠nh to√†n v·∫πn:</b> Gi·∫£m thi·ªÉu l·ªói v√† m√¢u thu·∫´n d·ªØ li·ªáu
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω:</h4>
              <p>
                Vi·ªác chu·∫©n h√≥a gi√∫p c∆° s·ªü d·ªØ li·ªáu c·ªßa b·∫°n tr·ªü n√™n hi·ªáu qu·∫£ h∆°n
                b·∫±ng c√°ch gi·∫£m thi·ªÉu c√°c v·∫•n ƒë·ªÅ nh∆∞ <b>d∆∞ th·ª´a d·ªØ li·ªáu</b>,
                <b>b·∫•t th∆∞·ªùng khi c·∫≠p nh·∫≠t</b>, v√† <b>b·∫•t th∆∞·ªùng khi x√≥a</b>.
                Tuy nhi√™n, ƒë√¥i khi c·∫ßn ph·∫£i
                <b>phi chu·∫©n h√≥a (denormalization)</b> ƒë·ªÉ t·ªëi ∆∞u hi·ªáu su·∫•t truy
                v·∫•n trong c√°c h·ªá th·ªëng c√≥ l∆∞·ª£ng ƒë·ªçc l·ªõn.
              </p>
            </div>
          </section>

          <!-- 14 -->
          <section class="section" id="group-by">
            <h2>14. GROUP BY</h2>

            <div class="info-box">
              <h4>üìä GROUP BY l√† g√¨?</h4>
              <p>
                M·ªánh ƒë·ªÅ <b>GROUP BY</b> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ nh√≥m c√°c h√†ng c√≥ c√πng
                gi√° tr·ªã trong m·ªôt ho·∫∑c nhi·ªÅu c·ªôt th√†nh c√°c nh√≥m t√≥m t·∫Øt. Sau khi
                c√°c h√†ng ƒë∆∞·ª£c nh√≥m, b·∫°n c√≥ th·ªÉ √°p d·ª•ng c√°c
                <b>h√†m t·ªïng h·ª£p</b> (nh∆∞ COUNT, SUM, AVG, MAX, MIN) l√™n m·ªói nh√≥m
                ƒë·ªÉ t√≠nh to√°n c√°c gi√° tr·ªã t·ªïng h·ª£p.
              </p>
            </div>

            <h3>üéØ Kh√°i ni·ªám c∆° b·∫£n</h3>
            <div class="highlight-box">
              <p>
                B·∫°n c√≥ th·ªÉ h√¨nh dung GROUP BY nh∆∞ m·ªôt c√°ch ƒë·ªÉ
                <b>"t·ªïng k·∫øt"</b> d·ªØ li·ªáu. Thay v√¨ xem x√©t t·ª´ng h√†ng ri√™ng l·∫ª,
                b·∫°n gom ch√∫ng l·∫°i th√†nh c√°c nh√≥m d·ª±a tr√™n m·ªôt ƒë·∫∑c ƒëi·ªÉm chung,
                sau ƒë√≥ t√≠nh to√°n m·ªôt gi√° tr·ªã t·ªïng k·∫øt cho m·ªói nh√≥m ƒë√≥.
              </p>

              <ul>
                <li>
                  <b>V·ªã tr√≠:</b> GROUP BY lu√¥n ƒë∆∞·ª£c ƒë·∫∑t sau m·ªánh ƒë·ªÅ FROM (v√†
                  WHERE, n·∫øu c√≥)
                </li>
                <li>
                  <b>M·ª•c ƒë√≠ch:</b> ƒê·ªÉ t·∫°o ra c√°c b√°o c√°o t√≥m t·∫Øt, th·ªëng k√™, ho·∫∑c
                  ph√¢n t√≠ch d·ªØ li·ªáu theo t·ª´ng nh√≥m
                </li>
              </ul>
            </div>

            <h3>üìã V√≠ d·ª• c·ª• th·ªÉ</h3>
            <div class="example">
              <h4>B√†i to√°n: ƒê·∫øm s·∫£n ph·∫©m theo c·ª≠a h√†ng</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt b·∫£ng <code>stocks</code> (t·ªìn kho) l∆∞u tr·ªØ
                th√¥ng tin v·ªÅ s·∫£n ph·∫©m trong c√°c c·ª≠a h√†ng, v·ªõi c√°c c·ªôt
                <code>store_id</code> (m√£ c·ª≠a h√†ng) v√†
                <code>product_id</code> (m√£ s·∫£n ph·∫©m).
              </p>

              <p>
                <b>V·∫•n ƒë·ªÅ:</b> N·∫øu b·∫°n mu·ªën bi·∫øt m·ªói c·ª≠a h√†ng c√≥ bao nhi√™u s·∫£n
                ph·∫©m, b·∫°n kh√¥ng th·ªÉ ch·ªâ d√πng SELECT v√† COUNT th√¥ng th∆∞·ªùng, v√¨ n√≥
                s·∫Ω ch·ªâ tr·∫£ v·ªÅ t·ªïng s·ªë s·∫£n ph·∫©m trong to√†n b·ªô b·∫£ng. B·∫°n c·∫ßn nh√≥m
                d·ªØ li·ªáu theo <code>store_id</code> ƒë·ªÉ ƒë·∫øm s·ªë s·∫£n ph·∫©m cho t·ª´ng
                c·ª≠a h√†ng.
              </p>

              <div class="code-block">
                SELECT store_id, COUNT(product_id) AS total_products FROM stocks
                GROUP BY store_id;
              </div>

              <h4>Gi·∫£i th√≠ch t·ª´ng ph·∫ßn:</h4>
              <ul>
                <li>
                  <b>SELECT store_id, COUNT(product_id) AS total_products:</b>
                  Ch·ªçn c·ªôt store_id v√† s·ª≠ d·ª•ng h√†m COUNT() ƒë·ªÉ ƒë·∫øm s·ªë product_id
                  trong m·ªói nh√≥m. K·∫øt qu·∫£ c·ªßa h√†m COUNT() s·∫Ω ƒë∆∞·ª£c ƒë·∫∑t t√™n l√†
                  total_products.
                </li>
                <li><b>FROM stocks:</b> Ch·ªâ ƒë·ªãnh b·∫£ng d·ªØ li·ªáu l√† stocks.</li>
                <li>
                  <b>GROUP BY store_id:</b> ƒê√¢y l√† ph·∫ßn quan tr·ªçng nh·∫•t. N√≥ s·∫Ω
                  gom t·∫•t c·∫£ c√°c h√†ng c√≥ c√πng store_id l·∫°i th√†nh m·ªôt nh√≥m. V√≠
                  d·ª•, t·∫•t c·∫£ s·∫£n ph·∫©m c·ªßa c·ª≠a h√†ng c√≥ store_id = 1 s·∫Ω ƒë∆∞·ª£c nh√≥m
                  l·∫°i v·ªõi nhau, v√† COUNT() s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng cho nh√≥m ƒë√≥.
                </li>
              </ul>

              <h4>K·∫øt qu·∫£ c√≥ th·ªÉ l√†:</h4>
              <table style="margin: 10px 0">
                <thead>
                  <tr>
                    <th>store_id</th>
                    <th>total_products</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1</td>
                    <td>50</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>35</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>70</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <h3>üí° C√°c v√≠ d·ª• kh√°c</h3>

            <div class="example">
              <h4>1. T·ªïng doanh thu theo t·ª´ng danh m·ª•c s·∫£n ph·∫©m:</h4>
              <div class="code-block">
                SELECT category_id, SUM(price) AS total_revenue FROM products
                GROUP BY category_id;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> Hi·ªÉn th·ªã t·ªïng gi√° tr·ªã c·ªßa t·∫•t c·∫£ s·∫£n ph·∫©m trong
                m·ªói danh m·ª•c.
              </p>
            </div>

            <div class="example">
              <h4>2. Gi√° tr·ªã trung b√¨nh c·ªßa ƒë∆°n h√†ng theo t·ª´ng kh√°ch h√†ng:</h4>
              <div class="code-block">
                SELECT customer_id, AVG(total_amount) AS average_order_value
                FROM orders GROUP BY customer_id;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> Hi·ªÉn th·ªã gi√° tr·ªã ƒë∆°n h√†ng trung b√¨nh c·ªßa m·ªói
                kh√°ch h√†ng.
              </p>
            </div>

            <div class="example">
              <h4>3. S·ªë l∆∞·ª£ng nh√¢n vi√™n theo t·ª´ng ph√≤ng ban:</h4>
              <div class="code-block">
                SELECT department_id, COUNT(*) AS employee_count FROM employees
                GROUP BY department_id;
              </div>
              <p><b>K·∫øt qu·∫£:</b> ƒê·∫øm s·ªë nh√¢n vi√™n trong m·ªói ph√≤ng ban.</p>
            </div>

            <div class="example">
              <h4>4. S·∫£n ph·∫©m ƒë·∫Øt nh·∫•t v√† r·∫ª nh·∫•t theo t·ª´ng th∆∞∆°ng hi·ªáu:</h4>
              <div class="code-block">
                SELECT brand_id, MIN(price) AS cheapest_product, MAX(price) AS
                most_expensive_product, AVG(price) AS average_price FROM
                products GROUP BY brand_id;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> Th·ªëng k√™ gi√° s·∫£n ph·∫©m chi ti·∫øt cho t·ª´ng th∆∞∆°ng
                hi·ªáu.
              </p>
            </div>

            <h3>üîÑ GROUP BY v·ªõi nhi·ªÅu c·ªôt</h3>
            <div class="example">
              <h4>V√≠ d·ª•: Th·ªëng k√™ doanh thu theo c·ª≠a h√†ng v√† nƒÉm</h4>
              <div class="code-block">
                SELECT store_id, YEAR(order_date) AS order_year,
                SUM(total_amount) AS annual_revenue, COUNT(order_id) AS
                total_orders FROM orders GROUP BY store_id, YEAR(order_date)
                ORDER BY store_id, order_year;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> M·ªói nh√≥m s·∫Ω l√† k·∫øt h·ª£p c·ªßa
                <code>store_id</code> v√† <code>year</code>. V√≠ d·ª•: (store_id=1,
                year=2024), (store_id=1, year=2025), (store_id=2, year=2024),
                v.v.
              </p>
            </div>

            <h3>üéØ GROUP BY k·∫øt h·ª£p v·ªõi WHERE</h3>
            <div class="example">
              <h4>
                V√≠ d·ª•: ƒê·∫øm ƒë∆°n h√†ng c·ªßa kh√°ch h√†ng VIP (t·ªïng chi ti√™u > 10,000)
              </h4>
              <div class="code-block">
                SELECT customer_id, COUNT(order_id) AS total_orders,
                SUM(total_amount) AS total_spent FROM orders WHERE order_date >=
                '2024-01-01' -- L·ªçc tr∆∞·ªõc khi nh√≥m GROUP BY customer_id HAVING
                SUM(total_amount) > 10000 -- L·ªçc sau khi nh√≥m ORDER BY
                total_spent DESC;
              </div>
              <p>
                <b>Th·ª© t·ª± th·ª±c thi:</b> WHERE ‚Üí GROUP BY ‚Üí HAVING ‚Üí ORDER BY
              </p>
            </div>

            <h3>üìä C√°c h√†m t·ªïng h·ª£p th∆∞·ªùng d√πng v·ªõi GROUP BY</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>H√†m</th>
                  <th>M√¥ t·∫£</th>
                  <th>V√≠ d·ª•</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>COUNT()</b></td>
                  <td>ƒê·∫øm s·ªë h√†ng trong nh√≥m</td>
                  <td>COUNT(product_id), COUNT(*)</td>
                </tr>
                <tr>
                  <td><b>SUM()</b></td>
                  <td>T√≠nh t·ªïng gi√° tr·ªã</td>
                  <td>SUM(price), SUM(quantity)</td>
                </tr>
                <tr>
                  <td><b>AVG()</b></td>
                  <td>T√≠nh gi√° tr·ªã trung b√¨nh</td>
                  <td>AVG(salary), AVG(rating)</td>
                </tr>
                <tr>
                  <td><b>MIN()</b></td>
                  <td>T√¨m gi√° tr·ªã nh·ªè nh·∫•t</td>
                  <td>MIN(price), MIN(hire_date)</td>
                </tr>
                <tr>
                  <td><b>MAX()</b></td>
                  <td>T√¨m gi√° tr·ªã l·ªõn nh·∫•t</td>
                  <td>MAX(price), MAX(order_date)</td>
                </tr>
              </tbody>
            </table>

            <h3>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng</h3>
            <div class="info-box">
              <h4>Quy t·∫Øc v·ªÅ SELECT v·ªõi GROUP BY:</h4>
              <p>
                Khi s·ª≠ d·ª•ng GROUP BY, c√°c c·ªôt trong m·ªánh ƒë·ªÅ SELECT ch·ªâ c√≥ th·ªÉ
                l√†:
              </p>
              <ul>
                <li><b>C√°c c·ªôt b·∫°n ƒë√£ nh√≥m</b> (xu·∫•t hi·ªán trong GROUP BY)</li>
                <li>
                  <b>C√°c c·ªôt ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c h√†m t·ªïng h·ª£p</b> (COUNT,
                  SUM, AVG, etc.)
                </li>
              </ul>
              <p>
                N·∫øu b·∫°n mu·ªën hi·ªÉn th·ªã m·ªôt c·ªôt kh√¥ng n·∫±m trong GROUP BY, b·∫°n ph·∫£i
                bao n√≥ trong m·ªôt h√†m t·ªïng h·ª£p.
              </p>
            </div>

            <div class="example">
              <h4>‚ùå L·ªói th∆∞·ªùng g·∫∑p:</h4>
              <div class="code-block">
                -- SAI: product_name kh√¥ng c√≥ trong GROUP BY v√† kh√¥ng c√≥ trong
                h√†m t·ªïng h·ª£p SELECT category_id, product_name, COUNT(*) FROM
                products GROUP BY category_id; -- L·ªñI!
              </div>

              <h4>‚úÖ C√°ch s·ª≠a:</h4>
              <div class="code-block">
                -- ƒê√öNG: Ch·ªâ hi·ªÉn th·ªã c√°c c·ªôt ƒë√£ nh√≥m v√† h√†m t·ªïng h·ª£p SELECT
                category_id, COUNT(*) AS product_count FROM products GROUP BY
                category_id; -- Ho·∫∑c n·∫øu mu·ªën th·∫•y t√™n s·∫£n ph·∫©m, c√≥ th·ªÉ d√πng
                STRING_AGG (SQL Server) SELECT category_id, COUNT(*) AS
                product_count, STRING_AGG(product_name, ', ') AS product_list
                FROM products GROUP BY category_id;
              </div>
            </div>

            <h3>üîß V√≠ d·ª• th·ª±c t·∫ø: B√°o c√°o b√°n h√†ng t·ªïng h·ª£p</h3>
            <div class="example">
              <h4>K·ªãch b·∫£n: T·∫°o b√°o c√°o t·ªïng h·ª£p cho qu·∫£n l√Ω</h4>
              <div class="code-block">
                -- B√°o c√°o doanh thu t·ªïng h·ª£p theo th√°ng v√† c·ª≠a h√†ng SELECT
                s.store_name, YEAR(o.order_date) AS order_year,
                MONTH(o.order_date) AS order_month, COUNT(o.order_id) AS
                total_orders, SUM(o.total_amount) AS total_revenue,
                AVG(o.total_amount) AS average_order_value, MIN(o.total_amount)
                AS smallest_order, MAX(o.total_amount) AS largest_order FROM
                stores s JOIN orders o ON s.store_id = o.store_id WHERE
                o.order_date >= '2024-01-01' GROUP BY s.store_name,
                YEAR(o.order_date), MONTH(o.order_date) HAVING
                SUM(o.total_amount) > 50000 -- Ch·ªâ hi·ªÉn th·ªã th√°ng c√≥ doanh thu >
                50K ORDER BY order_year, order_month, total_revenue DESC;
              </div>
            </div>

            <div class="success-box">
              <h4>üí° Best Practices:</h4>
              <ul>
                <li>
                  <b>S·ª≠ d·ª•ng alias:</b> ƒê·∫∑t t√™n d·ªÖ hi·ªÉu cho c√°c c·ªôt t√≠nh to√°n
                  (AS total_products)
                </li>
                <li><b>K·∫øt h·ª£p v·ªõi ORDER BY:</b> S·∫Øp x·∫øp k·∫øt qu·∫£ ƒë·ªÉ d·ªÖ ƒë·ªçc</li>
                <li>
                  <b>S·ª≠ d·ª•ng HAVING:</b> L·ªçc c√°c nh√≥m d·ª±a tr√™n k·∫øt qu·∫£ t·ªïng h·ª£p
                </li>
                <li>
                  <b>Nh√≥m th√¥ng minh:</b> Nh√≥m theo c√°c c·ªôt c√≥ √Ω nghƒ©a kinh
                  doanh
                </li>
                <li>
                  <b>Test v·ªõi d·ªØ li·ªáu nh·ªè:</b> Ki·ªÉm tra logic tr∆∞·ªõc khi ch·∫°y v·ªõi
                  d·ªØ li·ªáu l·ªõn
                </li>
              </ul>
            </div>
          </section>

          <!-- 15 -->
          <section class="section" id="functions">
            <h2>15. Function th∆∞·ªùng d√πng</h2>

            <div class="info-box">
              <h4>‚öôÔ∏è T·ªïng quan v·ªÅ Functions:</h4>
              <p>
                SQL cung c·∫•p nhi·ªÅu lo·∫°i h√†m ƒë·ªÉ x·ª≠ l√Ω v√† t√≠nh to√°n d·ªØ li·ªáu. C√°c
                h√†m n√†y ƒë∆∞·ª£c chia th√†nh ba nh√≥m ch√≠nh: <b>H√†m T·ªïng H·ª£p</b>,
                <b>H√†m Chu·ªói</b>, v√† <b>H√†m Ng√†y Gi·ªù</b>.
              </p>
            </div>

            <h3>üìä H√†m T·ªïng H·ª£p (Aggregate Functions)</h3>
            <div class="highlight-box">
              <p>
                C√°c h√†m n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ th·ª±c hi·ªán ph√©p t√≠nh tr√™n
                <b>m·ªôt t·∫≠p h·ª£p c√°c gi√° tr·ªã</b> v√† tr·∫£ v·ªÅ
                <b>m·ªôt gi√° tr·ªã duy nh·∫•t</b>. Ch√∫ng th∆∞·ªùng ƒëi k√®m v·ªõi m·ªánh ƒë·ªÅ
                GROUP BY.
              </p>
            </div>

            <h4>üî¢ COUNT() - ƒê·∫øm s·ªë h√†ng</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> ƒê·∫øm s·ªë h√†ng th·ªèa m√£n ƒëi·ªÅu ki·ªán.</p>
              <div class="code-block">
                -- ƒê·∫øm t·ªïng s·ªë s·∫£n ph·∫©m trong b·∫£ng products SELECT
                COUNT(product_id) AS total_products FROM products; -- ƒê·∫øm s·ªë
                kh√°ch h√†ng c√≥ email (kh√¥ng NULL) SELECT COUNT(email) AS
                customers_with_email FROM customers; -- ƒê·∫øm t·∫•t c·∫£ h√†ng (bao g·ªìm
                NULL) SELECT COUNT(*) AS total_customers FROM customers; -- ƒê·∫øm
                s·ªë s·∫£n ph·∫©m theo t·ª´ng danh m·ª•c SELECT category_id,
                COUNT(product_id) AS products_count FROM products GROUP BY
                category_id;
              </div>
              <p>
                <b>L∆∞u √Ω:</b> COUNT(column) b·ªè qua gi√° tr·ªã NULL, COUNT(*) ƒë·∫øm
                t·∫•t c·∫£ h√†ng.
              </p>
            </div>

            <h4>‚ûï SUM() - T√≠nh t·ªïng</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> T√≠nh t·ªïng c·ªßa m·ªôt c·ªôt s·ªë.</p>
              <div class="code-block">
                -- T√≠nh t·ªïng doanh thu t·ª´ t·∫•t c·∫£ c√°c ƒë∆°n h√†ng SELECT
                SUM(total_amount) AS total_revenue FROM orders; -- T·ªïng s·ªë l∆∞·ª£ng
                s·∫£n ph·∫©m trong kho SELECT SUM(stock_quantity) AS total_inventory
                FROM products; -- T·ªïng doanh thu theo t·ª´ng c·ª≠a h√†ng SELECT
                store_id, SUM(total_amount) AS store_revenue FROM orders GROUP
                BY store_id; -- T·ªïng l∆∞∆°ng theo ph√≤ng ban SELECT department_id,
                SUM(salary) AS total_department_salary FROM employees GROUP BY
                department_id;
              </div>
            </div>

            <h4>üìà AVG() - T√≠nh gi√° tr·ªã trung b√¨nh</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> T√≠nh gi√° tr·ªã trung b√¨nh c·ªßa m·ªôt c·ªôt s·ªë.</p>
              <div class="code-block">
                -- T√≠nh gi√° b√°n trung b√¨nh c·ªßa c√°c s·∫£n ph·∫©m SELECT
                AVG(list_price) AS avg_price FROM products; -- Gi√° tr·ªã ƒë∆°n h√†ng
                trung b√¨nh c·ªßa t·ª´ng kh√°ch h√†ng SELECT customer_id,
                AVG(total_amount) AS avg_order_value FROM orders GROUP BY
                customer_id; -- M·ª©c l∆∞∆°ng trung b√¨nh theo t·ª´ng ph√≤ng ban SELECT
                department_id, AVG(salary) AS avg_salary FROM employees GROUP BY
                department_id; -- ƒêi·ªÉm trung b√¨nh c·ªßa sinh vi√™n SELECT
                student_id, AVG(grade) AS gpa FROM student_grades GROUP BY
                student_id;
              </div>
            </div>

            <h4>‚¨áÔ∏è MIN() - T√¨m gi√° tr·ªã nh·ªè nh·∫•t</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> T√¨m gi√° tr·ªã nh·ªè nh·∫•t c·ªßa m·ªôt c·ªôt.</p>
              <div class="code-block">
                -- T√¨m ng√†y thu√™ nh√¢n vi√™n s·ªõm nh·∫•t SELECT MIN(hire_date) AS
                earliest_hire_date FROM employees; -- Gi√° s·∫£n ph·∫©m r·∫ª nh·∫•t trong
                m·ªói danh m·ª•c SELECT category_id, MIN(list_price) AS
                cheapest_price FROM products GROUP BY category_id; -- Tu·ªïi nh·ªè
                nh·∫•t c·ªßa nh√¢n vi√™n trong m·ªói ph√≤ng ban SELECT department_id,
                MIN(DATEDIFF(YEAR, birth_date, GETDATE())) AS youngest_age FROM
                employees GROUP BY department_id; -- ƒê∆°n h√†ng c√≥ gi√° tr·ªã th·∫•p
                nh·∫•t c·ªßa t·ª´ng kh√°ch h√†ng SELECT customer_id, MIN(total_amount)
                AS smallest_order FROM orders GROUP BY customer_id;
              </div>
            </div>

            <h4>‚¨ÜÔ∏è MAX() - T√¨m gi√° tr·ªã l·ªõn nh·∫•t</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> T√¨m gi√° tr·ªã l·ªõn nh·∫•t c·ªßa m·ªôt c·ªôt.</p>
              <div class="code-block">
                -- T√¨m m·ª©c l∆∞∆°ng cao nh·∫•t SELECT MAX(salary) AS highest_salary
                FROM employees; -- Gi√° s·∫£n ph·∫©m ƒë·∫Øt nh·∫•t trong m·ªói danh m·ª•c
                SELECT category_id, MAX(list_price) AS most_expensive_price FROM
                products GROUP BY category_id; -- ƒê∆°n h√†ng c√≥ gi√° tr·ªã cao nh·∫•t
                c·ªßa t·ª´ng kh√°ch h√†ng SELECT customer_id, MAX(total_amount) AS
                largest_order FROM orders GROUP BY customer_id; -- Ng√†y ƒë·∫∑t h√†ng
                g·∫ßn nh·∫•t SELECT MAX(order_date) AS latest_order_date FROM
                orders;
              </div>
            </div>

            <h3>üî§ H√†m Chu·ªói (String Functions)</h3>
            <div class="highlight-box">
              <p>
                C√°c h√†m n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ
                <b>thao t√°c tr√™n d·ªØ li·ªáu chu·ªói</b> nh∆∞ n·ªëi chu·ªói, t√¨m ƒë·ªô d√†i,
                tr√≠ch xu·∫•t chu·ªói con, v.v.
              </p>
            </div>

            <h4>üîó CONCAT() - N·ªëi chu·ªói</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> N·ªëi hai ho·∫∑c nhi·ªÅu chu·ªói l·∫°i v·ªõi nhau.</p>
              <div class="code-block">
                -- Gh√©p t√™n v√† h·ªç th√†nh m·ªôt c·ªôt t√™n ƒë·∫ßy ƒë·ªß SELECT
                CONCAT(first_name, ' ', last_name) AS full_name FROM customers;
                -- T·∫°o m√£ s·∫£n ph·∫©m ƒë·∫ßy ƒë·ªß SELECT CONCAT('PRD-', category_id,
                '-', product_id) AS full_product_code FROM products; -- T·∫°o ƒë·ªãa
                ch·ªâ ƒë·∫ßy ƒë·ªß SELECT customer_id, CONCAT(street_address, ', ',
                city, ', ', state, ' ', zip_code) AS full_address FROM
                customers; -- T·∫°o th√¥ng tin nh√¢n vi√™n SELECT
                CONCAT(employee_name, ' (', department_name, ')') AS
                employee_info FROM employees e JOIN departments d ON
                e.department_id = d.department_id;
              </div>
            </div>

            <h4>üìè LENGTH() / LEN() - ƒê·ªô d√†i chu·ªói</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> Tr·∫£ v·ªÅ ƒë·ªô d√†i c·ªßa m·ªôt chu·ªói (s·ªë k√Ω t·ª±).</p>
              <div class="code-block">
                -- Tr·∫£ v·ªÅ t√™n s·∫£n ph·∫©m v√† ƒë·ªô d√†i c·ªßa t√™n ƒë√≥ SELECT product_name,
                LEN(product_name) AS name_length FROM products; -- T√¨m kh√°ch
                h√†ng c√≥ t√™n d√†i nh·∫•t SELECT TOP 1 customer_name,
                LEN(customer_name) AS name_length FROM customers ORDER BY
                LEN(customer_name) DESC; -- L·ªçc s·∫£n ph·∫©m c√≥ t√™n ng·∫Øn (d∆∞·ªõi 10 k√Ω
                t·ª±) SELECT product_name FROM products WHERE LEN(product_name) <
                10; -- Th·ªëng k√™ ƒë·ªô d√†i email SELECT AVG(LEN(email)) AS
                avg_email_length, MIN(LEN(email)) AS shortest_email,
                MAX(LEN(email)) AS longest_email FROM customers WHERE email IS
                NOT NULL;
              </div>
            </div>

            <h4>‚úÇÔ∏è SUBSTRING() / SUBSTR() - Tr√≠ch xu·∫•t chu·ªói con</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> Tr√≠ch xu·∫•t m·ªôt chu·ªói con t·ª´ m·ªôt chu·ªói.</p>
              <div class="code-block">
                -- Tr√≠ch xu·∫•t 7 k√Ω t·ª± ƒë·∫ßu ti√™n t·ª´ v·ªã tr√≠ 1 SELECT
                SUBSTRING('Welcome to SQL', 1, 7) AS result; -- K·∫øt qu·∫£:
                'Welcome' -- L·∫•y 3 k√Ω t·ª± ƒë·∫ßu c·ªßa m√£ s·∫£n ph·∫©m SELECT product_id,
                SUBSTRING(product_code, 1, 3) AS category_code FROM products; --
                L·∫•y nƒÉm t·ª´ m√£ ƒë∆°n h√†ng (gi·∫£ s·ª≠ format: ORD-2024-001) SELECT
                order_id, SUBSTRING(order_code, 5, 4) AS order_year FROM orders;
                -- T·∫°o t√™n vi·∫øt t·∫Øt t·ª´ h·ªç t√™n SELECT customer_name,
                SUBSTRING(first_name, 1, 1) + '.' + SUBSTRING(last_name, 1, 1) +
                '.' AS initials FROM customers; -- L·∫•y domain t·ª´ email SELECT
                email, SUBSTRING(email, CHARINDEX('@', email) + 1, LEN(email))
                AS email_domain FROM customers WHERE email IS NOT NULL;
              </div>
            </div>

            <h3>üìÖ H√†m Ng√†y Gi·ªù (Date and Time Functions)</h3>
            <div class="highlight-box">
              <p>
                C√°c h√†m n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ
                <b>l√†m vi·ªác v·ªõi d·ªØ li·ªáu ng√†y v√† gi·ªù</b>. T√™n h√†m c√≥ th·ªÉ thay ƒë·ªïi
                t√πy thu·ªôc v√†o h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu (MySQL, SQL Server,
                PostgreSQL, v.v.).
              </p>
            </div>

            <h4>üìÜ CURRENT_DATE() / GETDATE() - Ng√†y hi·ªán t·∫°i</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> Tr·∫£ v·ªÅ ng√†y hi·ªán t·∫°i c·ªßa h·ªá th·ªëng.</p>
              <div class="code-block">
                -- SQL Server SELECT GETDATE() AS current_datetime; -- MySQL /
                PostgreSQL SELECT CURRENT_DATE() AS current_date; SELECT NOW()
                AS current_datetime; -- T√≠nh tu·ªïi nh√¢n vi√™n SELECT
                employee_name, birth_date, DATEDIFF(YEAR, birth_date, GETDATE())
                AS age FROM employees; -- T·∫°o b·∫£n ghi v·ªõi timestamp INSERT INTO
                audit_log (action, created_date) VALUES ('User Login',
                GETDATE()); -- L·ªçc ƒë∆°n h√†ng trong 30 ng√†y qua SELECT * FROM
                orders WHERE order_date >= DATEADD(DAY, -30, GETDATE());
              </div>
            </div>

            <h4>‚ûï DATEADD() / DATE_ADD() - C·ªông th·ªùi gian</h4>
            <div class="example">
              <p>
                <b>Ch·ª©c nƒÉng:</b> C·ªông th√™m m·ªôt kho·∫£ng th·ªùi gian v√†o m·ªôt ng√†y.
              </p>
              <div class="code-block">
                -- SQL Server: Tr·∫£ v·ªÅ ng√†y sau 30 ng√†y k·ªÉ t·ª´ ng√†y hi·ªán t·∫°i
                SELECT DATEADD(DAY, 30, GETDATE()) AS date_after_30_days; --
                T√≠nh ng√†y h·∫øt h·∫°n h·ª£p ƒë·ªìng (2 nƒÉm sau ng√†y k√Ω) SELECT
                employee_name, hire_date, DATEADD(YEAR, 2, hire_date) AS
                contract_expiry FROM employees; -- MySQL: C·ªông th√™m 1 th√°ng
                SELECT DATE_ADD(order_date, INTERVAL 1 MONTH) AS follow_up_date
                FROM orders; -- T√≠nh ng√†y giao h√†ng d·ª± ki·∫øn (7 ng√†y sau ƒë·∫∑t
                h√†ng) SELECT order_id, order_date, DATEADD(DAY, 7, order_date)
                AS expected_delivery_date FROM orders; -- L·ªçc nh√¢n vi√™n s·∫Øp ngh·ªâ
                h∆∞u (trong 1 nƒÉm t·ªõi, gi·∫£ s·ª≠ 65 tu·ªïi) SELECT employee_name,
                birth_date FROM employees WHERE DATEADD(YEAR, 65, birth_date) <=
                DATEADD(YEAR, 1, GETDATE());
              </div>
            </div>

            <h4>üìä DATEDIFF() - T√≠nh kho·∫£ng c√°ch th·ªùi gian</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b> T√≠nh kho·∫£ng th·ªùi gian gi·ªØa hai ng√†y.</p>
              <div class="code-block">
                -- Tr·∫£ v·ªÅ s·ªë ng√†y ƒë√£ tr√¥i qua k·ªÉ t·ª´ ng√†y 01/01/2025 ƒë·∫øn nay
                SELECT DATEDIFF(DAY, '2025-01-01', GETDATE()) AS days_passed; --
                T√≠nh s·ªë nƒÉm l√†m vi·ªác c·ªßa nh√¢n vi√™n SELECT employee_name,
                hire_date, DATEDIFF(YEAR, hire_date, GETDATE()) AS
                years_of_service FROM employees; -- T√≠nh th·ªùi gian x·ª≠ l√Ω ƒë∆°n
                h√†ng (gi·ªù) SELECT order_id, order_date, shipped_date,
                DATEDIFF(HOUR, order_date, shipped_date) AS processing_hours
                FROM orders WHERE shipped_date IS NOT NULL; -- T√¨m kh√°ch h√†ng
                l√¢u kh√¥ng mua h√†ng SELECT customer_id, customer_name,
                MAX(order_date) AS last_order_date, DATEDIFF(DAY,
                MAX(order_date), GETDATE()) AS days_since_last_order FROM
                customers c LEFT JOIN orders o ON c.customer_id = o.customer_id
                GROUP BY customer_id, customer_name HAVING DATEDIFF(DAY,
                MAX(order_date), GETDATE()) > 365;
              </div>
            </div>

            <h4>üóìÔ∏è DATEPART() / EXTRACT() - Tr√≠ch xu·∫•t ph·∫ßn ng√†y</h4>
            <div class="example">
              <p>
                <b>Ch·ª©c nƒÉng:</b> Tr√≠ch xu·∫•t m·ªôt ph·∫ßn c·ªßa ng√†y (v√≠ d·ª•: nƒÉm,
                th√°ng, ng√†y).
              </p>
              <div class="code-block">
                -- SQL Server: Tr·∫£ v·ªÅ nƒÉm c·ªßa m·ªói ƒë∆°n h√†ng SELECT order_id,
                order_date, DATEPART(YEAR, order_date) AS order_year,
                DATEPART(MONTH, order_date) AS order_month, DATEPART(DAY,
                order_date) AS order_day FROM orders; -- PostgreSQL: S·ª≠ d·ª•ng
                EXTRACT SELECT order_id, EXTRACT(YEAR FROM order_date) AS
                order_year, EXTRACT(MONTH FROM order_date) AS order_month FROM
                orders; -- Ph√¢n t√≠ch doanh thu theo th√°ng SELECT DATEPART(YEAR,
                order_date) AS year, DATEPART(MONTH, order_date) AS month,
                SUM(total_amount) AS monthly_revenue FROM orders GROUP BY
                DATEPART(YEAR, order_date), DATEPART(MONTH, order_date) ORDER BY
                year, month; -- T√¨m ng√†y trong tu·∫ßn b√°n ch·∫°y nh·∫•t SELECT
                DATEPART(WEEKDAY, order_date) AS day_of_week, COUNT(*) AS
                order_count FROM orders GROUP BY DATEPART(WEEKDAY, order_date)
                ORDER BY order_count DESC;
              </div>
            </div>

            <h4>üé® FORMAT() - ƒê·ªãnh d·∫°ng ng√†y</h4>
            <div class="example">
              <p>
                <b>Ch·ª©c nƒÉng:</b> ƒê·ªãnh d·∫°ng ng√†y th√†nh m·ªôt chu·ªói theo format
                mong mu·ªën.
              </p>
              <div class="code-block">
                -- Tr·∫£ v·ªÅ ng√†y hi·ªán t·∫°i d∆∞·ªõi d·∫°ng chu·ªói '21-09-2025' SELECT
                FORMAT(GETDATE(), 'dd-MM-yyyy') AS formatted_date; -- C√°c format
                kh√°c nhau SELECT GETDATE() AS original_date, FORMAT(GETDATE(),
                'dd/MM/yyyy') AS format1, FORMAT(GETDATE(), 'yyyy-MM-dd') AS
                format2, FORMAT(GETDATE(), 'MMMM dd, yyyy') AS format3,
                FORMAT(GETDATE(), 'dddd, MMMM dd, yyyy') AS format4; -- Format
                trong b√°o c√°o SELECT order_id, customer_name, FORMAT(order_date,
                'dd/MM/yyyy') AS order_date_formatted, FORMAT(total_amount, 'C',
                'vi-VN') AS amount_formatted FROM orders o JOIN customers c ON
                o.customer_id = c.customer_id; -- T·∫°o t√™n file backup theo ng√†y
                SELECT CONCAT('backup_', FORMAT(GETDATE(), 'yyyyMMdd'), '.sql')
                AS backup_filename;
              </div>
            </div>

            <h3>üîß V√≠ d·ª• t·ªïng h·ª£p: B√°o c√°o b√°n h√†ng ƒëa ch·ª©c nƒÉng</h3>
            <div class="example">
              <h4>K·ªãch b·∫£n: B√°o c√°o chi ti·∫øt v·ªõi t·∫•t c·∫£ lo·∫°i functions</h4>
              <div class="code-block">
                SELECT -- String functions CONCAT(c.first_name, ' ',
                c.last_name) AS customer_full_name, LEFT(c.email, CHARINDEX('@',
                c.email) - 1) AS email_username, -- Date functions
                FORMAT(o.order_date, 'MMMM yyyy') AS order_month_year,
                DATEDIFF(DAY, o.order_date, GETDATE()) AS days_since_order, --
                Aggregate functions COUNT(od.product_id) AS total_items,
                SUM(od.quantity * od.unit_price) AS order_total,
                AVG(od.unit_price) AS avg_item_price, MIN(od.unit_price) AS
                cheapest_item, MAX(od.unit_price) AS most_expensive_item FROM
                customers c JOIN orders o ON c.customer_id = o.customer_id JOIN
                order_details od ON o.order_id = od.order_id WHERE o.order_date
                >= DATEADD(MONTH, -6, GETDATE()) -- 6 th√°ng g·∫ßn ƒë√¢y GROUP BY
                c.customer_id, c.first_name, c.last_name, c.email, o.order_id,
                o.order_date HAVING SUM(od.quantity * od.unit_price) > 1000 --
                ƒê∆°n h√†ng > 1000 ORDER BY order_total DESC;
              </div>
            </div>

            <div class="success-box">
              <h4>üí° Best Practices cho Functions:</h4>
              <ul>
                <li>
                  <b>Hi·ªáu su·∫•t:</b> Tr√°nh s·ª≠ d·ª•ng functions trong WHERE clause
                  v·ªõi c·ªôt ƒë∆∞·ª£c index
                </li>
                <li>
                  <b>NULL handling:</b> Lu√¥n ki·ªÉm tra NULL tr∆∞·ªõc khi s·ª≠ d·ª•ng
                  string/date functions
                </li>
                <li>
                  <b>Database specific:</b> Ch√∫ √Ω s·ª± kh√°c bi·ªát gi·ªØa c√°c h·ªá CSDL
                  (MySQL, SQL Server, PostgreSQL)
                </li>
                <li>
                  <b>Alias:</b> S·ª≠ d·ª•ng alias c√≥ √Ω nghƒ©a cho k·∫øt qu·∫£ functions
                </li>
                <li>
                  <b>Testing:</b> Test functions v·ªõi d·ªØ li·ªáu edge cases (NULL,
                  empty string, extreme dates)
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω v·ªÅ t∆∞∆°ng th√≠ch:</h4>
              <p>M·ªôt s·ªë functions c√≥ t√™n kh√°c nhau gi·ªØa c√°c h·ªá CSDL:</p>
              <ul>
                <li>
                  <b>SQL Server:</b> LEN(), GETDATE(), DATEPART(), FORMAT()
                </li>
                <li><b>MySQL:</b> LENGTH(), NOW(), EXTRACT(), DATE_FORMAT()</li>
                <li>
                  <b>PostgreSQL:</b> LENGTH(), NOW(), EXTRACT(), TO_CHAR()
                </li>
                <li><b>Oracle:</b> LENGTH(), SYSDATE, EXTRACT(), TO_CHAR()</li>
              </ul>
            </div>
          </section>

          <!-- 16 -->
          <section class="section" id="join">
            <h2>16. JOIN</h2>

            <div class="info-box">
              <h4>üîó JOIN l√† g√¨?</h4>
              <p>
                <b>JOIN</b> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ k·∫øt h·ª£p c√°c h√†ng t·ª´ hai ho·∫∑c nhi·ªÅu
                b·∫£ng d·ª±a tr√™n m·ªôt c·ªôt li√™n quan gi·ªØa ch√∫ng. M·ª•c ƒë√≠ch c·ªßa JOIN l√†
                l·∫•y d·ªØ li·ªáu t·ª´ nhi·ªÅu b·∫£ng v√† hi·ªÉn th·ªã ch√∫ng trong m·ªôt t·∫≠p h·ª£p
                k·∫øt qu·∫£ duy nh·∫•t.
              </p>
            </div>

            <div class="highlight-box">
              <h4>üìã C√°c lo·∫°i JOIN ch√≠nh:</h4>
              <p>
                C√≥ <b>b·ªën lo·∫°i JOIN ch√≠nh</b>: INNER JOIN, LEFT JOIN, RIGHT
                JOIN, v√† FULL JOIN. Ngo√†i ra, c√≤n c√≥ <b>CROSS JOIN</b>.
              </p>
            </div>

            <h3>üîÑ 1. INNER JOIN</h3>
            <div class="highlight-box">
              <p>
                <b>INNER JOIN</b> tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c h√†ng khi c√≥ s·ª± kh·ªõp nhau
                trong c·∫£ hai b·∫£ng. N√≥ l√† lo·∫°i JOIN ph·ªï bi·∫øn nh·∫•t v√† th∆∞·ªùng ƒë∆∞·ª£c
                s·ª≠ d·ª•ng m·∫∑c ƒë·ªãnh n·∫øu b·∫°n kh√¥ng ch·ªâ ƒë·ªãnh lo·∫°i JOIN n√†o.
              </p>
              <p>
                <b>Ho·∫°t ƒë·ªông:</b> L·∫•y c√°c h√†ng t·ª´ b·∫£ng A v√† b·∫£ng B ch·ªâ khi c√≥
                gi√° tr·ªã t∆∞∆°ng ·ª©ng trong c·∫£ hai b·∫£ng d·ª±a tr√™n ƒëi·ªÅu ki·ªán ON.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• INNER JOIN:</h4>
              <p>
                <b>B√†i to√°n:</b> T√¨m t·∫•t c·∫£ c√°c ƒë∆°n h√†ng v√† th√¥ng tin kh√°ch h√†ng
                t∆∞∆°ng ·ª©ng.
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">o.order_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>, <span class="column">o.order_date</span>, <span class="column">o.total_amount</span>
                <span class="keyword">FROM</span> <span class="table">orders</span> <span class="column">o</span>
                <span class="keyword">INNER JOIN</span> <span class="table">customers</span> <span class="column">c</span> <span class="keyword">ON</span> <span class="column">o.customer_id</span> <span class="operator">=</span> <span class="column">c.customer_id</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> L·ªánh n√†y s·∫Ω ch·ªâ tr·∫£ v·ªÅ c√°c ƒë∆°n h√†ng c√≥
                customer_id t·ªìn t·∫°i trong b·∫£ng customers. N·∫øu c√≥ ƒë∆°n h√†ng kh√¥ng
                c√≥ kh√°ch h√†ng (ho·∫∑c ng∆∞·ª£c l·∫°i), n√≥ s·∫Ω kh√¥ng xu·∫•t hi·ªán trong k·∫øt
                qu·∫£.
              </p>
            </div>

            <div class="example">
              <h4>INNER JOIN v·ªõi nhi·ªÅu b·∫£ng:</h4>
              <div class="code-block">
                <span class="comment">-- L·∫•y th√¥ng tin ƒë∆°n h√†ng, kh√°ch h√†ng v√† chi ti·∫øt s·∫£n ph·∫©m</span>
                <span class="keyword">SELECT</span> <span class="column">o.order_id</span>, <span class="column">c.customer_name</span>, <span class="column">p.product_name</span>, 
                       <span class="column">od.quantity</span>, <span class="column">od.unit_price</span>, 
                       (<span class="column">od.quantity</span> <span class="operator">*</span> <span class="column">od.unit_price</span>) <span class="keyword">AS</span> <span class="column">line_total</span>
                <span class="keyword">FROM</span> <span class="table">orders</span> <span class="column">o</span>
                <span class="keyword">INNER JOIN</span> <span class="table">customers</span> <span class="column">c</span> <span class="keyword">ON</span> <span class="column">o.customer_id</span> <span class="operator">=</span> <span class="column">c.customer_id</span>
                <span class="keyword">INNER JOIN</span> <span class="table">order_details</span> <span class="column">od</span> <span class="keyword">ON</span> <span class="column">o.order_id</span> <span class="operator">=</span> <span class="column">od.order_id</span>
                <span class="keyword">INNER JOIN</span> <span class="table">products</span> <span class="column">p</span> <span class="keyword">ON</span> <span class="column">od.product_id</span> <span class="operator">=</span> <span class="column">p.product_id</span>
                <span class="keyword">WHERE</span> <span class="column">o.order_date</span> <span class="operator">>=</span> <span class="string">'2024-01-01'</span>;
              </div>
            </div>

            <h3>‚¨ÖÔ∏è 2. LEFT JOIN (LEFT OUTER JOIN)</h3>
            <div class="highlight-box">
              <p>
                <b>LEFT JOIN</b> tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c h√†ng t·ª´ b·∫£ng b√™n tr√°i (b·∫£ng
                ƒë·∫ßu ti√™n trong FROM) v√† c√°c h√†ng kh·ªõp t·ª´ b·∫£ng b√™n ph·∫£i. N·∫øu
                kh√¥ng c√≥ s·ª± kh·ªõp n√†o, c√°c c·ªôt t·ª´ b·∫£ng b√™n ph·∫£i s·∫Ω c√≥ gi√° tr·ªã
                NULL.
              </p>
              <p>
                <b>Ho·∫°t ƒë·ªông:</b> Gi·ªØ l·∫°i t·∫•t c·∫£ c√°c h√†ng t·ª´ b·∫£ng b√™n tr√°i v√†
                t√¨m c√°c h√†ng kh·ªõp t·ª´ b·∫£ng b√™n ph·∫£i.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• LEFT JOIN:</h4>
              <p>
                <b>B√†i to√°n:</b> L·∫•y t·∫•t c·∫£ kh√°ch h√†ng v√† c√°c ƒë∆°n h√†ng c·ªßa h·ªç
                (n·∫øu c√≥).
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">c.customer_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>, 
                       <span class="column">o.order_id</span>, <span class="column">o.order_date</span>, <span class="column">o.total_amount</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">LEFT JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>
                <span class="keyword">ORDER BY</span> <span class="column">c.customer_id</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> L·ªánh n√†y s·∫Ω tr·∫£ v·ªÅ t·∫•t c·∫£ kh√°ch h√†ng. Nh·ªØng
                kh√°ch h√†ng ƒë√£ c√≥ ƒë∆°n h√†ng s·∫Ω hi·ªÉn th·ªã order_id t∆∞∆°ng ·ª©ng, c√≤n
                nh·ªØng kh√°ch h√†ng ch∆∞a c√≥ ƒë∆°n h√†ng th√¨ c√°c c·ªôt ƒë∆°n h√†ng s·∫Ω l√†
                NULL.
              </p>
            </div>

            <div class="example">
              <h4>T√¨m kh√°ch h√†ng ch∆∞a c√≥ ƒë∆°n h√†ng:</h4>
              <div class="code-block">
                <span class="comment">-- S·ª≠ d·ª•ng LEFT JOIN ƒë·ªÉ t√¨m kh√°ch h√†ng ch∆∞a mua h√†ng</span>
                <span class="keyword">SELECT</span> <span class="column">c.customer_id</span>, <span class="column">c.customer_name</span>, <span class="column">c.email</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">LEFT JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>
                <span class="keyword">WHERE</span> <span class="column">o.customer_id</span> <span class="keyword">IS NULL</span>; <span class="comment">-- ƒêi·ªÅu ki·ªán ƒë·ªÉ t√¨m kh√°ch h√†ng ch∆∞a c√≥ ƒë∆°n h√†ng</span>
              </div>
            </div>

            <h3>‚û°Ô∏è 3. RIGHT JOIN (RIGHT OUTER JOIN)</h3>
            <div class="highlight-box">
              <p>
                <b>RIGHT JOIN</b> ho·∫°t ƒë·ªông t∆∞∆°ng t·ª± nh∆∞ LEFT JOIN, nh∆∞ng n√≥ gi·ªØ
                l·∫°i t·∫•t c·∫£ c√°c h√†ng t·ª´ b·∫£ng b√™n ph·∫£i. N·∫øu kh√¥ng c√≥ s·ª± kh·ªõp n√†o,
                c√°c c·ªôt t·ª´ b·∫£ng b√™n tr√°i s·∫Ω c√≥ gi√° tr·ªã NULL.
              </p>
              <p>
                <b>Ho·∫°t ƒë·ªông:</b> Gi·ªØ l·∫°i t·∫•t c·∫£ c√°c h√†ng t·ª´ b·∫£ng b√™n ph·∫£i v√†
                t√¨m c√°c h√†ng kh·ªõp t·ª´ b·∫£ng b√™n tr√°i.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• RIGHT JOIN:</h4>
              <p>
                <b>B√†i to√°n:</b> L·∫•y t·∫•t c·∫£ c√°c ƒë∆°n h√†ng v√† th√¥ng tin kh√°ch h√†ng
                c·ªßa h·ªç.
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">o.order_id</span>, <span class="column">o.order_date</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>, <span class="column">c.email</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">RIGHT JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>
                <span class="keyword">ORDER BY</span> <span class="column">o.order_id</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> L·ªánh n√†y s·∫Ω tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c ƒë∆°n h√†ng. N·∫øu c√≥
                ƒë∆°n h√†ng n√†o kh√¥ng c√≥ kh√°ch h√†ng t∆∞∆°ng ·ª©ng (v√≠ d·ª•: customer_id
                l√† NULL), th√¨ c√°c c·ªôt c·ªßa kh√°ch h√†ng s·∫Ω l√† NULL.
              </p>
            </div>

            <div class="example">
              <h4>T√¨m ƒë∆°n h√†ng kh√¥ng c√≥ kh√°ch h√†ng:</h4>
              <div class="code-block">
                -- T√¨m ƒë∆°n h√†ng c√≥ d·ªØ li·ªáu b·∫•t th∆∞·ªùng (kh√¥ng c√≥ customer_id h·ª£p
                l·ªá) SELECT o.order_id, o.order_date, o.total_amount FROM
                customers c RIGHT JOIN orders o ON c.customer_id = o.customer_id
                WHERE c.customer_id IS NULL;
              </div>
            </div>

            <h3>üîÑ 4. FULL JOIN (FULL OUTER JOIN)</h3>
            <div class="highlight-box">
              <p>
                <b>FULL JOIN</b> tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c h√†ng khi c√≥ s·ª± kh·ªõp trong b·∫•t
                k·ª≥ b·∫£ng n√†o. C√°c h√†ng kh√¥ng kh·ªõp s·∫Ω hi·ªÉn th·ªã gi√° tr·ªã NULL ·ªü c√°c
                c·ªôt t∆∞∆°ng ·ª©ng.
              </p>
              <p><b>Ho·∫°t ƒë·ªông:</b> K·∫øt h·ª£p c·∫£ LEFT JOIN v√† RIGHT JOIN.</p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• FULL JOIN:</h4>
              <p>
                <b>B√†i to√°n:</b> L·∫•y t·∫•t c·∫£ kh√°ch h√†ng v√† t·∫•t c·∫£ ƒë∆°n h√†ng, hi·ªÉn
                th·ªã c·∫£ nh·ªØng kh√°ch h√†ng ch∆∞a c√≥ ƒë∆°n h√†ng v√† nh·ªØng ƒë∆°n h√†ng ch∆∞a
                c√≥ kh√°ch h√†ng.
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">c.customer_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>, 
                       <span class="column">o.order_id</span>, <span class="column">o.order_date</span>, <span class="column">o.total_amount</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">FULL JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>
                <span class="keyword">ORDER BY</span> <span class="column">c.customer_id</span>, <span class="column">o.order_id</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> Hi·ªÉn th·ªã t·∫•t c·∫£ kh√°ch h√†ng (k·ªÉ c·∫£ ch∆∞a c√≥ ƒë∆°n
                h√†ng) v√† t·∫•t c·∫£ ƒë∆°n h√†ng (k·ªÉ c·∫£ kh√¥ng c√≥ kh√°ch h√†ng).
              </p>
            </div>

            <div class="example">
              <h4>Ph√¢n t√≠ch d·ªØ li·ªáu v·ªõi FULL JOIN:</h4>
              <div class="code-block">
                <span class="comment">-- T√¨m t·∫•t c·∫£ c√°c tr∆∞·ªùng h·ª£p b·∫•t th∆∞·ªùng</span>
                <span class="keyword">SELECT</span> 
                    <span class="keyword">CASE</span> 
                        <span class="keyword">WHEN</span> <span class="column">c.customer_id</span> <span class="keyword">IS NULL</span> <span class="keyword">THEN</span> <span class="string">'ƒê∆°n h√†ng kh√¥ng c√≥ kh√°ch h√†ng'</span>
                        <span class="keyword">WHEN</span> <span class="column">o.order_id</span> <span class="keyword">IS NULL</span> <span class="keyword">THEN</span> <span class="string">'Kh√°ch h√†ng ch∆∞a c√≥ ƒë∆°n h√†ng'</span>
                        <span class="keyword">ELSE</span> <span class="string">'D·ªØ li·ªáu b√¨nh th∆∞·ªùng'</span>
                    <span class="keyword">END</span> <span class="keyword">AS</span> <span class="column">data_status</span>,
                    <span class="column">c.customer_name</span>, <span class="column">o.order_id</span>, <span class="column">o.total_amount</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">FULL JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>
                <span class="keyword">WHERE</span> <span class="column">c.customer_id</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">o.order_id</span> <span class="keyword">IS NULL</span>;
              </div>
            </div>

            <h3>‚ùå 5. CROSS JOIN</h3>
            <div class="highlight-box">
              <p>
                <b>CROSS JOIN</b> t·∫°o ra m·ªôt t√≠ch ƒê·ªÅ-c√°c (Cartesian product) c·ªßa
                hai b·∫£ng. N√≥ k·∫øt h·ª£p m·ªçi h√†ng c·ªßa b·∫£ng th·ª© nh·∫•t v·ªõi m·ªçi h√†ng c·ªßa
                b·∫£ng th·ª© hai.
              </p>
              <p>
                <b>Ho·∫°t ƒë·ªông:</b> Kh√¥ng c·∫ßn ƒëi·ªÅu ki·ªán ON. N√≥ t·∫°o ra m·ªôt t·∫≠p h·ª£p
                k·∫øt qu·∫£ r·∫•t l·ªõn.
              </p>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• CROSS JOIN:</h4>
              <p>
                <b>B√†i to√°n:</b> L·∫•y t·∫•t c·∫£ c√°c s·∫£n ph·∫©m v√† k·∫øt h·ª£p v·ªõi t·∫•t c·∫£
                c√°c th∆∞∆°ng hi·ªáu.
              </p>
              <div class="code-block">
                <span class="keyword">SELECT</span> <span class="column">p.product_name</span>, <span class="column">b.brand_name</span>, 
                       <span class="function">CONCAT</span>(<span class="column">b.brand_name</span>, <span class="string">' - '</span>, <span class="column">p.product_name</span>) <span class="keyword">AS</span> <span class="column">full_product_name</span>
                <span class="keyword">FROM</span> <span class="table">products</span> <span class="column">p</span>
                <span class="keyword">CROSS JOIN</span> <span class="table">brands</span> <span class="column">b</span>;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> N·∫øu b·∫£ng products c√≥ 100 s·∫£n ph·∫©m v√† b·∫£ng brands
                c√≥ 10 th∆∞∆°ng hi·ªáu, k·∫øt qu·∫£ s·∫Ω c√≥ 1000 h√†ng. Lo·∫°i JOIN n√†y √≠t khi
                ƒë∆∞·ª£c s·ª≠ d·ª•ng, th∆∞·ªùng d√πng ƒë·ªÉ ki·ªÉm tra ho·∫∑c t·∫°o d·ªØ li·ªáu m·∫´u.
              </p>
            </div>

            <div class="example">
              <h4>·ª®ng d·ª•ng th·ª±c t·∫ø c·ªßa CROSS JOIN:</h4>
              <div class="code-block">
                <span class="comment">-- T·∫°o l·ªãch l√†m vi·ªác cho t·∫•t c·∫£ nh√¢n vi√™n trong th√°ng</span>
                <span class="keyword">SELECT</span> <span class="column">e.employee_name</span>, <span class="column">d.work_date</span>, <span class="string">'Available'</span> <span class="keyword">AS</span> <span class="column">status</span>
                <span class="keyword">FROM</span> <span class="table">employees</span> <span class="column">e</span>
                <span class="keyword">CROSS JOIN</span> (
                    <span class="keyword">SELECT</span> <span class="function">DATEADD</span>(<span class="keyword">DAY</span>, <span class="column">number</span>, <span class="string">'2025-01-01'</span>) <span class="keyword">AS</span> <span class="column">work_date</span>
                    <span class="keyword">FROM</span> <span class="table">master.dbo.spt_values</span> 
                    <span class="keyword">WHERE</span> <span class="column">type</span> <span class="operator">=</span> <span class="string">'P'</span> <span class="keyword">AND</span> <span class="column">number</span> <span class="operator"><</span> <span class="number">31</span>
                ) <span class="column">d</span>
                <span class="keyword">WHERE</span> <span class="function">DATEPART</span>(<span class="keyword">WEEKDAY</span>, <span class="column">d.work_date</span>) <span class="keyword">NOT IN</span> (<span class="number">1</span>, <span class="number">7</span>); <span class="comment">-- Lo·∫°i b·ªè ch·ªß nh·∫≠t v√† th·ª© 7</span>
              </div>
            </div>

            <h3>üìä So s√°nh c√°c lo·∫°i JOIN</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>Lo·∫°i JOIN</th>
                  <th>K·∫øt qu·∫£</th>
                  <th>Khi n√†o s·ª≠ d·ª•ng</th>
                  <th>NULL xu·∫•t hi·ªán</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>INNER JOIN</b></td>
                  <td>Ch·ªâ h√†ng kh·ªõp ·ªü c·∫£ 2 b·∫£ng</td>
                  <td>L·∫•y d·ªØ li·ªáu c√≥ li√™n k·∫øt ch·∫Øc ch·∫Øn</td>
                  <td>Kh√¥ng</td>
                </tr>
                <tr>
                  <td><b>LEFT JOIN</b></td>
                  <td>T·∫•t c·∫£ h√†ng b·∫£ng tr√°i + kh·ªõp b·∫£ng ph·∫£i</td>
                  <td>Gi·ªØ t·∫•t c·∫£ d·ªØ li·ªáu ch√≠nh, t√¨m li√™n k·∫øt</td>
                  <td>B·∫£ng ph·∫£i</td>
                </tr>
                <tr>
                  <td><b>RIGHT JOIN</b></td>
                  <td>T·∫•t c·∫£ h√†ng b·∫£ng ph·∫£i + kh·ªõp b·∫£ng tr√°i</td>
                  <td>√çt d√πng, th∆∞·ªùng thay b·∫±ng LEFT JOIN</td>
                  <td>B·∫£ng tr√°i</td>
                </tr>
                <tr>
                  <td><b>FULL JOIN</b></td>
                  <td>T·∫•t c·∫£ h√†ng t·ª´ c·∫£ 2 b·∫£ng</td>
                  <td>Ph√¢n t√≠ch ƒë·∫ßy ƒë·ªß, t√¨m d·ªØ li·ªáu thi·∫øu</td>
                  <td>C·∫£ 2 b·∫£ng</td>
                </tr>
                <tr>
                  <td><b>CROSS JOIN</b></td>
                  <td>T√≠ch ƒê·ªÅ-c√°c c·ªßa 2 b·∫£ng</td>
                  <td>T·∫°o d·ªØ li·ªáu m·∫´u, l·ªãch l√†m vi·ªác</td>
                  <td>Kh√¥ng</td>
                </tr>
              </tbody>
            </table>

            <h3>üîß V√≠ d·ª• th·ª±c t·∫ø: H·ªá th·ªëng qu·∫£n l√Ω b√°n h√†ng</h3>
            <div class="example">
              <h4>B√°o c√°o doanh thu t·ªïng h·ª£p:</h4>
              <div class="code-block">
                -- S·ª≠ d·ª•ng nhi·ªÅu lo·∫°i JOIN trong m·ªôt truy v·∫•n SELECT
                s.store_name, c.customer_name, p.product_name,
                cat.category_name, o.order_date, od.quantity, od.unit_price,
                (od.quantity * od.unit_price) AS line_total, o.total_amount FROM
                stores s LEFT JOIN orders o ON s.store_id = o.store_id -- Gi·ªØ
                t·∫•t c·∫£ c·ª≠a h√†ng LEFT JOIN customers c ON o.customer_id =
                c.customer_id -- Th√¥ng tin kh√°ch h√†ng LEFT JOIN order_details od
                ON o.order_id = od.order_id -- Chi ti·∫øt ƒë∆°n h√†ng LEFT JOIN
                products p ON od.product_id = p.product_id -- Th√¥ng tin s·∫£n ph·∫©m
                LEFT JOIN categories cat ON p.category_id = cat.category_id --
                Danh m·ª•c WHERE o.order_date >= DATEADD(MONTH, -3, GETDATE()) --
                3 th√°ng g·∫ßn ƒë√¢y ORDER BY s.store_name, o.order_date DESC;
              </div>
            </div>

            <div class="example">
              <h4>Ph√¢n t√≠ch kh√°ch h√†ng v√† ƒë∆°n h√†ng:</h4>
              <div class="code-block">
                -- T√¨m th√¥ng tin kh√°ch h√†ng v√† th·ªëng k√™ ƒë∆°n h√†ng SELECT
                c.customer_id, c.customer_name, c.email, COUNT(o.order_id) AS
                total_orders, COALESCE(SUM(o.total_amount), 0) AS total_spent,
                COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
                MAX(o.order_date) AS last_order_date, CASE WHEN
                COUNT(o.order_id) = 0 THEN 'Ch∆∞a mua h√†ng' WHEN
                COUNT(o.order_id) >= 10 THEN 'VIP' WHEN COUNT(o.order_id) >= 5
                THEN 'Th√¢n thi·∫øt' ELSE 'Th∆∞·ªùng' END AS customer_tier FROM
                customers c LEFT JOIN orders o ON c.customer_id = o.customer_id
                GROUP BY c.customer_id, c.customer_name, c.email ORDER BY
                total_spent DESC;
              </div>
            </div>

            <h3>üîç Self JOIN</h3>
            <div class="example">
              <h4>JOIN b·∫£ng v·ªõi ch√≠nh n√≥:</h4>
              <p><b>B√†i to√°n:</b> T√¨m nh√¢n vi√™n v√† ng∆∞·ªùi qu·∫£n l√Ω c·ªßa h·ªç.</p>
              <div class="code-block">
                -- Self JOIN ƒë·ªÉ t√¨m quan h·ªá c·∫•p b·∫≠c SELECT e.employee_name AS
                employee, m.employee_name AS manager, e.salary AS
                employee_salary, m.salary AS manager_salary FROM employees e
                LEFT JOIN employees m ON e.manager_id = m.employee_id ORDER BY
                m.employee_name, e.employee_name;
              </div>
            </div>

            <div class="success-box">
              <h4>üí° Best Practices cho JOIN:</h4>
              <ul>
                <li>
                  <b>S·ª≠ d·ª•ng alias:</b> ƒê·∫∑t t√™n ng·∫Øn g·ªçn cho b·∫£ng (customers c,
                  orders o)
                </li>
                <li>
                  <b>Ch·ªâ ƒë·ªãnh c·ªôt r√µ r√†ng:</b> D√πng table.column ƒë·ªÉ tr√°nh nh·∫ßm
                  l·∫´n
                </li>
                <li>
                  <b>Index:</b> ƒê·∫£m b·∫£o c√≥ index tr√™n c√°c c·ªôt JOIN ƒë·ªÉ tƒÉng hi·ªáu
                  su·∫•t
                </li>
                <li>
                  <b>ƒêi·ªÅu ki·ªán WHERE:</b> ƒê·∫∑t ƒëi·ªÅu ki·ªán l·ªçc sau JOIN ƒë·ªÉ t·ªëi ∆∞u
                </li>
                <li><b>LEFT JOIN thay RIGHT JOIN:</b> D·ªÖ ƒë·ªçc v√† hi·ªÉu h∆°n</li>
                <li>
                  <b>COALESCE/ISNULL:</b> X·ª≠ l√Ω gi√° tr·ªã NULL t·ª´ OUTER JOIN
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <ul>
                <li>
                  <b>Hi·ªáu su·∫•t:</b> CROSS JOIN c√≥ th·ªÉ t·∫°o ra k·∫øt qu·∫£ r·∫•t l·ªõn,
                  c·∫©n th·∫≠n khi s·ª≠ d·ª•ng
                </li>
                <li>
                  <b>NULL values:</b> Lu√¥n ki·ªÉm tra v√† x·ª≠ l√Ω NULL t·ª´ OUTER JOIN
                </li>
                <li>
                  <b>Duplicate keys:</b> Ch√∫ √Ω khi JOIN v·ªõi b·∫£ng c√≥ kh√≥a tr√πng
                  l·∫∑p
                </li>
                <li>
                  <b>Order of JOINs:</b> Th·ª© t·ª± JOIN c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu
                  su·∫•t
                </li>
              </ul>
            </div>
          </section>

          <!-- 17 -->
          <section class="section" id="view">
            <h2>17. VIEW</h2>

            <div class="info-box">
              <h4>üëÅÔ∏è VIEW l√† g√¨?</h4>
              <p>
                <b>VIEW</b> c√≥ th·ªÉ ƒë∆∞·ª£c xem nh∆∞ m·ªôt
                <b>b·∫£ng ·∫£o (virtual table)</b> d·ª±a tr√™n k·∫øt qu·∫£ c·ªßa m·ªôt c√¢u l·ªánh
                truy v·∫•n SQL. N√≥ kh√¥ng ch·ª©a d·ªØ li·ªáu th·ª±c t·∫ø c·ªßa ch√≠nh n√≥ m√† ch·ªâ
                l√† m·ªôt <b>"c·ª≠a s·ªï"</b> ƒë·ªÉ xem d·ªØ li·ªáu t·ª´ m·ªôt ho·∫∑c nhi·ªÅu b·∫£ng c∆°
                s·ªü. M·ªói khi b·∫°n truy v·∫•n m·ªôt VIEW, h·ªá th·ªëng s·∫Ω ch·∫°y l·∫°i c√¢u l·ªánh
                SELECT ƒë√£ ƒë·ªãnh nghƒ©a ƒë·ªÉ tr·∫£ v·ªÅ k·∫øt qu·∫£ m·ªõi nh·∫•t.
              </p>
            </div>

            <h3>üîß C√∫ ph√°p t·∫°o VIEW</h3>
            <div class="highlight-box">
              <div class="code-block">
                <span class="keyword">CREATE VIEW</span> <span class="table">view_name</span> <span class="keyword">AS</span>
                <span class="keyword">SELECT</span> <span class="column">column1</span>, <span class="column">column2</span>, ...
                <span class="keyword">FROM</span> <span class="table">table_name</span>
                <span class="keyword">WHERE</span> <span class="column">condition</span>;
              </div>
            </div>

            <h3>‚úÖ ∆Øu ƒëi·ªÉm c·ªßa VIEW</h3>
            <div class="success-box">
              <p>
                S·ª≠ d·ª•ng VIEW mang l·∫°i nhi·ªÅu l·ª£i √≠ch quan tr·ªçng trong qu·∫£n l√Ω c∆°
                s·ªü d·ªØ li·ªáu:
              </p>

              <h4>1Ô∏è‚É£ ƒê∆°n gi·∫£n h√≥a truy v·∫•n</h4>
              <p>
                VIEW gi√∫p b·∫°n l∆∞u tr·ªØ c√°c truy v·∫•n ph·ª©c t·∫°p (ch·ª©a JOIN, GROUP
                BY, v.v.) d∆∞·ªõi m·ªôt t√™n duy nh·∫•t. Thay v√¨ ph·∫£i vi·∫øt l·∫°i to√†n b·ªô
                c√¢u l·ªánh ph·ª©c t·∫°p ƒë√≥, b·∫°n ch·ªâ c·∫ßn SELECT t·ª´ VIEW nh∆∞ th·ªÉ n√≥ l√†
                m·ªôt b·∫£ng b√¨nh th∆∞·ªùng.
              </p>

              <h4>2Ô∏è‚É£ TƒÉng c∆∞·ªùng b·∫£o m·∫≠t</h4>
              <p>
                B·∫°n c√≥ th·ªÉ gi·ªõi h·∫°n quy·ªÅn truy c·∫≠p c·ªßa ng∆∞·ªùi d√πng b·∫±ng c√°ch c·∫•p
                quy·ªÅn cho h·ªç truy v·∫•n m·ªôt VIEW thay v√¨ to√†n b·ªô c√°c b·∫£ng c∆° s·ªü.
                VIEW c√≥ th·ªÉ che gi·∫•u c√°c c·ªôt ho·∫∑c h√†ng nh·∫°y c·∫£m m√† ng∆∞·ªùi d√πng
                kh√¥ng n√™n xem.
              </p>

              <h4>3Ô∏è‚É£ ƒê∆°n gi·∫£n h√≥a c·∫•u tr√∫c</h4>
              <p>
                VIEW c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ tr√¨nh b√†y d·ªØ li·ªáu theo m·ªôt c√°ch d·ªÖ
                hi·ªÉu h∆°n cho ng∆∞·ªùi d√πng cu·ªëi, m√† kh√¥ng l√†m thay ƒë·ªïi c·∫•u tr√∫c c·ªßa
                c√°c b·∫£ng g·ªëc.
              </p>

              <h4>4Ô∏è‚É£ T√≠nh ƒë·ªôc l·∫≠p d·ªØ li·ªáu</h4>
              <p>
                N·∫øu c·∫•u tr√∫c c·ªßa c√°c b·∫£ng c∆° s·ªü thay ƒë·ªïi (v√≠ d·ª•: m·ªôt c·ªôt ƒë∆∞·ª£c
                ƒë·ªïi t√™n), b·∫°n ch·ªâ c·∫ßn s·ª≠a ƒë·ªïi ƒë·ªãnh nghƒ©a c·ªßa VIEW ch·ª© kh√¥ng c·∫ßn
                ph·∫£i c·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c ·ª©ng d·ª•ng ƒëang s·ª≠ d·ª•ng d·ªØ li·ªáu ƒë√≥.
              </p>
            </div>

            <h3>üìã V√≠ d·ª• c∆° b·∫£n</h3>
            <div class="example">
              <h4>T·∫°o VIEW cho th√¥ng tin ƒë∆°n h√†ng kh√°ch h√†ng:</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n th∆∞·ªùng xuy√™n c·∫ßn truy c·∫≠p th√¥ng tin v·ªÅ c√°c ƒë∆°n h√†ng
                c√πng v·ªõi t√™n c·ªßa kh√°ch h√†ng ƒë√£ ƒë·∫∑t. Thay v√¨ ph·∫£i vi·∫øt m·ªôt c√¢u
                l·ªánh JOIN m·ªói l·∫ßn, b·∫°n c√≥ th·ªÉ t·∫°o m·ªôt VIEW ƒë·ªÉ ƒë∆°n gi·∫£n h√≥a qu√°
                tr√¨nh n√†y.
              </p>
              <div class="code-block">
                <span class="keyword">CREATE VIEW</span> <span class="table">customer_orders</span> <span class="keyword">AS</span>
                <span class="keyword">SELECT</span> <span class="column">c.customer_id</span>, <span class="column">c.first_name</span>, <span class="column">c.last_name</span>, <span class="column">c.email</span>,
                       <span class="column">o.order_id</span>, <span class="column">o.order_date</span>, <span class="column">o.total_amount</span>
                <span class="keyword">FROM</span> <span class="table">customers</span> <span class="column">c</span>
                <span class="keyword">JOIN</span> <span class="table">orders</span> <span class="column">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span>;
              </div>

              <h4>Gi·∫£i th√≠ch:</h4>
              <ul>
                <li>
                  <b>CREATE VIEW customer_orders AS:</b> T·∫°o m·ªôt VIEW c√≥ t√™n l√†
                  customer_orders
                </li>
                <li>
                  <b>SELECT ...:</b> ƒê·ªãnh nghƒ©a c√¢u truy v·∫•n ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´
                  hai b·∫£ng customers v√† orders
                </li>
                <li>
                  <b>JOIN ...:</b> N·ªëi hai b·∫£ng l·∫°i v·ªõi nhau ƒë·ªÉ l·∫•y th√¥ng tin
                  kh√°ch h√†ng v√† ƒë∆°n h√†ng t∆∞∆°ng ·ª©ng
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>S·ª≠ d·ª•ng VIEW ƒë√£ t·∫°o:</h4>
              <p>
                Sau khi VIEW n√†y ƒë∆∞·ª£c t·∫°o, b·∫°n c√≥ th·ªÉ truy v·∫•n n√≥ m·ªôt c√°ch ƒë∆°n
                gi·∫£n nh∆∞ sau:
              </p>
              <div class="code-block">
                -- Truy v·∫•n ƒë∆°n gi·∫£n nh∆∞ b·∫£ng th√¥ng th∆∞·ªùng SELECT * FROM
                customer_orders WHERE order_date >= '2024-01-01'; -- L·ªçc theo
                kh√°ch h√†ng c·ª• th·ªÉ SELECT * FROM customer_orders WHERE
                customer_id = 123; -- S·∫Øp x·∫øp theo ng√†y ƒë·∫∑t h√†ng SELECT * FROM
                customer_orders ORDER BY order_date DESC; -- K·∫øt h·ª£p v·ªõi c√°c
                ƒëi·ªÅu ki·ªán kh√°c SELECT first_name, last_name, COUNT(*) AS
                total_orders, SUM(total_amount) AS total_spent FROM
                customer_orders WHERE order_date >= '2024-01-01' GROUP BY
                customer_id, first_name, last_name ORDER BY total_spent DESC;
              </div>
            </div>

            <h3>üíº V√≠ d·ª• th·ª±c t·∫ø n√¢ng cao</h3>

            <div class="example">
              <h4>1. VIEW cho b√°o c√°o doanh thu:</h4>
              <div class="code-block">
                CREATE VIEW monthly_sales_report AS SELECT YEAR(o.order_date) AS
                sales_year, MONTH(o.order_date) AS sales_month, DATENAME(MONTH,
                o.order_date) AS month_name, COUNT(o.order_id) AS total_orders,
                SUM(o.total_amount) AS total_revenue, AVG(o.total_amount) AS
                avg_order_value, COUNT(DISTINCT o.customer_id) AS
                unique_customers FROM orders o GROUP BY YEAR(o.order_date),
                MONTH(o.order_date), DATENAME(MONTH, o.order_date); -- S·ª≠ d·ª•ng
                VIEW SELECT * FROM monthly_sales_report WHERE sales_year = 2024
                ORDER BY sales_month;
              </div>
            </div>

            <div class="example">
              <h4>2. VIEW cho th√¥ng tin s·∫£n ph·∫©m ƒë·∫ßy ƒë·ªß:</h4>
              <div class="code-block">
                CREATE VIEW product_details AS SELECT p.product_id,
                p.product_name, c.category_name, b.brand_name, p.list_price,
                p.stock_quantity, CASE WHEN p.stock_quantity = 0 THEN 'H·∫øt h√†ng'
                WHEN p.stock_quantity < 10 THEN 'S·∫Øp h·∫øt' ELSE 'C√≤n h√†ng' END AS
                stock_status, CONCAT(b.brand_name, ' - ', p.product_name) AS
                full_product_name FROM products p LEFT JOIN categories c ON
                p.category_id = c.category_id LEFT JOIN brands b ON p.brand_id =
                b.brand_id; -- S·ª≠ d·ª•ng ƒë·ªÉ t√¨m s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng SELECT *
                FROM product_details WHERE stock_status = 'S·∫Øp h·∫øt' ORDER BY
                stock_quantity;
              </div>
            </div>

            <div class="example">
              <h4>3. VIEW cho th√¥ng tin nh√¢n vi√™n v√† hi·ªáu su·∫•t:</h4>
              <div class="code-block">
                CREATE VIEW employee_performance AS SELECT e.employee_id,
                e.employee_name, d.department_name, e.hire_date, DATEDIFF(YEAR,
                e.hire_date, GETDATE()) AS years_of_service, COUNT(o.order_id)
                AS orders_handled, COALESCE(SUM(o.total_amount), 0) AS
                total_sales, COALESCE(AVG(o.total_amount), 0) AS avg_sale_amount
                FROM employees e LEFT JOIN departments d ON e.department_id =
                d.department_id LEFT JOIN orders o ON e.employee_id =
                o.sales_rep_id GROUP BY e.employee_id, e.employee_name,
                d.department_name, e.hire_date; -- T√¨m nh√¢n vi√™n c√≥ hi·ªáu su·∫•t
                t·ªët nh·∫•t SELECT TOP 5 * FROM employee_performance ORDER BY
                total_sales DESC;
              </div>
            </div>

            <h3>üõ°Ô∏è VIEW cho b·∫£o m·∫≠t</h3>
            <div class="example">
              <h4>T·∫°o VIEW ƒë·ªÉ ·∫©n th√¥ng tin nh·∫°y c·∫£m:</h4>
              <div class="code-block">
                -- VIEW cho ph√©p kh√°ch h√†ng xem th√¥ng tin c√° nh√¢n (kh√¥ng c√≥
                th√¥ng tin t√†i ch√≠nh) CREATE VIEW customer_public_info AS SELECT
                customer_id, first_name, last_name, email, phone, city, state
                FROM customers; -- Kh√¥ng bao g·ªìm: credit_card_number,
                bank_account, salary, etc. -- VIEW cho nh√¢n vi√™n sales (ch·ªâ xem
                ƒë∆°n h√†ng trong khu v·ª±c c·ªßa h·ªç) CREATE VIEW sales_rep_orders AS
                SELECT o.order_id, o.order_date, o.total_amount,
                c.customer_name, c.city FROM orders o JOIN customers c ON
                o.customer_id = c.customer_id JOIN employees e ON o.sales_rep_id
                = e.employee_id WHERE e.employee_id = USER_ID(); -- Ch·ªâ hi·ªÉn th·ªã
                ƒë∆°n h√†ng c·ªßa nh√¢n vi√™n hi·ªán t·∫°i
              </div>
            </div>

            <h3>üîß Qu·∫£n l√Ω VIEW</h3>
            <div class="example">
              <h4>C√°c thao t√°c v·ªõi VIEW:</h4>
              <div class="code-block">
                -- Xem ƒë·ªãnh nghƒ©a c·ªßa VIEW SELECT
                OBJECT_DEFINITION(OBJECT_ID('customer_orders')) AS
                view_definition; -- S·ª≠a ƒë·ªïi VIEW ALTER VIEW customer_orders AS
                SELECT c.customer_id, CONCAT(c.first_name, ' ', c.last_name) AS
                full_name, c.email, o.order_id, o.order_date, o.total_amount,
                o.status FROM customers c JOIN orders o ON c.customer_id =
                o.customer_id WHERE o.status != 'Cancelled'; -- Th√™m ƒëi·ªÅu ki·ªán
                l·ªçc -- X√≥a VIEW DROP VIEW customer_orders; -- Ki·ªÉm tra VIEW c√≥
                t·ªìn t·∫°i kh√¥ng IF OBJECT_ID('customer_orders', 'V') IS NOT NULL
                DROP VIEW customer_orders;
              </div>
            </div>

            <h3>üìä VIEW v·ªõi tham s·ªë (SQL Server)</h3>
            <div class="example">
              <h4>S·ª≠ d·ª•ng Table-Valued Functions thay cho VIEW c√≥ tham s·ªë:</h4>
              <div class="code-block">
                <span class="comment"></span>-- T·∫°o function tr·∫£ v·ªÅ table thay v√¨ VIEW</span>
                <span class="keyword">CREATE FUNCTION</span> <span class="function">get_orders_by_date</span>(<span class="column">@start_date</span> <span class="datatype">DATE</span>, <span class="column">@end_date</span> <span class="datatype">DATE</span>) 
                <span class="keyword">RETURNS TABLE</span> 
                <span class="keyword">AS</span> 
                <span class="keyword">RETURN</span> (
                  <span class="keyword">SELECT</span> <span class="column">c.customer_name</span>, <span class="column">o.order_id</span>, <span class="column">o.order_date</span>, <span class="column">o.total_amount</span> 
                  <span class="keyword">FROM</span> <span class="table">customers</span> <span class="keyword">c</span> 
                  <span class="keyword">JOIN</span> <span class="table">orders</span> <span class="keyword">o</span> <span class="keyword">ON</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">o.customer_id</span> 
                  <span class="keyword">WHERE</span> <span class="column">o.order_date</span> <span class="keyword">BETWEEN</span> <span class="column">@start_date</span> <span class="keyword">AND</span> <span class="column">@end_date</span>
                );
                
                <span class="comment">-- S·ª≠ d·ª•ng function</span>
                <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="function">get_orders_by_date</span>(<span class="string">'2024-01-01'</span>, <span class="string">'2024-12-31'</span>);
              </div>
            </div>

            <h3>‚öñÔ∏è VIEW vs B·∫£ng th·∫≠t</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>VIEW</th>
                  <th>B·∫£ng th·∫≠t</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>L∆∞u tr·ªØ d·ªØ li·ªáu</b></td>
                  <td>Kh√¥ng l∆∞u tr·ªØ, ch·ªâ l∆∞u ƒë·ªãnh nghƒ©a</td>
                  <td>L∆∞u tr·ªØ d·ªØ li·ªáu th·ª±c t·∫ø</td>
                </tr>
                <tr>
                  <td><b>Hi·ªáu su·∫•t</b></td>
                  <td>Ch·∫≠m h∆°n (ph·∫£i th·ª±c thi query m·ªói l·∫ßn)</td>
                  <td>Nhanh h∆°n (d·ªØ li·ªáu ƒë√£ c√≥ s·∫µn)</td>
                </tr>
                <tr>
                  <td><b>Dung l∆∞·ª£ng</b></td>
                  <td>Kh√¥ng chi·∫øm dung l∆∞·ª£ng d·ªØ li·ªáu</td>
                  <td>Chi·∫øm dung l∆∞·ª£ng l∆∞u tr·ªØ</td>
                </tr>
                <tr>
                  <td><b>C·∫≠p nh·∫≠t d·ªØ li·ªáu</b></td>
                  <td>Lu√¥n m·ªõi nh·∫•t (real-time)</td>
                  <td>C·∫ßn c·∫≠p nh·∫≠t th·ªß c√¥ng</td>
                </tr>
                <tr>
                  <td><b>B·∫£o m·∫≠t</b></td>
                  <td>C√≥ th·ªÉ ·∫©n d·ªØ li·ªáu nh·∫°y c·∫£m</td>
                  <td>Ph·∫£i c·∫•p quy·ªÅn to√†n b·ªô b·∫£ng</td>
                </tr>
                <tr>
                  <td><b>Indexing</b></td>
                  <td>Kh√¥ng th·ªÉ t·∫°o index tr·ª±c ti·∫øp</td>
                  <td>C√≥ th·ªÉ t·∫°o index</td>
                </tr>
              </tbody>
            </table>

            <h3>üéØ Khi n√†o n√™n s·ª≠ d·ª•ng VIEW</h3>
            <div class="success-box">
              <h4>‚úÖ N√äN s·ª≠ d·ª•ng VIEW khi:</h4>
              <ul>
                <li>
                  <b>Truy v·∫•n ph·ª©c t·∫°p th∆∞·ªùng xuy√™n:</b> JOIN nhi·ªÅu b·∫£ng, GROUP
                  BY ph·ª©c t·∫°p
                </li>
                <li>
                  <b>B·∫£o m·∫≠t d·ªØ li·ªáu:</b> C·∫ßn ·∫©n m·ªôt s·ªë c·ªôt ho·∫∑c h√†ng nh·∫°y c·∫£m
                </li>
                <li>
                  <b>ƒê∆°n gi·∫£n h√≥a cho ng∆∞·ªùi d√πng:</b> T·∫°o giao di·ªán d·ªÖ s·ª≠ d·ª•ng
                </li>
                <li>
                  <b>T√≠nh ƒë·ªôc l·∫≠p:</b> T√°ch bi·ªát ·ª©ng d·ª•ng kh·ªèi c·∫•u tr√∫c b·∫£ng
                </li>
                <li><b>B√°o c√°o:</b> T·∫°o c√°c view cho t·ª´ng lo·∫°i b√°o c√°o</li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå KH√îNG n√™n s·ª≠ d·ª•ng VIEW khi:</h4>
              <ul>
                <li>
                  <b>Hi·ªáu su·∫•t quan tr·ªçng:</b> Truy v·∫•n c·∫ßn t·ªëc ƒë·ªô cao, d·ªØ li·ªáu
                  l·ªõn
                </li>
                <li>
                  <b>C·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n:</b> C·∫ßn INSERT, UPDATE, DELETE ph·ª©c
                  t·∫°p
                </li>
                <li>
                  <b>T√≠nh to√°n n·∫∑ng:</b> C√°c ph√©p t√≠nh ph·ª©c t·∫°p n√™n d√πng Stored
                  Procedure
                </li>
                <li><b>D·ªØ li·ªáu t·∫°m:</b> D·ªØ li·ªáu ch·ªâ s·ª≠ d·ª•ng m·ªôt l·∫ßn</li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>üí° Best Practices cho VIEW:</h4>
              <ul>
                <li>
                  <b>ƒê·∫∑t t√™n c√≥ √Ω nghƒ©a:</b> S·ª≠ d·ª•ng prefix nh∆∞ v_ ho·∫∑c view_
                </li>
                <li><b>Document VIEW:</b> Ghi ch√∫ m·ª•c ƒë√≠ch v√† c√°ch s·ª≠ d·ª•ng</li>
                <li>
                  <b>T·ªëi ∆∞u truy v·∫•n:</b> ƒê·∫£m b·∫£o c√°c b·∫£ng c∆° s·ªü c√≥ index ph√π
                  h·ª£p
                </li>
                <li><b>Ki·ªÉm tra hi·ªáu su·∫•t:</b> Test v·ªõi d·ªØ li·ªáu th·ª±c t·∫ø</li>
                <li>
                  <b>Ph√¢n quy·ªÅn ƒë√∫ng:</b> Ch·ªâ c·∫•p quy·ªÅn c·∫ßn thi·∫øt cho t·ª´ng user
                </li>
                <li>
                  <b>Review ƒë·ªãnh k·ª≥:</b> Ki·ªÉm tra v√† c·∫≠p nh·∫≠t VIEW khi c·∫ßn
                </li>
              </ul>
            </div>
          </section>

          <!-- 18 -->
          <section class="section" id="subquery">
            <h2>18. SUBQUERY</h2>

            <div class="info-box">
              <h4>üîç Subquery l√† g√¨?</h4>
              <p>
                <b>Subquery (truy v·∫•n con)</b> l√† m·ªôt c√¢u l·ªánh SELECT n·∫±m b√™n
                trong m·ªôt c√¢u l·ªánh SQL kh√°c. N√≥ c√≤n ƒë∆∞·ª£c g·ªçi l√†
                <b>truy v·∫•n l·ªìng nhau (nested query)</b> ho·∫∑c
                <b>truy v·∫•n b√™n trong (inner query)</b>. K·∫øt qu·∫£ c·ªßa truy v·∫•n
                con ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi truy v·∫•n b√™n ngo√†i (outer query).
              </p>
              <p>
                Subquery th∆∞·ªùng ƒë∆∞·ª£c ƒë·∫∑t trong d·∫•u ngo·∫∑c ƒë∆°n <code>()</code> v√†
                c√≥ th·ªÉ xu·∫•t hi·ªán trong nhi·ªÅu m·ªánh ƒë·ªÅ kh√°c nhau c·ªßa c√¢u l·ªánh SQL,
                nh∆∞ <b>WHERE</b>, <b>FROM</b>, ho·∫∑c <b>SELECT</b>.
              </p>
            </div>

            <h3>‚öôÔ∏è C√°ch ho·∫°t ƒë·ªông v√† c√°c lo·∫°i Subquery</h3>
            <div class="highlight-box">
              <h4>üîÑ Ho·∫°t ƒë·ªông:</h4>
              <p>
                H·ªá th·ªëng s·∫Ω <b>th·ª±c thi truy v·∫•n con tr∆∞·ªõc</b>. Sau ƒë√≥, k·∫øt qu·∫£
                t·ª´ truy v·∫•n con s·∫Ω ƒë∆∞·ª£c ƒë∆∞a v√†o truy v·∫•n ch√≠nh ƒë·ªÉ th·ª±c thi.
              </p>

              <h4>üìã C√°c lo·∫°i ph·ªï bi·∫øn:</h4>
              <ul>
                <li>
                  <b>Subquery trong m·ªánh ƒë·ªÅ WHERE:</b> ƒê√¢y l√† c√°ch s·ª≠ d·ª•ng ph·ªï
                  bi·∫øn nh·∫•t, d√πng ƒë·ªÉ l·ªçc d·ªØ li·ªáu c·ªßa truy v·∫•n ch√≠nh
                </li>
                <li>
                  <b>Subquery trong m·ªánh ƒë·ªÅ FROM:</b> K·∫øt qu·∫£ c·ªßa truy v·∫•n con
                  ƒë∆∞·ª£c coi nh∆∞ m·ªôt b·∫£ng t·∫°m th·ªùi
                </li>
                <li>
                  <b>Subquery trong m·ªánh ƒë·ªÅ SELECT:</b> Tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã duy
                  nh·∫•t cho m·ªói h√†ng c·ªßa truy v·∫•n ch√≠nh
                </li>
              </ul>
            </div>

            <h3>üîç 1. Subquery trong m·ªánh ƒë·ªÅ WHERE</h3>
            <div class="example">
              <h4>V√≠ d·ª• c∆° b·∫£n:</h4>
              <p>
                <b>B√†i to√°n:</b> T√¨m t√™n c·ªßa t·∫•t c·∫£ nh·ªØng kh√°ch h√†ng ƒë√£ ƒë·∫∑t ƒë∆°n
                h√†ng sau ng√†y 01/01/2025.
              </p>

              <p><b>C√°ch ti·∫øp c·∫≠n truy·ªÅn th·ªëng (2 b∆∞·ªõc):</b></p>
              <div class="code-block">
                -- B∆∞·ªõc 1: T√¨m customer_id c·ªßa c√°c ƒë∆°n h√†ng th·ªèa m√£n ƒëi·ªÅu ki·ªán
                SELECT customer_id FROM orders WHERE order_date > '2025-01-01';
                -- B∆∞·ªõc 2: S·ª≠ d·ª•ng k·∫øt qu·∫£ ƒë·ªÉ t√¨m t√™n kh√°ch h√†ng -- (Ph·∫£i
                copy-paste k·∫øt qu·∫£ t·ª´ b∆∞·ªõc 1)
              </div>

              <p><b>C√°ch s·ª≠ d·ª•ng Subquery (1 b∆∞·ªõc):</b></p>
              <div class="code-block">
                SELECT first_name, last_name FROM customers WHERE customer_id IN
                ( SELECT customer_id FROM orders WHERE order_date > '2025-01-01'
                );
              </div>

              <h4>Gi·∫£i th√≠ch:</h4>
              <ul>
                <li>
                  <b>Truy v·∫•n con:</b>
                  <code
                    >(SELECT customer_id FROM orders WHERE order_date >
                    '2025-01-01')</code
                  >
                  s·∫Ω ƒë∆∞·ª£c th·ª±c thi tr∆∞·ªõc. N√≥ tr·∫£ v·ªÅ m·ªôt danh s√°ch c√°c ID kh√°ch
                  h√†ng (v√≠ d·ª•: 101, 105, 110)
                </li>
                <li>
                  <b>Truy v·∫•n ch√≠nh:</b> Sau ƒë√≥, truy v·∫•n ch√≠nh s·∫Ω s·ª≠ d·ª•ng k·∫øt
                  qu·∫£ n√†y v√† l·ªçc b·∫£ng customers ƒë·ªÉ ch·ªâ l·∫•y nh·ªØng kh√°ch h√†ng c√≥
                  customer_id n·∫±m trong danh s√°ch ƒë√≥
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>C√°c to√°n t·ª≠ v·ªõi Subquery trong WHERE:</h4>
              <div class="code-block">
                -- 1. IN - Ki·ªÉm tra gi√° tr·ªã c√≥ trong danh s√°ch kh√¥ng SELECT
                product_name FROM products WHERE category_id IN ( SELECT
                category_id FROM categories WHERE category_name IN
                ('Electronics', 'Clothing') ); -- 2. NOT IN - Ki·ªÉm tra gi√° tr·ªã
                kh√¥ng c√≥ trong danh s√°ch SELECT customer_name FROM customers
                WHERE customer_id NOT IN ( SELECT DISTINCT customer_id FROM
                orders WHERE order_date >= '2024-01-01' ); -- 3. EXISTS - Ki·ªÉm
                tra subquery c√≥ tr·∫£ v·ªÅ k·∫øt qu·∫£ kh√¥ng SELECT c.customer_name FROM
                customers c WHERE EXISTS ( SELECT 1 FROM orders o WHERE
                o.customer_id = c.customer_id AND o.total_amount > 1000 ); -- 4.
                NOT EXISTS - Ki·ªÉm tra subquery kh√¥ng tr·∫£ v·ªÅ k·∫øt qu·∫£ SELECT
                c.customer_name FROM customers c WHERE NOT EXISTS ( SELECT 1
                FROM orders o WHERE o.customer_id = c.customer_id ); -- 5. So
                s√°nh v·ªõi gi√° tr·ªã ƒë∆°n (=, >, <, >=, <=) SELECT employee_name,
                salary FROM employees WHERE salary > ( SELECT AVG(salary) FROM
                employees );
              </div>
            </div>

            <h3>üìä 2. Subquery trong m·ªánh ƒë·ªÅ FROM</h3>
            <div class="example">
              <h4>Subquery nh∆∞ b·∫£ng t·∫°m:</h4>
              <p>
                <b>B√†i to√°n:</b> T√¨m th√¥ng tin kh√°ch h√†ng v√† t·ªïng s·ªë ƒë∆°n h√†ng
                c·ªßa h·ªç, ch·ªâ hi·ªÉn th·ªã nh·ªØng kh√°ch h√†ng c√≥ t·ª´ 3 ƒë∆°n h√†ng tr·ªü l√™n.
              </p>
              <div class="code-block">
                SELECT c.customer_name, c.email, customer_stats.total_orders,
                customer_stats.total_spent FROM customers c JOIN ( SELECT
                customer_id, COUNT(*) AS total_orders, SUM(total_amount) AS
                total_spent FROM orders GROUP BY customer_id HAVING COUNT(*) >=
                3 ) AS customer_stats ON c.customer_id =
                customer_stats.customer_id ORDER BY customer_stats.total_spent
                DESC;
              </div>
              <p>
                <b>Gi·∫£i th√≠ch:</b> Subquery trong FROM t·∫°o ra m·ªôt "b·∫£ng t·∫°m"
                ch·ª©a th·ªëng k√™ c·ªßa kh√°ch h√†ng, sau ƒë√≥ JOIN v·ªõi b·∫£ng customers ƒë·ªÉ
                l·∫•y th√¥ng tin ƒë·∫ßy ƒë·ªß.
              </p>
            </div>

            <div class="example">
              <h4>Subquery ph·ª©c t·∫°p trong FROM:</h4>
              <div class="code-block">
                -- B√°o c√°o doanh thu theo th√°ng v·ªõi so s√°nh th√°ng tr∆∞·ªõc SELECT
                current_month.month_year, current_month.monthly_revenue,
                COALESCE(previous_month.monthly_revenue, 0) AS
                previous_month_revenue, current_month.monthly_revenue -
                COALESCE(previous_month.monthly_revenue, 0) AS
                revenue_difference FROM ( SELECT FORMAT(order_date, 'yyyy-MM')
                AS month_year, SUM(total_amount) AS monthly_revenue FROM orders
                GROUP BY FORMAT(order_date, 'yyyy-MM') ) AS current_month LEFT
                JOIN ( SELECT FORMAT(DATEADD(MONTH, 1, order_date), 'yyyy-MM')
                AS next_month, SUM(total_amount) AS monthly_revenue FROM orders
                GROUP BY FORMAT(DATEADD(MONTH, 1, order_date), 'yyyy-MM') ) AS
                previous_month ON current_month.month_year =
                previous_month.next_month ORDER BY current_month.month_year;
              </div>
            </div>

            <h3>üìà 3. Subquery trong m·ªánh ƒë·ªÅ SELECT</h3>
            <div class="example">
              <h4>Subquery tr·∫£ v·ªÅ gi√° tr·ªã ƒë∆°n:</h4>
              <div class="code-block">
                -- Hi·ªÉn th·ªã th√¥ng tin s·∫£n ph·∫©m k√®m theo t·ªïng s·ªë l∆∞·ª£ng ƒë√£ b√°n
                SELECT p.product_id, p.product_name, p.list_price,
                p.stock_quantity, (SELECT COUNT(*) FROM order_details od WHERE
                od.product_id = p.product_id) AS times_sold, (SELECT
                COALESCE(SUM(od.quantity), 0) FROM order_details od WHERE
                od.product_id = p.product_id) AS total_quantity_sold, (SELECT
                AVG(od.unit_price) FROM order_details od WHERE od.product_id =
                p.product_id) AS avg_selling_price FROM products p ORDER BY
                times_sold DESC;
              </div>
            </div>

            <div class="example">
              <h4>Subquery v·ªõi ƒëi·ªÅu ki·ªán ph·ª©c t·∫°p trong SELECT:</h4>
              <div class="code-block">
                -- Th√¥ng tin kh√°ch h√†ng v·ªõi th·ªëng k√™ chi ti·∫øt SELECT
                c.customer_id, c.customer_name, c.email, (SELECT COUNT(*) FROM
                orders o WHERE o.customer_id = c.customer_id) AS total_orders,
                (SELECT COALESCE(MAX(o.order_date), 'Ch∆∞a c√≥ ƒë∆°n h√†ng') FROM
                orders o WHERE o.customer_id = c.customer_id) AS
                last_order_date, (SELECT COALESCE(SUM(o.total_amount), 0) FROM
                orders o WHERE o.customer_id = c.customer_id) AS total_spent,
                CASE WHEN (SELECT COUNT(*) FROM orders o WHERE o.customer_id =
                c.customer_id) = 0 THEN 'Ch∆∞a mua h√†ng' WHEN (SELECT
                SUM(o.total_amount) FROM orders o WHERE o.customer_id =
                c.customer_id) > 10000 THEN 'VIP' WHEN (SELECT COUNT(*) FROM
                orders o WHERE o.customer_id = c.customer_id) >= 5 THEN 'Th√¢n
                thi·∫øt' ELSE 'Th∆∞·ªùng' END AS customer_tier FROM customers c ORDER
                BY total_spent DESC;
              </div>
            </div>

            <h3>üîÑ 4. Correlated Subquery (Subquery c√≥ t∆∞∆°ng quan)</h3>
            <div class="example">
              <h4>Subquery tham chi·∫øu ƒë·∫øn b·∫£ng b√™n ngo√†i:</h4>
              <div class="code-block">
                -- T√¨m nh√¢n vi√™n c√≥ l∆∞∆°ng cao nh·∫•t trong m·ªói ph√≤ng ban SELECT
                e1.employee_name, e1.department_id, e1.salary FROM employees e1
                WHERE e1.salary = ( SELECT MAX(e2.salary) FROM employees e2
                WHERE e2.department_id = e1.department_id -- T∆∞∆°ng quan v·ªõi b·∫£ng
                ngo√†i ); -- T√¨m s·∫£n ph·∫©m c√≥ gi√° cao h∆°n gi√° trung b√¨nh trong
                c√πng danh m·ª•c SELECT p1.product_name, p1.category_id,
                p1.list_price, (SELECT AVG(p2.list_price) FROM products p2 WHERE
                p2.category_id = p1.category_id) AS avg_category_price FROM
                products p1 WHERE p1.list_price > ( SELECT AVG(p2.list_price)
                FROM products p2 WHERE p2.category_id = p1.category_id );
              </div>
            </div>

            <h3>üéØ 5. Subquery v·ªõi ANY, ALL, SOME</h3>
            <div class="example">
              <h4>So s√°nh v·ªõi nhi·ªÅu gi√° tr·ªã:</h4>
              <div class="code-block">
                -- ANY/SOME: Th·ªèa m√£n √≠t nh·∫•t m·ªôt gi√° tr·ªã trong subquery SELECT
                product_name, list_price FROM products WHERE list_price > ANY (
                SELECT AVG(list_price) FROM products GROUP BY category_id ); --
                ALL: Th·ªèa m√£n t·∫•t c·∫£ gi√° tr·ªã trong subquery SELECT product_name,
                list_price FROM products WHERE list_price > ALL ( SELECT
                AVG(list_price) FROM products GROUP BY category_id ); -- V√≠ d·ª•
                th·ª±c t·∫ø: T√¨m kh√°ch h√†ng c√≥ ƒë∆°n h√†ng l·ªõn h∆°n b·∫•t k·ª≥ ƒë∆°n h√†ng n√†o
                c·ªßa kh√°ch h√†ng VIP SELECT DISTINCT c.customer_name FROM
                customers c JOIN orders o ON c.customer_id = o.customer_id WHERE
                o.total_amount > ANY ( SELECT o2.total_amount FROM orders o2
                JOIN customers c2 ON o2.customer_id = c2.customer_id WHERE
                c2.customer_tier = 'VIP' );
              </div>
            </div>

            <h3>‚úÖ ∆Øu ƒëi·ªÉm c·ªßa Subquery</h3>
            <div class="success-box">
              <h4>üéØ L·ª£i √≠ch ch√≠nh:</h4>
              <ul>
                <li>
                  <b>D·ªÖ ƒë·ªçc v√† d·ªÖ hi·ªÉu h∆°n:</b> Trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p, vi·ªác s·ª≠
                  d·ª•ng subquery c√≥ th·ªÉ l√†m cho c√¢u l·ªánh SQL tr·ªü n√™n d·ªÖ ƒë·ªçc v√†
                  di·ªÖn gi·∫£i logic h∆°n so v·ªõi vi·ªác s·ª≠ d·ª•ng JOIN
                </li>
                <li>
                  <b>Linh ho·∫°t:</b> Subquery c√≥ th·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ ph·ª©c
                  t·∫°p m√† JOIN kh√¥ng th·ªÉ l√†m ƒë∆∞·ª£c m·ªôt c√°ch tr·ª±c ti·∫øp
                </li>
                <li>
                  <b>Th·ª±c hi·ªán c√°c ph√©p t√≠nh ph·ª©c t·∫°p:</b> Ch√∫ng cho ph√©p b·∫°n
                  l·ªçc d·ªØ li·ªáu d·ª±a tr√™n c√°c k·∫øt qu·∫£ t·ªïng h·ª£p c·ªßa m·ªôt b·∫£ng kh√°c
                </li>
                <li>
                  <b>Modular:</b> C√≥ th·ªÉ test v√† debug t·ª´ng ph·∫ßn ri√™ng bi·ªát
                </li>
              </ul>
            </div>

            <h3>‚öñÔ∏è Subquery vs JOIN</h3>
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>Ti√™u ch√≠</th>
                  <th>Subquery</th>
                  <th>JOIN</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>Hi·ªáu su·∫•t</b></td>
                  <td>Ch·∫≠m h∆°n (ƒë·∫∑c bi·ªát correlated)</td>
                  <td>Nhanh h∆°n v·ªõi index ph√π h·ª£p</td>
                </tr>
                <tr>
                  <td><b>D·ªÖ ƒë·ªçc</b></td>
                  <td>D·ªÖ hi·ªÉu logic, r√µ r√†ng</td>
                  <td>C√≥ th·ªÉ ph·ª©c t·∫°p v·ªõi nhi·ªÅu b·∫£ng</td>
                </tr>
                <tr>
                  <td><b>Linh ho·∫°t</b></td>
                  <td>C√≥ th·ªÉ d√πng trong SELECT, WHERE, FROM</td>
                  <td>Ch·ªâ trong FROM clause</td>
                </tr>
                <tr>
                  <td><b>K·∫øt qu·∫£</b></td>
                  <td>C√≥ th·ªÉ tr·∫£ v·ªÅ gi√° tr·ªã ƒë∆°n</td>
                  <td>Lu√¥n tr·∫£ v·ªÅ t·∫≠p h·ª£p</td>
                </tr>
                <tr>
                  <td><b>Correlated</b></td>
                  <td>H·ªó tr·ª£ tham chi·∫øu b·∫£ng ngo√†i</td>
                  <td>Kh√¥ng tham chi·∫øu ƒë∆∞·ª£c</td>
                </tr>
              </tbody>
            </table>

            <h3>üîß V√≠ d·ª• th·ª±c t·∫ø: Ph√¢n t√≠ch b√°n h√†ng</h3>
            <div class="example">
              <h4>Query ph·ª©c t·∫°p k·∫øt h·ª£p nhi·ªÅu lo·∫°i Subquery:</h4>
              <div class="code-block">
                -- B√°o c√°o to√†n di·ªán v·ªÅ hi·ªáu su·∫•t b√°n h√†ng SELECT
                monthly_sales.month_year, monthly_sales.total_revenue,
                monthly_sales.total_orders, monthly_sales.avg_order_value, --
                Subquery trong SELECT: So s√°nh v·ªõi th√°ng tr∆∞·ªõc (SELECT
                ms2.total_revenue FROM ( SELECT FORMAT(order_date, 'yyyy-MM') AS
                month_year, SUM(total_amount) AS total_revenue FROM orders GROUP
                BY FORMAT(order_date, 'yyyy-MM') ) ms2 WHERE ms2.month_year =
                FORMAT(DATEADD(MONTH, -1, monthly_sales.month_year + '-01'),
                'yyyy-MM') ) AS previous_month_revenue, -- T√≠nh ph·∫ßn trƒÉm tƒÉng
                tr∆∞·ªüng CASE WHEN (SELECT ms2.total_revenue FROM (SELECT
                FORMAT(order_date, 'yyyy-MM') AS month_year, SUM(total_amount)
                AS total_revenue FROM orders GROUP BY FORMAT(order_date,
                'yyyy-MM')) ms2 WHERE ms2.month_year = FORMAT(DATEADD(MONTH, -1,
                monthly_sales.month_year + '-01'), 'yyyy-MM')) > 0 THEN ROUND(
                (monthly_sales.total_revenue - (SELECT ms2.total_revenue FROM
                (SELECT FORMAT(order_date, 'yyyy-MM') AS month_year,
                SUM(total_amount) AS total_revenue FROM orders GROUP BY
                FORMAT(order_date, 'yyyy-MM')) ms2 WHERE ms2.month_year =
                FORMAT(DATEADD(MONTH, -1, monthly_sales.month_year + '-01'),
                'yyyy-MM')) ) * 100.0 / (SELECT ms2.total_revenue FROM (SELECT
                FORMAT(order_date, 'yyyy-MM') AS month_year, SUM(total_amount)
                AS total_revenue FROM orders GROUP BY FORMAT(order_date,
                'yyyy-MM')) ms2 WHERE ms2.month_year = FORMAT(DATEADD(MONTH, -1,
                monthly_sales.month_year + '-01'), 'yyyy-MM')), 2) ELSE NULL END
                AS growth_percentage FROM ( -- Subquery trong FROM: Th·ªëng k√™
                theo th√°ng SELECT FORMAT(order_date, 'yyyy-MM') AS month_year,
                SUM(total_amount) AS total_revenue, COUNT(*) AS total_orders,
                AVG(total_amount) AS avg_order_value FROM orders WHERE
                order_date >= DATEADD(YEAR, -1, GETDATE()) -- 12 th√°ng g·∫ßn ƒë√¢y
                GROUP BY FORMAT(order_date, 'yyyy-MM') ) AS monthly_sales --
                Subquery trong WHERE: Ch·ªâ hi·ªÉn th·ªã th√°ng c√≥ doanh thu > trung
                b√¨nh WHERE monthly_sales.total_revenue > ( SELECT
                AVG(monthly_revenue) FROM ( SELECT SUM(total_amount) AS
                monthly_revenue FROM orders WHERE order_date >= DATEADD(YEAR,
                -1, GETDATE()) GROUP BY FORMAT(order_date, 'yyyy-MM') ) AS
                avg_calc ) ORDER BY monthly_sales.month_year DESC;
              </div>
            </div>

            <div class="info-box">
              <h4>üí° Best Practices cho Subquery:</h4>
              <ul>
                <li>
                  <b>T·ªëi ∆∞u hi·ªáu su·∫•t:</b> Tr√°nh correlated subquery n·∫øu c√≥ th·ªÉ,
                  s·ª≠ d·ª•ng JOIN thay th·∫ø
                </li>
                <li>
                  <b>Index:</b> ƒê·∫£m b·∫£o c√≥ index tr√™n c√°c c·ªôt ƒë∆∞·ª£c s·ª≠ d·ª•ng trong
                  subquery
                </li>
                <li>
                  <b>NULL handling:</b> Ch√∫ √Ω v·ªõi NOT IN khi c√≥ gi√° tr·ªã NULL
                </li>
                <li>
                  <b>Test ri√™ng bi·ªát:</b> Ch·∫°y th·ª≠ subquery ƒë·ªôc l·∫≠p ƒë·ªÉ ki·ªÉm tra
                  k·∫øt qu·∫£
                </li>
                <li><b>Comment:</b> Ghi ch√∫ r√µ r√†ng cho subquery ph·ª©c t·∫°p</li>
                <li>
                  <b>Gi·ªõi h·∫°n depth:</b> Tr√°nh l·ªìng qu√° nhi·ªÅu t·∫ßng subquery
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
              <p>
                M·∫∑c d√π <b>JOIN th∆∞·ªùng hi·ªáu qu·∫£ h∆°n v·ªÅ m·∫∑t hi·ªáu su·∫•t</b>, nh∆∞ng
                subquery v·∫´n l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω v√† kh√¥ng th·ªÉ thi·∫øu ƒë·ªëi v·ªõi
                c√°c nh√† ph√°t tri·ªÉn c∆° s·ªü d·ªØ li·ªáu. Ch·ªçn ph∆∞∆°ng ph√°p ph√π h·ª£p d·ª±a
                tr√™n ƒë·ªô ph·ª©c t·∫°p c·ªßa logic v√† y√™u c·∫ßu hi·ªáu su·∫•t.
              </p>
            </div>
          </section>

          <!-- 19 -->
          <section class="section" id="ranking">
            <h2>19. Ranking & Window</h2>

            <div class="info-box">
              <h4>ü™ü Window Functions l√† g√¨?</h4>
              <p>
                <b>Window Functions (h√†m c·ª≠a s·ªï)</b> th·ª±c hi·ªán m·ªôt ph√©p t√≠nh
                tr√™n m·ªôt t·∫≠p h·ª£p c√°c h√†ng li√™n quan ƒë·∫øn h√†ng hi·ªán t·∫°i. Kh√¥ng
                gi·ªëng nh∆∞ c√°c h√†m t·ªïng h·ª£p th√¥ng th∆∞·ªùng (GROUP BY), h√†m c·ª≠a s·ªï
                <b>kh√¥ng gom c√°c h√†ng l·∫°i</b> m√† thay v√†o ƒë√≥, n√≥
                <b>th√™m m·ªôt c·ªôt m·ªõi</b> v√†o k·∫øt qu·∫£ c·ªßa truy v·∫•n v·ªõi gi√° tr·ªã
                ƒë∆∞·ª£c t√≠nh to√°n.
              </p>
              <p>
                C√°c h√†m n√†y r·∫•t h·ªØu √≠ch ƒë·ªÉ
                <b>x·∫øp h·∫°ng, ph√¢n t√≠ch v√† so s√°nh d·ªØ li·ªáu</b> trong c√°c ph√¢n
                ƒëo·∫°n ho·∫∑c "c·ª≠a s·ªï" c·ªßa d·ªØ li·ªáu.
              </p>
            </div>

            <h3>üèÜ C√°c h√†m Ranking ph·ªï bi·∫øn</h3>
            <div class="highlight-box">
              <p>
                C√°c h√†m x·∫øp h·∫°ng ƒë∆∞·ª£c d√πng ƒë·ªÉ g√°n m·ªôt <b>th·ª© h·∫°ng</b> cho m·ªói
                h√†ng trong m·ªôt t·∫≠p k·∫øt qu·∫£.
              </p>
            </div>

            <h4>1Ô∏è‚É£ ROW_NUMBER()</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b></p>
              <ul>
                <li>
                  G√°n m·ªôt s·ªë th·ª© t·ª± <b>duy nh·∫•t v√† li√™n ti·∫øp</b> cho m·ªói h√†ng
                  trong m·ªôt ph√¢n v√πng
                </li>
                <li>Th·ª© t·ª± n√†y b·∫Øt ƒë·∫ßu t·ª´ <b>1</b></li>
                <li><b>Kh√¥ng c√≥ hai h√†ng n√†o c√≥ c√πng ROW_NUMBER()</b></li>
              </ul>

              <div class="code-block">
                -- V√≠ d·ª• c∆° b·∫£n: ƒê√°nh s·ªë th·ª© t·ª± s·∫£n ph·∫©m theo gi√° gi·∫£m d·∫ßn
                SELECT product_id, product_name, list_price, ROW_NUMBER() OVER
                (ORDER BY list_price DESC) AS row_num FROM products;
              </div>
              <p>
                <b>K·∫øt qu·∫£:</b> L·ªánh n√†y s·∫Ω ƒë√°nh s·ªë th·ª© t·ª± cho t·∫•t c·∫£ c√°c s·∫£n
                ph·∫©m, t·ª´ 1 ƒë·∫øn N, d·ª±a tr√™n gi√° s·∫£n ph·∫©m (list_price) theo th·ª© t·ª±
                gi·∫£m d·∫ßn.
              </p>
            </div>

            <div class="example">
              <h4>ROW_NUMBER() v·ªõi PARTITION BY:</h4>
              <div class="code-block">
                -- ƒê√°nh s·ªë th·ª© t·ª± s·∫£n ph·∫©m trong t·ª´ng danh m·ª•c SELECT
                product_id, product_name, category_id, list_price, ROW_NUMBER()
                OVER (PARTITION BY category_id ORDER BY list_price DESC) AS
                row_num_in_category FROM products ORDER BY category_id,
                row_num_in_category;
              </div>
              <p>
                <b>Gi·∫£i th√≠ch:</b> Vi·ªác ƒë√°nh s·ªë s·∫Ω ƒë∆∞·ª£c reset l·∫°i cho m·ªói
                category_id. S·∫£n ph·∫©m ƒë·∫Øt nh·∫•t trong danh m·ª•c 1 s·∫Ω c√≥ row_num =
                1, v√† s·∫£n ph·∫©m ƒë·∫Øt nh·∫•t trong danh m·ª•c 2 c≈©ng s·∫Ω c√≥ row_num = 1.
              </p>
            </div>

            <h4>2Ô∏è‚É£ RANK()</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b></p>
              <ul>
                <li>
                  G√°n m·ªôt <b>th·ª© h·∫°ng</b> cho m·ªói h√†ng trong m·ªôt ph√¢n v√πng
                </li>
                <li>
                  N·∫øu hai ho·∫∑c nhi·ªÅu h√†ng c√≥ c√πng gi√° tr·ªã, ch√∫ng s·∫Ω nh·∫≠n
                  <b>c√πng m·ªôt th·ª© h·∫°ng</b>
                </li>
                <li>
                  Th·ª© h·∫°ng ti·∫øp theo s·∫Ω <b>b·ªã b·ªè qua (c√≥ "kho·∫£ng tr·ªëng")</b>
                </li>
              </ul>

              <div class="code-block">
                -- X·∫øp h·∫°ng nh√¢n vi√™n theo l∆∞∆°ng SELECT employee_id,
                employee_name, salary, RANK() OVER (ORDER BY salary DESC) AS
                salary_rank FROM employees;
              </div>
              <p>
                <b>V√≠ d·ª• k·∫øt qu·∫£:</b> N·∫øu hai nh√¢n vi√™n c√≥ c√πng l∆∞∆°ng cao nh·∫•t
                (100,000), c·∫£ hai s·∫Ω nh·∫≠n h·∫°ng 1, v√† nh√¢n vi√™n ti·∫øp theo s·∫Ω c√≥
                h·∫°ng 3 (b·ªè qua h·∫°ng 2).
              </p>

              <table style="margin: 10px 0">
                <thead>
                  <tr>
                    <th>employee_name</th>
                    <th>salary</th>
                    <th>salary_rank</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>John</td>
                    <td>100,000</td>
                    <td>1</td>
                  </tr>
                  <tr>
                    <td>Jane</td>
                    <td>100,000</td>
                    <td>1</td>
                  </tr>
                  <tr>
                    <td>Bob</td>
                    <td>95,000</td>
                    <td>3</td>
                  </tr>
                  <tr>
                    <td>Alice</td>
                    <td>90,000</td>
                    <td>4</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <h4>3Ô∏è‚É£ DENSE_RANK()</h4>
            <div class="example">
              <p><b>Ch·ª©c nƒÉng:</b></p>
              <ul>
                <li>
                  Gi·ªëng nh∆∞ RANK(), nh∆∞ng <b>kh√¥ng b·ªè qua th·ª© h·∫°ng</b> sau khi
                  c√≥ gi√° tr·ªã tr√πng l·∫∑p
                </li>
                <li><b>Kh√¥ng c√≥ "kho·∫£ng tr·ªëng"</b> trong th·ª© h·∫°ng</li>
              </ul>

              <div class="code-block">
                -- X·∫øp h·∫°ng s·∫£n ph·∫©m theo gi√° v·ªõi DENSE_RANK SELECT product_id,
                product_name, list_price, DENSE_RANK() OVER (ORDER BY list_price
                DESC) AS price_dense_rank FROM products;
              </div>
              <p>
                <b>V√≠ d·ª• k·∫øt qu·∫£:</b> N·∫øu hai s·∫£n ph·∫©m c√≥ c√πng gi√° cao nh·∫•t, c·∫£
                hai s·∫Ω nh·∫≠n h·∫°ng 1, v√† s·∫£n ph·∫©m ti·∫øp theo s·∫Ω c√≥ h·∫°ng 2 (kh√¥ng b·ªè
                qua).
              </p>

              <table style="margin: 10px 0">
                <thead>
                  <tr>
                    <th>product_name</th>
                    <th>list_price</th>
                    <th>price_dense_rank</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Product A</td>
                    <td>500</td>
                    <td>1</td>
                  </tr>
                  <tr>
                    <td>Product B</td>
                    <td>500</td>
                    <td>1</td>
                  </tr>
                  <tr>
                    <td>Product C</td>
                    <td>450</td>
                    <td>2</td>
                  </tr>
                  <tr>
                    <td>Product D</td>
                    <td>400</td>
                    <td>3</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <h3>üìä So s√°nh 3 h√†m Ranking</h3>
            <table>
              <thead>
                <tr>
                  <th>H√†m</th>
                  <th>X·ª≠ l√Ω gi√° tr·ªã tr√πng</th>
                  <th>Th·ª© h·∫°ng ti·∫øp theo</th>
                  <th>Khi n√†o s·ª≠ d·ª•ng</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>ROW_NUMBER()</b></td>
                  <td>G√°n s·ªë kh√°c nhau (t√πy √Ω)</td>
                  <td>Li√™n ti·∫øp (1,2,3,4...)</td>
                  <td>C·∫ßn s·ªë th·ª© t·ª± duy nh·∫•t</td>
                </tr>
                <tr>
                  <td><b>RANK()</b></td>
                  <td>G√°n c√πng h·∫°ng</td>
                  <td>B·ªè qua (1,1,3,4...)</td>
                  <td>X·∫øp h·∫°ng thi ƒë·∫•u th·ªÉ thao</td>
                </tr>
                <tr>
                  <td><b>DENSE_RANK()</b></td>
                  <td>G√°n c√πng h·∫°ng</td>
                  <td>Li√™n ti·∫øp (1,1,2,3...)</td>
                  <td>Ph√¢n lo·∫°i, nh√≥m m·ª©c ƒë·ªô</td>
                </tr>
              </tbody>
            </table>

            <h3>üîß M·ªánh ƒë·ªÅ OVER v√† PARTITION BY</h3>
            <div class="highlight-box">
              <h4>üìã OVER():</h4>
              <ul>
                <li>ƒê√¢y l√† m·ªôt ph·∫ßn <b>b·∫Øt bu·ªôc</b> c·ªßa h√†m c·ª≠a s·ªï</li>
                <li>
                  N√≥ x√°c ƒë·ªãnh <b>"c·ª≠a s·ªï"</b> ho·∫∑c t·∫≠p h·ª£p c√°c h√†ng m√† h√†m s·∫Ω
                  ho·∫°t ƒë·ªông tr√™n ƒë√≥
                </li>
                <li>
                  <b>ORDER BY b√™n trong OVER():</b> X√°c ƒë·ªãnh th·ª© t·ª± s·∫Øp x·∫øp c·ªßa
                  c√°c h√†ng trong "c·ª≠a s·ªï"
                </li>
              </ul>

              <h4>üìã PARTITION BY:</h4>
              <ul>
                <li>L√† m·ªôt m·ªánh ƒë·ªÅ <b>t√πy ch·ªçn</b> b√™n trong OVER()</li>
                <li>
                  N√≥ chia t·∫≠p k·∫øt qu·∫£ th√†nh c√°c <b>ph√¢n v√πng ho·∫∑c nh√≥m</b>
                </li>
                <li>
                  M·ªói h√†m x·∫øp h·∫°ng s·∫Ω ƒë∆∞·ª£c <b>t√≠nh to√°n l·∫°i t·ª´ ƒë·∫ßu</b> cho m·ªói
                  ph√¢n v√πng
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• t·ªïng h·ª£p v·ªõi PARTITION BY:</h4>
              <div class="code-block">
                SELECT product_id, product_name, category_id, list_price, -- X·∫øp
                h·∫°ng trong to√†n b·ªô b·∫£ng ROW_NUMBER() OVER (ORDER BY list_price
                DESC) AS overall_row_num, RANK() OVER (ORDER BY list_price DESC)
                AS overall_rank, DENSE_RANK() OVER (ORDER BY list_price DESC) AS
                overall_dense_rank, -- X·∫øp h·∫°ng trong t·ª´ng danh m·ª•c ROW_NUMBER()
                OVER (PARTITION BY category_id ORDER BY list_price DESC) AS
                category_row_num, RANK() OVER (PARTITION BY category_id ORDER BY
                list_price DESC) AS category_rank, DENSE_RANK() OVER (PARTITION
                BY category_id ORDER BY list_price DESC) AS category_dense_rank
                FROM products ORDER BY category_id, list_price DESC;
              </div>
            </div>

            <h3>üìà C√°c Window Functions kh√°c</h3>

            <h4>üî¢ NTILE() - Chia th√†nh nh√≥m</h4>
            <div class="example">
              <p>
                <b>Ch·ª©c nƒÉng:</b> Chia t·∫≠p k·∫øt qu·∫£ th√†nh N nh√≥m (tiles) c√≥ k√≠ch
                th∆∞·ªõc g·∫ßn b·∫±ng nhau.
              </p>
              <div class="code-block">
                -- Chia kh√°ch h√†ng th√†nh 4 nh√≥m theo t·ªïng chi ti√™u SELECT
                customer_id, customer_name, total_spent, NTILE(4) OVER (ORDER BY
                total_spent DESC) AS spending_quartile FROM ( SELECT
                c.customer_id, c.customer_name, COALESCE(SUM(o.total_amount), 0)
                AS total_spent FROM customers c LEFT JOIN orders o ON
                c.customer_id = o.customer_id GROUP BY c.customer_id,
                c.customer_name ) customer_spending ORDER BY total_spent DESC;
              </div>
              <p>
                <b>·ª®ng d·ª•ng:</b> Ph√¢n kh√∫c kh√°ch h√†ng (quartile 1 = VIP,
                quartile 4 = √≠t chi ti√™u)
              </p>
            </div>

            <h4>‚¨ÜÔ∏è‚¨áÔ∏è LAG() v√† LEAD() - Truy c·∫≠p h√†ng tr∆∞·ªõc/sau</h4>
            <div class="example">
              <p>
                <b>Ch·ª©c nƒÉng:</b> LAG() l·∫•y gi√° tr·ªã t·ª´ h√†ng tr∆∞·ªõc, LEAD() l·∫•y
                gi√° tr·ªã t·ª´ h√†ng sau.
              </p>
              <div class="code-block">
                -- So s√°nh doanh thu th√°ng hi·ªán t·∫°i v·ªõi th√°ng tr∆∞·ªõc SELECT
                sales_month, monthly_revenue, LAG(monthly_revenue, 1) OVER
                (ORDER BY sales_month) AS previous_month_revenue,
                LEAD(monthly_revenue, 1) OVER (ORDER BY sales_month) AS
                next_month_revenue, -- T√≠nh ph·∫ßn trƒÉm tƒÉng tr∆∞·ªüng CASE WHEN
                LAG(monthly_revenue, 1) OVER (ORDER BY sales_month) > 0 THEN
                ROUND( (monthly_revenue - LAG(monthly_revenue, 1) OVER (ORDER BY
                sales_month)) * 100.0 / LAG(monthly_revenue, 1) OVER (ORDER BY
                sales_month), 2 ) ELSE NULL END AS growth_percentage FROM (
                SELECT FORMAT(order_date, 'yyyy-MM') AS sales_month,
                SUM(total_amount) AS monthly_revenue FROM orders GROUP BY
                FORMAT(order_date, 'yyyy-MM') ) monthly_sales ORDER BY
                sales_month;
              </div>
            </div>

            <h4>üéØ FIRST_VALUE() v√† LAST_VALUE()</h4>
            <div class="example">
              <p>
                <b>Ch·ª©c nƒÉng:</b> L·∫•y gi√° tr·ªã ƒë·∫ßu ti√™n v√† cu·ªëi c√πng trong
                window.
              </p>
              <div class="code-block">
                -- So s√°nh gi√° s·∫£n ph·∫©m v·ªõi gi√° cao nh·∫•t v√† th·∫•p nh·∫•t trong danh
                m·ª•c SELECT product_id, product_name, category_id, list_price,
                FIRST_VALUE(list_price) OVER ( PARTITION BY category_id ORDER BY
                list_price DESC ROWS UNBOUNDED PRECEDING ) AS
                highest_price_in_category, LAST_VALUE(list_price) OVER (
                PARTITION BY category_id ORDER BY list_price DESC ROWS BETWEEN
                UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING ) AS
                lowest_price_in_category, -- T√≠nh ph·∫ßn trƒÉm so v·ªõi gi√° cao nh·∫•t
                ROUND( list_price * 100.0 / FIRST_VALUE(list_price) OVER (
                PARTITION BY category_id ORDER BY list_price DESC ROWS UNBOUNDED
                PRECEDING ), 2 ) AS percentage_of_max_price FROM products ORDER
                BY category_id, list_price DESC;
              </div>
            </div>

            <h3>üìä Window Frame Specification</h3>
            <div class="example">
              <h4>T√≠nh t·ªïng l≈©y k·∫ø v√† trung b√¨nh ƒë·ªông:</h4>
              <div class="code-block">
                -- Ph√¢n t√≠ch doanh thu v·ªõi c√°c frame kh√°c nhau SELECT
                order_date, daily_revenue, -- T·ªïng l≈©y k·∫ø t·ª´ ƒë·∫ßu ƒë·∫øn hi·ªán t·∫°i
                SUM(daily_revenue) OVER ( ORDER BY order_date ROWS UNBOUNDED
                PRECEDING ) AS cumulative_revenue, -- Trung b√¨nh ƒë·ªông 7 ng√†y
                AVG(daily_revenue) OVER ( ORDER BY order_date ROWS BETWEEN 6
                PRECEDING AND CURRENT ROW ) AS moving_avg_7_days, -- T·ªïng 3 ng√†y
                (tr∆∞·ªõc, hi·ªán t·∫°i, sau) SUM(daily_revenue) OVER ( ORDER BY
                order_date ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING ) AS
                sum_3_days FROM ( SELECT CAST(order_date AS DATE) AS order_date,
                SUM(total_amount) AS daily_revenue FROM orders GROUP BY
                CAST(order_date AS DATE) ) daily_sales ORDER BY order_date;
              </div>
            </div>

            <h3>üéØ V√≠ d·ª• th·ª±c t·∫ø: Ph√¢n t√≠ch hi·ªáu su·∫•t b√°n h√†ng</h3>
            <div class="example">
              <h4>B√°o c√°o to√†n di·ªán v·ªõi Window Functions:</h4>
              <div class="code-block">
                -- Ph√¢n t√≠ch hi·ªáu su·∫•t nh√¢n vi√™n b√°n h√†ng WITH sales_performance
                AS ( SELECT e.employee_id, e.employee_name, e.department_id,
                COUNT(o.order_id) AS total_orders, SUM(o.total_amount) AS
                total_sales, AVG(o.total_amount) AS avg_order_value FROM
                employees e LEFT JOIN orders o ON e.employee_id = o.sales_rep_id
                WHERE e.department_id = 1 -- Sales department GROUP BY
                e.employee_id, e.employee_name, e.department_id ) SELECT
                employee_id, employee_name, total_orders, total_sales,
                avg_order_value, -- X·∫øp h·∫°ng theo doanh thu RANK() OVER (ORDER
                BY total_sales DESC) AS sales_rank, DENSE_RANK() OVER (ORDER BY
                total_sales DESC) AS sales_dense_rank, -- Ph√¢n nh√≥m hi·ªáu su·∫•t
                (top 25%, 50%, 75%, bottom 25%) NTILE(4) OVER (ORDER BY
                total_sales DESC) AS performance_quartile, -- So s√°nh v·ªõi nh√¢n
                vi√™n t·ªët nh·∫•t v√† k√©m nh·∫•t FIRST_VALUE(total_sales) OVER (ORDER
                BY total_sales DESC) AS top_performer_sales,
                LAST_VALUE(total_sales) OVER ( ORDER BY total_sales DESC ROWS
                BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING ) AS
                bottom_performer_sales, -- Ph·∫ßn trƒÉm so v·ªõi top performer ROUND(
                total_sales * 100.0 / FIRST_VALUE(total_sales) OVER (ORDER BY
                total_sales DESC), 2 ) AS percentage_of_top_performer, -- So
                s√°nh v·ªõi nh√¢n vi√™n tr∆∞·ªõc v√† sau LAG(total_sales) OVER (ORDER BY
                total_sales DESC) AS higher_performer_sales, LEAD(total_sales)
                OVER (ORDER BY total_sales DESC) AS lower_performer_sales, --
                Ph√¢n lo·∫°i hi·ªáu su·∫•t CASE WHEN NTILE(4) OVER (ORDER BY
                total_sales DESC) = 1 THEN 'Xu·∫•t s·∫Øc' WHEN NTILE(4) OVER (ORDER
                BY total_sales DESC) = 2 THEN 'T·ªët' WHEN NTILE(4) OVER (ORDER BY
                total_sales DESC) = 3 THEN 'Trung b√¨nh' ELSE 'C·∫ßn c·∫£i thi·ªán' END
                AS performance_category FROM sales_performance ORDER BY
                total_sales DESC;
              </div>
            </div>

            <h3>üí° Best Practices cho Window Functions</h3>
            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>S·ª≠ d·ª•ng alias:</b> ƒê·∫∑t t√™n r√µ r√†ng cho window functions
                </li>
                <li>
                  <b>PARTITION BY hi·ªáu qu·∫£:</b> Chia nh·ªè dataset ƒë·ªÉ tƒÉng hi·ªáu
                  su·∫•t
                </li>
                <li><b>ORDER BY ph√π h·ª£p:</b> Ch·ªçn c·ªôt s·∫Øp x·∫øp c√≥ √Ω nghƒ©a</li>
                <li>
                  <b>Index:</b> T·∫°o index tr√™n c·ªôt ORDER BY v√† PARTITION BY
                </li>
                <li>
                  <b>Frame specification:</b> X√°c ƒë·ªãnh r√µ frame khi c·∫ßn thi·∫øt
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li>
                  <b>Qu√° nhi·ªÅu window functions:</b> C√≥ th·ªÉ l√†m ch·∫≠m query
                </li>
                <li><b>Frame kh√¥ng c·∫ßn thi·∫øt:</b> Ch·ªâ d√πng khi th·ª±c s·ª± c·∫ßn</li>
                <li><b>PARTITION BY qu√° nhi·ªÅu c·ªôt:</b> C√≥ th·ªÉ gi·∫£m hi·ªáu qu·∫£</li>
                <li>
                  <b>Window functions trong WHERE:</b> Kh√¥ng ƒë∆∞·ª£c ph√©p, d√πng
                  subquery
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                Vi·ªác s·ª≠ d·ª•ng c√°c <b>h√†m c·ª≠a s·ªï</b> gi√∫p b·∫°n th·ª±c hi·ªán c√°c ph√©p
                ph√¢n t√≠ch ph·ª©c t·∫°p m√† kh√¥ng c·∫ßn d√πng ƒë·∫øn JOIN ho·∫∑c GROUP BY l·ªìng
                nhau. Ch√∫ng ƒë·∫∑c bi·ªát h·ªØu √≠ch cho:
              </p>
              <ul>
                <li><b>X·∫øp h·∫°ng v√† so s√°nh</b></li>
                <li><b>Ph√¢n t√≠ch xu h∆∞·ªõng</b> (LAG/LEAD)</li>
                <li><b>T√≠nh to√°n l≈©y k·∫ø</b> (Running totals)</li>
                <li><b>Ph√¢n nh√≥m hi·ªáu su·∫•t</b> (NTILE)</li>
                <li><b>So s√°nh v·ªõi gi√° tr·ªã c·ª±c ƒë·∫°i/c·ª±c ti·ªÉu</b></li>
              </ul>
            </div>
          </section>

          <!-- 20 -->
          <section class="section" id="cte">
            <h2>20. CTE</h2>

            <div class="info-box">
              <h4>üéØ CTE l√† g√¨?</h4>
              <p>
                <b>CTE (Common Table Expression)</b> l√† m·ªôt t·∫≠p h·ª£p k·∫øt qu·∫£ t·∫°m
                th·ªùi, ƒë∆∞·ª£c ƒë·∫∑t t√™n, ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong ph·∫°m vi c·ªßa m·ªôt c√¢u
                l·ªánh SQL duy nh·∫•t. B·∫°n c√≥ th·ªÉ coi CTE nh∆∞ m·ªôt
                <b>bi·∫øn b·∫£ng (table variable)</b> ch·ªâ t·ªìn t·∫°i trong su·ªët qu√°
                tr√¨nh th·ª±c thi c·ªßa c√¢u l·ªánh truy v·∫•n.
              </p>
              <p>
                CTE gi√∫p b·∫°n <b>t·ªï ch·ª©c c√°c truy v·∫•n ph·ª©c t·∫°p</b> m·ªôt c√°ch g·ªçn
                g√†ng v√† d·ªÖ ƒë·ªçc h∆°n, ƒë·∫∑c bi·ªát khi c·∫ßn truy v·∫•n l·ªìng nhau ho·∫∑c s·ª≠
                d·ª•ng l·∫°i m·ªôt ph·∫ßn c·ªßa truy v·∫•n nhi·ªÅu l·∫ßn.
              </p>
            </div>

            <h3>üìù C√∫ ph√°p c·ªßa CTE</h3>
            <div class="highlight-box">
              <p>
                M·ªôt CTE ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng m·ªánh ƒë·ªÅ <b>WITH</b>, theo sau l√†
                t√™n c·ªßa CTE v√† c√¢u l·ªánh SELECT c·ªßa n√≥.
              </p>
            </div>

            <div class="example">
              <h4>C√∫ ph√°p chung:</h4>
              <div class="code-block">
                WITH cte_name AS ( SELECT column1, column2 FROM table_name WHERE
                condition ) SELECT * FROM cte_name WHERE another_condition;
              </div>

              <p><b>C√°c th√†nh ph·∫ßn:</b></p>
              <ul>
                <li><b>WITH:</b> M·ªánh ƒë·ªÅ b·∫Øt ƒë·∫ßu c·ªßa CTE</li>
                <li><b>cte_name:</b> T√™n b·∫°n ƒë·∫∑t cho t·∫≠p k·∫øt qu·∫£ t·∫°m th·ªùi</li>
                <li>
                  <b>AS ( ... ):</b> Khai b√°o truy v·∫•n SELECT t·∫°o ra t·∫≠p k·∫øt qu·∫£
                  c·ªßa CTE
                </li>
                <li>
                  <b>SELECT * FROM cte_name:</b> Sau khi CTE ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a,
                  b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng t√™n c·ªßa n√≥ nh∆∞ m·ªôt b·∫£ng th√¥ng th∆∞·ªùng trong
                  c√¢u l·ªánh ch√≠nh
                </li>
              </ul>
            </div>

            <h3>üîÑ So s√°nh: Tr∆∞·ªõc v√† sau khi s·ª≠ d·ª•ng CTE</h3>

            <div class="example">
              <h4>‚ùå Kh√¥ng s·ª≠ d·ª•ng CTE (Subquery):</h4>
              <p>
                Gi·∫£ s·ª≠ b·∫°n mu·ªën t√¨m c√°c s·∫£n ph·∫©m c√≥ t·ªïng s·ªë l∆∞·ª£ng b√°n ƒë∆∞·ª£c l·ªõn
                h∆°n 10:
              </p>
              <div class="code-block">
                -- C√°ch c≈©: S·ª≠ d·ª•ng subquery l·ªìng nhau SELECT * FROM ( SELECT
                product_id, SUM(quantity) AS total_quantity FROM order_items
                GROUP BY product_id ) AS ProductSales WHERE total_quantity > 10;
              </div>
              <p>
                <b>V·∫•n ƒë·ªÅ:</b> Kh√≥ ƒë·ªçc, kh√≥ hi·ªÉu, kh√≥ b·∫£o tr√¨ khi truy v·∫•n ph·ª©c
                t·∫°p h∆°n.
              </p>
            </div>

            <div class="example">
              <h4>‚úÖ S·ª≠ d·ª•ng CTE:</h4>
              <div class="code-block">
                -- C√°ch m·ªõi: S·ª≠ d·ª•ng CTE WITH ProductSales AS ( SELECT
                product_id, SUM(quantity) AS total_quantity FROM order_items
                GROUP BY product_id ) SELECT * FROM ProductSales WHERE
                total_quantity > 10;
              </div>

              <p><b>Gi·∫£i th√≠ch t·ª´ng b∆∞·ªõc:</b></p>
              <ol>
                <li>
                  <b>B∆∞·ªõc 1 (WITH):</b>
                  <code>WITH ProductSales AS (...)</code> ƒë·ªãnh nghƒ©a m·ªôt CTE c√≥
                  t√™n l√† <code>ProductSales</code>. CTE n√†y ch·ª©a m·ªôt truy v·∫•n
                  t√≠nh t·ªïng s·ªë l∆∞·ª£ng b√°n ƒë∆∞·ª£c c·ªßa m·ªói s·∫£n ph·∫©m t·ª´ b·∫£ng
                  <code>order_items</code>.
                </li>
                <li>
                  <b>B∆∞·ªõc 2 (SELECT):</b> Sau ƒë√≥, b·∫°n c√≥ th·ªÉ d·ªÖ d√†ng truy v·∫•n t·ª´
                  CTE <code>ProductSales</code> nh∆∞ m·ªôt b·∫£ng th√¥ng th∆∞·ªùng. C√¢u
                  l·ªánh ch√≠nh
                  <code
                    >SELECT * FROM ProductSales WHERE total_quantity > 10;</code
                  >
                  s·∫Ω tr·∫£ v·ªÅ t·∫•t c·∫£ c√°c c·ªôt t·ª´ CTE, nh∆∞ng ch·ªâ nh·ªØng h√†ng c√≥
                  <code>total_quantity</code> l·ªõn h∆°n 10.
                </li>
              </ol>
            </div>

            <h3>üåü ∆Øu ƒëi·ªÉm c·ªßa CTE</h3>
            <div class="success-box">
              <h4>‚úÖ Nh·ªØng l·ª£i √≠ch ch√≠nh:</h4>
              <ul>
                <li>
                  <b>D·ªÖ ƒë·ªçc v√† b·∫£o tr√¨:</b> CTE gi√∫p chia nh·ªè c√°c truy v·∫•n ph·ª©c
                  t·∫°p th√†nh c√°c kh·ªëi nh·ªè h∆°n, d·ªÖ hi·ªÉu h∆°n
                </li>
                <li>
                  <b>C√≥ th·ªÉ t√°i s·ª≠ d·ª•ng:</b> B·∫°n c√≥ th·ªÉ tham chi·∫øu ƒë·∫øn m·ªôt CTE
                  nhi·ªÅu l·∫ßn trong c√πng m·ªôt c√¢u l·ªánh SELECT, gi√∫p tr√°nh l·∫∑p l·∫°i
                  m√£
                </li>
                <li>
                  <b>C√≥ kh·∫£ nƒÉng ƒë·ªá quy:</b> CTE c√≥ th·ªÉ t·ª± tham chi·∫øu ƒë·∫øn ch√≠nh
                  n√≥, cho ph√©p b·∫°n th·ª±c hi·ªán c√°c truy v·∫•n ƒë·ªá quy
                </li>
                <li>
                  <b>Gi·∫£i quy·∫øt b√†i to√°n ph·ª©c t·∫°p:</b> CTE th∆∞·ªùng l√† gi·∫£i ph√°p
                  t·ªët h∆°n v√† d·ªÖ hi·ªÉu h∆°n cho c√°c b√†i to√°n m√† subquery tr·ªü n√™n
                  qu√° ph·ª©c t·∫°p
                </li>
              </ul>
            </div>

            <h3>üìö C√°c lo·∫°i CTE</h3>

            <h4>1Ô∏è‚É£ CTE ƒë∆°n gi·∫£n (Simple CTE)</h4>
            <div class="example">
              <p>
                ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l√†m cho truy v·∫•n d·ªÖ ƒë·ªçc h∆°n v√† t√°ch bi·ªát logic.
              </p>
              <div class="code-block">
                -- T√¨m kh√°ch h√†ng c√≥ ƒë∆°n h√†ng tr√™n 1 tri·ªáu WITH
                HighValueCustomers AS ( SELECT customer_id, customer_name,
                SUM(total_amount) AS total_spent FROM customers c INNER JOIN
                orders o ON c.customer_id = o.customer_id GROUP BY customer_id,
                customer_name HAVING SUM(total_amount) > 1000000 ) SELECT
                customer_name, total_spent, total_spent - 1000000 AS
                over_threshold FROM HighValueCustomers ORDER BY total_spent
                DESC;
              </div>
            </div>

            <h4>2Ô∏è‚É£ CTE v·ªõi nhi·ªÅu ƒë·ªãnh nghƒ©a (Multiple CTEs)</h4>
            <div class="example">
              <p>
                B·∫°n c√≥ th·ªÉ ƒë·ªãnh nghƒ©a nhi·ªÅu CTE trong m·ªôt c√¢u l·ªánh, ph√¢n c√°ch
                b·∫±ng d·∫•u ph·∫©y.
              </p>
              <div class="code-block">
                -- Ph√¢n t√≠ch doanh thu theo th√°ng v√† so s√°nh v·ªõi kh√°ch h√†ng VIP
                WITH MonthlySales AS ( SELECT YEAR(order_date) AS year,
                MONTH(order_date) AS month, SUM(total_amount) AS
                monthly_revenue, COUNT(order_id) AS total_orders FROM orders
                GROUP BY YEAR(order_date), MONTH(order_date) ), VipCustomers AS
                ( SELECT customer_id, customer_name, SUM(total_amount) AS
                lifetime_value FROM customers c INNER JOIN orders o ON
                c.customer_id = o.customer_id GROUP BY customer_id,
                customer_name HAVING SUM(total_amount) > 5000000 -- Kh√°ch h√†ng
                VIP > 5 tri·ªáu ), VipMonthlySales AS ( SELECT YEAR(o.order_date)
                AS year, MONTH(o.order_date) AS month, SUM(o.total_amount) AS
                vip_monthly_revenue FROM orders o INNER JOIN VipCustomers v ON
                o.customer_id = v.customer_id GROUP BY YEAR(o.order_date),
                MONTH(o.order_date) ) SELECT ms.year, ms.month,
                ms.monthly_revenue, ms.total_orders,
                COALESCE(vms.vip_monthly_revenue, 0) AS vip_revenue, ROUND(
                COALESCE(vms.vip_monthly_revenue, 0) * 100.0 /
                ms.monthly_revenue, 2 ) AS vip_percentage FROM MonthlySales ms
                LEFT JOIN VipMonthlySales vms ON ms.year = vms.year AND ms.month
                = vms.month ORDER BY ms.year DESC, ms.month DESC;
              </div>
            </div>

            <h4>3Ô∏è‚É£ CTE ƒë·ªá quy (Recursive CTE)</h4>
            <div class="example">
              <p>
                CTE ƒë·ªá quy cho ph√©p b·∫°n th·ª±c hi·ªán c√°c truy v·∫•n tr√™n c·∫•u tr√∫c d·ªØ
                li·ªáu ph√¢n c·∫•p nh∆∞ c√¢y t·ªï ch·ª©c, danh m·ª•c s·∫£n ph·∫©m...
              </p>
              <div class="code-block">
                -- V√≠ d·ª•: T√¨m t·∫•t c·∫£ nh√¢n vi√™n d∆∞·ªõi quy·ªÅn c·ªßa m·ªôt manager WITH
                EmployeeHierarchy AS ( -- Anchor: Manager g·ªëc SELECT
                <span class="keyword">WITH</span> EmployeeHierarchy
                <span class="keyword">AS</span> (
                <span class="comment"
                  >-- Anchor query: T√¨m ƒëi·ªÉm b·∫Øt ƒë·∫ßu (top managers)</span
                >
                <span class="keyword">SELECT</span>
                employee_id, employee_name, manager_id,
                <span class="number">1</span>
                <span class="keyword">AS</span> level,
                <span class="function">CAST</span>(employee_name
                <span class="keyword">AS</span>
                <span class="datatype">NVARCHAR</span>(<span class="number"
                  >1000</span
                >)) <span class="keyword">AS</span> hierarchy_path
                <span class="keyword">FROM</span> employees
                <span class="keyword">WHERE</span> manager_id
                <span class="keyword">IS NULL</span>
                <span class="comment">-- Top-level managers</span>

                <span class="keyword">UNION ALL</span>

                <span class="comment"
                  >-- Recursive part: T√¨m nh√¢n vi√™n d∆∞·ªõi quy·ªÅn</span
                >
                <span class="keyword">SELECT</span>
                e.employee_id, e.employee_name, e.manager_id, eh.level +
                <span class="number">1</span>,
                <span class="function">CAST</span>(eh.hierarchy_path +
                <span class="string">' > '</span> + e.employee_name
                <span class="keyword">AS</span>
                <span class="datatype">NVARCHAR</span>(<span class="number"
                  >1000</span
                >)) <span class="keyword">FROM</span> employees e
                <span class="keyword">INNER JOIN</span> EmployeeHierarchy eh
                <span class="keyword">ON</span> e.manager_id = eh.employee_id
                <span class="keyword">WHERE</span> eh.level <
                <span class="number">10</span>
                <span class="comment"
                  >-- Gi·ªõi h·∫°n ƒë·ªô s√¢u ƒë·ªÉ tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n</span
                >
                )
                <span class="keyword">SELECT</span>
                employee_id, employee_name, level, hierarchy_path,
                <span class="function">REPLICATE</span>(<span class="string"
                  >' '</span
                >, level - <span class="number">1</span>) + employee_name
                <span class="keyword">AS</span> indented_name
                <span class="keyword">FROM</span> EmployeeHierarchy
                <span class="keyword">ORDER BY</span> hierarchy_path;
              </div>

              <p><b>Gi·∫£i th√≠ch CTE ƒë·ªá quy:</b></p>
              <ul>
                <li>
                  <b>Anchor query:</b> Ph·∫ßn ƒë·∫ßu t√¨m ƒëi·ªÉm b·∫Øt ƒë·∫ßu (managers kh√¥ng
                  c√≥ manager)
                </li>
                <li>
                  <b>UNION ALL:</b> K·∫øt h·ª£p k·∫øt qu·∫£ t·ª´ anchor v√† recursive part
                </li>
                <li>
                  <b>Recursive part:</b> T·ª± tham chi·∫øu ƒë·∫øn CTE ƒë·ªÉ t√¨m c√°c level
                  ti·∫øp theo
                </li>
                <li>
                  <b>Termination condition:</b> ƒêi·ªÅu ki·ªán d·ª´ng ƒë·ªÉ tr√°nh v√≤ng l·∫∑p
                  v√¥ h·∫°n
                </li>
              </ul>
            </div>

            <h3>üí° V√≠ d·ª• th·ª±c t·∫ø: Ph√¢n t√≠ch doanh s·ªë b√°n h√†ng</h3>
            <div class="example">
              <h4>B√°o c√°o t·ªïng h·ª£p s·ª≠ d·ª•ng nhi·ªÅu CTE:</h4>
              <div class="code-block">
                <span class="comment"
                  >-- Ph√¢n t√≠ch hi·ªáu su·∫•t b√°n h√†ng t·ªïng th·ªÉ</span
                >
                <span class="keyword">WITH</span> CategorySales
                <span class="keyword">AS</span> (
                <span class="comment">-- Doanh thu theo danh m·ª•c</span>
                <span class="keyword">SELECT</span>
                c.category_id, c.category_name,
                <span class="function">SUM</span>(oi.quantity * oi.list_price)
                <span class="keyword">AS</span> category_revenue,
                <span class="function">COUNT</span>(<span class="keyword"
                  >DISTINCT</span
                >
                o.order_id) <span class="keyword">AS</span> total_orders,
                <span class="function">AVG</span>(oi.quantity * oi.list_price)
                <span class="keyword">AS</span> avg_order_value
                <span class="keyword">FROM</span> categories c
                <span class="keyword">INNER JOIN</span> products p
                <span class="keyword">ON</span> c.category_id = p.category_id
                <span class="keyword">INNER JOIN</span> order_items oi
                <span class="keyword">ON</span> p.product_id = oi.product_id
                <span class="keyword">INNER JOIN</span> orders o
                <span class="keyword">ON</span> oi.order_id = o.order_id
                <span class="keyword">WHERE</span> o.order_date >=
                <span class="function">DATEADD</span>(<span class="keyword"
                  >MONTH</span
                >, -<span class="number">12</span>,
                <span class="function">GETDATE</span>())
                <span class="comment">-- 12 th√°ng g·∫ßn nh·∫•t</span>
                <span class="keyword">GROUP BY</span> c.category_id,
                c.category_name ), TopProducts <span class="keyword">AS</span> (
                <span class="comment"
                  >-- Top 3 s·∫£n ph·∫©m b√°n ch·∫°y trong m·ªói danh m·ª•c</span
                >
                <span class="keyword">SELECT</span>
                category_id, product_id, product_name, total_sold,
                <span class="function">ROW_NUMBER</span>()
                <span class="keyword">OVER</span> (<span class="keyword"
                  >PARTITION BY</span
                >
                category_id <span class="keyword">ORDER BY</span> total_sold
                <span class="keyword">DESC</span>)
                <span class="keyword">AS</span> rank_in_category
                <span class="keyword">FROM</span> (
                <span class="keyword">SELECT</span>
                p.category_id, p.product_id, p.product_name,
                <span class="function">SUM</span>(oi.quantity)
                <span class="keyword">AS</span> total_sold
                <span class="keyword">FROM</span> products p
                <span class="keyword">INNER JOIN</span> order_items oi
                <span class="keyword">ON</span> p.product_id = oi.product_id
                <span class="keyword">INNER JOIN</span> orders o
                <span class="keyword">ON</span> oi.order_id = o.order_id
                <span class="keyword">WHERE</span> o.order_date >=
                <span class="function">DATEADD</span>(<span class="keyword"
                  >MONTH</span
                >, -<span class="number">12</span>,
                <span class="function">GETDATE</span>())
                <span class="keyword">GROUP BY</span> p.category_id,
                p.product_id, p.product_name ) ProductSales ), QuarterlySales
                <span class="keyword">AS</span> (
                <span class="comment">-- Doanh thu theo qu√Ω</span>
                <span class="keyword">SELECT</span>
                <span class="function">YEAR</span>(o.order_date)
                <span class="keyword">AS</span> year,
                <span class="function">CEILING</span>(<span class="function"
                  >MONTH</span
                >(o.order_date) / <span class="number">3.0</span>)
                <span class="keyword">AS</span> quarter,
                <span class="function">SUM</span>(oi.quantity * oi.list_price)
                <span class="keyword">AS</span> quarterly_revenue
                <span class="keyword">FROM</span> orders o
                <span class="keyword">INNER JOIN</span> order_items oi
                <span class="keyword">ON</span> o.order_id = oi.order_id
                <span class="keyword">WHERE</span> o.order_date >=
                <span class="function">DATEADD</span>(<span class="keyword"
                  >MONTH</span
                >, -<span class="number">12</span>,
                <span class="function">GETDATE</span>())
                <span class="keyword">GROUP BY</span>
                <span class="function">YEAR</span>(o.order_date),
                <span class="function">CEILING</span>(<span class="function"
                  >MONTH</span
                >(o.order_date) / <span class="number">3.0</span>) )
                <span class="comment"
                  >-- Truy v·∫•n ch√≠nh k·∫øt h·ª£p t·∫•t c·∫£ CTE</span
                >
                <span class="keyword">SELECT</span>
                cs.category_name, cs.category_revenue, cs.total_orders,
                cs.avg_order_value,
                <span class="comment"
                  >-- Top selling product trong danh m·ª•c</span
                >
                tp.product_name <span class="keyword">AS</span> top_product,
                tp.total_sold
                <span class="keyword">AS</span> top_product_quantity,
                <span class="comment"
                  >-- Percentage c·ªßa danh m·ª•c so v·ªõi t·ªïng doanh thu</span
                >
                <span class="function">ROUND</span>( cs.category_revenue *
                <span class="number">100.0</span> /
                <span class="function">SUM</span>(cs.category_revenue)
                <span class="keyword">OVER</span>(),
                <span class="number">2</span> )
                <span class="keyword">AS</span> category_percentage,
                <span class="comment">-- Rank danh m·ª•c theo doanh thu</span>
                <span class="function">RANK</span>()
                <span class="keyword">OVER</span> (<span class="keyword"
                  >ORDER BY</span
                >
                cs.category_revenue <span class="keyword">DESC</span>)
                <span class="keyword">AS</span> category_rank
                <span class="keyword">FROM</span> CategorySales cs
                <span class="keyword">LEFT JOIN</span> TopProducts tp
                <span class="keyword">ON</span> cs.category_id = tp.category_id
                <span class="keyword">AND</span> tp.rank_in_category =
                <span class="number">1</span>
                <span class="keyword">ORDER BY</span> cs.category_revenue
                <span class="keyword">DESC</span>;
              </div>
            </div>

            <h3>‚ö° Hi·ªáu su·∫•t v√† Best Practices</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>ƒê·∫∑t t√™n CTE c√≥ √Ω nghƒ©a:</b> S·ª≠ d·ª•ng t√™n m√¥ t·∫£ r√µ r√†ng m·ª•c
                  ƒë√≠ch c·ªßa CTE
                </li>
                <li>
                  <b>S·ª≠ d·ª•ng CTE cho logic ph·ª©c t·∫°p:</b> Thay th·∫ø subquery l·ªìng
                  nhau b·∫±ng CTE
                </li>
                <li>
                  <b>Chia nh·ªè truy v·∫•n:</b> Chia m·ªôt truy v·∫•n l·ªõn th√†nh nhi·ªÅu
                  CTE nh·ªè h∆°n
                </li>
                <li>
                  <b>Comment r√µ r√†ng:</b> Th√™m comment gi·∫£i th√≠ch logic c·ªßa m·ªói
                  CTE
                </li>
                <li>
                  <b>T·ªëi ∆∞u index:</b> ƒê·∫£m b·∫£o c√°c c·ªôt trong WHERE, JOIN c√≥
                  index ph√π h·ª£p
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li>
                  <b>CTE qu√° ph·ª©c t·∫°p:</b> Kh√¥ng n√™n ƒë·∫∑t qu√° nhi·ªÅu logic v√†o m·ªôt
                  CTE
                </li>
                <li>
                  <b>Recursive CTE kh√¥ng c√≥ ƒëi·ªÅu ki·ªán d·ª´ng:</b> C√≥ th·ªÉ g√¢y v√≤ng
                  l·∫∑p v√¥ h·∫°n
                </li>
                <li>
                  <b>S·ª≠ d·ª•ng CTE khi kh√¥ng c·∫ßn:</b> V·ªõi truy v·∫•n ƒë∆°n gi·∫£n,
                  subquery c√≥ th·ªÉ ƒë·ªß
                </li>
                <li><b>Qu√™n index:</b> CTE v·∫´n c·∫ßn index ƒë·ªÉ ch·∫°y nhanh</li>
              </ul>
            </div>

            <h3>üîÑ CTE vs Subquery vs Temporary Table</h3>
            <table>
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>CTE</th>
                  <th>Subquery</th>
                  <th>Temporary Table</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>Kh·∫£ nƒÉng ƒë·ªçc</b></td>
                  <td>R·∫•t t·ªët</td>
                  <td>Kh√≥ v·ªõi truy v·∫•n ph·ª©c t·∫°p</td>
                  <td>T·ªët</td>
                </tr>
                <tr>
                  <td><b>T√°i s·ª≠ d·ª•ng</b></td>
                  <td>Trong c√πng m·ªôt query</td>
                  <td>Kh√¥ng</td>
                  <td>Trong c√πng session</td>
                </tr>
                <tr>
                  <td><b>ƒê·ªá quy</b></td>
                  <td>C√≥</td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                </tr>
                <tr>
                  <td><b>Hi·ªáu su·∫•t</b></td>
                  <td>T∆∞∆°ng ƒë∆∞∆°ng subquery</td>
                  <td>T·ªët</td>
                  <td>T·ªët cho dataset l·ªõn</td>
                </tr>
                <tr>
                  <td><b>Khi n√†o d√πng</b></td>
                  <td>Logic ph·ª©c t·∫°p, ƒë·ªá quy</td>
                  <td>Truy v·∫•n ƒë∆°n gi·∫£n</td>
                  <td>D·ªØ li·ªáu l·ªõn, nhi·ªÅu thao t√°c</td>
                </tr>
              </tbody>
            </table>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>CTE</b> l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω gi√∫p b·∫°n vi·∫øt SQL
                <b>d·ªÖ ƒë·ªçc, d·ªÖ hi·ªÉu v√† d·ªÖ b·∫£o tr√¨</b>. ƒê·∫∑c bi·ªát h·ªØu √≠ch cho:
              </p>
              <ul>
                <li>
                  <b>Chia nh·ªè truy v·∫•n ph·ª©c t·∫°p</b> th√†nh c√°c b∆∞·ªõc logic r√µ r√†ng
                </li>
                <li><b>Thay th·∫ø subquery l·ªìng nhau</b> kh√≥ ƒë·ªçc</li>
                <li><b>X·ª≠ l√Ω d·ªØ li·ªáu ph√¢n c·∫•p</b> v·ªõi CTE ƒë·ªá quy</li>
                <li><b>T√°i s·ª≠ d·ª•ng logic</b> trong c√πng m·ªôt truy v·∫•n</li>
                <li><b>L√†m vi·ªác nh√≥m</b> - code d·ªÖ hi·ªÉu cho ƒë·ªìng nghi·ªáp</li>
              </ul>
            </div>
          </section>

          <!-- 21 -->
          <section class="section" id="conditions">
            <h2>21. C√¢u l·ªánh ƒëi·ªÅu khi·ªÉn</h2>

            <div class="info-box">
              <h4>üéõÔ∏è C√°c c√¢u l·ªánh ƒëi·ªÅu khi·ªÉn (Control Flow Statements)</h4>
              <p>
                C√°c c√¢u l·ªánh ƒëi·ªÅu khi·ªÉn trong SQL, th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c
                <b>th·ªß t·ª•c l∆∞u tr·ªØ (Stored Procedures)</b>,
                <b>h√†m (Functions)</b>, v√† <b>kh·ªëi m√£ (Blocks)</b>, cho ph√©p b·∫°n
                ƒëi·ªÅu h∆∞·ªõng logic th·ª±c thi c·ªßa ch∆∞∆°ng tr√¨nh.
              </p>
              <p>
                Ch√∫ng gi√∫p t·∫°o ra c√°c
                <b>logic ph·ª©c t·∫°p, x·ª≠ l√Ω ƒëi·ªÅu ki·ªán, l·∫∑p v√† x·ª≠ l√Ω l·ªói</b> trong
                SQL.
              </p>
            </div>

            <h3>üîÄ 1. C√¢u l·ªánh ƒëi·ªÅu ki·ªán (IF...ELSE, CASE)</h3>

            <h4>‚ö° IF...ELSE</h4>
            <div class="highlight-box">
              <p>
                Cho ph√©p b·∫°n th·ª±c hi·ªán c√°c kh·ªëi m√£ kh√°c nhau d·ª±a tr√™n m·ªôt ƒëi·ªÅu
                ki·ªán.
              </p>
            </div>

            <div class="example">
              <h4>C√∫ ph√°p c∆° b·∫£n:</h4>
              <div class="code-block">
                -- C√∫ ph√°p IF...ELSE ƒë∆°n gi·∫£n IF condition statement(s) ELSE
                statement(s); -- C√∫ ph√°p IF...ELSE v·ªõi kh·ªëi l·ªánh IF condition
                BEGIN statement1; statement2; END ELSE BEGIN statement3;
                statement4; END;
              </div>
            </div>

            <div class="example">
              <h4>V√≠ d·ª• th·ª±c t·∫ø:</h4>
              <div class="code-block">
                -- Ph√¢n lo·∫°i s·∫£n ph·∫©m theo gi√° DECLARE @price DECIMAL(10, 2) =
                1500; IF @price > 1000 PRINT 'S·∫£n ph·∫©m ƒë·∫Øt ti·ªÅn'; ELSE PRINT
                'S·∫£n ph·∫©m b√¨nh d√¢n'; -- V√≠ d·ª• ph·ª©c t·∫°p h∆°n v·ªõi nhi·ªÅu ƒëi·ªÅu ki·ªán
                DECLARE @quantity INT = 50; DECLARE @status VARCHAR(20); IF
                @quantity > 100 BEGIN SET @status = 'D∆∞ th·ª´a'; PRINT 'Kho h√†ng
                d∆∞ th·ª´a, c·∫ßn khuy·∫øn m√£i'; END ELSE IF @quantity > 50 BEGIN SET
                @status = 'ƒê·ªß d√πng'; PRINT 'M·ª©c t·ªìn kho ·ªïn ƒë·ªãnh'; END ELSE IF
                @quantity > 10 BEGIN SET @status = 'S·∫Øp h·∫øt'; PRINT 'C·∫ßn nh·∫≠p
                th√™m h√†ng'; END ELSE BEGIN SET @status = 'H·∫øt h√†ng'; PRINT 'Kh·∫©n
                c·∫•p: Nh·∫≠p h√†ng ngay!'; END; SELECT @status AS inventory_status;
              </div>
            </div>

            <h4>üîÑ CASE</h4>
            <div class="highlight-box">
              <p>
                M·ªôt bi·ªÉu th·ª©c ph·ª©c t·∫°p h∆°n IF...ELSE, cho ph√©p b·∫°n so s√°nh m·ªôt
                gi√° tr·ªã v·ªõi nhi·ªÅu ƒëi·ªÅu ki·ªán kh√°c nhau v√† tr·∫£ v·ªÅ k·∫øt qu·∫£ t∆∞∆°ng
                ·ª©ng.
              </p>
            </div>

            <div class="example">
              <h4>CASE trong SELECT:</h4>
              <div class="code-block">
                <span class="comment">-- Ph√¢n lo·∫°i s·∫£n ph·∫©m theo gi√°</span>
                <span class="keyword">SELECT</span> <span class="column">product_id</span>, <span class="column">product_name</span>, <span class="column">list_price</span>,
                  <span class="keyword">CASE</span> 
                    <span class="keyword">WHEN</span> <span class="column">list_price</span> <span class="operator">></span> <span class="number">1000</span> <span class="keyword">THEN</span> <span class="string">'High-end'</span>
                    <span class="keyword">WHEN</span> <span class="column">list_price</span> <span class="keyword">BETWEEN</span> <span class="number">500</span> <span class="keyword">AND</span> <span class="number">1000</span> <span class="keyword">THEN</span> <span class="string">'Mid-range'</span>
                    <span class="keyword">WHEN</span> <span class="column">list_price</span> <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">499</span> <span class="keyword">THEN</span> <span class="string">'Budget'</span>
                    <span class="keyword">ELSE</span> <span class="string">'Economy'</span>
                  <span class="keyword">END</span> <span class="keyword">AS</span> <span class="column">product_category</span>,
                  <span class="comment">-- CASE v·ªõi ph√©p t√≠nh</span>
                  <span class="keyword">CASE</span> 
                    <span class="keyword">WHEN</span> <span class="column">list_price</span> <span class="operator">></span> <span class="number">1000</span> <span class="keyword">THEN</span> <span class="column">list_price</span> <span class="operator">*</span> <span class="number">0.05</span> <span class="comment">-- 5% discount</span>
                    <span class="keyword">WHEN</span> <span class="column">list_price</span> <span class="operator">></span> <span class="number">500</span> <span class="keyword">THEN</span> <span class="column">list_price</span> <span class="operator">*</span> <span class="number">0.03</span> <span class="comment">-- 3% discount</span>
                    <span class="keyword">ELSE</span> <span class="column">list_price</span> <span class="operator">*</span> <span class="number">0.01</span> <span class="comment">-- 1% discount</span>
                  <span class="keyword">END</span> <span class="keyword">AS</span> <span class="column">discount_amount</span>
                <span class="keyword">FROM</span> <span class="table">products</span>;
              </div>
            </div>

            <div class="example">
              <h4>CASE trong Stored Procedure:</h4>
              <div class="code-block">
                <span class="comment">-- Procedure t√≠nh ph√≠ ship d·ª±a tr√™n tr·ªçng l∆∞·ª£ng v√† kho·∫£ng c√°ch</span>
                <span class="keyword">CREATE PROCEDURE</span> <span class="function">CalculateShippingFee</span> 
                  <span class="column">@weight</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),
                  <span class="column">@distance</span> <span class="datatype">INT</span>,
                  <span class="column">@shipping_fee</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">OUTPUT</span>
                <span class="keyword">AS</span>
                <span class="keyword">BEGIN</span>
                  <span class="keyword">SET</span> <span class="column">@shipping_fee</span> <span class="operator">=</span> 
                    <span class="keyword">CASE</span> 
                      <span class="keyword">WHEN</span> <span class="column">@weight</span> <span class="operator"><=</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="column">@distance</span> <span class="operator"><=</span> <span class="number">50</span> <span class="keyword">THEN</span> <span class="number">20000</span>
                      <span class="keyword">WHEN</span> <span class="column">@weight</span> <span class="operator"><=</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="column">@distance</span> <span class="operator"><=</span> <span class="number">100</span> <span class="keyword">THEN</span> <span class="number">35000</span>
                      <span class="keyword">WHEN</span> <span class="column">@weight</span> <span class="operator"><=</span> <span class="number">5</span> <span class="keyword">AND</span> <span class="column">@distance</span> <span class="operator"><=</span> <span class="number">50</span> <span class="keyword">THEN</span> <span class="number">40000</span>
                      <span class="keyword">WHEN</span> <span class="column">@weight</span> <span class="operator"><=</span> <span class="number">5</span> <span class="keyword">AND</span> <span class="column">@distance</span> <span class="operator"><=</span> <span class="number">100</span> <span class="keyword">THEN</span> <span class="number">60000</span>
                      <span class="keyword">WHEN</span> <span class="column">@weight</span> <span class="operator"><=</span> <span class="number">10</span> <span class="keyword">THEN</span> <span class="number">80000</span> <span class="operator">+</span> (<span class="column">@distance</span> <span class="operator">*</span> <span class="number">500</span>)
                      <span class="keyword">ELSE</span> <span class="number">120000</span> <span class="operator">+</span> (<span class="column">@weight</span> <span class="operator">*</span> <span class="number">5000</span>) <span class="operator">+</span> (<span class="column">@distance</span> <span class="operator">*</span> <span class="number">800</span>)
                    <span class="keyword">END</span>;
                    
                  <span class="comment">-- Log t√≠nh ph√≠</span>
                  <span class="keyword">PRINT</span> <span class="string">'Tr·ªçng l∆∞·ª£ng: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">@weight</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>) <span class="operator">+</span> <span class="string">'kg'</span>;
                  <span class="keyword">PRINT</span> <span class="string">'Kho·∫£ng c√°ch: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">@distance</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>) <span class="operator">+</span> <span class="string">'km'</span>;
                  <span class="keyword">PRINT</span> <span class="string">'Ph√≠ ship: '</span> <span class="operator">+</span> <span class="function">FORMAT</span>(<span class="column">@shipping_fee</span>, <span class="string">'N0'</span>) <span class="operator">+</span> <span class="string">' VND'</span>;
                <span class="keyword">END</span>;
              </div>
            </div>

            <h3>üîÑ 2. V√≤ng l·∫∑p (LOOP, WHILE/REPEAT)</h3>

            <h4>‚è∞ WHILE</h4>
            <div class="highlight-box">
              <p>L·∫∑p l·∫°i m·ªôt kh·ªëi m√£ mi·ªÖn l√† m·ªôt ƒëi·ªÅu ki·ªán c√≤n ƒë√∫ng.</p>
            </div>

            <div class="example">
              <h4>WHILE c∆° b·∫£n:</h4>
              <div class="code-block">
                <span class="comment">-- ƒê·∫øm t·ª´ 1 ƒë·∫øn 5</span>
                <span class="keyword">DECLARE</span> <span class="column">@counter</span> <span class="datatype">INT</span> <span class="operator">=</span> <span class="number">1</span>;
                <span class="keyword">WHILE</span> <span class="column">@counter</span> <span class="operator"><=</span> <span class="number">5</span>
                <span class="keyword">BEGIN</span>
                  <span class="keyword">PRINT</span> <span class="string">'S·ªë ƒë·∫øm: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">@counter</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>);
                  <span class="keyword">SET</span> <span class="column">@counter</span> <span class="operator">=</span> <span class="column">@counter</span> <span class="operator">+</span> <span class="number">1</span>;
                <span class="keyword">END</span>;
                <span class="keyword">PRINT</span> <span class="string">'Ho√†n th√†nh ƒë·∫øm!'</span>;
              </div>
            </div>

            <div class="example">
              <h4>WHILE v·ªõi logic ph·ª©c t·∫°p:</h4>
              <div class="code-block">
                -- T·ª± ƒë·ªông t·∫°o m√£ s·∫£n ph·∫©m DECLARE @product_count INT = 0;
                DECLARE @max_products INT = 10; DECLARE @product_code
                VARCHAR(20); WHILE @product_count < @max_products BEGIN SET
                @product_count = @product_count + 1; -- T·∫°o m√£ s·∫£n ph·∫©m SET
                @product_code = 'PRD' + RIGHT('000' + CAST(@product_count AS
                VARCHAR), 3); -- Ki·ªÉm tra m√£ ƒë√£ t·ªìn t·∫°i ch∆∞a IF NOT EXISTS
                (SELECT 1 FROM products WHERE product_code = @product_code)
                BEGIN INSERT INTO products (product_code, product_name,
                created_date) VALUES (@product_code, 'S·∫£n ph·∫©m ' +
                @product_code, GETDATE()); PRINT 'ƒê√£ t·∫°o s·∫£n ph·∫©m: ' +
                @product_code; END ELSE BEGIN PRINT 'M√£ ' + @product_code + ' ƒë√£
                t·ªìn t·∫°i, b·ªè qua...'; END; -- Ngh·ªâ 1 gi√¢y (n·∫øu c·∫ßn) WAITFOR DELAY
                '00:00:01'; END; PRINT 'Ho√†n th√†nh t·∫°o ' + CAST(@product_count
                AS VARCHAR) + ' s·∫£n ph·∫©m!';
              </div>
            </div>

            <div class="example">
              <h4>WHILE v·ªõi BREAK v√† CONTINUE:</h4>
              <div class="code-block">
                -- X·ª≠ l√Ω batch d·ªØ li·ªáu DECLARE @batch_size INT = 100; DECLARE
                @processed_count INT = 0; DECLARE @total_records INT; DECLARE
                @error_count INT = 0; -- ƒê·∫øm t·ªïng s·ªë records c·∫ßn x·ª≠ l√Ω SELECT
                @total_records = COUNT(*) FROM pending_orders; WHILE
                @processed_count < @total_records BEGIN BEGIN TRY -- X·ª≠ l√Ω batch
                UPDATE TOP(@batch_size) pending_orders SET status = 'processed',
                processed_date = GETDATE() WHERE status = 'pending'; SET
                @processed_count = @processed_count + @@ROWCOUNT; PRINT 'ƒê√£ x·ª≠
                l√Ω: ' + CAST(@processed_count AS VARCHAR) + '/' +
                CAST(@total_records AS VARCHAR); -- N·∫øu kh√¥ng c√≤n record n√†o
                ƒë∆∞·ª£c update, tho√°t v√≤ng l·∫∑p IF @@ROWCOUNT = 0 BREAK; END TRY
                BEGIN CATCH SET @error_count = @error_count + 1; PRINT 'L·ªói x·ª≠
                l√Ω batch: ' + ERROR_MESSAGE(); -- N·∫øu qu√° nhi·ªÅu l·ªói, d·ª´ng l·∫°i IF
                @error_count > 5 BEGIN PRINT 'Qu√° nhi·ªÅu l·ªói, d·ª´ng x·ª≠ l√Ω!';
                BREAK; END; -- Ti·∫øp t·ª•c v·ªõi batch ti·∫øp theo CONTINUE; END CATCH;
                -- Ngh·ªâ gi·ªØa c√°c batch WAITFOR DELAY '00:00:02'; END;
              </div>
            </div>

            <h3>‚ö†Ô∏è 3. X·ª≠ l√Ω l·ªói (TRY...CATCH, DECLARE HANDLER)</h3>

            <h4>üõ°Ô∏è TRY...CATCH</h4>
            <div class="highlight-box">
              <p>
                Cho ph√©p b·∫°n x·ª≠ l√Ω l·ªói m·ªôt c√°ch c√≥ ki·ªÉm so√°t. Kh·ªëi TRY ch·ª©a m√£
                c√≥ th·ªÉ g√¢y l·ªói, v√† kh·ªëi CATCH s·∫Ω ƒë∆∞·ª£c th·ª±c thi n·∫øu c√≥ l·ªói x·∫£y
                ra.
              </p>
            </div>

            <div class="example">
              <h4>TRY...CATCH c∆° b·∫£n:</h4>
              <div class="code-block">
                -- X·ª≠ l√Ω l·ªói chia cho 0 BEGIN TRY -- C√¢u l·ªánh c√≥ th·ªÉ g√¢y l·ªói
                DECLARE @result INT = 10 / 0; PRINT 'K·∫øt qu·∫£: ' + CAST(@result
                AS VARCHAR); END TRY BEGIN CATCH PRINT 'ƒê√£ x·∫£y ra l·ªói: ' +
                ERROR_MESSAGE(); PRINT 'M√£ l·ªói: ' + CAST(ERROR_NUMBER() AS
                VARCHAR); PRINT 'ƒê·ªô nghi√™m tr·ªçng: ' + CAST(ERROR_SEVERITY() AS
                VARCHAR); PRINT 'Tr·∫°ng th√°i: ' + CAST(ERROR_STATE() AS VARCHAR);
                PRINT 'T·∫°i d√≤ng: ' + CAST(ERROR_LINE() AS VARCHAR); END CATCH;
              </div>
            </div>

            <div class="example">
              <h4>TRY...CATCH trong Transaction:</h4>
              <div class="code-block">
                -- Stored Procedure chuy·ªÉn ti·ªÅn an to√†n CREATE PROCEDURE
                TransferMoney @from_account_id INT, @to_account_id INT, @amount
                DECIMAL(15,2) AS BEGIN DECLARE @error_message VARCHAR(500);
                DECLARE @from_balance DECIMAL(15,2); BEGIN TRANSACTION; BEGIN
                TRY -- Ki·ªÉm tra t√†i kho·∫£n ngu·ªìn SELECT @from_balance = balance
                FROM accounts WHERE account_id = @from_account_id; IF
                @from_balance IS NULL BEGIN RAISERROR('T√†i kho·∫£n ngu·ªìn kh√¥ng t·ªìn
                t·∫°i', 16, 1); RETURN; END; IF @from_balance < @amount BEGIN
                RAISERROR('S·ªë d∆∞ kh√¥ng ƒë·ªß. S·ªë d∆∞ hi·ªán t·∫°i: %s', 16, 1,
                FORMAT(@from_balance, 'N2')); RETURN; END; -- Ki·ªÉm tra t√†i kho·∫£n
                ƒë√≠ch IF NOT EXISTS (SELECT 1 FROM accounts WHERE account_id =
                @to_account_id) BEGIN RAISERROR('T√†i kho·∫£n ƒë√≠ch kh√¥ng t·ªìn t·∫°i',
                16, 1); RETURN; END; -- Th·ª±c hi·ªán chuy·ªÉn ti·ªÅn UPDATE accounts
                SET balance = balance - @amount WHERE account_id =
                @from_account_id; UPDATE accounts SET balance = balance +
                @amount WHERE account_id = @to_account_id; -- Ghi log giao d·ªãch
                INSERT INTO transaction_log (from_account, to_account, amount,
                transaction_date, status) VALUES (@from_account_id,
                @to_account_id, @amount, GETDATE(), 'completed'); COMMIT
                TRANSACTION; PRINT 'Chuy·ªÉn ti·ªÅn th√†nh c√¥ng: ' + FORMAT(@amount,
                'N2'); END TRY BEGIN CATCH ROLLBACK TRANSACTION; SET
                @error_message = ERROR_MESSAGE(); PRINT 'L·ªói chuy·ªÉn ti·ªÅn: ' +
                @error_message; -- Ghi log l·ªói INSERT INTO error_log
                (error_message, error_time, procedure_name) VALUES
                (@error_message, GETDATE(), 'TransferMoney'); -- N√©m l·∫°i l·ªói n·∫øu
                c·∫ßn THROW; END CATCH; END;
              </div>
            </div>

            <h4>üéØ C√°c h√†m ERROR trong CATCH:</h4>
            <table>
              <thead>
                <tr>
                  <th>H√†m</th>
                  <th>M√¥ t·∫£</th>
                  <th>V√≠ d·ª•</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>ERROR_MESSAGE()</b></td>
                  <td>Th√¥ng b√°o l·ªói chi ti·∫øt</td>
                  <td>"Division by zero error encountered"</td>
                </tr>
                <tr>
                  <td><b>ERROR_NUMBER()</b></td>
                  <td>M√£ s·ªë l·ªói</td>
                  <td>8134</td>
                </tr>
                <tr>
                  <td><b>ERROR_SEVERITY()</b></td>
                  <td>M·ª©c ƒë·ªô nghi√™m tr·ªçng (1-25)</td>
                  <td>16</td>
                </tr>
                <tr>
                  <td><b>ERROR_STATE()</b></td>
                  <td>Tr·∫°ng th√°i l·ªói</td>
                  <td>1</td>
                </tr>
                <tr>
                  <td><b>ERROR_LINE()</b></td>
                  <td>S·ªë d√≤ng x·∫£y ra l·ªói</td>
                  <td>15</td>
                </tr>
                <tr>
                  <td><b>ERROR_PROCEDURE()</b></td>
                  <td>T√™n procedure/function l·ªói</td>
                  <td>"TransferMoney"</td>
                </tr>
              </tbody>
            </table>

            <h3>üéØ 4. ƒêi·ªÅu h∆∞·ªõng kh√°c (GOTO, RETURN, LEAVE, ITERATE)</h3>

            <h4>‚Ü©Ô∏è RETURN</h4>
            <div class="highlight-box">
              <p>
                Tho√°t kh·ªèi m·ªôt th·ªß t·ª•c l∆∞u tr·ªØ ho·∫∑c h√†m v√† tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã.
              </p>
            </div>

            <div class="example">
              <h4>RETURN trong Stored Procedure:</h4>
              <div class="code-block">
                -- Procedure ki·ªÉm tra v√† t·∫°o ƒë∆°n h√†ng CREATE PROCEDURE
                CreateOrder @customer_id INT, @product_id INT, @quantity INT AS
                BEGIN DECLARE @stock_quantity INT; DECLARE @order_id INT; --
                Ki·ªÉm tra kh√°ch h√†ng IF NOT EXISTS (SELECT 1 FROM customers WHERE
                customer_id = @customer_id) BEGIN PRINT 'L·ªói: Kh√°ch h√†ng kh√¥ng
                t·ªìn t·∫°i'; RETURN -1; -- M√£ l·ªói -1 END; -- Ki·ªÉm tra s·∫£n ph·∫©m v√†
                t·ªìn kho SELECT @stock_quantity = stock_quantity FROM products
                WHERE product_id = @product_id; IF @stock_quantity IS NULL BEGIN
                PRINT 'L·ªói: S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i'; RETURN -2; -- M√£ l·ªói -2
                END; IF @stock_quantity < @quantity BEGIN PRINT 'L·ªói: Kh√¥ng ƒë·ªß
                t·ªìn kho. C√≤n l·∫°i: ' + CAST(@stock_quantity AS VARCHAR); RETURN
                -3; -- M√£ l·ªói -3 END; -- T·∫°o ƒë∆°n h√†ng INSERT INTO orders
                (customer_id, order_date, status) VALUES (@customer_id,
                GETDATE(), 'pending'); SET @order_id = SCOPE_IDENTITY(); INSERT
                INTO order_items (order_id, product_id, quantity, unit_price)
                SELECT @order_id, @product_id, @quantity, list_price FROM
                products WHERE product_id = @product_id; -- C·∫≠p nh·∫≠t t·ªìn kho
                UPDATE products SET stock_quantity = stock_quantity - @quantity
                WHERE product_id = @product_id; PRINT 'T·∫°o ƒë∆°n h√†ng th√†nh c√¥ng.
                Order ID: ' + CAST(@order_id AS VARCHAR); RETURN @order_id; --
                Tr·∫£ v·ªÅ Order ID END; -- S·ª≠ d·ª•ng procedure DECLARE @result INT;
                EXEC @result = CreateOrder @customer_id = 1, @product_id = 5,
                @quantity = 2; IF @result > 0 PRINT 'Order ƒë∆∞·ª£c t·∫°o v·ªõi ID: ' +
                CAST(@result AS VARCHAR); ELSE PRINT 'T·∫°o order th·∫•t b·∫°i v·ªõi m√£
                l·ªói: ' + CAST(@result AS VARCHAR);
              </div>
            </div>

            <h4>‚û°Ô∏è GOTO (Kh√¥ng khuy·∫øn kh√≠ch)</h4>
            <div class="info-box">
              <p>
                <b>L∆∞u √Ω:</b> GOTO kh√¥ng ƒë∆∞·ª£c khuy·∫øn kh√≠ch v√¨ c√≥ th·ªÉ l√†m cho m√£
                tr·ªü n√™n kh√≥ ƒë·ªçc v√† b·∫£o tr√¨. Tuy nhi√™n, ƒë√¥i khi n√≥ c√≥ th·ªÉ h·ªØu √≠ch
                trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát.
              </p>
            </div>

            <div class="example">
              <h4>GOTO - V√≠ d·ª• (ch·ªâ ƒë·ªÉ tham kh·∫£o):</h4>
              <div class="code-block">
                -- V√≠ d·ª• s·ª≠ d·ª•ng GOTO (kh√¥ng khuy·∫øn kh√≠ch) DECLARE @counter INT
                = 1; DECLARE @max_attempts INT = 3; DECLARE @success BIT = 0;
                retry_label: BEGIN TRY -- Thao t√°c c√≥ th·ªÉ th·∫•t b·∫°i INSERT INTO
                critical_table (data) VALUES ('important_data'); SET @success =
                1; GOTO success_label; END TRY BEGIN CATCH SET @counter =
                @counter + 1; IF @counter <= @max_attempts BEGIN PRINT 'Th·ª≠ l·∫°i
                l·∫ßn ' + CAST(@counter AS VARCHAR); WAITFOR DELAY '00:00:01'; --
                ƒê·ª£i 1 gi√¢y GOTO retry_label; END ELSE BEGIN PRINT 'Th·∫•t b·∫°i sau
                ' + CAST(@max_attempts AS VARCHAR) + ' l·∫ßn th·ª≠'; GOTO
                error_label; END; END CATCH; success_label: PRINT 'Th√†nh c√¥ng!';
                GOTO end_label; error_label: PRINT 'X·ª≠ l√Ω l·ªói cu·ªëi c√πng';
                end_label: PRINT 'K·∫øt th√∫c procedure';
              </div>
            </div>

            <h4>üîÑ BREAK v√† CONTINUE</h4>
            <div class="example">
              <h4>S·ª≠ d·ª•ng BREAK v√† CONTINUE trong WHILE:</h4>
              <div class="code-block">
                -- X·ª≠ l√Ω danh s√°ch file, b·ªè qua file l·ªói DECLARE @file_id INT =
                1; DECLARE @max_files INT = 100; DECLARE @error_count INT = 0;
                DECLARE @max_errors INT = 10; WHILE @file_id <= @max_files BEGIN
                BEGIN TRY -- Gi·∫£ l·∫≠p x·ª≠ l√Ω file IF @file_id % 7 = 0 -- Gi·∫£ l·∫≠p
                file l·ªói RAISERROR('File corrupted', 16, 1); PRINT 'X·ª≠ l√Ω file '
                + CAST(@file_id AS VARCHAR) + ' th√†nh c√¥ng'; END TRY BEGIN CATCH
                SET @error_count = @error_count + 1; PRINT 'L·ªói x·ª≠ l√Ω file ' +
                CAST(@file_id AS VARCHAR) + ': ' + ERROR_MESSAGE(); -- N·∫øu qu√°
                nhi·ªÅu l·ªói, d·ª´ng l·∫°i IF @error_count >= @max_errors BEGIN PRINT
                'Qu√° nhi·ªÅu l·ªói (' + CAST(@error_count AS VARCHAR) + '), d·ª´ng x·ª≠
                l√Ω!'; BREAK; -- Tho√°t kh·ªèi v√≤ng l·∫∑p END; -- B·ªè qua file l·ªói,
                ti·∫øp t·ª•c v·ªõi file ti·∫øp theo SET @file_id = @file_id + 1;
                CONTINUE; -- B·ªè qua ph·∫ßn c√≤n l·∫°i, l·∫∑p ti·∫øp END CATCH; SET
                @file_id = @file_id + 1; END; PRINT 'Ho√†n th√†nh x·ª≠ l√Ω. T·ªïng l·ªói:
                ' + CAST(@error_count AS VARCHAR);
              </div>
            </div>

            <h3>üí° Best Practices cho Control Flow</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>S·ª≠ d·ª•ng TRY...CATCH:</b> Lu√¥n x·ª≠ l√Ω l·ªói c√≥ th·ªÉ x·∫£y ra
                </li>
                <li>
                  <b>Ki·ªÉm tra ƒëi·ªÅu ki·ªán tr∆∞·ªõc:</b> Validate input tr∆∞·ªõc khi x·ª≠
                  l√Ω
                </li>
                <li><b>Log l·ªói chi ti·∫øt:</b> Ghi l·∫°i th√¥ng tin l·ªói ƒë·ªÉ debug</li>
                <li><b>S·ª≠ d·ª•ng RETURN codes:</b> Tr·∫£ v·ªÅ m√£ l·ªói c√≥ √Ω nghƒ©a</li>
                <li><b>T·ªëi ∆∞u v√≤ng l·∫∑p:</b> Tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n</li>
                <li><b>Transaction safety:</b> S·ª≠ d·ª•ng ROLLBACK khi c√≥ l·ªói</li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li>
                  <b>GOTO kh√¥ng c·∫ßn thi·∫øt:</b> L√†m code kh√≥ ƒë·ªçc v√† maintain
                </li>
                <li>
                  <b>V√≤ng l·∫∑p kh√¥ng c√≥ ƒëi·ªÅu ki·ªán d·ª´ng:</b> C√≥ th·ªÉ g√¢y infinite
                  loop
                </li>
                <li><b>Kh√¥ng x·ª≠ l√Ω l·ªói:</b> C√≥ th·ªÉ l√†m crash ·ª©ng d·ª•ng</li>
                <li><b>Nested qu√° s√¢u:</b> Kh√≥ ƒë·ªçc v√† debug</li>
                <li><b>Hardcode values:</b> N√™n d√πng variables/parameters</li>
              </ul>
            </div>

            <h3>üéØ V√≠ d·ª• t·ªïng h·ª£p: Procedure x·ª≠ l√Ω ƒë∆°n h√†ng</h3>
            <div class="example">
              <h4>Procedure ho√†n ch·ªânh v·ªõi t·∫•t c·∫£ control flow:</h4>
              <div class="code-block">
                -- Procedure x·ª≠ l√Ω batch ƒë∆°n h√†ng v·ªõi ƒë·∫ßy ƒë·ªß control flow CREATE
                PROCEDURE ProcessOrderBatch @batch_size INT = 50, @max_errors
                INT = 5 AS BEGIN DECLARE @processed_count INT = 0; DECLARE
                @error_count INT = 0; DECLARE @order_id INT; DECLARE
                @customer_id INT; DECLARE @total_amount DECIMAL(15,2); DECLARE
                @payment_status VARCHAR(20); -- Cursor ƒë·ªÉ x·ª≠ l√Ω t·ª´ng ƒë∆°n h√†ng
                DECLARE order_cursor CURSOR FOR SELECT TOP (@batch_size)
                order_id, customer_id, total_amount, payment_status FROM orders
                WHERE status = 'pending' ORDER BY order_date; OPEN order_cursor;
                WHILE 1 = 1 -- V√≤ng l·∫∑p v√¥ h·∫°n, s·∫Ω d√πng BREAK ƒë·ªÉ tho√°t BEGIN
                FETCH NEXT FROM order_cursor INTO @order_id, @customer_id,
                @total_amount, @payment_status; -- N·∫øu kh√¥ng c√≤n record, tho√°t
                IF @@FETCH_STATUS <> 0 BREAK; BEGIN TRY -- Ki·ªÉm tra ƒëi·ªÅu ki·ªán IF
                @payment_status != 'paid' BEGIN PRINT 'Order ' + CAST(@order_id
                AS VARCHAR) + ' ch∆∞a thanh to√°n, b·ªè qua'; CONTINUE; -- Ti·∫øp t·ª•c
                v·ªõi order ti·∫øp theo END; -- X·ª≠ l√Ω order IF @total_amount >
                1000000 -- ƒê∆°n h√†ng l·ªõn BEGIN -- C·∫ßn approval ƒë·∫∑c bi·ªát UPDATE
                orders SET status = 'pending_approval', notes = 'ƒê∆°n h√†ng l·ªõn
                c·∫ßn duy·ªát' WHERE order_id = @order_id; PRINT 'Order ' +
                CAST(@order_id AS VARCHAR) + ' c·∫ßn duy·ªát (gi√° tr·ªã cao)'; END
                ELSE BEGIN -- X·ª≠ l√Ω b√¨nh th∆∞·ªùng UPDATE orders SET status =
                'processing', processing_date = GETDATE() WHERE order_id =
                @order_id; -- C·∫≠p nh·∫≠t inventory UPDATE products SET
                stock_quantity = stock_quantity - oi.quantity FROM products p
                INNER JOIN order_items oi ON p.product_id = oi.product_id WHERE
                oi.order_id = @order_id; PRINT 'X·ª≠ l√Ω th√†nh c√¥ng order ' +
                CAST(@order_id AS VARCHAR); END; SET @processed_count =
                @processed_count + 1; END TRY BEGIN CATCH SET @error_count =
                @error_count + 1; -- Log l·ªói INSERT INTO error_log (order_id,
                error_message, error_time) VALUES (@order_id, ERROR_MESSAGE(),
                GETDATE()); PRINT 'L·ªói x·ª≠ l√Ω order ' + CAST(@order_id AS
                VARCHAR) + ': ' + ERROR_MESSAGE(); -- N·∫øu qu√° nhi·ªÅu l·ªói, d·ª´ng x·ª≠
                l√Ω IF @error_count >= @max_errors BEGIN PRINT 'Qu√° nhi·ªÅu l·ªói,
                d·ª´ng batch processing!'; BREAK; END; END CATCH; END; CLOSE
                order_cursor; DEALLOCATE order_cursor; -- B√°o c√°o k·∫øt qu·∫£ PRINT
                'Batch processing ho√†n th√†nh:'; PRINT '- ƒê√£ x·ª≠ l√Ω: ' +
                CAST(@processed_count AS VARCHAR) + ' orders'; PRINT '- L·ªói: ' +
                CAST(@error_count AS VARCHAR) + ' orders'; -- Tr·∫£ v·ªÅ status code
                IF @error_count = 0 RETURN 0; -- Th√†nh c√¥ng ho√†n to√†n ELSE IF
                @error_count < @max_errors RETURN 1; -- Th√†nh c√¥ng m·ªôt ph·∫ßn ELSE
                RETURN -1; -- Th·∫•t b·∫°i END;
              </div>
            </div>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                C√°c c√¢u l·ªánh ƒëi·ªÅu khi·ªÉn gi√∫p b·∫°n t·∫°o ra
                <b>logic ph·ª©c t·∫°p v√† x·ª≠ l√Ω c√°c t√¨nh hu·ªëng ƒë·∫∑c bi·ªát</b> trong
                SQL:
              </p>
              <ul>
                <li>
                  <b>IF...ELSE & CASE:</b> X·ª≠ l√Ω ƒëi·ªÅu ki·ªán v√† ph√¢n nh√°nh logic
                </li>
                <li>
                  <b>WHILE:</b> L·∫∑p l·∫°i c√°c thao t√°c ƒë·∫øn khi ƒë·∫°t ƒëi·ªÅu ki·ªán
                </li>
                <li><b>TRY...CATCH:</b> X·ª≠ l√Ω l·ªói an to√†n v√† c√≥ ki·ªÉm so√°t</li>
                <li><b>RETURN:</b> Tho√°t s·ªõm v√† tr·∫£ v·ªÅ k·∫øt qu·∫£</li>
                <li><b>BREAK/CONTINUE:</b> ƒêi·ªÅu khi·ªÉn lu·ªìng trong v√≤ng l·∫∑p</li>
              </ul>
            </div>
          </section>

          <!-- 22 -->
          <section class="section" id="udf">
            <h2>22. UDF (User-Defined Function)</h2>

            <div class="info-box">
              <h4>üîß UDF (User-Defined Function) l√† g√¨?</h4>
              <p>
                <b>User-Defined Function (H√†m do ng∆∞·ªùi d√πng ƒë·ªãnh nghƒ©a)</b> l√†
                m·ªôt ch∆∞∆°ng tr√¨nh con ƒë∆∞·ª£c vi·∫øt b·∫±ng SQL ho·∫∑c m·ªôt ng√¥n ng·ªØ kh√°c
                (nh∆∞ C#, Java) v√† ƒë∆∞·ª£c l∆∞u tr·ªØ trong c∆° s·ªü d·ªØ li·ªáu. N√≥ cho ph√©p
                b·∫°n <b>ƒë√≥ng g√≥i c√°c logic ph·ª©c t·∫°p, c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng</b>, ƒë·ªÉ
                th·ª±c hi·ªán m·ªôt t√°c v·ª• c·ª• th·ªÉ.
              </p>
              <p>
                Thay v√¨ ph·∫£i vi·∫øt ƒëi vi·∫øt l·∫°i m·ªôt ƒëo·∫°n m√£, b·∫°n ch·ªâ c·∫ßn
                <b>g·ªçi h√†m n√†y</b>.
              </p>
            </div>

            <h3>üåü ∆Øu ƒëi·ªÉm c·ªßa UDF</h3>
            <div class="success-box">
              <h4>‚úÖ Nh·ªØng l·ª£i √≠ch ch√≠nh:</h4>
              <ul>
                <li>
                  <b>T√°i s·ª≠ d·ª•ng code:</b> B·∫°n c√≥ th·ªÉ g·ªçi h√†m nhi·ªÅu l·∫ßn trong
                  c√°c truy v·∫•n kh√°c nhau m√† kh√¥ng c·∫ßn vi·∫øt l·∫°i m√£
                </li>
                <li>
                  <b>C·∫£i thi·ªán hi·ªáu su·∫•t:</b> C√°c h√†m ƒë∆∞·ª£c bi√™n d·ªãch v√† l∆∞u tr·ªØ
                  trong c∆° s·ªü d·ªØ li·ªáu, gi√∫p gi·∫£m th·ªùi gian th·ª±c thi
                </li>
                <li>
                  <b>ƒê∆°n gi·∫£n h√≥a truy v·∫•n:</b> Gi√∫p c√°c c√¢u truy v·∫•n ph·ª©c t·∫°p
                  tr·ªü n√™n d·ªÖ ƒë·ªçc v√† d·ªÖ hi·ªÉu h∆°n
                </li>
                <li>
                  <b>T√≠nh nh·∫•t qu√°n:</b> ƒê·∫£m b·∫£o logic t√≠nh to√°n ƒë∆∞·ª£c th·ª±c hi·ªán
                  gi·ªëng nhau ·ªü m·ªçi n∆°i
                </li>
                <li>
                  <b>B·∫£o m·∫≠t:</b> C√≥ th·ªÉ ·∫©n logic ph·ª©c t·∫°p kh·ªèi ng∆∞·ªùi d√πng cu·ªëi
                </li>
              </ul>
            </div>

            <h3>üìö C√°c lo·∫°i UDF ph·ªï bi·∫øn</h3>
            <div class="highlight-box">
              <p>C√≥ <b>hai lo·∫°i UDF ch√≠nh</b> trong SQL Server:</p>
              <ul>
                <li><b>Scalar Function:</b> Tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã duy nh·∫•t</li>
                <li><b>Table-Valued Function:</b> Tr·∫£ v·ªÅ m·ªôt b·∫£ng d·ªØ li·ªáu</li>
              </ul>
            </div>

            <h3>1Ô∏è‚É£ Scalar Function (H√†m v√¥ h∆∞·ªõng)</h3>
            <div class="example">
              <p>
                <b>ƒê·∫∑c ƒëi·ªÉm:</b> H√†m v√¥ h∆∞·ªõng nh·∫≠n m·ªôt ho·∫∑c nhi·ªÅu tham s·ªë ƒë·∫ßu
                v√†o v√† <b>tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã duy nh·∫•t</b>.
              </p>

              <h4>V√≠ d·ª• c∆° b·∫£n: T√≠nh thu·∫ø VAT</h4>
              <div class="code-block">
                -- T·∫°o h√†m t√≠nh thu·∫ø VAT 10% tr√™n gi√° s·∫£n ph·∫©m CREATE FUNCTION
                calculate_tax (@price DECIMAL(10, 2)) RETURNS DECIMAL(10, 2) AS
                BEGIN RETURN @price * 0.1; END;
              </div>

              <h4>C√°ch s·ª≠ d·ª•ng:</h4>
              <div class="code-block">
                -- S·ª≠ d·ª•ng h√†m ƒë·ªÉ t√≠nh thu·∫ø cho m·ªôt gi√° tr·ªã c·ª• th·ªÉ SELECT
                dbo.calculate_tax(100) AS tax_amount; -- Tr·∫£ v·ªÅ 10.00 -- S·ª≠ d·ª•ng
                h√†m trong c√¢u l·ªánh SELECT v·ªõi b·∫£ng SELECT product_id,
                product_name, list_price, dbo.calculate_tax(list_price) AS
                tax_amount, list_price + dbo.calculate_tax(list_price) AS
                total_price FROM products;
              </div>
            </div>

            <div class="example">
              <h4>Scalar Function ph·ª©c t·∫°p h∆°n:</h4>
              <div class="code-block">
                -- H√†m t√≠nh discount d·ª±a tr√™n s·ªë l∆∞·ª£ng v√† lo·∫°i kh√°ch h√†ng CREATE
                FUNCTION calculate_discount ( @quantity INT, @unit_price
                DECIMAL(10,2), @customer_type VARCHAR(20) ) RETURNS
                DECIMAL(10,2) AS BEGIN DECLARE @discount_rate DECIMAL(5,4) = 0;
                DECLARE @total_amount DECIMAL(15,2) = @quantity * @unit_price;
                -- Discount theo lo·∫°i kh√°ch h√†ng IF @customer_type = 'VIP' SET
                @discount_rate = 0.15; -- 15% ELSE IF @customer_type = 'Premium'
                SET @discount_rate = 0.10; -- 10% ELSE IF @customer_type =
                'Regular' SET @discount_rate = 0.05; -- 5% -- Discount th√™m theo
                s·ªë l∆∞·ª£ng IF @quantity >= 100 SET @discount_rate = @discount_rate
                + 0.05; -- +5% ELSE IF @quantity >= 50 SET @discount_rate =
                @discount_rate + 0.03; -- +3% ELSE IF @quantity >= 20 SET
                @discount_rate = @discount_rate + 0.02; -- +2% -- Gi·ªõi h·∫°n
                discount t·ªëi ƒëa 25% IF @discount_rate > 0.25 SET @discount_rate
                = 0.25; RETURN @total_amount * @discount_rate; END; -- S·ª≠ d·ª•ng
                h√†m SELECT c.customer_name, c.customer_type, oi.quantity,
                oi.unit_price, oi.quantity * oi.unit_price AS subtotal,
                dbo.calculate_discount(oi.quantity, oi.unit_price,
                c.customer_type) AS discount_amount, (oi.quantity *
                oi.unit_price) - dbo.calculate_discount(oi.quantity,
                oi.unit_price, c.customer_type) AS final_amount FROM order_items
                oi INNER JOIN orders o ON oi.order_id = o.order_id INNER JOIN
                customers c ON o.customer_id = c.customer_id;
              </div>
            </div>

            <div class="example">
              <h4>H√†m x·ª≠ l√Ω chu·ªói:</h4>
              <div class="code-block">
                -- H√†m t·∫°o m√£ s·∫£n ph·∫©m t·ª± ƒë·ªông CREATE FUNCTION
                generate_product_code( @category_code VARCHAR(5),
                @sequence_number INT ) RETURNS VARCHAR(20) AS BEGIN DECLARE
                @product_code VARCHAR(20); DECLARE @year VARCHAR(4) =
                CAST(YEAR(GETDATE()) AS VARCHAR(4)); DECLARE @sequence
                VARCHAR(6) = RIGHT('000000' + CAST(@sequence_number AS VARCHAR),
                6); SET @product_code = @category_code + '-' + @year + '-' +
                @sequence; RETURN @product_code; END; -- S·ª≠ d·ª•ng SELECT
                dbo.generate_product_code('ELC', 1) AS product_code1, --
                ELC-2025-000001 dbo.generate_product_code('CLT', 245) AS
                product_code2, -- CLT-2025-000245
                dbo.generate_product_code('BK', 1052) AS product_code3; --
                BK-2025-001052
              </div>
            </div>

            <h3>2Ô∏è‚É£ Table-Valued Function (H√†m tr·∫£ v·ªÅ b·∫£ng)</h3>
            <div class="example">
              <p>
                <b>ƒê·∫∑c ƒëi·ªÉm:</b> H√†m tr·∫£ v·ªÅ b·∫£ng nh·∫≠n m·ªôt ho·∫∑c nhi·ªÅu tham s·ªë ƒë·∫ßu
                v√†o v√† <b>tr·∫£ v·ªÅ m·ªôt b·∫£ng d·ªØ li·ªáu</b> (m·ªôt t·∫≠p h·ª£p c√°c h√†ng v√†
                c·ªôt).
              </p>

              <h4>Inline Table-Valued Function:</h4>
              <div class="code-block">
                -- H√†m tr·∫£ v·ªÅ danh s√°ch s·∫£n ph·∫©m theo th∆∞∆°ng hi·ªáu CREATE
                FUNCTION get_products_by_brand (@brand_id INT) RETURNS TABLE AS
                RETURN ( SELECT product_id, product_name, brand_id, list_price,
                stock_quantity FROM products WHERE brand_id = @brand_id ); --
                C√°ch s·ª≠ d·ª•ng SELECT * FROM dbo.get_products_by_brand(1); -- S·ª≠
                d·ª•ng trong JOIN SELECT p.product_name, p.list_price,
                b.brand_name FROM dbo.get_products_by_brand(1) p INNER JOIN
                brands b ON p.brand_id = b.brand_id;
              </div>
            </div>

            <div class="example">
              <h4>Multi-Statement Table-Valued Function:</h4>
              <div class="code-block">
                -- H√†m tr·∫£ v·ªÅ b√°o c√°o b√°n h√†ng theo th√°ng CREATE FUNCTION
                get_monthly_sales_report(@year INT, @month INT) RETURNS
                @SalesReport TABLE ( product_id INT, product_name VARCHAR(100),
                category_name VARCHAR(50), quantity_sold INT, total_revenue
                DECIMAL(15,2), avg_price DECIMAL(10,2) ) AS BEGIN INSERT INTO
                @SalesReport SELECT p.product_id, p.product_name,
                c.category_name, SUM(oi.quantity) AS quantity_sold,
                SUM(oi.quantity * oi.unit_price) AS total_revenue,
                AVG(oi.unit_price) AS avg_price FROM products p INNER JOIN
                categories c ON p.category_id = c.category_id INNER JOIN
                order_items oi ON p.product_id = oi.product_id INNER JOIN orders
                o ON oi.order_id = o.order_id WHERE YEAR(o.order_date) = @year
                AND MONTH(o.order_date) = @month AND o.status = 'completed'
                GROUP BY p.product_id, p.product_name, c.category_name HAVING
                SUM(oi.quantity) > 0; RETURN; END; -- S·ª≠ d·ª•ng h√†m SELECT * FROM
                dbo.get_monthly_sales_report(2025, 9) ORDER BY total_revenue
                DESC; -- T√¨m top 5 s·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t SELECT TOP 5
                product_name, category_name, quantity_sold,
                FORMAT(total_revenue, 'N0') AS formatted_revenue FROM
                dbo.get_monthly_sales_report(2025, 9) ORDER BY quantity_sold
                DESC;
              </div>
            </div>

            <div class="example">
              <h4>Table-Valued Function v·ªõi logic ph·ª©c t·∫°p:</h4>
              <div class="code-block">
                -- H√†m ph√¢n t√≠ch hi·ªáu su·∫•t kh√°ch h√†ng CREATE FUNCTION
                analyze_customer_performance(@start_date DATE, @end_date DATE)
                RETURNS @CustomerAnalysis TABLE ( customer_id INT, customer_name
                VARCHAR(100), total_orders INT, total_spent DECIMAL(15,2),
                avg_order_value DECIMAL(10,2), last_order_date DATE,
                customer_segment VARCHAR(20), loyalty_score DECIMAL(5,2) ) AS
                BEGIN INSERT INTO @CustomerAnalysis SELECT c.customer_id,
                c.customer_name, COUNT(o.order_id) AS total_orders,
                COALESCE(SUM(o.total_amount), 0) AS total_spent,
                COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
                MAX(o.order_date) AS last_order_date, CASE WHEN
                COALESCE(SUM(o.total_amount), 0) > 10000000 THEN 'VIP' WHEN
                COALESCE(SUM(o.total_amount), 0) > 5000000 THEN 'Premium' WHEN
                COALESCE(SUM(o.total_amount), 0) > 1000000 THEN 'Gold' WHEN
                COALESCE(SUM(o.total_amount), 0) > 0 THEN 'Regular' ELSE
                'Inactive' END AS customer_segment, -- Loyalty score: T√≠nh d·ª±a
                tr√™n t·∫ßn su·∫•t mua v√† gi√° tr·ªã CASE WHEN COUNT(o.order_id) = 0
                THEN 0 ELSE (COUNT(o.order_id) * 10) +
                (COALESCE(SUM(o.total_amount), 0) / 100000) + (CASE WHEN
                MAX(o.order_date) >= DATEADD(MONTH, -3, GETDATE()) THEN 20 WHEN
                MAX(o.order_date) >= DATEADD(MONTH, -6, GETDATE()) THEN 10 WHEN
                MAX(o.order_date) >= DATEADD(YEAR, -1, GETDATE()) THEN 5 ELSE 0
                END) END AS loyalty_score FROM customers c LEFT JOIN orders o ON
                c.customer_id = o.customer_id AND o.order_date BETWEEN
                @start_date AND @end_date AND o.status = 'completed' GROUP BY
                c.customer_id, c.customer_name; RETURN; END; -- S·ª≠ d·ª•ng ƒë·ªÉ ph√¢n
                t√≠ch kh√°ch h√†ng SELECT customer_segment, COUNT(*) AS
                customer_count, AVG(total_spent) AS avg_spent_per_customer,
                AVG(loyalty_score) AS avg_loyalty_score FROM
                dbo.analyze_customer_performance('2024-01-01', '2025-09-21')
                GROUP BY customer_segment ORDER BY avg_spent_per_customer DESC;
              </div>
            </div>

            <h3>üîß So s√°nh Scalar vs Table-Valued Functions</h3>
            <table>
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>Scalar Function</th>
                  <th>Table-Valued Function</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>Gi√° tr·ªã tr·∫£ v·ªÅ</b></td>
                  <td>M·ªôt gi√° tr·ªã duy nh·∫•t</td>
                  <td>M·ªôt b·∫£ng d·ªØ li·ªáu</td>
                </tr>
                <tr>
                  <td><b>S·ª≠ d·ª•ng trong</b></td>
                  <td>SELECT, WHERE, SET</td>
                  <td>FROM, JOIN</td>
                </tr>
                <tr>
                  <td><b>Performance</b></td>
                  <td>Nhanh cho logic ƒë∆°n gi·∫£n</td>
                  <td>T·ªët cho t·∫≠p d·ªØ li·ªáu ph·ª©c t·∫°p</td>
                </tr>
                <tr>
                  <td><b>Caching</b></td>
                  <td>C√≥ th·ªÉ cache k·∫øt qu·∫£</td>
                  <td>Inline TVF c√≥ th·ªÉ optimize</td>
                </tr>
                <tr>
                  <td><b>V√≠ d·ª• s·ª≠ d·ª•ng</b></td>
                  <td>T√≠nh to√°n, format, validation</td>
                  <td>Filtering, reporting, joins</td>
                </tr>
              </tbody>
            </table>

            <h3>‚ö° Performance v√† Best Practices</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>S·ª≠ d·ª•ng Inline TVF:</b> Thay v√¨ Multi-statement TVF khi c√≥
                  th·ªÉ
                </li>
                <li>
                  <b>T·ªëi ∆∞u logic:</b> Vi·∫øt code SQL hi·ªáu qu·∫£ b√™n trong h√†m
                </li>
                <li>
                  <b>S·ª≠ d·ª•ng tham s·ªë ph√π h·ª£p:</b> ƒê√∫ng ki·ªÉu d·ªØ li·ªáu v√† k√≠ch
                  th∆∞·ªõc
                </li>
                <li><b>Error handling:</b> X·ª≠ l√Ω l·ªói trong h√†m ph·ª©c t·∫°p</li>
                <li><b>ƒê·∫∑t t√™n c√≥ √Ω nghƒ©a:</b> D·ªÖ hi·ªÉu v√† maintain</li>
                <li>
                  <b>Document h√†m:</b> Comment r√µ r√†ng m·ª•c ƒë√≠ch v√† c√°ch d√πng
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li><b>UDF trong WHERE v·ªõi b·∫£ng l·ªõn:</b> C√≥ th·ªÉ ch·∫≠m</li>
                <li><b>Logic qu√° ph·ª©c t·∫°p:</b> N√™n d√πng Stored Procedure</li>
                <li>
                  <b>G·ªçi UDF kh√°c b√™n trong UDF:</b> C√≥ th·ªÉ g√¢y performance
                  issues
                </li>
                <li>
                  <b>Non-deterministic functions:</b> GETDATE(), RAND() trong
                  Scalar UDF
                </li>
                <li><b>Side effects:</b> UDF kh√¥ng n√™n thay ƒë·ªïi d·ªØ li·ªáu</li>
              </ul>
            </div>

            <h3>üõ†Ô∏è Qu·∫£n l√Ω UDF</h3>

            <div class="example">
              <h4>Xem th√¥ng tin UDF:</h4>
              <div class="code-block">
                -- Li·ªát k√™ t·∫•t c·∫£ UDF trong database SELECT
                OBJECT_SCHEMA_NAME(object_id) AS schema_name, name AS
                function_name, type_desc AS function_type, create_date,
                modify_date FROM sys.objects WHERE type IN ('FN', 'IF', 'TF') --
                FN=Scalar, IF=Inline TVF, TF=Multi-statement TVF ORDER BY
                schema_name, name; -- Xem definition c·ªßa m·ªôt UDF SELECT o.name
                AS function_name, m.definition FROM sys.objects o INNER JOIN
                sys.sql_modules m ON o.object_id = m.object_id WHERE o.name =
                'calculate_tax';
              </div>
            </div>

            <div class="example">
              <h4>Modify v√† Drop UDF:</h4>
              <div class="code-block">
                -- S·ª≠a ƒë·ªïi h√†m existing ALTER FUNCTION calculate_tax (@price
                DECIMAL(10, 2)) RETURNS DECIMAL(10, 2) AS BEGIN -- C·∫≠p nh·∫≠t thu·∫ø
                VAT th√†nh 8% RETURN @price * 0.08; END; -- X√≥a h√†m DROP FUNCTION
                IF EXISTS dbo.calculate_tax; -- Ki·ªÉm tra dependencies tr∆∞·ªõc khi
                x√≥a SELECT OBJECT_SCHEMA_NAME(referencing_id) AS
                referencing_schema, OBJECT_NAME(referencing_id) AS
                referencing_object, o.type_desc AS referencing_type FROM
                sys.sql_expression_dependencies d INNER JOIN sys.objects o ON
                d.referencing_id = o.object_id WHERE referenced_id =
                OBJECT_ID('dbo.calculate_tax');
              </div>
            </div>

            <h3>üéØ V√≠ d·ª• t·ªïng h·ª£p: H·ªá th·ªëng UDF cho E-commerce</h3>
            <div class="example">
              <h4>B·ªô UDF ho√†n ch·ªânh cho h·ªá th·ªëng b√°n h√†ng:</h4>
              <div class="code-block">
                -- 1. Scalar Function: T√≠nh shipping fee CREATE FUNCTION
                calculate_shipping_fee( @weight DECIMAL(10,2), @distance INT,
                @express_delivery BIT = 0 ) RETURNS DECIMAL(10,2) AS BEGIN
                DECLARE @base_fee DECIMAL(10,2) = 20000; -- 20k base DECLARE
                @weight_fee DECIMAL(10,2) = 0; DECLARE @distance_fee
                DECIMAL(10,2) = 0; DECLARE @express_fee DECIMAL(10,2) = 0; --
                Ph√≠ theo tr·ªçng l∆∞·ª£ng SET @weight_fee = (@weight - 1) * 5000; --
                5k/kg sau kg ƒë·∫ßu ti√™n IF @weight_fee < 0 SET @weight_fee = 0; --
                Ph√≠ theo kho·∫£ng c√°ch IF @distance > 50 SET @distance_fee =
                (@distance - 50) * 500; -- 500/km sau 50km ƒë·∫ßu -- Ph√≠ express IF
                @express_delivery = 1 SET @express_fee = @base_fee * 0.5; --
                <span class="operator"></span>+</span><span class="number">50</span><span class="operator">%</span> 
                <span class="keyword">RETURN</span> <span class="column">@base_fee</span> <span class="operator">+</span> <span class="column">@weight_fee</span> <span class="operator">+</span> <span class="column">@distance_fee</span> <span class="operator">+</span> <span class="column">@express_fee</span>;
                <span class="keyword">END</span>;

                <span class="comment">-- 2. Table-Valued Function: L·∫•y s·∫£n ph·∫©m theo filter</span>
                <span class="keyword">CREATE FUNCTION</span> <span class="function">get_filtered_products</span>(
                  <span class="column">@category_id</span> <span class="datatype">INT</span> <span class="operator">=</span> <span class="keyword">NULL</span>,
                  <span class="column">@min_price</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="keyword">NULL</span>,
                  <span class="column">@max_price</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="keyword">NULL</span>,
                  <span class="column">@in_stock_only</span> <span class="datatype">BIT</span> <span class="operator">=</span> <span class="number">0</span>
                ) 
                <span class="keyword">RETURNS TABLE</span> 
                <span class="keyword">AS</span> 
                <span class="keyword">RETURN</span> (
                  <span class="keyword">SELECT</span> <span class="column">p.product_id</span>, <span class="column">p.product_name</span>, <span class="column">p.list_price</span>, <span class="column">p.stock_quantity</span>, 
                         <span class="column">c.category_name</span>, <span class="column">b.brand_name</span>
                  <span class="keyword">FROM</span> <span class="table">products</span> <span class="keyword">p</span>
                  <span class="keyword">INNER JOIN</span> <span class="table">categories</span> <span class="keyword">c</span> <span class="keyword">ON</span> <span class="column">p.category_id</span> <span class="operator">=</span> <span class="column">c.category_id</span>
                  <span class="keyword">INNER JOIN</span> <span class="table">brands</span> <span class="keyword">b</span> <span class="keyword">ON</span> <span class="column">p.brand_id</span> <span class="operator">=</span> <span class="column">b.brand_id</span>
                  <span class="keyword">WHERE</span> (<span class="column">@category_id</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">p.category_id</span> <span class="operator">=</span> <span class="column">@category_id</span>)
                    <span class="keyword">AND</span> (<span class="column">@min_price</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">p.list_price</span> <span class="operator">>=</span> <span class="column">@min_price</span>)
                    <span class="keyword">AND</span> (<span class="column">@max_price</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">p.list_price</span> <span class="operator"><=</span> <span class="column">@max_price</span>)
                    <span class="keyword">AND</span> (<span class="column">@in_stock_only</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">OR</span> <span class="column">p.stock_quantity</span> <span class="operator">></span> <span class="number">0</span>)
                );

                <span class="comment">-- 3. S·ª≠ d·ª•ng c√°c UDF trong m·ªôt query th·ª±c t·∫ø</span>
                <span class="keyword">SELECT</span> <span class="column">p.product_name</span>, <span class="column">p.list_price</span>, <span class="column">p.stock_quantity</span>,
                       <span class="function">dbo.calculate_tax</span>(<span class="column">p.list_price</span>) <span class="keyword">AS</span> <span class="column">tax_amount</span>,
                       <span class="column">p.list_price</span> <span class="operator">+</span> <span class="function">dbo.calculate_tax</span>(<span class="column">p.list_price</span>) <span class="keyword">AS</span> <span class="column">total_price</span>,
                       <span class="function">dbo.calculate_shipping_fee</span>(<span class="number">2.5</span>, <span class="number">75</span>, <span class="number">0</span>) <span class="keyword">AS</span> <span class="column">standard_shipping</span>,
                       <span class="function">dbo.calculate_shipping_fee</span>(<span class="number">2.5</span>, <span class="number">75</span>, <span class="number">1</span>) <span class="keyword">AS</span> <span class="column">express_shipping</span>
                <span class="keyword">FROM</span> <span class="function">dbo.get_filtered_products</span>(<span class="number">1</span>, <span class="number">100000</span>, <span class="number">500000</span>, <span class="number">1</span>) <span class="keyword">p</span>
                <span class="keyword">ORDER BY</span> <span class="column">p.list_price</span> <span class="keyword">DESC</span>;
              </div>
            </div>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>User-Defined Functions</b> l√† c√¥ng c·ª• m·∫°nh m·∫Ω gi√∫p b·∫°n
                <b>t√°i s·ª≠ d·ª•ng logic v√† ƒë∆°n gi·∫£n h√≥a SQL</b>:
              </p>
              <ul>
                <li>
                  <b>Scalar Functions:</b> Ho√†n h·∫£o cho t√≠nh to√°n, validation,
                  formatting
                </li>
                <li>
                  <b>Table-Valued Functions:</b> Tuy·ªát v·ªùi cho filtering,
                  reporting, complex queries
                </li>
                <li><b>T√°i s·ª≠ d·ª•ng cao:</b> Vi·∫øt m·ªôt l·∫ßn, d√πng nhi·ªÅu n∆°i</li>
                <li><b>Maintainability:</b> Logic t·∫≠p trung, d·ªÖ c·∫≠p nh·∫≠t</li>
                <li>
                  <b>Performance:</b> ƒê∆∞·ª£c optimize v√† cached b·ªüi SQL Engine
                </li>
              </ul>
            </div>
          </section>

          <!-- 23 -->
          <section class="section" id="sp">
            <h2>23. Stored Procedure</h2>

            <div class="info-box">
              <h4>‚öôÔ∏è Stored Procedure l√† g√¨?</h4>
              <p>
                <b>Stored Procedure (Th·ªß t·ª•c l∆∞u tr·ªØ)</b> l√† m·ªôt ch∆∞∆°ng tr√¨nh
                con ho·∫∑c m·ªôt t·∫≠p h·ª£p c√°c c√¢u l·ªánh SQL ƒë∆∞·ª£c
                <b>bi√™n d·ªãch v√† l∆∞u tr·ªØ trong c∆° s·ªü d·ªØ li·ªáu</b>. N√≥ l√† m·ªôt ƒë·ªëi
                t∆∞·ª£ng c∆° s·ªü d·ªØ li·ªáu c√≥ t√™n, t∆∞∆°ng t·ª± nh∆∞ m·ªôt b·∫£ng ho·∫∑c m·ªôt view.
              </p>
              <p>
                Kh√°c v·ªõi h√†m UDF ch·ªâ c√≥ th·ªÉ tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã ho·∫∑c m·ªôt b·∫£ng,
                m·ªôt Stored Procedure c√≥ th·ªÉ
                <b>th·ª±c hi·ªán nhi·ªÅu t√°c v·ª• kh√°c nhau</b>, bao g·ªìm c·∫£ vi·ªác thay
                ƒë·ªïi d·ªØ li·ªáu (nh∆∞ INSERT, UPDATE, DELETE), ch·∫°y c√°c c√¢u l·ªánh ƒëi·ªÅu
                khi·ªÉn ph·ª©c t·∫°p (nh∆∞ IF/ELSE, WHILE), v√† tr·∫£ v·ªÅ nhi·ªÅu t·∫≠p k·∫øt
                qu·∫£.
              </p>
            </div>

            <div class="example">
              <h4>C√∫ ph√°p chung:</h4>
              <div class="code-block">
                CREATE PROCEDURE procedure_name @parameter1 datatype,
                @parameter2 datatype = default_value AS BEGIN -- C√°c c√¢u l·ªánh
                SQL -- Logic x·ª≠ l√Ω -- Return values (optional) END;
              </div>
            </div>

            <h3>üåü ∆Øu ƒëi·ªÉm c·ªßa Stored Procedure</h3>
            <div class="success-box">
              <p>
                S·ª≠ d·ª•ng Stored Procedure mang l·∫°i nhi·ªÅu l·ª£i √≠ch quan tr·ªçng trong
                ph√°t tri·ªÉn ·ª©ng d·ª•ng v√† qu·∫£n l√Ω c∆° s·ªü d·ªØ li·ªáu:
              </p>
              <ul>
                <li>
                  <b>TƒÉng hi·ªáu su·∫•t:</b> Th·ªß t·ª•c l∆∞u tr·ªØ ƒë∆∞·ª£c bi√™n d·ªãch v√† l∆∞u
                  tr·ªØ s·∫µn trong c∆° s·ªü d·ªØ li·ªáu. ƒêi·ªÅu n√†y gi√∫p gi·∫£m th·ªùi gian x·ª≠
                  l√Ω v√¨ kh√¥ng c·∫ßn ph·∫£i bi√™n d·ªãch l·∫°i m·ªói khi ƒë∆∞·ª£c g·ªçi
                </li>
                <li>
                  <b>T√°i s·ª≠ d·ª•ng code:</b> B·∫°n c√≥ th·ªÉ g·ªçi m·ªôt th·ªß t·ª•c l∆∞u tr·ªØ
                  nhi·ªÅu l·∫ßn t·ª´ c√°c ·ª©ng d·ª•ng kh√°c nhau ho·∫∑c t·ª´ c√°c th·ªß t·ª•c kh√°c,
                  gi√∫p tr√°nh l·∫∑p l·∫°i m√£ v√† d·ªÖ d√†ng b·∫£o tr√¨
                </li>
                <li>
                  <b>TƒÉng c∆∞·ªùng b·∫£o m·∫≠t:</b> B·∫°n c√≥ th·ªÉ c·∫•p quy·ªÅn cho ng∆∞·ªùi d√πng
                  th·ª±c thi m·ªôt th·ªß t·ª•c l∆∞u tr·ªØ m√† kh√¥ng c·∫ßn c·∫•p quy·ªÅn truy c·∫≠p
                  tr·ª±c ti·∫øp v√†o c√°c b·∫£ng c∆° s·ªü
                </li>
                <li>
                  <b>Gi·∫£m l∆∞u l∆∞·ª£ng m·∫°ng:</b> Thay v√¨ g·ª≠i nhi·ªÅu c√¢u l·ªánh SQL qua
                  m·∫°ng, ·ª©ng d·ª•ng ch·ªâ c·∫ßn g·ª≠i t√™n c·ªßa th·ªß t·ª•c v√† c√°c tham s·ªë c·∫ßn
                  thi·∫øt
                </li>
                <li>
                  <b>T√≠nh nh·∫•t qu√°n:</b> Logic nghi·ªáp v·ª• ƒë∆∞·ª£c t·∫≠p trung, ƒë·∫£m b·∫£o
                  x·ª≠ l√Ω ƒë·ªìng nh·∫•t
                </li>
              </ul>
            </div>

            <h3>üìù C√°c lo·∫°i Stored Procedure</h3>

            <h4>1Ô∏è‚É£ Th·ªß t·ª•c ƒë∆°n gi·∫£n (Simple Procedure)</h4>
            <div class="example">
              <p>T·∫°o m·ªôt Stored Procedure ƒë·ªÉ l·∫•y t·∫•t c·∫£ s·∫£n ph·∫©m:</p>
              <div class="code-block">
                <span class="keyword">CREATE PROCEDURE</span> <span class="function">get_products</span> 
                <span class="keyword">AS</span>
                <span class="keyword">BEGIN</span>
                  <span class="keyword">SELECT</span> <span class="column">product_id</span>, <span class="column">product_name</span>, <span class="column">list_price</span>, <span class="column">stock_quantity</span>, <span class="column">category_id</span>
                  <span class="keyword">FROM</span> <span class="table">products</span> 
                  <span class="keyword">ORDER BY</span> <span class="column">product_name</span>;
                <span class="keyword">END</span>;
                
                <span class="comment">-- C√°ch g·ªçi</span>
                <span class="keyword">EXEC</span> <span class="function">get_products</span>;
              </div>
            </div>

            <h4>2Ô∏è‚É£ Th·ªß t·ª•c c√≥ tham s·ªë ƒë·∫ßu v√†o (Input Parameters)</h4>
            <div class="example">
              <p>T·∫°o m·ªôt Stored Procedure ƒë·ªÉ l·∫•y s·∫£n ph·∫©m theo ID:</p>
              <div class="code-block">
                <span class="keyword">CREATE PROCEDURE</span> <span class="function">get_product_by_id</span> 
                  <span class="column">@product_id</span> <span class="datatype">INT</span> 
                <span class="keyword">AS</span>
                <span class="keyword">BEGIN</span>
                  <span class="comment">-- Ki·ªÉm tra tham s·ªë ƒë·∫ßu v√†o</span>
                  <span class="keyword">IF</span> <span class="column">@product_id</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">@product_id</span> <span class="operator"><=</span> <span class="number">0</span>
                  <span class="keyword">BEGIN</span>
                    <span class="keyword">RAISERROR</span>(<span class="string">'Product ID ph·∫£i l√† s·ªë d∆∞∆°ng'</span>, <span class="number">16</span>, <span class="number">1</span>);
                    <span class="keyword">RETURN</span>;
                  <span class="keyword">END</span>;
                  
                  <span class="keyword">SELECT</span> <span class="column">p.product_id</span>, <span class="column">p.product_name</span>, <span class="column">p.list_price</span>, <span class="column">p.stock_quantity</span>,
                         <span class="column">c.category_name</span>, <span class="column">b.brand_name</span>
                  <span class="keyword">FROM</span> <span class="table">products</span> <span class="keyword">p</span>
                  <span class="keyword">LEFT JOIN</span> <span class="table">categories</span> <span class="keyword">c</span> <span class="keyword">ON</span> <span class="column">p.category_id</span> <span class="operator">=</span> <span class="column">c.category_id</span>
                  <span class="keyword">LEFT JOIN</span> <span class="table">brands</span> <span class="keyword">b</span> <span class="keyword">ON</span> <span class="column">p.brand_id</span> <span class="operator">=</span> <span class="column">b.brand_id</span>
                  <span class="keyword">WHERE</span> <span class="column">p.product_id</span> <span class="operator">=</span> <span class="column">@product_id</span>;
                  
                  <span class="comment">-- Ki·ªÉm tra xem c√≥ t√¨m th·∫•y s·∫£n ph·∫©m kh√¥ng</span>
                  <span class="keyword">IF</span> <span class="function">@@ROWCOUNT</span> <span class="operator">=</span> <span class="number">0</span>
                  <span class="keyword">BEGIN</span>
                    <span class="keyword">PRINT</span> <span class="string">'Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m v·ªõi ID: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">@product_id</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>);
                  <span class="keyword">END</span>;
                <span class="keyword">END</span>;
                
                <span class="comment">-- C√°ch g·ªçi</span>
                <span class="keyword">EXEC</span> <span class="function">get_product_by_id</span> <span class="column">@product_id</span> <span class="operator">=</span> <span class="number">10</span>;
                <span class="keyword">EXEC</span> <span class="function">get_product_by_id</span> <span class="number">10</span>; <span class="comment">-- C√°ch vi·∫øt ng·∫Øn g·ªçn</span>
              </div>
            </div>

            <h4>3Ô∏è‚É£ Th·ªß t·ª•c v·ªõi tham s·ªë c√≥ gi√° tr·ªã m·∫∑c ƒë·ªãnh</h4>
            <div class="example">
              <div class="code-block">
                <span class="keyword"></span>CREATE PROCEDURE</span> <span class="function">get_products_by_category</span> 
                  <span class="column">@category_id</span> <span class="datatype">INT</span> <span class="operator">=</span> <span class="keyword">NULL</span>,
                  <span class="column">@min_price</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="number">0</span>,
                  <span class="column">@max_price</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="keyword">NULL</span>,
                  <span class="column">@order_by</span> <span class="datatype">VARCHAR</span>(<span class="number">50</span>) <span class="operator">=</span> <span class="string">'product_name'</span>
                <span class="keyword">AS</span>
                <span class="keyword">BEGIN</span>
                  <span class="comment">-- Validate order by parameter</span>
                  <span class="keyword">IF</span> <span class="column">@order_by</span> <span class="keyword">NOT IN</span> (<span class="string">'product_name'</span>, <span class="string">'list_price'</span>, <span class="string">'stock_quantity'</span>)
                  <span class="keyword">BEGIN</span>
                    <span class="keyword">SET</span> <span class="column">@order_by</span> <span class="operator">=</span> <span class="string">'product_name'</span>;
                  <span class="keyword">END</span>;
                  
                  <span class="comment">-- Dynamic query v·ªõi parameters</span>
                  <span class="keyword">SELECT</span> <span class="column">p.product_id</span>, <span class="column">p.product_name</span>, <span class="column">p.list_price</span>, <span class="column">p.stock_quantity</span>, <span class="column">c.category_name</span>
                  <span class="keyword">FROM</span> <span class="table">products</span> <span class="keyword">p</span>
                  <span class="keyword">INNER JOIN</span> <span class="table">categories</span> <span class="keyword">c</span> <span class="keyword">ON</span> <span class="column">p.category_id</span> <span class="operator">=</span> <span class="column">c.category_id</span>
                  <span class="keyword">WHERE</span> (<span class="column">@category_id</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">p.category_id</span> <span class="operator">=</span> <span class="column">@category_id</span>)
                    <span class="keyword">AND</span> <span class="column">p.list_price</span> <span class="operator">>=</span> <span class="column">@min_price</span>
                    <span class="keyword">AND</span> (<span class="column">@max_price</span> <span class="keyword">IS NULL</span> <span class="keyword">OR</span> <span class="column">p.list_price</span> <span class="operator"><=</span> <span class="column">@max_price</span>)
                  <span class="keyword">ORDER BY</span> 
                    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="column">@order_by</span> <span class="operator">=</span> <span class="string">'product_name'</span> <span class="keyword">THEN</span> <span class="column">p.product_name</span> <span class="keyword">END</span>,
                    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="column">@order_by</span> <span class="operator">=</span> <span class="string">'list_price'</span> <span class="keyword">THEN</span> <span class="column">p.list_price</span> <span class="keyword">END</span>,
                    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="column">@order_by</span> <span class="operator">=</span> <span class="string">'stock_quantity'</span> <span class="keyword">THEN</span> <span class="column">p.stock_quantity</span> <span class="keyword">END</span>;
                <span class="keyword">END</span>;
                
                <span class="comment">-- C√°c c√°ch g·ªçi kh√°c nhau</span>
                <span class="keyword">EXEC</span> <span class="function">get_products_by_category</span>; <span class="comment">-- L·∫•y t·∫•t c·∫£</span>
                <span class="keyword">EXEC</span> <span class="function">get_products_by_category</span> <span class="column">@category_id</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- Theo category</span>
                <span class="keyword">EXEC</span> <span class="function">get_products_by_category</span> <span class="column">@min_price</span> <span class="operator">=</span> <span class="number">100000</span>, <span class="column">@max_price</span> <span class="operator">=</span> <span class="number">500000</span>; <span class="comment">-- Theo gi√°</span>
                <span class="keyword">EXEC</span> <span class="function">get_products_by_category</span> <span class="column">@category_id</span> <span class="operator">=</span> <span class="number">1</span>, <span class="column">@order_by</span> <span class="operator">=</span> <span class="string">'list_price'</span>; <span class="comment">-- V·ªõi s·∫Øp x·∫øp</span>
              </div>
            </div>

            <h4>4Ô∏è‚É£ Th·ªß t·ª•c v·ªõi tham s·ªë ƒë·∫ßu ra (Output Parameters)</h4>
            <div class="example">
              <div class="code-block">
                <span class="keyword"></span>CREATE PROCEDURE</span> <span class="function">get_order_summary</span> 
                  <span class="column">@customer_id</span> <span class="datatype">INT</span>,
                  <span class="column">@total_orders</span> <span class="datatype">INT</span> <span class="keyword">OUTPUT</span>,
                  <span class="column">@total_amount</span> <span class="datatype">DECIMAL</span>(<span class="number">15</span>,<span class="number">2</span>) <span class="keyword">OUTPUT</span>,
                  <span class="column">@avg_order_value</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">OUTPUT</span>,
                  <span class="column">@last_order_date</span> <span class="datatype">DATE</span> <span class="keyword">OUTPUT</span>
                <span class="keyword">AS</span>
                <span class="keyword">BEGIN</span>
                  <span class="keyword">SELECT</span> <span class="column">@total_orders</span> <span class="operator">=</span> <span class="function">COUNT</span>(<span class="column">order_id</span>),
                         <span class="column">@total_amount</span> <span class="operator">=</span> <span class="function">COALESCE</span>(<span class="function">SUM</span>(<span class="column">total_amount</span>), <span class="number">0</span>),
                         <span class="column">@avg_order_value</span> <span class="operator">=</span> <span class="function">COALESCE</span>(<span class="function">AVG</span>(<span class="column">total_amount</span>), <span class="number">0</span>),
                         <span class="column">@last_order_date</span> <span class="operator">=</span> <span class="function">MAX</span>(<span class="column">order_date</span>)
                  <span class="keyword">FROM</span> <span class="table">orders</span> 
                  <span class="keyword">WHERE</span> <span class="column">customer_id</span> <span class="operator">=</span> <span class="column">@customer_id</span> <span class="keyword">AND</span> <span class="column">status</span> <span class="operator">=</span> <span class="string">'completed'</span>;
                  
                  <span class="comment">-- Tr·∫£ v·ªÅ th√¥ng tin chi ti·∫øt trong result set</span>
                  <span class="keyword">SELECT</span> <span class="column">c.customer_name</span>, <span class="column">@total_orders</span> <span class="keyword">AS</span> <span class="column">total_orders</span>,
                         <span class="column">@total_amount</span> <span class="keyword">AS</span> <span class="column">total_amount</span>, <span class="column">@avg_order_value</span> <span class="keyword">AS</span> <span class="column">avg_order_value</span>,
                         <span class="column">@last_order_date</span> <span class="keyword">AS</span> <span class="column">last_order_date</span>,
                         <span class="keyword">CASE</span> 
                           <span class="keyword">WHEN</span> <span class="column">@total_amount</span> <span class="operator">></span> <span class="number">10000000</span> <span class="keyword">THEN</span> <span class="string">'VIP'</span>
                           <span class="keyword">WHEN</span> <span class="column">@total_amount</span> <span class="operator">></span> <span class="number">5000000</span> <span class="keyword">THEN</span> <span class="string">'Premium'</span>
                           <span class="keyword">WHEN</span> <span class="column">@total_amount</span> <span class="operator">></span> <span class="number">1000000</span> <span class="keyword">THEN</span> <span class="string">'Gold'</span>
                           <span class="keyword">ELSE</span> <span class="string">'Regular'</span>
                         <span class="keyword">END</span> <span class="keyword">AS</span> <span class="column">customer_tier</span>
                  <span class="keyword">FROM</span> <span class="table">customers</span> <span class="keyword">c</span> 
                  <span class="keyword">WHERE</span> <span class="column">c.customer_id</span> <span class="operator">=</span> <span class="column">@customer_id</span>;
                <span class="keyword">END</span>;
                
                <span class="comment">-- C√°ch s·ª≠ d·ª•ng v·ªõi OUTPUT parameters</span>
                <span class="keyword">DECLARE</span> <span class="column">@orders</span> <span class="datatype">INT</span>, <span class="column">@amount</span> <span class="datatype">DECIMAL</span>(<span class="number">15</span>,<span class="number">2</span>), <span class="column">@avg</span> <span class="datatype">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>), <span class="column">@last_date</span> <span class="datatype">DATE</span>;
                
                <span class="keyword">EXEC</span> <span class="function">get_order_summary</span> 
                  <span class="column">@customer_id</span> <span class="operator">=</span> <span class="number">1</span>,
                  <span class="column">@total_orders</span> <span class="operator">=</span> <span class="column">@orders</span> <span class="keyword">OUTPUT</span>,
                  <span class="column">@total_amount</span> <span class="operator">=</span> <span class="column">@amount</span> <span class="keyword">OUTPUT</span>,
                  <span class="column">@avg_order_value</span> <span class="operator">=</span> <span class="column">@avg</span> <span class="keyword">OUTPUT</span>,
                  <span class="column">@last_order_date</span> <span class="operator">=</span> <span class="column">@last_date</span> <span class="keyword">OUTPUT</span>;
                  
                <span class="comment">-- S·ª≠ d·ª•ng c√°c gi√° tr·ªã OUTPUT</span>
                <span class="keyword">PRINT</span> <span class="string">'T·ªïng ƒë∆°n h√†ng: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">@orders</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>);
                <span class="keyword">PRINT</span> <span class="string">'T·ªïng gi√° tr·ªã: '</span> <span class="operator">+</span> <span class="function">FORMAT</span>(<span class="column">@amount</span>, <span class="string">'N0'</span>);
                <span class="keyword">PRINT</span> <span class="string">'Gi√° tr·ªã trung b√¨nh: '</span> <span class="operator">+</span> <span class="function">FORMAT</span>(<span class="column">@avg</span>, <span class="string">'N0'</span>);
                <span class="keyword">PRINT</span> <span class="string">'ƒê∆°n h√†ng cu·ªëi: '</span> <span class="operator">+</span> <span class="function">CAST</span>(<span class="column">@last_date</span> <span class="keyword">AS</span> <span class="datatype">VARCHAR</span>);
              </div>
            </div>

            <h4>5Ô∏è‚É£ Th·ªß t·ª•c v·ªõi logic ƒëi·ªÅu khi·ªÉn ph·ª©c t·∫°p</h4>
            <div class="example">
              <p>
                T·∫°o m·ªôt Stored Procedure ƒë·ªÉ ch√®n s·∫£n ph·∫©m m·ªõi, ki·ªÉm tra n·∫øu t√™n
                s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i:
              </p>
              <div class="code-block">
                CREATE PROCEDURE insert_new_product @product_name VARCHAR(255),
                @category_id INT, @brand_id INT, @list_price DECIMAL(10,2),
                @stock_quantity INT = 0, @description NTEXT = NULL,
                @new_product_id INT OUTPUT AS BEGIN SET NOCOUNT ON; -- Kh√¥ng tr·∫£
                v·ªÅ row count DECLARE @error_message VARCHAR(500); BEGIN TRY --
                Validate inputs IF LTRIM(RTRIM(@product_name)) = '' BEGIN
                RAISERROR('T√™n s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng', 16, 1); RETURN;
                END; IF @list_price < 0 BEGIN RAISERROR('Gi√° s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c
                √¢m', 16, 1); RETURN; END; -- Ki·ªÉm tra category exists IF NOT
                EXISTS (SELECT 1 FROM categories WHERE category_id =
                @category_id) BEGIN RAISERROR('Category ID kh√¥ng t·ªìn t·∫°i: %d',
                16, 1, @category_id); RETURN; END; -- Ki·ªÉm tra brand exists IF
                NOT EXISTS (SELECT 1 FROM brands WHERE brand_id = @brand_id)
                BEGIN RAISERROR('Brand ID kh√¥ng t·ªìn t·∫°i: %d', 16, 1, @brand_id);
                RETURN; END; -- Ki·ªÉm tra duplicate product name IF EXISTS
                (SELECT 1 FROM products WHERE product_name = @product_name)
                BEGIN PRINT 'C·∫£nh b√°o: S·∫£n ph·∫©m "' + @product_name + '" ƒë√£ t·ªìn
                t·∫°i.'; -- L·∫•y ID c·ªßa s·∫£n ph·∫©m existing SELECT @new_product_id =
                product_id FROM products WHERE product_name = @product_name;
                RETURN; END; -- Insert new product INSERT INTO products (
                product_name, category_id, brand_id, list_price, stock_quantity,
                description, created_date, updated_date ) VALUES (
                @product_name, @category_id, @brand_id, @list_price,
                @stock_quantity, @description, GETDATE(), GETDATE() ); -- L·∫•y ID
                c·ªßa s·∫£n ph·∫©m v·ª´a t·∫°o SET @new_product_id = SCOPE_IDENTITY();
                PRINT 'S·∫£n ph·∫©m "' + @product_name + '" ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng
                v·ªõi ID: ' + CAST(@new_product_id AS VARCHAR); END TRY BEGIN
                CATCH SET @error_message = ERROR_MESSAGE(); RAISERROR('L·ªói khi
                th√™m s·∫£n ph·∫©m: %s', 16, 1, @error_message); END CATCH; END; --
                S·ª≠ d·ª•ng procedure DECLARE @product_id INT; EXEC
                insert_new_product @product_name = 'iPhone 15 Pro Max',
                @category_id = 1, @brand_id = 2, @list_price = 29990000,
                @stock_quantity = 50, @description = 'Flagship smartphone from
                Apple', @new_product_id = @product_id OUTPUT; IF @product_id IS
                NOT NULL PRINT 'Product created with ID: ' + CAST(@product_id AS
                VARCHAR);
              </div>
            </div>

            <h3>üîÑ Stored Procedure v·ªõi Transaction</h3>
            <div class="example">
              <h4>Procedure x·ª≠ l√Ω ƒë·∫∑t h√†ng v·ªõi transaction safety:</h4>
              <div class="code-block">
                CREATE PROCEDURE process_order @customer_id INT, @product_items
                NVARCHAR(MAX), -- JSON string: [{"product_id":1,"quantity":2}]
                @payment_method VARCHAR(50), @shipping_address NVARCHAR(500),
                @order_id INT OUTPUT AS BEGIN SET NOCOUNT ON; DECLARE
                @total_amount DECIMAL(15,2) = 0; DECLARE @error_message
                VARCHAR(500); BEGIN TRANSACTION; BEGIN TRY -- Validate customer
                IF NOT EXISTS (SELECT 1 FROM customers WHERE customer_id =
                @customer_id) BEGIN RAISERROR('Customer kh√¥ng t·ªìn t·∫°i', 16, 1);
                RETURN; END; -- Create order INSERT INTO orders (customer_id,
                order_date, status, payment_method, shipping_address) VALUES
                (@customer_id, GETDATE(), 'processing', @payment_method,
                @shipping_address); SET @order_id = SCOPE_IDENTITY(); -- Process
                order items (gi·∫£ s·ª≠ d√πng JSON) DECLARE @product_id INT,
                @quantity INT, @unit_price DECIMAL(10,2), @stock INT; -- Cursor
                ƒë·ªÉ x·ª≠ l√Ω t·ª´ng item (simplified example) DECLARE item_cursor
                CURSOR FOR SELECT product_id, quantity FROM
                OPENJSON(@product_items) WITH (product_id INT '$.product_id',
                quantity INT '$.quantity'); OPEN item_cursor; WHILE 1 = 1 BEGIN
                FETCH NEXT FROM item_cursor INTO @product_id, @quantity; IF
                @@FETCH_STATUS <> 0 BREAK; -- Get product info and check stock
                SELECT @unit_price = list_price, @stock = stock_quantity FROM
                products WHERE product_id = @product_id; IF @unit_price IS NULL
                BEGIN RAISERROR('Product ID %d kh√¥ng t·ªìn t·∫°i', 16, 1,
                @product_id); CLOSE item_cursor; DEALLOCATE item_cursor;
                ROLLBACK TRANSACTION; RETURN; END; IF @stock < @quantity BEGIN
                RAISERROR('Kh√¥ng ƒë·ªß stock cho product ID %d. C√≤n l·∫°i: %d', 16,
                1, @product_id, @stock); CLOSE item_cursor; DEALLOCATE
                item_cursor; ROLLBACK TRANSACTION; RETURN; END; -- Insert order
                item INSERT INTO order_items (order_id, product_id, quantity,
                unit_price) VALUES (@order_id, @product_id, @quantity,
                @unit_price); -- Update stock UPDATE products SET stock_quantity
                = stock_quantity - @quantity, updated_date = GETDATE() WHERE
                product_id = @product_id; SET @total_amount = @total_amount +
                (@quantity * @unit_price); END; CLOSE item_cursor; DEALLOCATE
                item_cursor; -- Update order total UPDATE orders SET
                total_amount = @total_amount, updated_date = GETDATE() WHERE
                order_id = @order_id; COMMIT TRANSACTION; PRINT 'ƒê∆°n h√†ng ' +
                CAST(@order_id AS VARCHAR) + ' ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng. T·ªïng
                ti·ªÅn: ' + FORMAT(@total_amount, 'N0'); END TRY BEGIN CATCH IF
                @@TRANCOUNT > 0 ROLLBACK TRANSACTION; SET @error_message =
                ERROR_MESSAGE(); RAISERROR('L·ªói x·ª≠ l√Ω ƒë∆°n h√†ng: %s', 16, 1,
                @error_message); SET @order_id = NULL; END CATCH; END;
              </div>
            </div>

            <h3>üìä Stored Procedure tr·∫£ v·ªÅ nhi·ªÅu Result Sets</h3>
            <div class="example">
              <div class="code-block">
                CREATE PROCEDURE get_customer_dashboard @customer_id INT AS
                BEGIN SET NOCOUNT ON; -- Result Set 1: Customer Info SELECT
                customer_id, customer_name, email, phone, registration_date,
                customer_type FROM customers WHERE customer_id = @customer_id;
                -- Result Set 2: Recent Orders SELECT TOP 10 order_id,
                order_date, status, total_amount, payment_method FROM orders
                WHERE customer_id = @customer_id ORDER BY order_date DESC; --
                Result Set 3: Favorite Products SELECT TOP 5 p.product_name,
                SUM(oi.quantity) AS total_purchased, AVG(oi.unit_price) AS
                avg_price FROM order_items oi INNER JOIN orders o ON oi.order_id
                = o.order_id INNER JOIN products p ON oi.product_id =
                p.product_id WHERE o.customer_id = @customer_id AND o.status =
                'completed' GROUP BY p.product_id, p.product_name ORDER BY
                total_purchased DESC; -- Result Set 4: Summary Statistics SELECT
                COUNT(DISTINCT o.order_id) AS total_orders,
                COALESCE(SUM(o.total_amount), 0) AS total_spent,
                COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
                MAX(o.order_date) AS last_order_date FROM orders o WHERE
                o.customer_id = @customer_id AND o.status = 'completed'; END; --
                G·ªçi procedure s·∫Ω tr·∫£ v·ªÅ 4 result sets EXEC
                get_customer_dashboard @customer_id = 1;
              </div>
            </div>

            <h3>üîß Qu·∫£n l√Ω Stored Procedures</h3>

            <div class="example">
              <h4>Xem th√¥ng tin Stored Procedures:</h4>
              <div class="code-block">
                -- Li·ªát k√™ t·∫•t c·∫£ stored procedures SELECT
                SCHEMA_NAME(schema_id) AS schema_name, name AS procedure_name,
                create_date, modify_date, type_desc FROM sys.procedures ORDER BY
                schema_name, name; -- Xem definition c·ªßa m·ªôt procedure SELECT
                p.name AS procedure_name, m.definition FROM sys.procedures p
                INNER JOIN sys.sql_modules m ON p.object_id = m.object_id WHERE
                p.name = 'get_products'; -- Xem parameters c·ªßa m·ªôt procedure
                SELECT p.name AS procedure_name, pm.name AS parameter_name,
                t.name AS data_type, pm.max_length, pm.precision, pm.scale,
                pm.is_output FROM sys.procedures p INNER JOIN sys.parameters pm
                ON p.object_id = pm.object_id INNER JOIN sys.types t ON
                pm.user_type_id = t.user_type_id WHERE p.name = 'process_order'
                ORDER BY pm.parameter_id;
              </div>
            </div>

            <div class="example">
              <h4>Modify v√† Drop Procedures:</h4>
              <div class="code-block">
                -- S·ª≠a ƒë·ªïi procedure existing ALTER PROCEDURE get_products AS
                BEGIN SELECT product_id, product_name, list_price,
                stock_quantity, CASE WHEN stock_quantity > 100 THEN 'In Stock'
                WHEN stock_quantity > 0 THEN 'Low Stock' ELSE 'Out of Stock' END
                AS stock_status FROM products WHERE stock_quantity >= 0 -- Only
                show valid products ORDER BY product_name; END; -- X√≥a procedure
                DROP PROCEDURE IF EXISTS dbo.old_procedure_name; -- Ki·ªÉm tra
                dependencies tr∆∞·ªõc khi x√≥a SELECT
                OBJECT_SCHEMA_NAME(referencing_id) AS referencing_schema,
                OBJECT_NAME(referencing_id) AS referencing_object, o.type_desc
                AS referencing_type FROM sys.sql_expression_dependencies d INNER
                JOIN sys.objects o ON d.referencing_id = o.object_id WHERE
                referenced_id = OBJECT_ID('dbo.get_products');
              </div>
            </div>

            <h3>‚ö° Performance v√† Best Practices</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>SET NOCOUNT ON:</b> T·∫Øt messages v·ªÅ row count ƒë·ªÉ tƒÉng
                  performance
                </li>
                <li>
                  <b>Validate inputs:</b> Ki·ªÉm tra tham s·ªë ƒë·∫ßu v√†o k·ªπ l∆∞·ª°ng
                </li>
                <li>
                  <b>Use transactions:</b> ƒê·∫£m b·∫£o data consistency v·ªõi
                  BEGIN/COMMIT/ROLLBACK
                </li>
                <li>
                  <b>Error handling:</b> S·ª≠ d·ª•ng TRY...CATCH cho t·∫•t c·∫£
                  procedures quan tr·ªçng
                </li>
                <li>
                  <b>Use OUTPUT parameters:</b> Tr·∫£ v·ªÅ status codes v√† values
                </li>
                <li><b>Optimize queries:</b> ƒê·∫£m b·∫£o c√≥ index ph√π h·ª£p</li>
                <li>
                  <b>Document thoroughly:</b> Comment r√µ r√†ng logic v√†
                  parameters
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li>
                  <b>Dynamic SQL kh√¥ng c·∫ßn thi·∫øt:</b> C√≥ th·ªÉ g√¢y SQL injection
                </li>
                <li><b>Procedures qu√° d√†i:</b> Kh√≥ maintain v√† debug</li>
                <li><b>Hardcode values:</b> N√™n d√πng parameters</li>
                <li><b>Kh√¥ng x·ª≠ l√Ω l·ªói:</b> C√≥ th·ªÉ g√¢y data inconsistency</li>
                <li>
                  <b>Cursors kh√¥ng c·∫ßn thi·∫øt:</b> Ch·∫≠m h∆°n set-based operations
                </li>
                <li>
                  <b>Qu√° nhi·ªÅu result sets:</b> G√¢y kh√≥ khƒÉn cho application
                </li>
              </ul>
            </div>

            <h3>üîÑ So s√°nh Stored Procedure vs UDF vs View</h3>
            <table>
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>Stored Procedure</th>
                  <th>User-Defined Function</th>
                  <th>View</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>C√≥ th·ªÉ thay ƒë·ªïi d·ªØ li·ªáu</b></td>
                  <td>C√≥ (INSERT/UPDATE/DELETE)</td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng (ch·ªâ ƒë·ªçc)</td>
                </tr>
                <tr>
                  <td><b>Tr·∫£ v·ªÅ</b></td>
                  <td>Multiple result sets, parameters</td>
                  <td>Single value ho·∫∑c table</td>
                  <td>Single result set</td>
                </tr>
                <tr>
                  <td><b>S·ª≠ d·ª•ng trong SELECT</b></td>
                  <td>Kh√¥ng</td>
                  <td>C√≥ (UDF)</td>
                  <td>C√≥</td>
                </tr>
                <tr>
                  <td><b>Transaction support</b></td>
                  <td>C√≥</td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                </tr>
                <tr>
                  <td><b>Error handling</b></td>
                  <td>TRY...CATCH</td>
                  <td>H·∫°n ch·∫ø</td>
                  <td>Kh√¥ng</td>
                </tr>
                <tr>
                  <td><b>Khi n√†o d√πng</b></td>
                  <td>Complex business logic</td>
                  <td>Calculations, formatting</td>
                  <td>Simple data presentation</td>
                </tr>
              </tbody>
            </table>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>Stored Procedures</b> l√† c√¥ng c·ª• m·∫°nh m·∫Ω nh·∫•t ƒë·ªÉ
                <b>x·ª≠ l√Ω logic nghi·ªáp v·ª• ph·ª©c t·∫°p</b> trong SQL:
              </p>
              <ul>
                <li><b>Flexibility:</b> C√≥ th·ªÉ th·ª±c hi·ªán m·ªçi thao t√°c SQL</li>
                <li><b>Security:</b> Ki·ªÉm so√°t truy c·∫≠p ch·∫∑t ch·∫Ω</li>
                <li><b>Performance:</b> ƒê∆∞·ª£c compile v√† cache</li>
                <li><b>Transaction support:</b> ƒê·∫£m b·∫£o data integrity</li>
                <li><b>Reusability:</b> Logic t·∫≠p trung, d·ªÖ maintain</li>
              </ul>
            </div>
          </section>

          <!-- 24 -->
          <section class="section" id="exception">
            <h2>24. Exception</h2>

            <div class="info-box">
              <h4>‚ö†Ô∏è X·ª≠ l√Ω ngo·∫°i l·ªá l√† g√¨?</h4>
              <p>
                <b>X·ª≠ l√Ω ngo·∫°i l·ªá (Exception Handling)</b> l√† m·ªôt c∆° ch·∫ø cho
                ph√©p b·∫°n qu·∫£n l√Ω v√† ph·∫£n ·ª©ng v·ªõi c√°c l·ªói ho·∫∑c c√°c t√¨nh hu·ªëng b·∫•t
                th∆∞·ªùng c√≥ th·ªÉ x·∫£y ra trong qu√° tr√¨nh th·ª±c thi m·ªôt c√¢u l·ªánh SQL
                ho·∫∑c m·ªôt kh·ªëi m√£.
              </p>
              <p>
                Thay v√¨ ƒë·ªÉ ch∆∞∆°ng tr√¨nh b·ªã d·ª´ng ƒë·ªôt ng·ªôt, c∆° ch·∫ø n√†y gi√∫p b·∫°n
                <b>"b·∫Øt" l·ªói v√† th·ª±c hi·ªán m·ªôt h√†nh ƒë·ªông n√†o ƒë√≥</b> (nh∆∞ ghi l·∫°i
                l·ªói, tr·∫£ v·ªÅ m·ªôt th√¥ng b√°o th√¢n thi·ªán, ho·∫∑c h·ªßy b·ªè giao d·ªãch).
              </p>
            </div>

            <h3>üõ°Ô∏è TRY...CATCH trong SQL Server</h3>
            <div class="highlight-box">
              <p>
                C∆° ch·∫ø TRY...CATCH ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x·ª≠ l√Ω l·ªói m·ªôt c√°ch c√≥ c·∫•u
                tr√∫c trong SQL Server. N√≥ ho·∫°t ƒë·ªông t∆∞∆°ng t·ª± nh∆∞ trong c√°c ng√¥n
                ng·ªØ l·∫≠p tr√¨nh kh√°c.
              </p>
            </div>

            <div class="example">
              <h4>üìã C·∫•u tr√∫c TRY...CATCH:</h4>
              <div class="code-block">
                BEGIN TRY -- Kh·ªëi m√£ c√≥ th·ªÉ g√¢y l·ªói -- C√°c c√¢u l·ªánh SQL c·∫ßn ki·ªÉm
                so√°t l·ªói END TRY BEGIN CATCH -- Kh·ªëi x·ª≠ l√Ω l·ªói -- ƒê∆∞·ª£c th·ª±c thi
                khi c√≥ l·ªói x·∫£y ra trong TRY -- C√≥ th·ªÉ s·ª≠ d·ª•ng c√°c h√†m ERROR_*()
                ƒë·ªÉ l·∫•y th√¥ng tin l·ªói END CATCH;
              </div>

              <p><b>Kh·ªëi TRY:</b></p>
              <ul>
                <li>
                  Ch·ª©a m·ªôt ho·∫∑c nhi·ªÅu c√¢u l·ªánh SQL m√† b·∫°n mu·ªën ki·ªÉm so√°t l·ªói
                </li>
                <li>
                  N·∫øu b·∫•t k·ª≥ l·ªói n√†o x·∫£y ra trong kh·ªëi n√†y, vi·ªác th·ª±c thi s·∫Ω
                  d·ª´ng l·∫°i v√† chuy·ªÉn ƒë·∫øn kh·ªëi CATCH
                </li>
              </ul>

              <p><b>Kh·ªëi CATCH:</b></p>
              <ul>
                <li>Ch·ª©a c√°c c√¢u l·ªánh SQL ƒë·ªÉ x·ª≠ l√Ω l·ªói</li>
                <li>
                  Kh·ªëi n√†y ch·ªâ ƒë∆∞·ª£c th·ª±c thi khi c√≥ l·ªói x·∫£y ra trong kh·ªëi TRY
                </li>
                <li>
                  B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c h√†m h·ªá th·ªëng ƒë·ªÉ l·∫•y th√¥ng tin chi ti·∫øt
                  v·ªÅ l·ªói
                </li>
              </ul>
            </div>

            <h3>üîç C√°c h√†m ERROR trong CATCH</h3>
            <table>
              <thead>
                <tr>
                  <th>H√†m</th>
                  <th>M√¥ t·∫£</th>
                  <th>V√≠ d·ª• tr·∫£ v·ªÅ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>ERROR_NUMBER()</b></td>
                  <td>S·ªë l·ªói c·ªßa h·ªá th·ªëng</td>
                  <td>547, 8134, 2627</td>
                </tr>
                <tr>
                  <td><b>ERROR_MESSAGE()</b></td>
                  <td>Th√¥ng b√°o l·ªói chi ti·∫øt</td>
                  <td>"Division by zero error"</td>
                </tr>
                <tr>
                  <td><b>ERROR_SEVERITY()</b></td>
                  <td>M·ª©c ƒë·ªô nghi√™m tr·ªçng (1-25)</td>
                  <td>16 (User errors)</td>
                </tr>
                <tr>
                  <td><b>ERROR_STATE()</b></td>
                  <td>Tr·∫°ng th√°i l·ªói</td>
                  <td>1, 2, 3...</td>
                </tr>
                <tr>
                  <td><b>ERROR_LINE()</b></td>
                  <td>S·ªë d√≤ng x·∫£y ra l·ªói</td>
                  <td>15, 23, 45...</td>
                </tr>
                <tr>
                  <td><b>ERROR_PROCEDURE()</b></td>
                  <td>T√™n stored procedure/function</td>
                  <td>"sp_insert_order"</td>
                </tr>
              </tbody>
            </table>

            <h3>üí° V√≠ d·ª• c∆° b·∫£n</h3>
            <div class="example">
              <h4>X·ª≠ l√Ω l·ªói chia cho 0:</h4>
              <div class="code-block">
                BEGIN TRY DECLARE @result INT; SET @result = 10 / 0; -- G√¢y l·ªói
                chia cho 0 PRINT 'K·∫øt qu·∫£: ' + CAST(@result AS VARCHAR); END TRY
                BEGIN CATCH PRINT 'ƒê√£ x·∫£y ra l·ªói!'; PRINT 'M√£ l·ªói: ' +
                CAST(ERROR_NUMBER() AS VARCHAR); PRINT 'Th√¥ng b√°o: ' +
                ERROR_MESSAGE(); PRINT 'ƒê·ªô nghi√™m tr·ªçng: ' +
                CAST(ERROR_SEVERITY() AS VARCHAR); PRINT 'Tr·∫°ng th√°i: ' +
                CAST(ERROR_STATE() AS VARCHAR); PRINT 'D√≤ng l·ªói: ' +
                CAST(ERROR_LINE() AS VARCHAR); END CATCH; -- K·∫øt qu·∫£ s·∫Ω in ra:
                -- ƒê√£ x·∫£y ra l·ªói! -- M√£ l·ªói: 8134 -- Th√¥ng b√°o: Divide by zero
                error encountered. -- ƒê·ªô nghi√™m tr·ªçng: 16 -- Tr·∫°ng th√°i: 1 --
                D√≤ng l·ªói: 3
              </div>
            </div>

            <h3>üîÑ TRY...CATCH v·ªõi Transaction</h3>
            <div class="example">
              <h4>V√≠ d·ª• th√™m ƒë∆°n h√†ng v·ªõi x·ª≠ l√Ω l·ªói:</h4>
              <div class="code-block">
                -- Stored Procedure th√™m ƒë∆°n h√†ng an to√†n CREATE PROCEDURE
                sp_create_order @customer_id INT, @product_id INT, @quantity INT
                AS BEGIN SET NOCOUNT ON; DECLARE @order_id INT; DECLARE
                @stock_quantity INT; DECLARE @unit_price DECIMAL(10,2); BEGIN
                TRY -- B·∫Øt ƒë·∫ßu transaction BEGIN TRANSACTION; -- Ki·ªÉm tra
                customer t·ªìn t·∫°i IF NOT EXISTS (SELECT 1 FROM customers WHERE
                customer_id = @customer_id) BEGIN RAISERROR('Customer ID %d
                kh√¥ng t·ªìn t·∫°i', 16, 1, @customer_id); RETURN; END; -- Ki·ªÉm tra
                s·∫£n ph·∫©m v√† l·∫•y th√¥ng tin SELECT @stock_quantity =
                stock_quantity, @unit_price = list_price FROM products WHERE
                product_id = @product_id; IF @stock_quantity IS NULL BEGIN
                RAISERROR('Product ID %d kh√¥ng t·ªìn t·∫°i', 16, 1, @product_id);
                RETURN; END; -- Ki·ªÉm tra t·ªìn kho IF @stock_quantity < @quantity
                BEGIN RAISERROR('Kh√¥ng ƒë·ªß t·ªìn kho. C√≤n l·∫°i: %d, y√™u c·∫ßu: %d',
                16, 1, @stock_quantity, @quantity); RETURN; END; -- T·∫°o ƒë∆°n h√†ng
                INSERT INTO orders (customer_id, order_date, total_amount,
                status) VALUES (@customer_id, GETDATE(), @quantity *
                @unit_price, 'processing'); SET @order_id = SCOPE_IDENTITY(); --
                Th√™m order items INSERT INTO order_items (order_id, product_id,
                quantity, unit_price) VALUES (@order_id, @product_id, @quantity,
                @unit_price); -- C·∫≠p nh·∫≠t t·ªìn kho UPDATE products SET
                stock_quantity = stock_quantity - @quantity, updated_date =
                GETDATE() WHERE product_id = @product_id; -- Commit transaction
                n·∫øu th√†nh c√¥ng COMMIT TRANSACTION; PRINT 'ƒê∆°n h√†ng ' +
                CAST(@order_id AS VARCHAR) + ' ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng'; RETURN
                @order_id; END TRY BEGIN CATCH -- Ki·ªÉm tra v√† rollback
                transaction n·∫øu ƒëang m·ªü IF @@TRANCOUNT > 0 ROLLBACK TRANSACTION;
                -- Ghi log l·ªói chi ti·∫øt DECLARE @error_message VARCHAR(2048) =
                'L·ªói t·∫°i procedure: ' + ISNULL(ERROR_PROCEDURE(),
                'sp_create_order') + ', D√≤ng: ' + CAST(ERROR_LINE() AS VARCHAR)
                + ', Th√¥ng b√°o: ' + ERROR_MESSAGE(); -- Ghi v√†o b·∫£ng error_log
                INSERT INTO error_log (error_message, error_number,
                error_severity, error_time, procedure_name) VALUES
                (@error_message, ERROR_NUMBER(), ERROR_SEVERITY(), GETDATE(),
                'sp_create_order'); -- Tr·∫£ v·ªÅ l·ªói cho ·ª©ng d·ª•ng
                RAISERROR(@error_message, 16, 1); RETURN -1; -- Return error
                code END CATCH; END; -- S·ª≠ d·ª•ng procedure EXEC sp_create_order
                @customer_id = 1, @product_id = 5, @quantity = 2;
              </div>
            </div>

            <h3>üìä TRY...CATCH l·ªìng nhau (Nested)</h3>
            <div class="example">
              <h4>X·ª≠ l√Ω l·ªói ƒëa c·∫•p:</h4>
              <div class="code-block">
                CREATE PROCEDURE sp_complex_operation @operation_type
                VARCHAR(20) AS BEGIN BEGIN TRY PRINT 'B·∫Øt ƒë·∫ßu thao t√°c: ' +
                @operation_type; IF @operation_type = 'risky_operation' BEGIN --
                Thao t√°c c√≥ th·ªÉ g√¢y l·ªói c·∫•p 2 BEGIN TRY -- Gi·∫£ l·∫≠p thao t√°c ph·ª©c
                t·∫°p DECLARE @result INT = 100 / 0; -- L·ªói chia cho 0 PRINT 'Thao
                t√°c ph·ª©c t·∫°p th√†nh c√¥ng'; END TRY BEGIN CATCH PRINT 'L·ªói c·∫•p 2:
                ' + ERROR_MESSAGE(); -- Th·ª≠ ph∆∞∆°ng √°n backup BEGIN TRY PRINT
                'Th·ª≠ ph∆∞∆°ng √°n backup...'; -- Gi·∫£ l·∫≠p backup operation th√†nh
                c√¥ng SET @result = 100 / 1; PRINT 'Ph∆∞∆°ng √°n backup th√†nh c√¥ng';
                END TRY BEGIN CATCH PRINT 'Ph∆∞∆°ng √°n backup c≈©ng th·∫•t b·∫°i: ' +
                ERROR_MESSAGE(); -- Re-throw error ƒë·ªÉ outer catch x·ª≠ l√Ω THROW;
                END CATCH; END CATCH; END ELSE BEGIN PRINT 'Thao t√°c b√¨nh th∆∞·ªùng
                ho√†n th√†nh'; END; END TRY BEGIN CATCH PRINT 'L·ªói c·∫•p 1 (ch√≠nh):
                ' + ERROR_MESSAGE(); PRINT 'M√£ l·ªói: ' + CAST(ERROR_NUMBER() AS
                VARCHAR); -- Cleanup operations PRINT 'Th·ª±c hi·ªán cleanup...'; --
                Log v√†o h·ªá th·ªëng INSERT INTO error_log (error_message,
                error_time, procedure_name) VALUES ('Complex operation failed: '
                + ERROR_MESSAGE(), GETDATE(), 'sp_complex_operation'); END
                CATCH; END; -- Test c√°c tr∆∞·ªùng h·ª£p EXEC sp_complex_operation
                @operation_type = 'normal'; EXEC sp_complex_operation
                @operation_type = 'risky_operation';
              </div>
            </div>

            <h3>üö® RAISERROR v√† THROW</h3>

            <h4>üì¢ RAISERROR</h4>
            <div class="example">
              <p>
                T·∫°o v√† n√©m m·ªôt l·ªói t√πy ch·ªânh v·ªõi th√¥ng b√°o v√† m·ª©c ƒë·ªô nghi√™m
                tr·ªçng c·ª• th·ªÉ.
              </p>
              <div class="code-block">
                -- C√∫ ph√°p RAISERROR RAISERROR('message', severity, state,
                [arguments]); -- V√≠ d·ª• s·ª≠ d·ª•ng RAISERROR CREATE PROCEDURE
                sp_validate_age @age INT AS BEGIN IF @age < 0 BEGIN
                RAISERROR('Tu·ªïi kh√¥ng th·ªÉ √¢m: %d', 16, 1, @age); RETURN; END; IF
                @age > 150 BEGIN RAISERROR('Tu·ªïi kh√¥ng h·ª£p l·ªá: %d (qu√° cao)',
                16, 2, @age); RETURN; END; IF @age < 18 BEGIN -- Warning level
                (severity 10) RAISERROR('C·∫£nh b√°o: Tu·ªïi d∆∞·ªõi 18: %d', 10, 1,
                @age); END; PRINT 'Tu·ªïi h·ª£p l·ªá: ' + CAST(@age AS VARCHAR); END;
                -- Test RAISERROR BEGIN TRY EXEC sp_validate_age @age = -5; END
                TRY BEGIN CATCH PRINT 'Caught error: ' + ERROR_MESSAGE(); END
                CATCH;
              </div>
            </div>

            <h4>üéØ THROW (SQL Server 2012+)</h4>
            <div class="example">
              <p>
                THROW l√† c√°ch hi·ªán ƒë·∫°i h∆°n ƒë·ªÉ n√©m l·ªói, ƒë∆°n gi·∫£n v√† m·∫°nh m·∫Ω h∆°n
                RAISERROR.
              </p>
              <div class="code-block">
                -- C√∫ ph√°p THROW THROW error_number, message, state; -- Ho·∫∑c
                re-throw l·ªói hi·ªán t·∫°i THROW; -- V√≠ d·ª• s·ª≠ d·ª•ng THROW CREATE
                PROCEDURE sp_transfer_money @from_account INT, @to_account INT,
                @amount DECIMAL(15,2) AS BEGIN BEGIN TRY BEGIN TRANSACTION; --
                Validate amount IF @amount <= 0 THROW 50001, 'S·ªë ti·ªÅn chuy·ªÉn
                ph·∫£i l·ªõn h∆°n 0', 1; -- Check from account exists and has
                sufficient balance DECLARE @balance DECIMAL(15,2); SELECT
                @balance = balance FROM accounts WHERE account_id =
                @from_account; IF @balance IS NULL THROW 50002, 'T√†i kho·∫£n ngu·ªìn
                kh√¥ng t·ªìn t·∫°i', 1; IF @balance < @amount THROW 50003, 'S·ªë d∆∞
                kh√¥ng ƒë·ªß ƒë·ªÉ chuy·ªÉn', 1; -- Check to account exists IF NOT EXISTS
                (SELECT 1 FROM accounts WHERE account_id = @to_account) THROW
                50004, 'T√†i kho·∫£n ƒë√≠ch kh√¥ng t·ªìn t·∫°i', 1; -- Perform transfer
                UPDATE accounts SET balance = balance - @amount WHERE account_id
                = @from_account; UPDATE accounts SET balance = balance + @amount
                WHERE account_id = @to_account; -- Log transaction INSERT INTO
                transaction_log (from_account, to_account, amount,
                transaction_time) VALUES (@from_account, @to_account, @amount,
                GETDATE()); COMMIT TRANSACTION; PRINT 'Chuy·ªÉn ti·ªÅn th√†nh c√¥ng: '
                + FORMAT(@amount, 'N0') + ' VND'; END TRY BEGIN CATCH IF
                @@TRANCOUNT > 0 ROLLBACK TRANSACTION; -- Re-throw ƒë·ªÉ preserve
                original error THROW; END CATCH; END; -- Test THROW BEGIN TRY
                EXEC sp_transfer_money @from_account = 1, @to_account = 2,
                @amount = -100; END TRY BEGIN CATCH PRINT 'Error ' +
                CAST(ERROR_NUMBER() AS VARCHAR) + ': ' + ERROR_MESSAGE(); END
                CATCH;
              </div>
            </div>

            <h3>üìù Logging v√† Monitoring Errors</h3>
            <div class="example">
              <h4>H·ªá th·ªëng log l·ªói ho√†n ch·ªânh:</h4>
              <div class="code-block">
                -- T·∫°o b·∫£ng error log CREATE TABLE error_log ( log_id INT
                IDENTITY(1,1) PRIMARY KEY, error_number INT, error_message
                NVARCHAR(4000), error_severity INT, error_state INT, error_line
                INT, error_procedure NVARCHAR(128), error_time DATETIME2 DEFAULT
                GETDATE(), user_name NVARCHAR(128) DEFAULT SUSER_NAME(),
                host_name NVARCHAR(128) DEFAULT HOST_NAME(), application_name
                NVARCHAR(128) DEFAULT APP_NAME() ); -- Stored procedure ƒë·ªÉ log
                l·ªói CREATE PROCEDURE sp_log_error @additional_info
                NVARCHAR(1000) = NULL AS BEGIN INSERT INTO error_log (
                error_number, error_message, error_severity, error_state,
                error_line, error_procedure, additional_info ) VALUES (
                ERROR_NUMBER(), ERROR_MESSAGE(), ERROR_SEVERITY(),
                ERROR_STATE(), ERROR_LINE(), ERROR_PROCEDURE(), @additional_info
                ); END; -- S·ª≠ d·ª•ng trong procedure kh√°c CREATE PROCEDURE
                sp_risky_operation @param1 INT, @param2 VARCHAR(50) AS BEGIN
                BEGIN TRY -- Thao t√°c c√≥ th·ªÉ g√¢y l·ªói IF @param1 = 0 THROW 50001,
                'Parameter 1 cannot be zero', 1; DECLARE @result INT = 100 /
                @param1; PRINT 'Result: ' + CAST(@result AS VARCHAR); END TRY
                BEGIN CATCH -- Log l·ªói v·ªõi th√¥ng tin b·ªï sung EXEC sp_log_error
                @additional_info = 'Parameters: @param1=' + CAST(@param1 AS
                VARCHAR) + ', @param2=' + ISNULL(@param2, 'NULL'); -- Re-throw
                ƒë·ªÉ caller bi·∫øt c√≥ l·ªói THROW; END CATCH; END; -- Query ƒë·ªÉ xem
                error logs SELECT log_id, error_number, error_message,
                error_procedure, error_time, user_name, additional_info FROM
                error_log ORDER BY error_time DESC;
              </div>
            </div>

            <h3>‚ö° Best Practices cho Exception Handling</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>Lu√¥n s·ª≠ d·ª•ng TRY...CATCH:</b> Cho t·∫•t c·∫£ procedures quan
                  tr·ªçng
                </li>
                <li>
                  <b>Log l·ªói chi ti·∫øt:</b> Ghi l·∫°i ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ debug
                </li>
                <li>
                  <b>Rollback transactions:</b> Khi c√≥ l·ªói trong transaction
                </li>
                <li>
                  <b>Validate inputs:</b> Ki·ªÉm tra tham s·ªë tr∆∞·ªõc khi x·ª≠ l√Ω
                </li>
                <li>
                  <b>Use meaningful error messages:</b> Th√¥ng b√°o l·ªói d·ªÖ hi·ªÉu
                </li>
                <li>
                  <b>Set appropriate severity levels:</b> Ph√¢n bi·ªát warning v√†
                  error
                </li>
                <li>
                  <b>Clean up resources:</b> ƒê√≥ng cursors, deallocate memory
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li><b>Ignore errors:</b> Lu√¥n x·ª≠ l√Ω l·ªói, kh√¥ng b·ªè qua</li>
                <li>
                  <b>Generic error messages:</b> Th√¥ng b√°o l·ªói qu√° chung chung
                </li>
                <li>
                  <b>Catching v√† re-throwing kh√¥ng c·∫ßn thi·∫øt:</b> L√†m m·∫•t
                  performance
                </li>
                <li><b>Hardcode error numbers:</b> N√™n d√πng constants</li>
                <li>
                  <b>Expose sensitive information:</b> Kh√¥ng ƒë·ªÉ l·ªô th√¥ng tin
                  nh·∫°y c·∫£m trong error
                </li>
                <li>
                  <b>Multiple nested TRY...CATCH:</b> G√¢y kh√≥ ƒë·ªçc v√† debug
                </li>
              </ul>
            </div>

            <h3>üîÑ So s√°nh RAISERROR vs THROW</h3>
            <table>
              <thead>
                <tr>
                  <th>ƒê·∫∑c ƒëi·ªÉm</th>
                  <th>RAISERROR</th>
                  <th>THROW</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>SQL Server version</b></td>
                  <td>T·∫•t c·∫£ versions</td>
                  <td>2012+</td>
                </tr>
                <tr>
                  <td><b>C√∫ ph√°p</b></td>
                  <td>Ph·ª©c t·∫°p h∆°n</td>
                  <td>ƒê∆°n gi·∫£n h∆°n</td>
                </tr>
                <tr>
                  <td><b>Error number range</b></td>
                  <td>50001-2147483647</td>
                  <td>50000-2147483647</td>
                </tr>
                <tr>
                  <td><b>Severity control</b></td>
                  <td>C√≥ th·ªÉ ƒëi·ªÅu ch·ªânh</td>
                  <td>Lu√¥n l√† 16</td>
                </tr>
                <tr>
                  <td><b>Re-throw capability</b></td>
                  <td>Kh√¥ng</td>
                  <td>C√≥ (THROW;)</td>
                </tr>
                <tr>
                  <td><b>String formatting</b></td>
                  <td>C√≥ (%d, %s)</td>
                  <td>Kh√¥ng</td>
                </tr>
                <tr>
                  <td><b>Khuy·∫øn ngh·ªã</b></td>
                  <td>Legacy code</td>
                  <td>New development</td>
                </tr>
              </tbody>
            </table>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>Exception Handling</b> l√† k·ªπ nƒÉng quan tr·ªçng ƒë·ªÉ t·∫°o ra
                <b>·ª©ng d·ª•ng database ·ªïn ƒë·ªãnh v√† tin c·∫≠y</b>:
              </p>
              <ul>
                <li>
                  <b>TRY...CATCH:</b> C∆° ch·∫ø ch√≠nh ƒë·ªÉ x·ª≠ l√Ω l·ªói trong SQL Server
                </li>
                <li><b>Transaction safety:</b> Lu√¥n rollback khi c√≥ l·ªói</li>
                <li><b>Error logging:</b> Ghi l·∫°i l·ªói ƒë·ªÉ ph√¢n t√≠ch v√† debug</li>
                <li>
                  <b>User-friendly messages:</b> Th√¥ng b√°o l·ªói d·ªÖ hi·ªÉu cho ng∆∞·ªùi
                  d√πng
                </li>
                <li>
                  <b>Graceful degradation:</b> ·ª®ng d·ª•ng kh√¥ng b·ªã crash khi c√≥
                  l·ªói
                </li>
              </ul>
            </div>
          </section>

          <!-- 25 -->
          <section class="section" id="transaction">
            <h2>25. Transaction</h2>

            <div class="info-box">
              <h4>üí∞ Transaction l√† g√¨?</h4>
              <p>
                <b>Transaction (Giao d·ªãch)</b> l√† m·ªôt ƒë∆°n v·ªã logic c·ªßa c√¥ng vi·ªác
                ƒë∆∞·ª£c th·ª±c hi·ªán tr√™n c∆° s·ªü d·ªØ li·ªáu. N√≥ bao g·ªìm m·ªôt ho·∫∑c nhi·ªÅu c√¢u
                l·ªánh SQL ƒë∆∞·ª£c th·ª±c thi nh∆∞ m·ªôt <b>kh·ªëi duy nh·∫•t</b>.
              </p>
              <p>
                ƒêi·ªÅu quan tr·ªçng l√† m·ªôt giao d·ªãch ph·∫£i th·ªèa m√£n b·ªën thu·ªôc t√≠nh
                <b>ACID</b>:
              </p>
            </div>

            <h3>üî¨ Thu·ªôc t√≠nh ACID</h3>
            <div class="highlight-box">
              <h4>üíé A.C.I.D Properties:</h4>
              <ul>
                <li><b>A</b>tomicity (T√≠nh nguy√™n t·ªë)</li>
                <li><b>C</b>onsistency (T√≠nh nh·∫•t qu√°n)</li>
                <li><b>I</b>solation (T√≠nh c√¥ l·∫≠p)</li>
                <li><b>D</b>urability (T√≠nh b·ªÅn v·ªØng)</li>
              </ul>
            </div>

            <div class="example">
              <h4>üîê Atomicity (T√≠nh nguy√™n t·ªë):</h4>
              <p>
                To√†n b·ªô giao d·ªãch ph·∫£i ƒë∆∞·ª£c th·ª±c hi·ªán th√†nh c√¥ng, ho·∫∑c kh√¥ng c√≥
                ph·∫ßn n√†o ƒë∆∞·ª£c th·ª±c hi·ªán. N·∫øu c√≥ l·ªói x·∫£y ra ·ªü b·∫•t k·ª≥ ƒë√¢u trong
                giao d·ªãch, m·ªçi thay ƒë·ªïi s·∫Ω b·ªã h·ªßy b·ªè.
              </p>
              <div class="code-block">
                <span class="comment"></span>-- V√≠ d·ª•: Chuy·ªÉn ti·ªÅn gi·ªØa 2 t√†i kho·∫£n</span>
                <span class="keyword">BEGIN TRANSACTION</span>;
                
                <span class="keyword">UPDATE</span> <span class="table">accounts</span> 
                <span class="keyword">SET</span> <span class="column">balance</span> <span class="operator">=</span> <span class="column">balance</span> <span class="operator">-</span> <span class="number">1000000</span> 
                <span class="keyword">WHERE</span> <span class="column">account_id</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- Tr·ª´ ti·ªÅn t√†i kho·∫£n A</span>
                
                <span class="keyword">UPDATE</span> <span class="table">accounts</span> 
                <span class="keyword">SET</span> <span class="column">balance</span> <span class="operator">=</span> <span class="column">balance</span> <span class="operator">+</span> <span class="number">1000000</span> 
                <span class="keyword">WHERE</span> <span class="column">account_id</span> <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- C·ªông ti·ªÅn t√†i kho·∫£n B</span>
                
                <span class="comment">-- N·∫øu b·∫•t k·ª≥ l·ªánh n√†o th·∫•t b·∫°i, c·∫£ 2 l·ªánh ƒë·ªÅu b·ªã ROLLBACK</span>
                <span class="keyword">COMMIT</span>;
              </div>
            </div>

            <div class="example">
              <h4>‚úÖ Consistency (T√≠nh nh·∫•t qu√°n):</h4>
              <p>
                Giao d·ªãch ph·∫£i ƒë∆∞a c∆° s·ªü d·ªØ li·ªáu t·ª´ m·ªôt tr·∫°ng th√°i nh·∫•t qu√°n n√†y
                sang m·ªôt tr·∫°ng th√°i nh·∫•t qu√°n kh√°c.
              </p>
              <div class="code-block">
                <span class="comment">-- V√≠ d·ª•: T·ªïng ti·ªÅn trong t·∫•t c·∫£ t√†i kho·∫£n ph·∫£i kh√¥ng ƒë·ªïi sau khi chuy·ªÉn ti·ªÅn</span>
                <span class="comment">-- Tr∆∞·ªõc giao d·ªãch: Account1(5M) + Account2(3M) = 8M</span>
                <span class="keyword">BEGIN TRANSACTION</span>;
                
                <span class="keyword">UPDATE</span> <span class="table">accounts</span> 
                <span class="keyword">SET</span> <span class="column">balance</span> <span class="operator">=</span> <span class="column">balance</span> <span class="operator">-</span> <span class="number">1000000</span> 
                <span class="keyword">WHERE</span> <span class="column">account_id</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- Account1: 4M</span>
                
                <span class="keyword">UPDATE</span> <span class="table">accounts</span> 
                <span class="keyword">SET</span> <span class="column">balance</span> <span class="operator">=</span> <span class="column">balance</span> <span class="operator">+</span> <span class="number">1000000</span> 
                <span class="keyword">WHERE</span> <span class="column">account_id</span> <span class="operator">=</span> <span class="number">2</span>; <span class="comment">-- Account2: 4M</span>
                
                <span class="keyword">COMMIT</span>;
                <span class="comment">-- Sau giao d·ªãch: Account1(4M) + Account2(4M) = 8M (kh√¥ng ƒë·ªïi)</span>
              </div>
            </div>

            <div class="example">
              <h4>üîí Isolation (T√≠nh c√¥ l·∫≠p):</h4>
              <p>C√°c giao d·ªãch ƒë·ªìng th·ªùi kh√¥ng ƒë∆∞·ª£c can thi·ªáp v√†o nhau.</p>
              <div class="code-block">
                <span class="comment">-- Transaction 1 v√† Transaction 2 ch·∫°y ƒë·ªìng th·ªùi</span>
                <span class="comment">-- Transaction 1:</span>
                <span class="keyword">BEGIN TRANSACTION</span>;
                <span class="keyword">SELECT</span> <span class="column">balance</span> <span class="keyword">FROM</span> <span class="table">accounts</span> <span class="keyword">WHERE</span> <span class="column">account_id</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- ƒê·ªçc balance</span>
                <span class="comment">-- ... l√†m vi·ªác g√¨ ƒë√≥ ...</span>
                <span class="keyword">UPDATE</span> <span class="table">accounts</span> <span class="keyword">SET</span> <span class="column">balance</span> <span class="operator">=</span> <span class="column">balance</span> <span class="operator">-</span> <span class="number">500000</span> <span class="keyword">WHERE</span> <span class="column">account_id</span> <span class="operator">=</span> <span class="number">1</span>;
                <span class="keyword">COMMIT</span>;
                
                <span class="comment">-- Transaction 2 kh√¥ng th·ªÉ th·∫•y changes c·ªßa Transaction 1 cho ƒë·∫øn khi COMMIT</span>
              </div>
            </div>

            <div class="example">
              <h4>üíæ Durability (T√≠nh b·ªÅn v·ªØng):</h4>
              <p>
                C√°c thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c cam k·∫øt (commit) s·∫Ω t·ªìn t·∫°i vƒ©nh vi·ªÖn, ngay
                c·∫£ khi h·ªá th·ªëng b·ªã l·ªói.
              </p>
              <div class="code-block">
                BEGIN TRANSACTION; INSERT INTO orders (customer_id,
                total_amount) VALUES (1, 2000000); COMMIT; -- Sau khi COMMIT, d·ªØ
                li·ªáu ƒë∆∞·ª£c l∆∞u vƒ©nh vi·ªÖn -- Ngay c·∫£ khi server restart, order n√†y
                v·∫´n t·ªìn t·∫°i
              </div>
            </div>

            <h3>üéõÔ∏è C√°c l·ªánh Transaction c∆° b·∫£n</h3>

            <div class="success-box">
              <h4>üìã C√°c l·ªánh ch√≠nh:</h4>
              <ul>
                <li>
                  <b>BEGIN TRANSACTION (BEGIN TRAN):</b> B·∫Øt ƒë·∫ßu m·ªôt giao d·ªãch
                  m·ªõi
                </li>
                <li>
                  <b>COMMIT TRANSACTION (COMMIT):</b> L∆∞u vƒ©nh vi·ªÖn t·∫•t c·∫£ c√°c
                  thay ƒë·ªïi
                </li>
                <li>
                  <b>ROLLBACK TRANSACTION (ROLLBACK):</b> H·ªßy b·ªè t·∫•t c·∫£ c√°c thay
                  ƒë·ªïi
                </li>
                <li>
                  <b>SAVE TRANSACTION:</b> T·∫°o savepoint trong transaction
                </li>
              </ul>
            </div>

            <div class="example">
              <h4>C√∫ ph√°p c∆° b·∫£n:</h4>
              <div class="code-block">
                -- C√∫ ph√°p ƒë·∫ßy ƒë·ªß BEGIN TRANSACTION [transaction_name]; -- C√°c
                c√¢u l·ªánh SQL IF (condition_success) COMMIT TRANSACTION
                [transaction_name]; ELSE ROLLBACK TRANSACTION
                [transaction_name]; -- C√∫ ph√°p ng·∫Øn g·ªçn BEGIN TRAN; -- SQL
                statements COMMIT; -- ho·∫∑c ROLLBACK;
              </div>
            </div>

            <h3>üí° V√≠ d·ª• th·ª±c t·∫ø</h3>

            <h4>üì¶ V√≠ d·ª• 1: C·∫≠p nh·∫≠t t·ªìn kho s·∫£n ph·∫©m</h4>
            <div class="example">
              <p>
                Gi·∫£ s·ª≠ b·∫°n c·∫ßn c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng t·ªìn kho c·ªßa m·ªôt s·∫£n ph·∫©m. ƒê√¢y
                l√† m·ªôt thao t√°c r·∫•t quan tr·ªçng v√† c·∫ßn ƒë∆∞·ª£c th·ª±c hi·ªán trong m·ªôt
                giao d·ªãch ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn c·ªßa d·ªØ li·ªáu.
              </p>
              <div class="code-block">
                -- Phi√™n b·∫£n c∆° b·∫£n (s·ª≠ d·ª•ng @@ERROR - legacy) BEGIN
                TRANSACTION; UPDATE products SET stock_quantity = stock_quantity
                - 1 WHERE product_id = 1; IF @@ERROR <> 0 ROLLBACK; ELSE COMMIT;
              </div>

              <p><b>Gi·∫£i th√≠ch:</b></p>
              <ul>
                <li><b>BEGIN TRANSACTION:</b> B·∫Øt ƒë·∫ßu giao d·ªãch m·ªõi</li>
                <li><b>UPDATE:</b> Gi·∫£m s·ªë l∆∞·ª£ng t·ªìn kho ƒëi 1</li>
                <li>
                  <b>@@ERROR:</b> Bi·∫øn h·ªá th·ªëng l∆∞u m√£ l·ªói c·ªßa c√¢u l·ªánh cu·ªëi
                  c√πng
                </li>
                <li><b>ROLLBACK:</b> H·ªßy thay ƒë·ªïi n·∫øu c√≥ l·ªói</li>
                <li><b>COMMIT:</b> L∆∞u thay ƒë·ªïi n·∫øu th√†nh c√¥ng</li>
              </ul>
            </div>

            <h4>üõí V√≠ d·ª• 2: X·ª≠ l√Ω ƒë∆°n h√†ng (Modern approach)</h4>
            <div class="example">
              <div class="code-block">
                -- Phi√™n b·∫£n hi·ªán ƒë·∫°i v·ªõi TRY...CATCH BEGIN TRY BEGIN
                TRANSACTION; DECLARE @product_id INT = 1; DECLARE @quantity INT
                = 2; DECLARE @customer_id INT = 100; DECLARE @current_stock INT;
                -- Ki·ªÉm tra t·ªìn kho hi·ªán t·∫°i SELECT @current_stock =
                stock_quantity FROM products WHERE product_id = @product_id; --
                Validate c√≥ ƒë·ªß t·ªìn kho kh√¥ng IF @current_stock < @quantity BEGIN
                RAISERROR('Kh√¥ng ƒë·ªß t·ªìn kho. C√≤n l·∫°i: %d, y√™u c·∫ßu: %d', 16, 1,
                @current_stock, @quantity); RETURN; END; -- T·∫°o ƒë∆°n h√†ng INSERT
                INTO orders (customer_id, order_date, status, total_amount)
                VALUES (@customer_id, GETDATE(), 'processing', 0); DECLARE
                @order_id INT = SCOPE_IDENTITY(); -- Th√™m order items INSERT
                INTO order_items (order_id, product_id, quantity, unit_price)
                SELECT @order_id, @product_id, @quantity, list_price FROM
                products WHERE product_id = @product_id; -- C·∫≠p nh·∫≠t t·ªìn kho
                UPDATE products SET stock_quantity = stock_quantity - @quantity,
                updated_date = GETDATE() WHERE product_id = @product_id; -- C·∫≠p
                nh·∫≠t t·ªïng ti·ªÅn ƒë∆°n h√†ng UPDATE orders SET total_amount = (
                SELECT SUM(quantity * unit_price) FROM order_items WHERE
                order_id = @order_id ) WHERE order_id = @order_id; COMMIT
                TRANSACTION; PRINT 'ƒê∆°n h√†ng ' + CAST(@order_id AS VARCHAR) + '
                ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng'; END TRY BEGIN CATCH IF @@TRANCOUNT > 0
                ROLLBACK TRANSACTION; PRINT 'L·ªói: ' + ERROR_MESSAGE(); THROW;
                END CATCH;
              </div>
            </div>

            <h4>üí≥ V√≠ d·ª• 3: Chuy·ªÉn ti·ªÅn gi·ªØa t√†i kho·∫£n</h4>
            <div class="example">
              <div class="code-block">
                CREATE PROCEDURE sp_transfer_money @from_account_id INT,
                @to_account_id INT, @amount DECIMAL(15,2) AS BEGIN SET NOCOUNT
                ON; BEGIN TRY BEGIN TRANSACTION; DECLARE @from_balance
                DECIMAL(15,2); DECLARE @to_balance DECIMAL(15,2); -- Lock v√† l·∫•y
                th√¥ng tin t√†i kho·∫£n (tr√°nh race condition) SELECT @from_balance
                = balance FROM accounts WITH (UPDLOCK) WHERE account_id =
                @from_account_id; SELECT @to_balance = balance FROM accounts
                WITH (UPDLOCK) WHERE account_id = @to_account_id; -- Validate
                accounts exist IF @from_balance IS NULL BEGIN RAISERROR('T√†i
                kho·∫£n ngu·ªìn kh√¥ng t·ªìn t·∫°i: %d', 16, 1, @from_account_id);
                RETURN; END; IF @to_balance IS NULL BEGIN RAISERROR('T√†i kho·∫£n
                ƒë√≠ch kh√¥ng t·ªìn t·∫°i: %d', 16, 1, @to_account_id); RETURN; END; --
                Validate amount IF @amount <= 0 BEGIN RAISERROR('S·ªë ti·ªÅn chuy·ªÉn
                ph·∫£i l·ªõn h∆°n 0', 16, 1); RETURN; END; -- Validate sufficient
                balance IF @from_balance < @amount BEGIN RAISERROR('S·ªë d∆∞ kh√¥ng
                ƒë·ªß. C√≥: %s, c·∫ßn: %s', 16, 1, FORMAT(@from_balance, 'N0'),
                FORMAT(@amount, 'N0')); RETURN; END; -- Th·ª±c hi·ªán chuy·ªÉn ti·ªÅn
                UPDATE accounts SET balance = balance - @amount, updated_date =
                GETDATE() WHERE account_id = @from_account_id; UPDATE accounts
                SET balance = balance + @amount, updated_date = GETDATE() WHERE
                account_id = @to_account_id; -- Ghi log giao d·ªãch INSERT INTO
                transaction_history (from_account, to_account, amount,
                transaction_time, description) VALUES (@from_account_id,
                @to_account_id, @amount, GETDATE(), 'Money transfer'); COMMIT
                TRANSACTION; PRINT 'Chuy·ªÉn ti·ªÅn th√†nh c√¥ng: ' + FORMAT(@amount,
                'N0') + ' VND'; PRINT 'T·ª´ t√†i kho·∫£n ' + CAST(@from_account_id AS
                VARCHAR) + ' ƒë·∫øn t√†i kho·∫£n ' + CAST(@to_account_id AS VARCHAR);
                END TRY BEGIN CATCH IF @@TRANCOUNT > 0 ROLLBACK TRANSACTION;
                DECLARE @error_msg VARCHAR(2000) = 'L·ªói chuy·ªÉn ti·ªÅn: ' +
                ERROR_MESSAGE() + ' (Line: ' + CAST(ERROR_LINE() AS VARCHAR) +
                ')'; PRINT @error_msg; THROW; END CATCH; END; -- S·ª≠ d·ª•ng EXEC
                sp_transfer_money @from_account_id = 1, @to_account_id = 2,
                @amount = 500000;
              </div>
            </div>

            <h3>üéöÔ∏è Transaction Isolation Levels</h3>
            <div class="highlight-box">
              <p>
                SQL Server h·ªó tr·ª£ nhi·ªÅu m·ª©c ƒë·ªô c√¥ l·∫≠p kh√°c nhau ƒë·ªÉ c√¢n b·∫±ng gi·ªØa
                hi·ªáu su·∫•t v√† t√≠nh nh·∫•t qu√°n:
              </p>
            </div>

            <table>
              <thead>
                <tr>
                  <th>Isolation Level</th>
                  <th>Dirty Read</th>
                  <th>Non-Repeatable Read</th>
                  <th>Phantom Read</th>
                  <th>Performance</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>READ UNCOMMITTED</b></td>
                  <td>C√≥</td>
                  <td>C√≥</td>
                  <td>C√≥</td>
                  <td>Cao nh·∫•t</td>
                </tr>
                <tr>
                  <td><b>READ COMMITTED</b> (default)</td>
                  <td>Kh√¥ng</td>
                  <td>C√≥</td>
                  <td>C√≥</td>
                  <td>Cao</td>
                </tr>
                <tr>
                  <td><b>REPEATABLE READ</b></td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                  <td>C√≥</td>
                  <td>Trung b√¨nh</td>
                </tr>
                <tr>
                  <td><b>SERIALIZABLE</b></td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                  <td>Th·∫•p</td>
                </tr>
                <tr>
                  <td><b>SNAPSHOT</b></td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                  <td>Kh√¥ng</td>
                  <td>Cao</td>
                </tr>
              </tbody>
            </table>

            <div class="example">
              <h4>Thi·∫øt l·∫≠p Isolation Level:</h4>
              <div class="code-block">
                -- Thi·∫øt l·∫≠p cho session hi·ªán t·∫°i SET TRANSACTION ISOLATION
                LEVEL READ COMMITTED; -- Thi·∫øt l·∫≠p cho m·ªôt transaction c·ª• th·ªÉ
                BEGIN TRANSACTION; SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
                SELECT * FROM accounts WHERE account_id = 1; -- Other operations
                COMMIT; -- S·ª≠ d·ª•ng table hints SELECT * FROM accounts WITH
                (NOLOCK) WHERE account_id = 1; -- READ UNCOMMITTED SELECT * FROM
                accounts WITH (READCOMMITTED) WHERE account_id = 1;
              </div>
            </div>

            <h3>üíæ Savepoints trong Transaction</h3>
            <div class="example">
              <h4>S·ª≠ d·ª•ng Savepoints ƒë·ªÉ rollback m·ªôt ph·∫ßn:</h4>
              <div class="code-block">
                BEGIN TRANSACTION; -- B∆∞·ªõc 1: T·∫°o ƒë∆°n h√†ng INSERT INTO orders
                (customer_id, order_date) VALUES (1, GETDATE()); DECLARE
                @order_id INT = SCOPE_IDENTITY(); SAVE TRANSACTION SavePoint1;
                -- T·∫°o savepoint -- B∆∞·ªõc 2: Th√™m s·∫£n ph·∫©m 1 INSERT INTO
                order_items (order_id, product_id, quantity, unit_price) VALUES
                (@order_id, 1, 2, 100000); SAVE TRANSACTION SavePoint2; -- T·∫°o
                savepoint th·ª© 2 -- B∆∞·ªõc 3: Th√™m s·∫£n ph·∫©m 2 (gi·∫£ s·ª≠ c√≥ l·ªói) BEGIN
                TRY INSERT INTO order_items (order_id, product_id, quantity,
                unit_price) VALUES (@order_id, 999, 1, 50000); -- Product 999
                kh√¥ng t·ªìn t·∫°i END TRY BEGIN CATCH PRINT 'L·ªói th√™m s·∫£n ph·∫©m 2: '
                + ERROR_MESSAGE(); ROLLBACK TRANSACTION SavePoint2; -- Ch·ªâ
                rollback t·ª´ SavePoint2 PRINT 'ƒê√£ rollback vi·ªác th√™m s·∫£n ph·∫©m 2,
                gi·ªØ l·∫°i s·∫£n ph·∫©m 1'; END CATCH; -- Ti·∫øp t·ª•c v·ªõi c√°c b∆∞·ªõc kh√°c...
                UPDATE orders SET total_amount = ( SELECT SUM(quantity *
                unit_price) FROM order_items WHERE order_id = @order_id ) WHERE
                order_id = @order_id; COMMIT TRANSACTION; -- Commit to√†n b·ªô (tr·ª´
                ph·∫ßn ƒë√£ rollback)
              </div>
            </div>

            <h3>üîç Monitoring Transactions</h3>
            <div class="example">
              <h4>Ki·ªÉm tra tr·∫°ng th√°i Transaction:</h4>
              <div class="code-block">
                -- Ki·ªÉm tra c√≥ transaction ƒëang m·ªü kh√¥ng SELECT @@TRANCOUNT AS
                'Open Transactions'; -- Xem th√¥ng tin c√°c transactions ƒëang ch·∫°y
                SELECT session_id, transaction_id, name, transaction_begin_time,
                transaction_type, transaction_state FROM
                sys.dm_tran_session_transactions st INNER JOIN
                sys.dm_tran_active_transactions at ON st.transaction_id =
                at.transaction_id; -- Xem locks ƒëang ƒë∆∞·ª£c hold SELECT
                resource_type, resource_database_id,
                resource_associated_entity_id, request_mode, request_status FROM
                sys.dm_tran_locks WHERE request_session_id = @@SPID;
              </div>
            </div>

            <h3>‚ö° Best Practices cho Transactions</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>Keep transactions short:</b> T·ªëi thi·ªÉu h√≥a th·ªùi gian
                  transaction
                </li>
                <li><b>Use TRY...CATCH:</b> Lu√¥n c√≥ error handling</li>
                <li><b>Check @@TRANCOUNT:</b> Tr∆∞·ªõc khi ROLLBACK</li>
                <li>
                  <b>Use appropriate isolation level:</b> C√¢n b·∫±ng performance
                  v√† consistency
                </li>
                <li><b>Index appropriately:</b> Gi·∫£m lock time</li>
                <li><b>Order operations:</b> Tr√°nh deadlocks</li>
                <li>
                  <b>Use UPDLOCK hints:</b> Khi c·∫ßn prevent concurrent
                  modifications
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li>
                  <b>Long-running transactions:</b> G√¢y blocking v√† deadlocks
                </li>
                <li>
                  <b>User interaction trong transaction:</b> KH√îNG ƒë·ª£i user
                  input
                </li>
                <li><b>Qu√™n COMMIT/ROLLBACK:</b> G√¢y resource leaks</li>
                <li>
                  <b>Nested transactions ph·ª©c t·∫°p:</b> Kh√≥ control v√† debug
                </li>
                <li>
                  <b>SELECT trong transaction kh√¥ng c·∫ßn thi·∫øt:</b> Gi·ªØ locks l√¢u
                  h∆°n
                </li>
                <li>
                  <b>Inconsistent error handling:</b> C√≥ th·ªÉ g√¢y data corruption
                </li>
              </ul>
            </div>

            <h3>üîÑ Deadlock Prevention</h3>
            <div class="example">
              <h4>Strategies ƒë·ªÉ tr√°nh Deadlocks:</h4>
              <div class="code-block">
                -- 1. Truy c·∫≠p tables theo th·ª© t·ª± nh·∫•t qu√°n -- Transaction A v√†
                B ƒë·ªÅu access theo th·ª© t·ª±: orders -> customers -> products -- 2.
                S·ª≠ d·ª•ng timeout SET LOCK_TIMEOUT 5000; -- 5 seconds timeout --
                3. S·ª≠ d·ª•ng appropriate isolation level SET TRANSACTION ISOLATION
                LEVEL READ COMMITTED; -- 4. V√≠ d·ª• procedure an to√†n CREATE
                PROCEDURE sp_safe_order_update @order_id INT, @customer_id INT
                AS BEGIN SET NOCOUNT ON; BEGIN TRY BEGIN TRANSACTION; -- Lu√¥n
                access theo th·ª© t·ª± ID tƒÉng d·∫ßn ƒë·ªÉ tr√°nh deadlock DECLARE
                @table_order TABLE (table_name VARCHAR(50), id INT); INSERT INTO
                @table_order VALUES ('customers', @customer_id), ('orders',
                @order_id); -- Process theo th·ª© t·ª± DECLARE @first_table
                VARCHAR(50), @first_id INT; DECLARE @second_table VARCHAR(50),
                @second_id INT; SELECT TOP 1 @first_table = table_name,
                @first_id = id FROM @table_order ORDER BY id; SELECT TOP 1
                @second_table = table_name, @second_id = id FROM @table_order
                WHERE id > @first_id ORDER BY id; -- Lock theo th·ª© t·ª± ƒë·ªÉ tr√°nh
                deadlock IF @first_table = 'customers' SELECT * FROM customers
                WITH (UPDLOCK) WHERE customer_id = @first_id; IF @second_table =
                'orders' SELECT * FROM orders WITH (UPDLOCK) WHERE order_id =
                @second_id; -- Th·ª±c hi·ªán business logic UPDATE orders SET status
                = 'confirmed' WHERE order_id = @order_id; COMMIT TRANSACTION;
                END TRY BEGIN CATCH IF @@TRANCOUNT > 0 ROLLBACK TRANSACTION;
                THROW; END CATCH; END;
              </div>
            </div>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>Transactions</b> l√† n·ªÅn t·∫£ng c·ªßa
                <b>t√≠nh to√†n v·∫πn d·ªØ li·ªáu</b> trong database:
              </p>
              <ul>
                <li>
                  <b>ACID Properties:</b> ƒê·∫£m b·∫£o reliability v√† consistency
                </li>
                <li><b>Error Handling:</b> TRY...CATCH ƒë·ªÉ x·ª≠ l√Ω l·ªói an to√†n</li>
                <li>
                  <b>Isolation Levels:</b> C√¢n b·∫±ng performance v√† data
                  consistency
                </li>
                <li>
                  <b>Best Practices:</b> Keep short, handle errors, prevent
                  deadlocks
                </li>
                <li>
                  <b>Monitoring:</b> Track transaction status v√† performance
                </li>
              </ul>
            </div>
          </section>

          <!-- 26 -->
          <section class="section" id="trigger">
            <h2>26. Trigger</h2>

            <div class="info-box">
              <h4>üéØ Trigger l√† g√¨?</h4>
              <p>
                <b>Trigger (b·ªô k√≠ch ho·∫°t)</b> l√† m·ªôt kh·ªëi m√£ SQL ƒë·∫∑c bi·ªát, ƒë∆∞·ª£c
                l∆∞u tr·ªØ trong c∆° s·ªü d·ªØ li·ªáu, v√† s·∫Ω <b>t·ª± ƒë·ªông ch·∫°y</b> khi c√≥
                m·ªôt s·ª± ki·ªán nh·∫•t ƒë·ªãnh x·∫£y ra tr√™n m·ªôt b·∫£ng ho·∫∑c m·ªôt view.
              </p>
              <p>
                Trigger ho·∫°t ƒë·ªông gi·ªëng nh∆∞ m·ªôt <b>"k·∫ª nghe l√©n"</b> lu√¥n theo
                d√µi c√°c thay ƒë·ªïi tr√™n b·∫£ng. Trigger ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ
                <b>duy tr√¨ t√≠nh to√†n v·∫πn c·ªßa d·ªØ li·ªáu</b> v√† t·ª± ƒë·ªông h√≥a c√°c t√°c
                v·ª• li√™n quan.
              </p>
            </div>

            <h3>‚ö° S·ª± ki·ªán k√≠ch ho·∫°t</h3>
            <div class="highlight-box">
              <p>Trigger c√≥ th·ªÉ ƒë∆∞·ª£c k√≠ch ho·∫°t b·ªüi c√°c s·ª± ki·ªán sau:</p>
              <ul>
                <li><b>INSERT:</b> Khi c√≥ h√†ng m·ªõi ƒë∆∞·ª£c th√™m v√†o</li>
                <li><b>UPDATE:</b> Khi m·ªôt h√†ng hi·ªán c√≥ ƒë∆∞·ª£c c·∫≠p nh·∫≠t</li>
                <li><b>DELETE:</b> Khi m·ªôt h√†ng b·ªã x√≥a</li>
              </ul>
              <p>
                C√°c s·ª± ki·ªán n√†y ƒë∆∞·ª£c g·ªçi l√†
                <b>DML (Data Manipulation Language)</b>.
              </p>
            </div>

            <h3>üìã C√°c lo·∫°i Trigger</h3>

            <h4>1Ô∏è‚É£ DML Trigger</h4>
            <div class="example">
              <p>
                Ch·∫°y khi c√≥ m·ªôt s·ª± ki·ªán INSERT, UPDATE, ho·∫∑c DELETE x·∫£y ra tr√™n
                m·ªôt b·∫£ng.
              </p>

              <h5>üïê AFTER Triggers (Th·ª±c thi sau):</h5>
              <ul>
                <li>Ch·∫°y <b>sau khi</b> c√¢u l·ªánh DML ƒë∆∞·ª£c th·ª±c thi</li>
                <li>C√≥ th·ªÉ rollback transaction n·∫øu c·∫ßn</li>
                <li>Ph·ªï bi·∫øn nh·∫•t v√† d·ªÖ s·ª≠ d·ª•ng</li>
              </ul>

              <h5>üîÑ INSTEAD OF Triggers (Th·ª±c thi thay th·∫ø):</h5>
              <ul>
                <li>Ch·∫°y <b>thay th·∫ø cho</b> c√¢u l·ªánh DML</li>
                <li>Th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi Views</li>
                <li>C√≥ th·ªÉ customize ho√†n to√†n logic th·ª±c thi</li>
              </ul>
            </div>

            <h4>2Ô∏è‚É£ DDL Trigger</h4>
            <div class="example">
              <p>
                Ch·∫°y khi c√≥ m·ªôt s·ª± ki·ªán DDL (Data Definition Language) x·∫£y ra,
                ch·∫≥ng h·∫°n nh∆∞ CREATE, ALTER, ho·∫∑c DROP m·ªôt ƒë·ªëi t∆∞·ª£ng trong c∆° s·ªü
                d·ªØ li·ªáu.
              </p>
              <ul>
                <li>Audit schema changes</li>
                <li>Prevent unauthorized modifications</li>
                <li>Log database structure changes</li>
              </ul>
            </div>

            <h3>üìù B·∫£ng ·∫£o trong Trigger</h3>
            <table>
              <thead>
                <tr>
                  <th>B·∫£ng ·∫£o</th>
                  <th>Ch·ª©a d·ªØ li·ªáu</th>
                  <th>C√≥ trong trigger</th>
                  <th>M√¥ t·∫£</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><b>inserted</b></td>
                  <td>D·ªØ li·ªáu m·ªõi</td>
                  <td>INSERT, UPDATE</td>
                  <td>H√†ng v·ª´a ƒë∆∞·ª£c ch√®n ho·∫∑c gi√° tr·ªã m·ªõi sau update</td>
                </tr>
                <tr>
                  <td><b>deleted</b></td>
                  <td>D·ªØ li·ªáu c≈©</td>
                  <td>DELETE, UPDATE</td>
                  <td>H√†ng v·ª´a b·ªã x√≥a ho·∫∑c gi√° tr·ªã c≈© tr∆∞·ªõc update</td>
                </tr>
              </tbody>
            </table>

            <h3>üí° V√≠ d·ª• c∆° b·∫£n</h3>

            <h4>üì¶ V√≠ d·ª• 1: C·∫≠p nh·∫≠t t·ªìn kho t·ª± ƒë·ªông</h4>
            <div class="example">
              <p>
                M·ªôt tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng ph·ªï bi·∫øn c·ªßa trigger l√† ƒë·ªÉ c·∫≠p nh·∫≠t t·ª±
                ƒë·ªông s·ªë l∆∞·ª£ng t·ªìn kho khi c√≥ m·ªôt ƒë∆°n h√†ng m·ªõi ƒë∆∞·ª£c th√™m v√†o:
              </p>
              <div class="code-block">
                CREATE TRIGGER trg_update_stock ON order_items -- Trigger tr√™n
                b·∫£ng order_items AFTER INSERT -- K√≠ch ho·∫°t sau khi c√≥ l·ªánh
                INSERT AS BEGIN SET NOCOUNT ON; -- Kh√¥ng tr·∫£ v·ªÅ s·ªë l∆∞·ª£ng rows
                affected -- C·∫≠p nh·∫≠t t·ªìn kho cho t·∫•t c·∫£ s·∫£n ph·∫©m v·ª´a ƒë∆∞·ª£c order
                UPDATE products SET stock_quantity = stock_quantity -
                i.quantity, updated_date = GETDATE() FROM products p INNER JOIN
                inserted i ON p.product_id = i.product_id; -- Log th√¥ng tin
                PRINT 'ƒê√£ c·∫≠p nh·∫≠t t·ªìn kho cho ' + CAST(@@ROWCOUNT AS VARCHAR) +
                ' s·∫£n ph·∫©m'; END;
              </div>

              <p><b>Gi·∫£i th√≠ch:</b></p>
              <ul>
                <li>
                  <b>CREATE TRIGGER trg_update_stock:</b> T·∫°o trigger t√™n
                  trg_update_stock
                </li>
                <li><b>ON order_items:</b> G·∫Øn trigger v√†o b·∫£ng order_items</li>
                <li>
                  <b>AFTER INSERT:</b> Trigger ch·∫°y sau khi INSERT ho√†n th√†nh
                </li>
                <li>
                  <b>inserted:</b> B·∫£ng ·∫£o ch·ª©a c√°c h√†ng v·ª´a ƒë∆∞·ª£c ch√®n v√†o
                </li>
                <li>
                  <b>JOIN v·ªõi inserted:</b> C·∫≠p nh·∫≠t stock cho t·∫•t c·∫£ s·∫£n ph·∫©m
                  trong ƒë∆°n h√†ng
                </li>
              </ul>
            </div>

            <h4>üîí V√≠ d·ª• 2: NgƒÉn x√≥a kh√°ch h√†ng c√≥ ƒë∆°n h√†ng</h4>
            <div class="example">
              <p>
                Trigger c√≥ kh·∫£ nƒÉng h·ªßy b·ªè c√°c thao t√°c ƒë√£ th·ª±c hi·ªán b·∫±ng c√°ch
                s·ª≠ d·ª•ng l·ªánh ROLLBACK:
              </p>
              <div class="code-block">
                CREATE TRIGGER trg_prevent_customer_delete ON customers AFTER
                DELETE AS BEGIN SET NOCOUNT ON; -- Ki·ªÉm tra xem kh√°ch h√†ng v·ª´a
                x√≥a c√≥ ƒë∆°n h√†ng kh√¥ng IF EXISTS ( SELECT 1 FROM orders o INNER
                JOIN deleted d ON o.customer_id = d.customer_id ) BEGIN -- In
                th√¥ng b√°o l·ªói PRINT 'Kh√¥ng th·ªÉ x√≥a kh√°ch h√†ng ƒë√£ c√≥ ƒë∆°n h√†ng.';
                -- Rollback transaction ƒë·ªÉ h·ªßy vi·ªác x√≥a ROLLBACK TRANSACTION; --
                Ho·∫∑c c√≥ th·ªÉ RAISERROR ƒë·ªÉ b√°o l·ªói chi ti·∫øt h∆°n RAISERROR('Kh√°ch
                h√†ng c√≥ ƒë∆°n h√†ng li√™n quan, kh√¥ng th·ªÉ x√≥a', 16, 1); END ELSE
                BEGIN PRINT 'ƒê√£ x√≥a kh√°ch h√†ng th√†nh c√¥ng'; END; END;
              </div>

              <p><b>Gi·∫£i th√≠ch:</b></p>
              <ul>
                <li><b>deleted:</b> B·∫£ng ·∫£o ch·ª©a c√°c h√†ng v·ª´a b·ªã x√≥a</li>
                <li>
                  <b>EXISTS check:</b> Ki·ªÉm tra xem c√≥ ƒë∆°n h√†ng li√™n quan kh√¥ng
                </li>
                <li><b>ROLLBACK:</b> H·ªßy b·ªè thao t√°c x√≥a n·∫øu kh√¥ng h·ª£p l·ªá</li>
                <li><b>RAISERROR:</b> B√°o l·ªói chi ti·∫øt cho ·ª©ng d·ª•ng</li>
              </ul>
            </div>

            <h3>üîÑ Trigger cho UPDATE</h3>
            <div class="example">
              <h4>Audit log cho thay ƒë·ªïi gi√° s·∫£n ph·∫©m:</h4>
              <div class="code-block">
                -- T·∫°o b·∫£ng audit log CREATE TABLE product_price_audit (
                audit_id INT IDENTITY(1,1) PRIMARY KEY, product_id INT,
                old_price DECIMAL(10,2), new_price DECIMAL(10,2), changed_by
                VARCHAR(100), changed_date DATETIME2 DEFAULT GETDATE() ); --
                Trigger audit cho vi·ªác thay ƒë·ªïi gi√° CREATE TRIGGER
                trg_audit_price_change ON products AFTER UPDATE AS BEGIN SET
                NOCOUNT ON; -- Ch·ªâ log khi c√≥ thay ƒë·ªïi v·ªÅ gi√° IF
                UPDATE(list_price) BEGIN INSERT INTO product_price_audit (
                product_id, old_price, new_price, changed_by ) SELECT
                i.product_id, d.list_price AS old_price, i.list_price AS
                new_price, SUSER_NAME() AS changed_by FROM inserted i INNER JOIN
                deleted d ON i.product_id = d.product_id WHERE i.list_price !=
                d.list_price; -- Ch·ªâ log khi gi√° th·ª±c s·ª± thay ƒë·ªïi PRINT 'ƒê√£ ghi
                log thay ƒë·ªïi gi√° cho ' + CAST(@@ROWCOUNT AS VARCHAR) + ' s·∫£n
                ph·∫©m'; END; END;
              </div>
            </div>

            <h3>üîÄ INSTEAD OF Trigger</h3>
            <div class="example">
              <h4>Trigger cho View ph·ª©c t·∫°p:</h4>
              <div class="code-block">
                -- T·∫°o view k·∫øt h·ª£p nhi·ªÅu b·∫£ng CREATE VIEW vw_product_summary AS
                SELECT p.product_id, p.product_name, p.list_price,
                c.category_name, b.brand_name, p.stock_quantity FROM products p
                INNER JOIN categories c ON p.category_id = c.category_id INNER
                JOIN brands b ON p.brand_id = b.brand_id; -- Trigger INSTEAD OF
                cho ph√©p INSERT v√†o view CREATE TRIGGER trg_insert_product_view
                ON vw_product_summary INSTEAD OF INSERT AS BEGIN SET NOCOUNT ON;
                DECLARE @category_id INT, @brand_id INT; -- L·∫•y category_id t·ª´
                t√™n SELECT @category_id = category_id FROM categories WHERE
                category_name = (SELECT TOP 1 category_name FROM inserted); --
                L·∫•y brand_id t·ª´ t√™n SELECT @brand_id = brand_id FROM brands
                WHERE brand_name = (SELECT TOP 1 brand_name FROM inserted); --
                Validate IDs t·ªìn t·∫°i IF @category_id IS NULL OR @brand_id IS
                NULL BEGIN RAISERROR('Category ho·∫∑c Brand kh√¥ng t·ªìn t·∫°i', 16,
                1); RETURN; END; -- Insert v√†o b·∫£ng products th·ª±c t·∫ø INSERT INTO
                products (product_name, list_price, category_id, brand_id,
                stock_quantity) SELECT product_name, list_price, @category_id,
                @brand_id, stock_quantity FROM inserted; PRINT 'ƒê√£ th√™m s·∫£n ph·∫©m
                m·ªõi qua view'; END; -- S·ª≠ d·ª•ng view nh∆∞ b·∫£ng th√¥ng th∆∞·ªùng INSERT
                INTO vw_product_summary (product_name, list_price,
                category_name, brand_name, stock_quantity) VALUES ('iPhone 16',
                25000000, 'Electronics', 'Apple', 100);
              </div>
            </div>

            <h3>üè¢ DDL Trigger</h3>
            <div class="example">
              <h4>Audit c√°c thay ƒë·ªïi schema:</h4>
              <div class="code-block">
                -- T·∫°o b·∫£ng log cho DDL events CREATE TABLE ddl_audit_log (
                event_id INT IDENTITY(1,1) PRIMARY KEY, event_type VARCHAR(100),
                object_name VARCHAR(200), object_type VARCHAR(100), sql_command
                NVARCHAR(MAX), event_time DATETIME2 DEFAULT GETDATE(),
                login_name VARCHAR(100), server_name VARCHAR(100) ); -- DDL
                Trigger cho database level CREATE TRIGGER trg_ddl_audit ON
                DATABASE -- √Åp d·ª•ng cho to√†n database FOR CREATE_TABLE,
                ALTER_TABLE, DROP_TABLE, CREATE_PROCEDURE, ALTER_PROCEDURE,
                DROP_PROCEDURE AS BEGIN SET NOCOUNT ON; DECLARE @event_data XML
                = EVENTDATA(); INSERT INTO ddl_audit_log ( event_type,
                object_name, object_type, sql_command, login_name, server_name )
                VALUES ( @event_data.value('(/EVENT_INSTANCE/EventType)[1]',
                'VARCHAR(100)'),
                @event_data.value('(/EVENT_INSTANCE/ObjectName)[1]',
                'VARCHAR(200)'),
                @event_data.value('(/EVENT_INSTANCE/ObjectType)[1]',
                'VARCHAR(100)'),
                @event_data.value('(/EVENT_INSTANCE/TSQLCommand)[1]',
                'NVARCHAR(MAX)'),
                @event_data.value('(/EVENT_INSTANCE/LoginName)[1]',
                'VARCHAR(100)'),
                @event_data.value('(/EVENT_INSTANCE/ServerName)[1]',
                'VARCHAR(100)') ); END; -- Test DDL trigger CREATE TABLE
                test_table (id INT); -- S·∫Ω ƒë∆∞·ª£c log DROP TABLE test_table; --
                C≈©ng s·∫Ω ƒë∆∞·ª£c log -- Xem audit log SELECT * FROM ddl_audit_log
                ORDER BY event_time DESC;
              </div>
            </div>

            <h3>üîß Qu·∫£n l√Ω Triggers</h3>

            <div class="example">
              <h4>Xem th√¥ng tin Triggers:</h4>
              <div class="code-block">
                -- Li·ªát k√™ t·∫•t c·∫£ DML triggers SELECT t.name AS trigger_name,
                OBJECT_NAME(t.parent_id) AS table_name, t.type_desc,
                t.is_disabled, t.is_instead_of_trigger, m.definition FROM
                sys.triggers t LEFT JOIN sys.sql_modules m ON t.object_id =
                m.object_id WHERE t.parent_class = 1 -- DML triggers ORDER BY
                table_name, trigger_name; -- Xem DDL triggers SELECT name AS
                trigger_name, type_desc, parent_class_desc, is_disabled,
                create_date, modify_date FROM sys.triggers WHERE parent_class =
                0 -- DDL triggers ORDER BY name; -- Xem trigger events SELECT
                t.name AS trigger_name, te.type_name AS event_type FROM
                sys.triggers t INNER JOIN sys.trigger_events te ON t.object_id =
                te.object_id ORDER BY t.name, te.type_name;
              </div>
            </div>

            <div class="example">
              <h4>Enable/Disable v√† Drop Triggers:</h4>
              <div class="code-block">
                -- Disable trigger DISABLE TRIGGER trg_update_stock ON
                order_items; -- Enable trigger ENABLE TRIGGER trg_update_stock
                ON order_items; -- Disable t·∫•t c·∫£ triggers tr√™n m·ªôt b·∫£ng DISABLE
                TRIGGER ALL ON products; -- Enable t·∫•t c·∫£ triggers tr√™n m·ªôt b·∫£ng
                ENABLE TRIGGER ALL ON products; -- S·ª≠a ƒë·ªïi trigger ALTER TRIGGER
                trg_update_stock ON order_items AFTER INSERT, UPDATE -- Th√™m
                UPDATE event AS BEGIN SET NOCOUNT ON; -- Logic m·ªõi... IF EXISTS
                (SELECT 1 FROM inserted) BEGIN UPDATE products SET
                stock_quantity = stock_quantity - i.quantity, updated_date =
                GETDATE() FROM products p INNER JOIN inserted i ON p.product_id
                = i.product_id; END; END; -- X√≥a trigger DROP TRIGGER IF EXISTS
                trg_update_stock; -- X√≥a DDL trigger DROP TRIGGER trg_ddl_audit
                ON DATABASE;
              </div>
            </div>

            <h3>‚ö° Performance v√† Best Practices</h3>

            <div class="success-box">
              <h4>‚úÖ N√™n l√†m:</h4>
              <ul>
                <li>
                  <b>SET NOCOUNT ON:</b> T·∫Øt row count messages ƒë·ªÉ tƒÉng
                  performance
                </li>
                <li>
                  <b>Keep triggers lightweight:</b> Logic ƒë∆°n gi·∫£n v√† nhanh
                </li>
                <li>
                  <b>Handle multiple rows:</b> Trigger ph·∫£i x·ª≠ l√Ω ƒë∆∞·ª£c nhi·ªÅu
                  rows c√πng l√∫c
                </li>
                <li>
                  <b>Use proper error handling:</b> TRY...CATCH cho triggers
                  ph·ª©c t·∫°p
                </li>
                <li><b>Test thoroughly:</b> Test v·ªõi bulk operations</li>
                <li><b>Document trigger logic:</b> Comment r√µ r√†ng m·ª•c ƒë√≠ch</li>
                <li>
                  <b>Use specific events:</b> Ch·ªâ trigger cho events c·∫ßn thi·∫øt
                </li>
              </ul>
            </div>

            <div class="info-box">
              <h4>‚ùå Tr√°nh:</h4>
              <ul>
                <li>
                  <b>Recursive triggers:</b> Trigger g·ªçi trigger kh√°c t·∫°o v√≤ng
                  l·∫∑p
                </li>
                <li>
                  <b>Heavy operations:</b> Complex queries, external calls
                </li>
                <li>
                  <b>User interaction:</b> PRINT, SELECT statements showing data
                  to user
                </li>
                <li><b>Assuming single row:</b> Lu√¥n x·ª≠ l√Ω nhi·ªÅu rows</li>
                <li>
                  <b>Trigger chains:</b> Qu√° nhi·ªÅu triggers ph·ª• thu·ªôc nhau
                </li>
                <li>
                  <b>Business logic in triggers:</b> N√™n ƒë·ªÉ trong stored
                  procedures
                </li>
                <li>
                  <b>Modifying same table:</b> C√≥ th·ªÉ g√¢y infinite recursion
                </li>
              </ul>
            </div>

            <h3>üéØ V√≠ d·ª• t·ªïng h·ª£p: H·ªá th·ªëng Audit ho√†n ch·ªânh</h3>
            <div class="example">
              <h4>Trigger audit universal cho m·ªçi b·∫£ng:</h4>
              <div class="code-block">
                -- B·∫£ng audit log chung CREATE TABLE audit_log ( audit_id BIGINT
                IDENTITY(1,1) PRIMARY KEY, table_name VARCHAR(100),
                operation_type VARCHAR(10), primary_key_value VARCHAR(100),
                old_values NVARCHAR(MAX), new_values NVARCHAR(MAX), changed_by
                VARCHAR(100), changed_date DATETIME2 DEFAULT GETDATE(),
                application_name VARCHAR(100) ); -- Function h·ªó tr·ª£ convert row
                th√†nh JSON string CREATE FUNCTION fn_row_to_json(@table_name
                VARCHAR(100), @row_data SQL_VARIANT) RETURNS NVARCHAR(MAX) AS
                BEGIN -- Simplified function - th·ª±c t·∫ø c·∫ßn implement JSON
                serialization RETURN N'{"data": "serialized_row_data"}'; END; --
                Trigger template cho audit (√°p d·ª•ng cho t·ª´ng b·∫£ng c·∫ßn audit)
                CREATE TRIGGER trg_audit_customers ON customers AFTER INSERT,
                UPDATE, DELETE AS BEGIN SET NOCOUNT ON; DECLARE @operation
                VARCHAR(10); DECLARE @table_name VARCHAR(100) = 'customers'; --
                X√°c ƒë·ªãnh lo·∫°i operation IF EXISTS (SELECT 1 FROM inserted) AND
                EXISTS (SELECT 1 FROM deleted) SET @operation = 'UPDATE'; ELSE
                IF EXISTS (SELECT 1 FROM inserted) SET @operation = 'INSERT';
                ELSE SET @operation = 'DELETE'; -- Log cho INSERT IF @operation
                = 'INSERT' BEGIN INSERT INTO audit_log (table_name,
                operation_type, primary_key_value, new_values, changed_by,
                application_name) SELECT @table_name, @operation,
                CAST(customer_id AS VARCHAR), (SELECT * FROM inserted i WHERE
                i.customer_id = inserted.customer_id FOR JSON AUTO),
                SUSER_NAME(), APP_NAME() FROM inserted; END; -- Log cho DELETE
                IF @operation = 'DELETE' BEGIN INSERT INTO audit_log
                (table_name, operation_type, primary_key_value, old_values,
                changed_by, application_name) SELECT @table_name, @operation,
                CAST(customer_id AS VARCHAR), (SELECT * FROM deleted d WHERE
                d.customer_id = deleted.customer_id FOR JSON AUTO),
                SUSER_NAME(), APP_NAME() FROM deleted; END; -- Log cho UPDATE IF
                @operation = 'UPDATE' BEGIN INSERT INTO audit_log (table_name,
                operation_type, primary_key_value, old_values, new_values,
                changed_by, application_name) SELECT @table_name, @operation,
                CAST(i.customer_id AS VARCHAR), (SELECT * FROM deleted d WHERE
                d.customer_id = i.customer_id FOR JSON AUTO), (SELECT * FROM
                inserted ins WHERE ins.customer_id = i.customer_id FOR JSON
                AUTO), SUSER_NAME(), APP_NAME() FROM inserted i INNER JOIN
                deleted d ON i.customer_id = d.customer_id; END; END; --
                Procedure ƒë·ªÉ generate audit trigger cho b·∫•t k·ª≥ b·∫£ng n√†o CREATE
                PROCEDURE sp_create_audit_trigger @table_name VARCHAR(100),
                @primary_key_column VARCHAR(100) AS BEGIN DECLARE @sql
                NVARCHAR(MAX); SET @sql = N' CREATE TRIGGER trg_audit_' +
                @table_name + N' ON ' + @table_name + N' AFTER INSERT, UPDATE,
                DELETE AS BEGIN SET NOCOUNT ON; -- Implementation similar to
                above template -- Customized for specific table and primary key
                END;'; EXEC sp_executesql @sql; PRINT 'Created audit trigger for
                table: ' + @table_name; END;
              </div>
            </div>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>Triggers</b> l√† c√¥ng c·ª• m·∫°nh m·∫Ω ƒë·ªÉ
                <b>t·ª± ƒë·ªông h√≥a v√† duy tr√¨ t√≠nh to√†n v·∫πn d·ªØ li·ªáu</b>:
              </p>
              <ul>
                <li><b>Automatic execution:</b> Ch·∫°y t·ª± ƒë·ªông khi c√≥ events</li>
                <li>
                  <b>Data integrity:</b> Enforce business rules v√† constraints
                </li>
                <li><b>Auditing:</b> Track changes v√† maintain history</li>
                <li><b>Complex logic:</b> Handle multi-table operations</li>
                <li>
                  <b>Performance consideration:</b> Must be lightweight v√†
                  efficient
                </li>
              </ul>
            </div>
          </section>

          <!-- 27 -->
          <section class="section" id="acid">
            <h2>27. ACID</h2>

            <div class="info-box">
              <h4>üèõÔ∏è ACID l√† g√¨?</h4>
              <p>
                <b>ACID</b> l√† m·ªôt t·∫≠p h·ª£p c√°c thu·ªôc t√≠nh ƒë·∫£m b·∫£o r·∫±ng c√°c giao
                d·ªãch trong c∆° s·ªü d·ªØ li·ªáu ƒë∆∞·ª£c x·ª≠ l√Ω m·ªôt c√°ch
                <b>ƒë√°ng tin c·∫≠y</b>. C√°c thu·ªôc t√≠nh n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ƒë·∫£m b·∫£o
                <b>t√≠nh to√†n v·∫πn c·ªßa d·ªØ li·ªáu</b> trong c√°c ho·∫°t ƒë·ªông tr√™n c∆° s·ªü
                d·ªØ li·ªáu.
              </p>
              <p>
                ACID l√† vi·∫øt t·∫Øt c·ªßa: <b>A</b>tomicity, <b>C</b>onsistency,
                <b>I</b>solation, <b>D</b>urability
              </p>
            </div>

            <h3>üíé B·ªën thu·ªôc t√≠nh c·ªßa ACID</h3>

            <h4>‚öõÔ∏è 1. Atomicity (T√≠nh nguy√™n t·ªë)</h4>
            <div class="example">
              <div class="highlight-box">
                <p>
                  <b>ƒê·ªãnh nghƒ©a:</b> Thu·ªôc t√≠nh n√†y ƒë·∫£m b·∫£o r·∫±ng m·ªôt giao d·ªãch
                  ƒë∆∞·ª£c coi l√† m·ªôt
                  <b>ƒë∆°n v·ªã c√¥ng vi·ªác duy nh·∫•t v√† kh√¥ng th·ªÉ chia c·∫Øt</b>.
                </p>
                <p>
                  <b>Nguy√™n t·∫Øc:</b> Ho·∫∑c t·∫•t c·∫£ c√°c c√¢u l·ªánh trong giao d·ªãch
                  ƒë·ªÅu ƒë∆∞·ª£c th·ª±c thi th√†nh c√¥ng, ho·∫∑c kh√¥ng c√≥ c√¢u l·ªánh n√†o ƒë∆∞·ª£c
                  th·ª±c thi.
                </p>
              </div>

              <h5>üéØ V√≠ d·ª• th·ª±c t·∫ø - Chuy·ªÉn ti·ªÅn:</h5>
              <div class="code-block">
                -- V√≠ d·ª• vi ph·∫°m Atomicity (KH√îNG n√™n l√†m) UPDATE accounts SET
                balance = balance - 1000000 WHERE account_id = 1; -- Tr·ª´ ti·ªÅn A
                -- N·∫øu l·ªói x·∫£y ra ·ªü ƒë√¢y, ch·ªâ c√≥ account 1 b·ªã tr·ª´ ti·ªÅn! UPDATE
                accounts SET balance = balance + 1000000 WHERE account_id = 2;
                -- C·ªông ti·ªÅn B -- V√≠ d·ª• tu√¢n th·ªß Atomicity (ƒê√öNG c√°ch) BEGIN
                TRANSACTION; UPDATE accounts SET balance = balance - 1000000
                WHERE account_id = 1; UPDATE accounts SET balance = balance +
                1000000 WHERE account_id = 2; -- N·∫øu c√≥ l·ªói b·∫•t k·ª≥, c·∫£ 2 l·ªánh
                ƒë·ªÅu b·ªã ROLLBACK COMMIT TRANSACTION;
              </div>

              <div class="success-box">
                <h5>‚úÖ Atomicity ƒë·∫£m b·∫£o:</h5>
                <ul>
                  <li>
                    N·∫øu c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh th·ª±c thi, to√†n b·ªô giao
                    d·ªãch s·∫Ω b·ªã h·ªßy b·ªè
                  </li>
                  <li>
                    C∆° s·ªü d·ªØ li·ªáu s·∫Ω quay tr·ªü l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu tr∆∞·ªõc khi
                    giao d·ªãch b·∫Øt ƒë·∫ßu
                  </li>
                  <li>
                    Kh√¥ng c√≥ tr·∫°ng th√°i "n·ª≠a ch·ª´ng" ho·∫∑c "kh√¥ng ho√†n ch·ªânh"
                  </li>
                  <li>All-or-nothing principle: T·∫•t c·∫£ ho·∫∑c kh√¥ng g√¨ c·∫£</li>
                </ul>
              </div>
            </div>

            <h4>‚öñÔ∏è 2. Consistency (T√≠nh nh·∫•t qu√°n)</h4>
            <div class="example">
              <div class="highlight-box">
                <p>
                  <b>ƒê·ªãnh nghƒ©a:</b> T√≠nh nh·∫•t qu√°n ƒë·∫£m b·∫£o r·∫±ng m·ªôt giao d·ªãch
                  s·∫Ω ƒë∆∞a c∆° s·ªü d·ªØ li·ªáu t·ª´ m·ªôt
                  <b>tr·∫°ng th√°i h·ª£p l·ªá (consistent)</b> n√†y sang m·ªôt
                  <b>tr·∫°ng th√°i h·ª£p l·ªá kh√°c</b>.
                </p>
                <p>
                  <b>Nguy√™n t·∫Øc:</b> C√°c quy t·∫Øc to√†n v·∫πn c·ªßa c∆° s·ªü d·ªØ li·ªáu (nh∆∞
                  r√†ng bu·ªôc, trigger) ph·∫£i ƒë∆∞·ª£c tu√¢n th·ªß sau khi giao d·ªãch ho√†n
                  th√†nh.
                </p>
              </div>

              <h5>üéØ V√≠ d·ª• th·ª±c t·∫ø - R√†ng bu·ªôc t·ªïng ti·ªÅn:</h5>
              <div class="code-block">
                -- Gi·∫£ s·ª≠ c√≥ constraint: T·ªïng ti·ªÅn trong t·∫•t c·∫£ accounts >= 0 --
                Tr∆∞·ªõc giao d·ªãch: Account A (2M) + Account B (3M) = 5M total
                BEGIN TRANSACTION; -- Th·ª≠ chuy·ªÉn 3M t·ª´ A sang B (nh∆∞ng A ch·ªâ c√≥
                2M) UPDATE accounts SET balance = balance - 3000000 WHERE
                account_id = 1; -- A: -1M (Vi ph·∫°m constraint!) UPDATE accounts
                SET balance = balance + 3000000 WHERE account_id = 2; -- B: 6M
                -- Transaction s·∫Ω b·ªã ROLLBACK v√¨ vi ph·∫°m constraint -- Database
                s·∫Ω gi·ªØ nguy√™n tr·∫°ng th√°i nh·∫•t qu√°n ban ƒë·∫ßu COMMIT TRANSACTION;
                -- S·∫Ω fail
              </div>

              <h5>üèóÔ∏è C√°c lo·∫°i r√†ng bu·ªôc ƒë·∫£m b·∫£o Consistency:</h5>
              <div class="code-block">
                -- 1. CHECK Constraints ALTER TABLE accounts ADD CONSTRAINT
                chk_positive_balance CHECK (balance >= 0); -- 2. FOREIGN KEY
                Constraints ALTER TABLE orders ADD CONSTRAINT fk_customer
                FOREIGN KEY (customer_id) REFERENCES customers(customer_id); --
                3. UNIQUE Constraints ALTER TABLE customers ADD CONSTRAINT
                uk_email UNIQUE (email); -- 4. Business Rules via Triggers
                CREATE TRIGGER trg_check_stock_consistency ON order_items AFTER
                INSERT AS BEGIN IF EXISTS ( SELECT 1 FROM products p INNER JOIN
                inserted i ON p.product_id = i.product_id WHERE p.stock_quantity
                < 0 ) BEGIN RAISERROR('Stock kh√¥ng th·ªÉ √¢m', 16, 1); ROLLBACK
                TRANSACTION; END; END;
              </div>

              <div class="success-box">
                <h5>‚úÖ Consistency ƒë·∫£m b·∫£o:</h5>
                <ul>
                  <li>
                    D·ªØ li·ªáu lu√¥n tu√¢n th·ªß c√°c business rules v√† constraints
                  </li>
                  <li>
                    Kh√¥ng c√≥ d·ªØ li·ªáu "invalid" sau khi transaction ho√†n th√†nh
                  </li>
                  <li>Referential integrity ƒë∆∞·ª£c duy tr√¨</li>
                  <li>Domain constraints v√† check constraints ƒë∆∞·ª£c enforce</li>
                </ul>
              </div>
            </div>

            <h4>üîí 3. Isolation (T√≠nh c√¥ l·∫≠p)</h4>
            <div class="example">
              <div class="highlight-box">
                <p>
                  <b>ƒê·ªãnh nghƒ©a:</b> Thu·ªôc t√≠nh n√†y ƒë·∫£m b·∫£o r·∫±ng c√°c giao d·ªãch
                  ƒë·ªìng th·ªùi <b>kh√¥ng can thi·ªáp v√†o nhau</b>. C√°c thay ƒë·ªïi ƒë∆∞·ª£c
                  th·ª±c hi·ªán b·ªüi m·ªôt giao d·ªãch ch∆∞a ho√†n th√†nh s·∫Ω kh√¥ng th·ªÉ nh√¨n
                  th·∫•y ƒë∆∞·ª£c b·ªüi c√°c giao d·ªãch kh√°c cho ƒë·∫øn khi giao d·ªãch ƒë√≥ ƒë∆∞·ª£c
                  cam k·∫øt (commit).
                </p>
                <p>
                  <b>M·ª•c ti√™u:</b> NgƒÉn ch·∫∑n c√°c v·∫•n ƒë·ªÅ nh∆∞ ƒë·ªçc d·ªØ li·ªáu "b·∫©n"
                  (dirty reads) ho·∫∑c d·ªØ li·ªáu "l·∫∑p l·∫°i kh√¥ng nh·∫•t qu√°n"
                  (non-repeatable reads).
                </p>
              </div>

              <h5>üéØ V√≠ d·ª• v·∫•n ƒë·ªÅ khi thi·∫øu Isolation:</h5>
              <div class="code-block">
                -- Scenario: 2 transactions ch·∫°y ƒë·ªìng th·ªùi -- Transaction 1
                (T1): BEGIN TRANSACTION; UPDATE accounts SET balance = balance +
                1000000 WHERE account_id = 1; -- Ch∆∞a COMMIT, nh∆∞ng T2 c√≥ th·ªÉ
                ƒë·ªçc ƒë∆∞·ª£c gi√° tr·ªã n√†y kh√¥ng? WAITFOR DELAY '00:00:10'; -- Delay
                10 gi√¢y ROLLBACK TRANSACTION; -- Cu·ªëi c√πng ROLLBACK! --
                Transaction 2 (T2) - ch·∫°y ƒë·ªìng th·ªùi: BEGIN TRANSACTION; SELECT
                balance FROM accounts WHERE account_id = 1; -- ƒê·ªçc ƒë∆∞·ª£c g√¨? --
                N·∫øu ƒë·ªçc ƒë∆∞·ª£c gi√° tr·ªã ƒë√£ update c·ªßa T1 -> DIRTY READ! -- N·∫øu T1
                rollback th√¨ T2 ƒë√£ ƒë·ªçc d·ªØ li·ªáu "phantom" COMMIT TRANSACTION;
              </div>

              <h5>üéöÔ∏è Isolation Levels trong SQL Server:</h5>
              <table>
                <thead>
                  <tr>
                    <th>Isolation Level</th>
                    <th>Dirty Read</th>
                    <th>Non-Repeatable Read</th>
                    <th>Phantom Read</th>
                    <th>M√¥ t·∫£</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><b>READ UNCOMMITTED</b></td>
                    <td>‚ùå C√≥</td>
                    <td>‚ùå C√≥</td>
                    <td>‚ùå C√≥</td>
                    <td>ƒê·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu ch∆∞a commit</td>
                  </tr>
                  <tr>
                    <td><b>READ COMMITTED</b> (default)</td>
                    <td>‚úÖ Kh√¥ng</td>
                    <td>‚ùå C√≥</td>
                    <td>‚ùå C√≥</td>
                    <td>Ch·ªâ ƒë·ªçc d·ªØ li·ªáu ƒë√£ commit</td>
                  </tr>
                  <tr>
                    <td><b>REPEATABLE READ</b></td>
                    <td>‚úÖ Kh√¥ng</td>
                    <td>‚úÖ Kh√¥ng</td>
                    <td>‚ùå C√≥</td>
                    <td>ƒê·ªçc l·∫∑p l·∫°i cho k·∫øt qu·∫£ gi·ªëng nhau</td>
                  </tr>
                  <tr>
                    <td><b>SERIALIZABLE</b></td>
                    <td>‚úÖ Kh√¥ng</td>
                    <td>‚úÖ Kh√¥ng</td>
                    <td>‚úÖ Kh√¥ng</td>
                    <td>C√¥ l·∫≠p ho√†n to√†n, nh∆∞ ch·∫°y tu·∫ßn t·ª±</td>
                  </tr>
                </tbody>
              </table>

              <div class="code-block">
                -- V√≠ d·ª• thi·∫øt l·∫≠p Isolation Level SET TRANSACTION ISOLATION
                LEVEL SERIALIZABLE; BEGIN TRANSACTION; SELECT * FROM accounts
                WHERE account_id = 1; -- C√°c transactions kh√°c kh√¥ng th·ªÉ modify
                account_id = 1 WAITFOR DELAY '00:00:05'; SELECT * FROM accounts
                WHERE account_id = 1; -- K·∫øt qu·∫£ gi·ªëng l·∫ßn ƒë·ªçc ƒë·∫ßu COMMIT
                TRANSACTION;
              </div>

              <div class="success-box">
                <h5>‚úÖ Isolation ƒë·∫£m b·∫£o:</h5>
                <ul>
                  <li>Transactions kh√¥ng th·∫•y incomplete changes c·ªßa nhau</li>
                  <li>ƒê·ªçc d·ªØ li·ªáu consistent trong su·ªët transaction</li>
                  <li>
                    NgƒÉn ch·∫∑n dirty reads, non-repeatable reads, phantom reads
                  </li>
                  <li>
                    Transactions nh∆∞ th·ªÉ ch·∫°y tu·∫ßn t·ª± (t√πy isolation level)
                  </li>
                </ul>
              </div>
            </div>

            <h4>üíæ 4. Durability (T√≠nh b·ªÅn v·ªØng)</h4>
            <div class="example">
              <div class="highlight-box">
                <p>
                  <b>ƒê·ªãnh nghƒ©a:</b> T√≠nh b·ªÅn v·ªØng ƒë·∫£m b·∫£o r·∫±ng khi m·ªôt giao
                  d·ªãch ƒë√£ ƒë∆∞·ª£c cam k·∫øt (commit), c√°c thay ƒë·ªïi c·ªßa n√≥ s·∫Ω
                  <b>t·ªìn t·∫°i vƒ©nh vi·ªÖn</b> trong c∆° s·ªü d·ªØ li·ªáu, ngay c·∫£ trong
                  tr∆∞·ªùng h·ª£p h·ªá th·ªëng b·ªã l·ªói.
                </p>
                <p>
                  <b>Nguy√™n t·∫Øc:</b> C√°c thay ƒë·ªïi n√†y ƒë∆∞·ª£c l∆∞u tr·ªØ trong b·ªô nh·ªõ
                  ·ªïn ƒë·ªãnh (nh∆∞ ·ªï ƒëƒ©a) ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng b·ªã m·∫•t.
                </p>
              </div>

              <h5>üéØ V√≠ d·ª• th·ª±c t·∫ø - ƒê·∫∑t h√†ng online:</h5>
              <div class="code-block">
                -- Kh√°ch h√†ng ƒë·∫∑t h√†ng v√† thanh to√°n th√†nh c√¥ng BEGIN
                TRANSACTION; INSERT INTO orders (customer_id, total_amount,
                status) VALUES (123, 2500000, 'paid'); INSERT INTO order_items
                (order_id, product_id, quantity, price) VALUES
                (SCOPE_IDENTITY(), 456, 2, 1250000); UPDATE products SET
                stock_quantity = stock_quantity - 2 WHERE product_id = 456;
                COMMIT TRANSACTION; -- ‚úÖ Sau khi COMMIT th√†nh c√¥ng -- Ngay c·∫£
                khi: -- - Server b·ªã restart -- - M·∫•t ƒëi·ªán -- - Disk failure (n·∫øu
                c√≥ backup/replication) -- - Application crash -- -- ƒê∆°n h√†ng v·∫´n
                t·ªìn t·∫°i v√† kh√¥ng b·ªã m·∫•t!
              </div>

              <h5>üõ°Ô∏è C√°c c∆° ch·∫ø ƒë·∫£m b·∫£o Durability:</h5>
              <div class="info-box">
                <h6>1. Transaction Log (WAL - Write-Ahead Logging):</h6>
                <ul>
                  <li>
                    M·ªçi thay ƒë·ªïi ƒë∆∞·ª£c ghi v√†o transaction log tr∆∞·ªõc khi commit
                  </li>
                  <li>
                    Log ƒë∆∞·ª£c flush to disk tr∆∞·ªõc khi transaction ƒë∆∞·ª£c coi l√†
                    committed
                  </li>
                  <li>
                    Recovery s·ª≠ d·ª•ng log ƒë·ªÉ replay transactions sau system
                    failure
                  </li>
                </ul>

                <h6>2. Checkpoint Process:</h6>
                <ul>
                  <li>ƒê·ªãnh k·ª≥ flush dirty pages t·ª´ memory xu·ªëng disk</li>
                  <li>ƒê·∫£m b·∫£o committed data ƒë∆∞·ª£c persisted</li>
                  <li>Gi·∫£m th·ªùi gian recovery khi restart</li>
                </ul>

                <h6>3. Backup v√† Recovery:</h6>
                <ul>
                  <li>
                    Full backups, differential backups, transaction log backups
                  </li>
                  <li>Point-in-time recovery capabilities</li>
                  <li>High Availability solutions (Always On, Mirroring)</li>
                </ul>
              </div>

              <div class="code-block">
                -- Ki·ªÉm tra transaction log v√† checkpoint -- Xem th√¥ng tin
                transaction log SELECT name AS database_name,
                log_reuse_wait_desc, recovery_model_desc FROM sys.databases; --
                Force checkpoint (admin only) CHECKPOINT; -- Backup transaction
                log ƒë·ªÉ ƒë·∫£m b·∫£o durability BACKUP LOG YourDatabase TO DISK =
                'C:\Backup\YourDatabase_Log.trn';
              </div>

              <div class="success-box">
                <h5>‚úÖ Durability ƒë·∫£m b·∫£o:</h5>
                <ul>
                  <li>Committed transactions survive system failures</li>
                  <li>Data ƒë∆∞·ª£c l∆∞u tr·ªØ persistent storage (disk)</li>
                  <li>Recovery mechanisms c√≥ th·ªÉ restore committed state</li>
                  <li>No data loss cho completed transactions</li>
                </ul>
              </div>
            </div>

            <h3>üèóÔ∏è ACID trong th·ª±c t·∫ø</h3>

            <h4>üí≥ V√≠ d·ª• t·ªïng h·ª£p: H·ªá th·ªëng thanh to√°n</h4>
            <div class="example">
              <div class="code-block">
                -- Stored Procedure minh h·ªça ƒë·∫ßy ƒë·ªß ACID properties CREATE
                PROCEDURE sp_process_payment @customer_id INT, @order_id INT,
                @payment_amount DECIMAL(15,2), @payment_method VARCHAR(50) AS
                BEGIN SET NOCOUNT ON; -- ISOLATION: Set appropriate isolation
                level SET TRANSACTION ISOLATION LEVEL SERIALIZABLE; BEGIN TRY --
                ATOMICITY: Begin transaction BEGIN TRANSACTION; DECLARE
                @customer_balance DECIMAL(15,2); DECLARE @order_total
                DECIMAL(15,2); -- CONSISTENCY: Validate business rules SELECT
                @customer_balance = account_balance FROM customers WHERE
                customer_id = @customer_id; SELECT @order_total = total_amount
                FROM orders WHERE order_id = @order_id AND status = 'pending';
                -- Check constraints (CONSISTENCY) IF @customer_balance IS NULL
                BEGIN RAISERROR('Customer kh√¥ng t·ªìn t·∫°i', 16, 1); RETURN; END;
                IF @order_total IS NULL BEGIN RAISERROR('Order kh√¥ng h·ª£p l·ªá ho·∫∑c
                ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω', 16, 1); RETURN; END; IF @payment_amount !=
                @order_total BEGIN RAISERROR('S·ªë ti·ªÅn thanh to√°n kh√¥ng kh·ªõp v·ªõi
                t·ªïng ƒë∆°n h√†ng', 16, 1); RETURN; END; IF @customer_balance <
                @payment_amount BEGIN RAISERROR('S·ªë d∆∞ kh√¥ng ƒë·ªß', 16, 1);
                RETURN; END; -- ATOMICITY: All operations must succeed together
                -- Tr·ª´ ti·ªÅn t·ª´ t√†i kho·∫£n kh√°ch h√†ng UPDATE customers SET
                account_balance = account_balance - @payment_amount,
                updated_date = GETDATE() WHERE customer_id = @customer_id; --
                C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng UPDATE orders SET status = 'paid',
                payment_date = GETDATE(), payment_method = @payment_method,
                updated_date = GETDATE() WHERE order_id = @order_id; -- Ghi log
                giao d·ªãch INSERT INTO payment_log ( customer_id, order_id,
                amount, payment_method, payment_time, status ) VALUES (
                @customer_id, @order_id, @payment_amount, @payment_method,
                GETDATE(), 'completed' ); -- C·∫≠p nh·∫≠t inventory UPDATE products
                SET stock_quantity = stock_quantity - oi.quantity, updated_date
                = GETDATE() FROM products p INNER JOIN order_items oi ON
                p.product_id = oi.product_id WHERE oi.order_id = @order_id; --
                ATOMICITY & DURABILITY: Commit all changes COMMIT TRANSACTION;
                PRINT 'Payment processed successfully'; PRINT 'Order ID: ' +
                CAST(@order_id AS VARCHAR); PRINT 'Amount: ' +
                FORMAT(@payment_amount, 'N0') + ' VND'; END TRY BEGIN CATCH --
                ATOMICITY: Rollback on any error IF @@TRANCOUNT > 0 ROLLBACK
                TRANSACTION; -- Log error (separate transaction for DURABILITY)
                DECLARE @error_msg VARCHAR(2000) = ERROR_MESSAGE(); BEGIN TRY
                INSERT INTO error_log ( procedure_name, error_message,
                error_time, parameters ) VALUES ( 'sp_process_payment',
                @error_msg, GETDATE(), 'customer_id=' + CAST(@customer_id AS
                VARCHAR) + ', order_id=' + CAST(@order_id AS VARCHAR) + ',
                amount=' + CAST(@payment_amount AS VARCHAR) ); END TRY BEGIN
                CATCH -- If logging fails, at least print the error PRINT 'Error
                logging failed: ' + ERROR_MESSAGE(); END CATCH; -- Re-throw the
                original error THROW; END CATCH; END; -- Test procedure EXEC
                sp_process_payment @customer_id = 1, @order_id = 100,
                @payment_amount = 2500000, @payment_method = 'credit_card';
              </div>
            </div>

            <h3>üîç Ki·ªÉm tra ACID Compliance</h3>
            <div class="example">
              <h4>Tools v√† queries ƒë·ªÉ verify ACID properties:</h4>
              <div class="code-block">
                -- 1. Ki·ªÉm tra Transaction isolation SELECT session_id,
                transaction_isolation_level, CASE transaction_isolation_level
                WHEN 0 THEN 'Unspecified' WHEN 1 THEN 'ReadUncommitted' WHEN 2
                THEN 'ReadCommitted' WHEN 3 THEN 'RepeatableRead' WHEN 4 THEN
                'Serializable' WHEN 5 THEN 'Snapshot' END AS
                isolation_level_name FROM sys.dm_exec_sessions WHERE
                is_user_process = 1; -- 2. Ki·ªÉm tra active transactions SELECT
                s.session_id, t.name AS transaction_name,
                t.transaction_begin_time, t.transaction_type,
                t.transaction_state, CASE t.transaction_state WHEN 0 THEN
                'Uninitialized' WHEN 1 THEN 'Not started' WHEN 2 THEN 'Active'
                WHEN 3 THEN 'Ended (read-only)' WHEN 4 THEN 'Commit initiated'
                WHEN 5 THEN 'Prepared' WHEN 6 THEN 'Committed' WHEN 7 THEN
                'Rolling back' WHEN 8 THEN 'Rolled back' END AS
                transaction_state_desc FROM sys.dm_tran_session_transactions s
                INNER JOIN sys.dm_tran_active_transactions t ON s.transaction_id
                = t.transaction_id; -- 3. Ki·ªÉm tra locks (Isolation) SELECT
                resource_type, resource_database_id,
                resource_associated_entity_id, resource_lock_partition,
                request_mode, request_type, request_status, request_session_id
                FROM sys.dm_tran_locks WHERE resource_database_id = DB_ID(); --
                4. Ki·ªÉm tra log space usage (Durability) DBCC LOGINFO; -- 5.
                Check constraint violations (Consistency) -- T√¨m foreign key
                violations SELECT fk.name AS foreign_key_name, tp.name AS
                parent_table, tr.name AS referenced_table FROM sys.foreign_keys
                fk INNER JOIN sys.tables tp ON fk.parent_object_id =
                tp.object_id INNER JOIN sys.tables tr ON fk.referenced_object_id
                = tr.object_id;
              </div>
            </div>

            <h3>‚ö° ACID Performance Trade-offs</h3>
            <div class="info-box">
              <h4>‚öñÔ∏è C√¢n b·∫±ng gi·ªØa ACID v√† Performance:</h4>
              <table>
                <thead>
                  <tr>
                    <th>ACID Property</th>
                    <th>Performance Impact</th>
                    <th>Optimization Strategies</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><b>Atomicity</b></td>
                    <td>Transaction overhead, log writes</td>
                    <td>Batch operations, minimize transaction scope</td>
                  </tr>
                  <tr>
                    <td><b>Consistency</b></td>
                    <td>Constraint checking, trigger execution</td>
                    <td>Efficient indexes, optimized constraints</td>
                  </tr>
                  <tr>
                    <td><b>Isolation</b></td>
                    <td>Locking, blocking, deadlocks</td>
                    <td>Lower isolation levels, read committed snapshot</td>
                  </tr>
                  <tr>
                    <td><b>Durability</b></td>
                    <td>Disk I/O, log flushes</td>
                    <td>Fast storage, delayed durability (carefully)</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="success-box">
              <h4>üí° Best Practices cho ACID:</h4>
              <ul>
                <li><b>Keep transactions short:</b> Minimize lock time</li>
                <li>
                  <b>Use appropriate isolation levels:</b> Balance consistency
                  vs performance
                </li>
                <li>
                  <b>Design efficient constraints:</b> Fast validation rules
                </li>
                <li><b>Monitor transaction log:</b> Ensure adequate space</li>
                <li><b>Regular backups:</b> Protect durability</li>
                <li>
                  <b>Test failure scenarios:</b> Verify recovery procedures
                </li>
              </ul>
            </div>

            <div class="highlight-box">
              <h4>üéØ K·∫øt lu·∫≠n:</h4>
              <p>
                <b>ACID Properties</b> l√† n·ªÅn t·∫£ng c·ªßa
                <b>database reliability v√† data integrity</b>:
              </p>
              <ul>
                <li><b>Atomicity:</b> All-or-nothing transactions</li>
                <li><b>Consistency:</b> Valid data states v√† business rules</li>
                <li><b>Isolation:</b> Concurrent transaction separation</li>
                <li>
                  <b>Durability:</b> Permanent storage c·ªßa committed changes
                </li>
              </ul>
              <p>
                Hi·ªÉu v√† √°p d·ª•ng ƒë√∫ng ACID gi√∫p x√¢y d·ª±ng
                <b>h·ªá th·ªëng database ƒë√°ng tin c·∫≠y</b> cho c√°c ·ª©ng d·ª•ng critical.
              </p>
            </div>
          </section>

          <!-- VIDEO -->
          <section class="section" id="video-tricks">
            <h2>üé¨ M·∫πo & Video</h2>
            <p><em>ƒêang c·∫≠p nh·∫≠t‚Ä¶</em></p>
          </section>
        </main>
      </div>
    </div>

    <button class="back-to-top" id="backTop" aria-label="L√™n ƒë·∫ßu trang">
      ‚Üë
    </button>

    <script>
      // Tabs
      const tabButtons = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");
      tabButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          tabButtons.forEach((b) => b.classList.remove("active"));
          tabContents.forEach((c) => c.classList.remove("active"));
          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");
        });
      });

      // TOC click -> show section
      const sections = document.querySelectorAll(".section");
      function showSection(id) {
        sections.forEach((s) => s.classList.remove("active"));
        const el = document.getElementById(id);
        if (el) {
          el.classList.add("active");
          document
            .querySelector(".content-area")
            .scrollTo({ top: 0, behavior: "smooth" });
        }
        document
          .querySelectorAll(".toc-item")
          .forEach((i) => i.classList.remove("active"));
        const item = document.querySelector(`.toc-item[data-target="${id}"]`);
        if (item) item.classList.add("active");
      }
      document.querySelectorAll(".toc-item").forEach((item) => {
        item.addEventListener("click", () => showSection(item.dataset.target));
      });

      // Search filter for TOC
      const searchBox = document.getElementById("searchBox");
      searchBox.addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase();
        document.querySelectorAll(".toc-item").forEach((item) => {
          item.style.display = item.textContent.toLowerCase().includes(q)
            ? ""
            : "none";
        });
      });

      // Back to top
      const backBtn = document.getElementById("backTop");
      window.addEventListener("scroll", () => {
        backBtn.style.display = window.scrollY > 200 ? "block" : "none";
      });
      backBtn.addEventListener("click", () =>
        window.scrollTo({ top: 0, behavior: "smooth" })
      );
    </script>
  </body>
</html>
